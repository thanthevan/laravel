function _autoload(){$.each(ACC,function(section,obj){$.isArray(obj._autoload)&&$.each(obj._autoload,function(key,value){$.isArray(value)?value[1]?ACC[section][value[0]]():value[2]&&ACC[section][value[2]]():ACC[section][value]()})})}var screenXs="480px",screenSm="640px",screenMd="1024px",screenLg="1240px",screenXsMin="480px",screenSmMin="640px",screenMdMin="1024px",screenLgMin="1240px",screenXsMax="639px",screenSmMax="1023px",screenMdMax="1239px";ACC.requests={_autoload:["getFullAddress","requestRefreshAfterTimeout",["requestGoogleApis",$(".g-plusone").length>0],["requestYoutubeIframeApi",$("#brandReputationPlayer").length>0],["requestRecentViewedProducts",$(".recent-viewed-products").length>0]],timeout:250,fullAddressRequest:$.Deferred(),googleApisRequest:$.Deferred(),vinidRequest:$.Deferred(),usermetaRequest:$.Deferred(),youtubeRequest:$.Deferred(),recentViewedProducts:$.Deferred(),getCurrentAddress:function(){return $.get("/deliveryzone/getcurrentaddress")},getFullAddress:function(){var res;if(res=$.Deferred(),ACC.config.loadFullAddress){$.get("/deliveryzone/getFullAddress").done(function(locationData){var all=[],pr=[],di=[],wa=[];_.each(locationData,function(p){var city={i:p.id,n:p.name,t:"p"};pr.push(city),all.push(city),_.each(p.children,function(d){var district={i:d.id,n:d.name,t:"d",p:p.id};di.push(district),all.push(district),_.each(d.children,function(w){var ward={i:w.id,n:w.name,t:"w",p:p.id,d:d.id};wa.push(ward),all.push(ward)})})}),res.resolve(all),ACC.requests.fullAddressRequest.resolve(all)})}else _.isUndefined(locationDataMin)||(res.resolve(locationDataMin),ACC.requests.fullAddressRequest.resolve(locationDataMin));return res},getLocalCache:function(name,value){if(void 0!==window.localStorage){var storage,result;return storage=window.localStorage,result=storage.getItem(name),!result&&void 0!==value&&value&&ACC.requests.setLocalCache(name,JSON.stringify(value)),result}},setLocalCache:function(name,value){if(void 0!==window.localStorage){var storage;return storage=window.localStorage,storage.setItem(name,JSON.stringify(value)),storage.getItem(name)}},location:{province:function(provinceEl,focus){ACC.requests.fullAddressRequest.done(function(addresses){var provinceLList=_.where(addresses,{t:"p"});ACC.selectize.renderListFull(provinceEl,provinceLList,focus)})},district:function(districtEl,provinceCode,focus){ACC.requests.fullAddressRequest.done(function(addresses){var districtList=_.where(addresses,{t:"d",p:provinceCode});ACC.selectize.renderListFull(districtEl,districtList,focus)})},ward:function(wardEl,provinceCode,districtCode,focus){_.isEmpty(provinceCode)||_.isEmpty(districtCode)||ACC.requests.fullAddressRequest.done(function(addresses){var wardList=_.where(addresses,{t:"w",p:provinceCode,d:districtCode});ACC.selectize.renderListFull(wardEl,wardList,focus)})},baseProvince:function(provinceEl,districtEl,wardEl){ACC.requests.fullAddressRequest.done(function(addresses){var provinceCode=ACC.selectize.get(provinceEl),districtList=_.where(addresses,{t:"d",p:provinceCode}),wardList=_.where(addresses,{t:"w",p:provinceCode,d:districtList[0].i});ACC.selectize.renderListFull(districtEl,districtList,0),ACC.selectize.set(districtEl,districtList[0].i,"silent"),ACC.selectize.unblock(districtEl),ACC.selectize.renderListFull(wardEl,wardList,0),ACC.selectize.set(wardEl,wardList[0].i,"silent"),ACC.selectize.unblock(wardEl)})},set:function(provinceEl,districtEl,wardEl,locationData){_.isEmpty(locationData)&&(locationData={},_.defaults(locationData,{province:"",district:"",ward:""}));var provinceSelect,districtSelect,wardSelect;provinceSelect=$(provinceEl).selectize(),districtSelect=$(districtEl).selectize(),wardSelect=$(wardEl).selectize(),provinceSelect[0].selectize.on("option_add",function(value){_.isEmpty(locationData.province)||parseInt(value)===parseInt(locationData.province)&&(ACC.selectize.set(provinceEl,locationData.province,"silent"),ACC.requests.location.district(districtEl,locationData.province))}),districtSelect[0].selectize.on("option_add",function(value){_.isEmpty(locationData.district)||parseInt(value)===parseInt(locationData.district)&&(ACC.selectize.set(districtEl,locationData.district,"silent"),ACC.requests.location.ward(wardEl,locationData.province,locationData.district))}),wardSelect[0].selectize.on("option_add",function(value){_.isEmpty(locationData.ward)||parseInt(value)===parseInt(locationData.ward)&&ACC.selectize.set(wardEl,locationData.ward,"silent")})}},triggerComboLocation:function(provinceEl,districtEl,wardEl,streetEl,locationData,loadFirstValue){_.isEmpty(locationData)&&(locationData={},_.defaults(locationData,{province:"",district:"",ward:"",street:""})),$(provinceEl).length>0&&$(districtEl).length>0&&$(wardEl).length>0&&(ACC.selectize.block(districtEl),ACC.selectize.block(wardEl),ACC.requests.location.set(provinceEl,districtEl,wardEl,locationData),ACC.requests.location.province(provinceEl),_.isEmpty(locationData.province)||(ACC.requests.location.district(districtEl,locationData.province),ACC.selectize.unblock(districtEl)),_.isEmpty(locationData.province)||_.isEmpty(locationData.district)||(ACC.requests.location.ward(wardEl,locationData.province,locationData.district),ACC.selectize.unblock(wardEl)),$(document).on("change",provinceEl,function(){if(ACC.selectize.block(districtEl),ACC.selectize.block(wardEl),ACC.selectize.off(districtEl,"option_add"),ACC.selectize.off(wardEl,"option_add"),_.isEmpty(ACC.selectize.get(provinceEl)))return ACC.selectize.unset(districtEl),void ACC.selectize.unset(wardEl);ACC.selectize.clear(districtEl),ACC.selectize.clear(wardEl),ACC.selectize.unblock(districtEl),ACC.requests.location.district(districtEl,ACC.selectize.get(provinceEl),1),void 0!==loadFirstValue&&Boolean(Number(loadFirstValue))&&ACC.requests.location.baseProvince(provinceEl,districtEl,wardEl)}),$(document).on("change",districtEl,function(){if(ACC.selectize.block(wardEl),_.isEmpty(ACC.selectize.get(districtEl)))return void ACC.selectize.unset(wardEl);ACC.selectize.clear(wardEl),ACC.selectize.unblock(wardEl),ACC.requests.location.ward(wardEl,ACC.selectize.get(provinceEl),ACC.selectize.get(districtEl),1),void 0!==loadFirstValue&&Boolean(Number(loadFirstValue))&&ACC.requests.fullAddressRequest.done(function(addresses){var wardList=_.where(addresses,{t:"w",p:ACC.selectize.get(provinceEl),d:ACC.selectize.get(districtEl)});_.isEmpty(wardList)||(ACC.selectize.renderListFull(wardEl,wardList,1),ACC.selectize.set(wardEl,wardList[0].i,"silent"),ACC.selectize.unblock(wardEl))})}))},debounce:function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}},deliveryZone:{request:function(url,dataString){return $.ajax({url:url,type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:dataString,success:function(response){"success"===response&&ACC.delivery.pageType}})},byStreet:function(streetString){var dataString,url;return dataString="street="+streetString,url="/deliveryzone/setdeliveryzonebystreet",ACC.requests.deliveryZone.request(url,dataString)},byDefault:function(province,district,ward){var dataString,url;return dataString="province="+province+"&district="+district+"&ward="+ward,url="/deliveryzone/setdeliveryzone",ACC.requests.deliveryZone.request(url,dataString)}},searchPattern:function(keyword){if(void 0!==keyword)return keyword=$.trim(keyword),keyword=keyword.replace(/\s\s+/g," "),!(keyword.length<1)&&(keyword=$.trim(keyword.replace(/[&\/\\#,.;!$~%"*?<>{}]/gi," ").replace(/\s+/g," ")))},getUrlParameter:function(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return null===results?"":decodeURIComponent(results[1].replace(/\+/g," "))},getParameterFromScheme:function(name,scheme){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(scheme);return null===results?"":decodeURIComponent(results[1].replace(/\+/g," "))},removeUrlParam:function(key,sourceURL){var rtn=sourceURL.split("?")[0],params_arr=[],queryString=-1!==sourceURL.indexOf("?")?sourceURL.split("?")[1]:"";if(""!==queryString){params_arr=queryString.split("&");for(var i=params_arr.length-1;i>=0;i-=1)params_arr[i].split("=")[0]===key&&params_arr.splice(i,1);rtn=rtn+"?"+params_arr.join("&")}return rtn},requestLocationText:function(province,district,ward){var res=$.Deferred();return ACC.requests.fullAddressRequest.done(function(addresses){var locationString="",provinceObj=_.find(addresses,function(l){return l.i===province&&"p"===l.t}),districtOb=_.find(addresses,function(l){return l.i===district&&"d"===l.t}),wardObj=_.find(addresses,function(l){return l.i===ward&&"w"===l.t});locationString+=_.isEmpty(wardObj)?"":wardObj.n+", ",locationString+=_.isEmpty(districtOb)?"":districtOb.n+", ",locationString+=_.isEmpty(provinceObj)?"":provinceObj.n+". ",res.resolve(locationString)}),res},requestLocationPlainText:function(province,district,ward){var res=$.Deferred(),locationString="";return locationString+=_.isEmpty(ward)?"":ward+", ",locationString+=_.isEmpty(district)?"":district+", ",locationString+=_.isEmpty(province)?"":province+". ",res.resolve(locationString),res},requestVinidInfo:function(){var res;return res=$.Deferred(),"resolved"!==ACC.requests.vinidRequest.state()?(res=$.ajax({method:"get",url:"/vinid/info",dataType:"json",timeout:40*ACC.requests.timeout}),res.fail(function(data){ACC.requests.vinidRequest.resolve(data),ACC.template.userInfo.points.desktop(data),ACC.template.userInfo.points.mobile(data),_.isEmpty(data.email)||ACC.login.updateUserEmail(data.email)}),res.done(function(data){ACC.requests.vinidRequest.resolve(data),ACC.template.userInfo.points.desktop(data),ACC.template.userInfo.points.mobile(data),_.isEmpty(data.email)||ACC.login.updateUserEmail(data.email)})):ACC.requests.vinidRequest.done(function(data){res.resolve(data)}),res},requestUserMeta:function(){var res;return res=$.Deferred(),"resolved"!==ACC.requests.usermetaRequest.state()?(res=$.ajax({method:"get",url:"/login/usermeta",dataType:"json",timeout:20*ACC.requests.timeout}),res.fail(function(data){ACC.requests.usermetaRequest.resolve(data)}),res.done(function(data){ACC.requests.usermetaRequest.resolve(data),ACC.template.userInfo.giftcode(data)})):ACC.requests.usermetaRequest.done(function(data){res.resolve(data)}),res},requestGoogleApis:function(){if("resolved"!==ACC.requests.googleApisRequest.state()){var renderPlusOne;renderPlusOne=_.debounce(function(){$.getScript("//apis.google.com/js/platform.js",function(){ACC.requests.googleApisRequest.resolve(!0),ACC.requests.googleApisRequest.done(function(){$(".product-detail__share").length>0&&gapi.plusone.render("widget-div"),$(window).off("scroll",renderPlusOne)})})},ACC.requests.timeout),$(window).scroll(renderPlusOne)}},requestCategoryTree:function(url,currentCode){var loadCats=function(url,currentCode){var $container,catid,tLi,tUl,reqData,reqcats;$container=$("#js-categoryFacetLayer"),url=_.isUndefined(url)?$container.attr("data-categoryFacetResultUrl"):url,currentCode=_.isUndefined(currentCode)?$container.attr("data-current-code"):currentCode,catid=_.uniqueId("categoryMenu_"),tLi=_.template('<li class="category-item category-item_lv<%= catlv %>  <%= catclass %>" data-pc="<%= catpc %>" data-code="<%= catcode %>"><a href="<%= caturl %>"><%= catlbl %></a></li>'),tUl=_.template("<ul id='<%= catid %>' class='<%= catclass %>' <%= uldata %>><%= catchildren %></ul>"),$container.append(tUl({catid:catid,catclass:"category-menu",catchildren:"",uldata:'data-cat-root="true"'})),reqData={url:url,method:"get",dataType:"json",beforeSend:function(){$container.block()}},reqcats=$.ajax(reqData),reqcats.fail(function(){$container.addClass("hidden")}).always(function(){$container.unblock()}).done(function(cats){if(!_.isEmpty(cats)){var sortCats=_.sortBy(_.groupBy(cats,function(c){return parseInt(c.lv)}),function(n){return parseInt(n.lv)});_.each(sortCats,function(groups,gi){var lvMarkup="";_.each(groups,function(cat,ci){var catData={catlv:cat.lv,catclass:"",catcode:cat.code,catpc:cat.pc,caturl:cat.url,catlbl:cat.lbl};if(1===cat.lv)$("#"+catid).append(tLi(catData));else{var gg=sortCats[gi];2===cat.lv&&(catData.catclass=" category-tree "),lvMarkup+=tLi(catData),gg.length-1===ci&&$('li[data-code="'+cat.pc+'"]').append(tUl({catid:"childCategoryLv"+cat.lv,catclass:"category-menu",uldata:_.template('data-cat-parent="<%= parentcode %>"')({parentcode:cat.pc}),catchildren:lvMarkup}))}})});var $currCat=$("#"+catid).find('li[data-code="'+currentCode+'"]');$currCat.addClass("selected active"),$currCat.parents(".category-item_lv2").addClass("has-arrow"),$container.removeClass("hidden")}})};$(document).ready(_.debounce(function(){loadCats(url,currentCode)},ACC.requests.timeout/5))},requestProductGroup:function(currentPageNumber,componentId){var req,res;if(res=!1,void 0!==componentId){var productGroup=ACC.productGroup[componentId];if(_.isUndefined(productGroup)||_.isEmpty(productGroup.data)||_.isUndefined(currentPageNumber))return res;productGroup.data.currentPage=currentPageNumber;var pgform={currentPage:productGroup.data.currentPage,maxSize:productGroup.data.maxSize,componentId:productGroup.data.componentId,groupId:productGroup.data.groupId,merchantCode:productGroup.data.merchantCode,brandCode:productGroup.data.brandCode};return req=$.ajax({url:ACC.config.encodedContextPath+productGroup.target.url+"/results",type:"POST",data:JSON.stringify(pgform),dataType:"json",cache:!0,contentType:"application/json; charset=utf-8"}),req.done(function(data){var $productGroupContainer=$("#productGroupContainer"+componentId),defaultImage={imgLoaderSrc:data.defaultImage.url,imgSrc:data.defaultImage.url,imgAlt:data.defaultImage.altText,imgTitle:data.defaultImage.description,imgBigSrc:""},pItemHtml="";pItemHtml+=ACC.template.productGroup.item(data.products,defaultImage,data.superSaleImage,data.giftImage),$productGroupContainer.html(pItemHtml)}),req}},requestYoutubeIframeApi:function(){if("undefined"!=typeof homeVideosList&&!_.isEmpty(homeVideosList)){var parsingVideo=function(url){var regExp=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/,match=url.match(regExp);return!(!match||11!=match[7].length)&&match[7]},videoList=[];_.each(homeVideosList,function(url){var videoId=parsingVideo(url);videoList.push(videoId)});var playerContainer,player=window.player;playerContainer="brandReputationPlayer",window.curVideoIndex=0,window.nextVideoIndex=1,window.onYouTubeIframeAPIReady=function(){player=new YT.Player(playerContainer,{height:"390",width:"640",videoId:videoList[curVideoIndex],events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})},window.onPlayerReady=function(event){player.cueVideoById(videoList[curVideoIndex],0,"large"),$(window).scroll(function(){var hT=$("#"+playerContainer).offset().top,hH=$("#"+playerContainer).outerHeight(),wH=$(window).height(),wS=$(this).scrollTop();wS>hT+hH-wH&&hT>wS&&wS+wH>hT+hH||player.pauseVideo()})},window.done=!1,window.onPlayerStateChange=function(event){nextVideoIndex===videoList.length&&(done=!0),event.data!=YT.PlayerState.ENDED||done||(player.loadVideoById(videoList[nextVideoIndex],0,"large"),curVideoIndex++,nextVideoIndex++)},window.stopVideo=function(){player.stopVideo()},$.getScript("https://www.youtube.com/iframe_api")}},requestRecentViewedProducts:function(dom){if("resolved"!==ACC.requests.recentViewedProducts.state()){var req=$.get("/rvproducts");dom=void 0===dom?".recent-viewed-products":dom,req.done(function(res){_.isElement($(dom)[0])&&($(dom).append(res),ACC.carousel.bindCarousel()),ACC.requests.recentViewedProducts.resolve(res)})}},requestRefreshAfterTimeout:function(){$(window).load(function(){window.IDLE_TIMEOUT=300,window._idleSecondsCounter=0,document.onclick=function(){_idleSecondsCounter=0},document.onmousemove=function(){_idleSecondsCounter=0},document.onkeypress=function(){_idleSecondsCounter=0},window.CheckIdleTime=function(){++_idleSecondsCounter>=IDLE_TIMEOUT&&window.location.reload()},window.setInterval(window.CheckIdleTime,6e4)})},topup:{getOffers:function(reqObj){var reqObj=reqObj||{};_.defaults(reqObj,{url:"/napthe/variants/",method:"get",dataType:"json",data:{}});var res=$.Deferred();return $.ajax(reqObj).done(function(data){res.resolve(data)}),res}}},ACC.template={userInfo:{points:{desktop:function(res){$("#userVinPoints .highlight-color").html(_.template("&nbsp;<%=points%><%=currency%>")({points:res.totalPoint||0,currency:ACC.config.currency}))},mobile:function(res){var vinIdTpMobile=_.template('<li class="auto liUserSign"><a class="userSign" href="'+ACC.config.profileUrl+'"><img src="<%= userIcon %>" title="" alt="" /><%= userName %><div class="user-point"><%= pointText %> <span class="text-point"><%= points %><%= currency %></span><span class="adr-icon chevron-right"></span></div></a><a href="<%= logoutUrl %>" type="button" class="js-close-mobile btn"><%= logoutText %></a></li>');$(".js-sticky-user-group").html(vinIdTpMobile({userIcon:ACC.config.themeResourcePath+"/images/user-left-menu.png",userName:ACC.userInfo.name,pointText:ACC.message.sumVinPointTextMobile,points:_.isNull(res.totalPoint)?0:res.totalPoint,currency:ACC.config.currency,logoutUrl:ACC.config.logoutUrl,logoutText:ACC.message.logoutText}))}},giftcode:function(res){if(!_.isUndefined(res)){$("#userGiftCode .highlight-color").html(res.totalGiftCode);$('.list-group-item [href="/my-account/gift-codes"]').append(_.template('<span style="<%= styleMobile %>"><%= totalGiftCode %></span>')({totalGiftCode:res.totalGiftCode,styleMobile:"border-radius: 100%;background: red;color: #fff;min-width: 20px;min-height: 20px;display: inline-block; margin-left: 5px; line-height: 20px; text-align: center;"}))}}},productGroup:{item:function(productsList,defaultImage,superSaleImage,giftImage){var pTp,variantInfoHtml,mainImageHtml,extraImageHtml,rewardHtml,priceHtml,pItemHtml,saleImageUrl;return saleImageUrl=ACC.config.themeResourcePath+"/images/icons/sale-tag.png",pTp=_.template('<div class="col-xs-6 col-sm-4 col-md-3 col-lg-2-5 product-item__wrapper product-item__wrapper--hover"> <div class="product-item__placeholder hidden-sm hidden-xs"></div> <div class="product-item <%= hasVariantClass %>"> <%= verticalVariantInfoHtml %><div class="product-item__container"> <a class="product-item__thumbnail " href="<%= productUrl %>"> <%= mainImageHtml %> <%= extraImageHtml %> </a> <%= horizVariantInfoHtml %><div class="product-item__info"> <a class="product-item__info-title" href="<%= productUrl %>"> <%= productName %> </a> <%= productPriceHtml %> <div class="product-item__info-vinid"> <%= rewardHtml %> </div> </div> </div> </div> </div>'),variantInfoHtml=_.template('<% if(product.multidimensional && !_.isNull(product.firstCategoryNameList)){ %> <div class="<%= variantsClass %>"> <div class="<%= variantsClass %>-container"> <% _.each(product.firstCategoryNameList, function(cat,loop){ %> <% if(loop.index <= variantNumber){ %> <% var variableClass = "product-item__variable-text" %> <% var totalVariants = _.size(product.firstCategoryNameList) - variantNumber - 1; %> <% if(cat.showImage){ %> <% variableClass = "product-item__variable-image"; %> <% } %> <a href="<%= product.url %><%= cat.variantCode %>?offer=<%= product.code %>" class="<%= variableClass %>"> <% if(cat.showImage){ %> <img class="img-responsive" alt="<%= cat.categoryName %>" src="<%= cat.image %>" /> <% } else { %> <%= cat.categoryName %> <% } %> <% if(loop.index === variantNumber && totalVariants > 0){ %> <div class="variant__mask"> <div class="vertical-alignment-helper"> <div class="vertical-align-center"> + <%= totalVariants %> </div> </div> </div> <% } %> </a> <% } %> <% }); %> </div> </div> <% } %> '),mainImageHtml=_.template('<% var imgBigSrc = imgBigSrc || imgSrc;%><img class="img-item-product-group swiper-lazy" src="<%= imgBigSrc %>" alt="<%= imgAlt %>" title="<% imgTitle %>" data-default-image="<%= imgSrc %>" data-original="<%= imgBigSrc %>" data-src="<%= imgBigSrc %>" style="display: inline;">'),extraImageHtml=_.template('<% if (!_.isNull(product.productStopperLeft) && typeof product.productStopperLeft.url !== "undefined") { %><img class="product-item__overlay product-item__overlay-sale-hot stopper-left" alt="" src="<%= product.productStopperLeft.url %>"><% } %><% if (!_.isNull(product.productStopperRight) && typeof product.productStopperRight.url !== "undefined") { %><img class="product-item__overlay product-item__overlay-sale-hot stopper-right" alt="" src="<%= product.productStopperRight.url %>"><%} else { %><% if (product.supperPromotion) { %><img class="product-item__overlay product-item__overlay-sale-hot supper-sale" src="<%= saleImgUrl %>" alt="" title=""><% } %><% } %><% if (!_.isNull(product.productStopperBottom) && typeof product.productStopperBottom.url !== "undefined") { %><img class="product-item__overlay product-item__overlay-sale-hot stopper-bottom" alt="" src="<%= product.productStopperBottom.url %>"><% } %><% if (!_.isEmpty(product.potentialPromotions)) { %><% if (!_.isNull(giftImage)) { %><img class="product-item__overlay product-item__overlay-cart-rule" alt="<%= giftImage.altText %>" src="<%= giftImage.url %>"><% } else { %><div class="product-item__overlay product-item__overlay-cart-rule"></div><% }} %>'),rewardHtml=_.template("<%= rewardRateMessage %>"),priceHtml=_.template('<div class="product-item__info-price"><span class="product-item__info-price-sale"><%= product.price.formattedValue %></span><% if(!product.supperPromotion  && product.offerDiscount > 0){if(isVoucher && (product.price.value < product.offerPrice.value)){ %><span class="product-item__info-price-original"><%= product.offerPrice.formattedValue %></span><%\t} %><span class="product-item__info-price-original"><%= product.rrp.formattedValue %></span><%  } %></div><% if(!product.supperPromotion && product.offerDiscount > 0){ %><div class="product-item__info-discount"><%= product.offerDiscount %>&#37;</div><% } %>'),_.defaults(defaultImage,{imgLoaderSrc:ACC.config.themeResourcePath+"/images/product-240x240.png",imgSrc:"",imgAlt:"ADR",imgTitle:"ADR",imgBigSrc:""}),_.defaults(superSaleImage,{url:saleImageUrl}),_.isUndefined(giftImage)&&(giftImage=null),pItemHtml="",_.each(productsList,function(product){var hasVariantClass=product.multidimensional&&!_.isNull(product.firstCategoryNameList)?"pgi-have__variant":"",mainImgObj={};!_.isNull(product.images)&&product.images.length>0?(mainImgObj.imgLoaderSrc=ACC.config.themeResourcePath+"/images/icons/AjaxLoader.gif",mainImgObj.imgSrc=product.images[0].url,mainImgObj.imgBigSrc=product.images[0].url):mainImgObj=defaultImage,mainImgObj.imgAlt=product.name,mainImgObj.imgTitle=product.name,pItemHtml+=pTp({productUrl:product.url+"?offer="+product.code,hasVariantClass:hasVariantClass,verticalVariantInfoHtml:variantInfoHtml({variantsClass:"product-item__variables-vertical hidden",product:product,variantNumber:3}),horizVariantInfoHtml:variantInfoHtml({variantsClass:"product-item__variables-horizontal",product:product,variantNumber:3}),mainImageHtml:mainImageHtml(mainImgObj),extraImageHtml:extraImageHtml({product:product,saleImgUrl:_.isEmpty(superSaleImage.url)||_.isUndefined(superSaleImage.url)?saleImageUrl:superSaleImage.url,giftImage:giftImage}),productName:product.name,productPriceHtml:priceHtml({product:product,isVoucher:!1}),rewardHtml:rewardHtml({rewardRateMessage:product.currentOffer.rewardRatePLPMessage})})}),pItemHtml}},pagination:function(pageObj,componentId,dom){var paginationHtml;if(void 0!==componentId)return _.isObject(pageObj)||(pageObj={},_.defaults(pageObj,{currentPage:0,numberOfPages:0,numberPagesShown:0,componentId:componentId})),paginationHtml=_.template('<% var isEnd, isBegin, hasPreviousPage, hasNextPage, limit, previousIndex, nextIndex; %><% var firstPageLabel = firstPageLabel || "&nbsp;Trang đầu";%><% var lastPageLabel =  lastPageLabel || "Trang cuối&nbsp;";%><% isBegin = currentPage <= 0; %><% isEnd = currentPage + 1 >= numberOfPages; %><% hasPreviousPage = currentPage > 0; %><% hasNextPage = currentPage + 1 < numberOfPages; %><% currentPage = parseInt(currentPage); %><% numberOfPages = parseInt(numberOfPages); %><% endPageIndex = parseInt(numberOfPages) - 1; %><% previousIndex = currentPage - 1; %><% nextIndex = currentPage + 1; %><% previousIndex = previousIndex >= 0 ? previousIndex : -69; %><% nextIndex = nextIndex < numberOfPages ? nextIndex : -69;  %><% limit = parseInt(numberPagesShown); %><% halfLimit = Math.floor(limit/2); %><% if(numberOfPages > 1){ %><section class="section__pagination text-center"><nav class="Page navigation"><ul class="pagination hidden-xs js-ajax-pagination"><% var searchPageFirstClass = "", prevClass = ""; %><% if(previousIndex === -69){ prevClass += " disabled"; } %><% if(isBegin){ searchPageFirstClass += " disabled"; } %><li class="first-page <%= searchPageFirstClass %>"><a href="javascript:void(0);" data-current-page-number="0"  data-component-id="<%= componentId %>"><i class="adr-icon icon-arrow-left-sm"></i><%= firstPageLabel %></a></li><li class="prev-page <%= prevClass %>"><a href="javascript:void(0);" data-current-page-number="<%= previousIndex %>"  data-component-id="<%= componentId %>"><i class="adr-icon icon-arrow-left-sm"></i></a></li><% var beginPage = 1; %><% var endPage = numberOfPages; %><% if(limit < numberOfPages){endPage = limit;if((currentPage + 1) % limit === 0){beginPage = currentPage + 1;endPage = currentPage + limit;}else{if((currentPage + 1) > limit){beginPage = (currentPage + 1) - ((currentPage + 1 ) % limit);endPage = beginPage - 1 + limit;}}if((currentPage + 1 === numberOfPages) || endPage > numberOfPages){beginPage = numberOfPages + 1 - limit;endPage = numberOfPages;}}%><% for(var i = beginPage; i <= endPage; i++){ %><% var activeClass = ""; %><% var pageRequest = i - 1; %><% if(pageRequest === currentPage){ %><% activeClass = "active"; %><% } %><li class="<%= activeClass %>"><a href="javascript:void(0);" data-current-page-number="<%= pageRequest %>" data-component-id="<%= componentId %>"><%= i %></a></li><% } %><% var searchPageEndClass = "", nextClass = ""; %><% if(nextIndex === -69){ nextClass += " disabled"; } %><% if(isEnd){ searchPageEndClass += " disabled"; } %><li class="next-page <%= nextClass %>"><a href="javascript:void(0);" data-current-page-number="<%= nextIndex %>"  data-component-id="<%= componentId %>"><i class="adr-icon icon-arrow-right-sm"></i></a></li><li class="end-page <%= searchPageEndClass %>"><a href="javascript:void(0);" data-current-page-number="<%= endPageIndex %>"  data-component-id="<%= componentId %>"><%= lastPageLabel %><i class="adr-icon icon-arrow-right-sm"></i></a></li></ul><div class="clearfix visible-xs"></div></nav></section><% } %>'),_.isElement($(dom)[0])&&$(dom).html(paginationHtml(pageObj)),paginationHtml(pageObj)},topup:{offer:function(offer){return _.defaults(offer,{type:"BUYCARD",min:"",max:"",available:"",offer:"",code:"",label:"",provider:"",price:"",quantity:1,active:"",onsite:!0}),_.template('<div class="col-xs-4 col-sm-4 col-md-2-5 col-lg-2-5"><a href="javascript:void(0);" data-type="<%= type %>" data-offer="<%= offer %>" data-provider="<%= provider %>" data-code="<%= code %>" data-min="<%= min %>" data-max="<%= max %>" data-available="<%= available %>" data-price="<%= price %>" data-quantity="<%= quantity %>" data-onsite="<%= onsite %>" class="mobile-charge__price-item <%= active %>"><%= label %></a></div>')(offer)},offerQuantity:function(offerQuantity){return _.defaults(offerQuantity,{minOrderQty:1,maxOrderQty:999,availableToSell:9999}),_.template('<% var qtyMinus = 1; %><% var maxDisplayItems = 10; %><% var minOrderQty = parseInt(minOrderQty) || 1; %><% var maxOrderQty = parseInt(maxOrderQty) || 999; %><% var maxQty = parseInt(maxQty) || 999999; %><% var displayItems = maxDisplayItems - 1; %><% var haveExtraInput = true; %><%if((maxOrderQty - minOrderQty + 1) <= maxDisplayItems ){displayItems = maxOrderQty - minOrderQty;haveExtraInput = false;}%><% var availableToSell = availableToSell || 9999; %><% var aval = availableToSell; %><%if(aval > (minOrderQty + displayItems)){aval = minOrderQty + displayItems;}%><%if(availableToSell > aval && haveExtraInput){haveExtraInput = true;}else{haveExtraInput = false;}%><% var extraInputNumber = minOrderQty + displayItems;%><% var currentQuantity = currentQuantity || 1; %><div class="product-order__quanity js-qty-selector js-product-order__quanity"><div class="product-order__form-control pdpAddtoCartSelectSection adr-dropdown" id="pdpAddtoCartSelectSection"><select name="pdpAddtoCartSelect" id="pdpAddtoCartSelect" class="product-order__quanity-select form-control"><% for(var i = minOrderQty; i<=aval;i++)    { %><% var selected =\' \'; %><% if(currentQuantity == i){selected = \' selected \';} %><option value="<%= i %>" <%= selected %> ><%= i %></option><% } %><% if (haveExtraInput){ %><option value="pdpAddtoCartInput"><%= extraInputNumber %>+</option><% } %></select></div><% if(haveExtraInput){ %><div class="product-order__form-control pdpAddtoCartInputSection" id="pdpAddtoCartInputSection" style="display: none;"><div class="qty-selector input-group js-qty-selector"><input type="number" step="1" maxlength="6" class="form-control js-qty-selector-input product-order__quanity-input" size="1"value="<%= extraInputNumber %>" data-default-value="<%= extraInputNumber %>"data-max="1000" data-min="1" name="pdpAddtoCartInput" id="pdpAddtoCartInput" min="1"/></div></div><% } %></div>')(offerQuantity)}}},ACC.selectize={_autoload:[["initSelectize",$(".js-selectize").length>0]],check:function(el){var stt=!1;return void 0!==el&&$(el).length>0&&void 0!==$(el)[0].selectize&&(stt=!0),stt},init:function(el){if(void 0!==el&&$(el).length>0){if(void 0!==$(el)[0].selectize)return;var placeholder=$(this).attr("placeholder");$(el).selectize({placeholder:placeholder,onInitialize:function(){this.$input.hasClass("disabled")&&this.$control.addClass("is-lock")}})}},block:function(el){if(ACC.selectize.check(el)){$(el)[0].selectize.disable()}},unblock:function(el){if(ACC.selectize.check(el)){$(el)[0].selectize.enable()}},unlock:function(el){if(ACC.selectize.check(el)){$(el)[0].selectize.$control.removeClass("is-lock")}},clear:function(el){if(ACC.selectize.check(el)){$(el)[0].selectize.clearOptions()}},destroy:function(el){if(ACC.selectize.check(el)){$(el)[0].selectize.destroy()}},render:function(el,value,text,triggerDropdown,current){return void 0!==current&&value===current?'<option selected value="'+value+'">'+text+"</option>":'<option value="'+value+'">'+text+"</option>"},renderList:function(el,data,triggerDropdown,current){var length,markup;if(markup="",length=data.length,!(void 0===el||$(el).length<1||null===data||length<1)){ACC.selectize.clear(el);for(var i=0;i<length;i++)markup+=ACC.selectize.render(el,data[i].code,data[i].name,triggerDropdown,current);$(el).html(markup),ACC.selectize.reinit(el,triggerDropdown);$(el).append('<option class="hidden" value="" selected disabled></option>')}},renderListFull:function(el,data,focus){for(var selectize=$(el)[0].selectize,i=0;i<data.length;i++)selectize.addOption({value:data[i].i,text:data[i].n});focus=_.isUndefined(focus)?0:focus,selectize.refreshOptions(focus)},renderStreetsList:function(el,data,triggerDropdown,current){var length,markup;if(markup="",length=data.length,!(void 0===el||null===data||data.length<1)){ACC.selectize.clear(el);for(var i=0;i<length;i++){var d=data[i].split(";");markup+=ACC.selectize.render(el,d[0],d[1],triggerDropdown,current)}$(el).html(markup),ACC.selectize.reinit(el,triggerDropdown);$(el).append('<option class="hidden" value="" selected disabled></option>')}},reinit:function(el,triggerDropdown){if(ACC.selectize.check(el)){var s=$(el)[0].selectize;$(el).find("option").each(function(){s.addOption({value:$(this).val(),text:$(this).text()
})}),void 0===triggerDropdown&&(triggerDropdown=0),s.refreshOptions(triggerDropdown)}},get:function(el){if(ACC.selectize.check(el)){return $(el)[0].selectize.getValue()}},set:function(el,val,silent){if(ACC.selectize.check(el)){var s=$(el)[0].selectize;$(el).val(val),void 0!==val&&""!==val&&(void 0!==silent?s.setValue(val,silent):s.setValue(val))}},unset:function(el,silent){if(ACC.selectize.check(el)){var s=$(el)[0].selectize;void 0===silent&&(silent="silent"),s.clear(silent)}},off:function(el,event){if(ACC.selectize.check(el)){var s=$(el)[0].selectize;_.isUndefined(event)||s.off(event)}},focus:function(el){if(ACC.selectize.check(el)){$(el)[0].selectize.focus()}},setTextbox:function(el,text,val,silent){if(ACC.selectize.check(el)){var s=$(el)[0].selectize;$(el).val(val),void 0!==$(el)[0].selectize&&(s.setTextbox(text),s.setValue(val,silent))}},delaySet:function(el,val,silent){setTimeout(function(){ACC.selectize.set(el,val,silent)},ACC.requests.timeout)},initSelectize:function(){ACC.selectize.init(".js-selectize")}},ACC.address={_autoload:["bindToChangeAddressButton","bindCreateUpdateAddressForm","bindSuggestedDeliveryAddresses","bindCountrySpecificAddressForms","showAddressFormButtonPanel","bindViewAddressBook","bindToColorboxClose","showRemoveAddressFromBookConfirmation","showChangeAddressConfirmation","backToListAddresses","init"],spinner:$("<img src='"+ACC.config.commonResourcePath+"/images/spinner.gif' />"),addressID:"",init:function(){$(document).on("click","#acc_address_add",function(e){e.preventDefault(),ACC.address.addAddress()}),$(document).on("click","#acc_address_add_form_show",function(e){e.preventDefault(),$("#acc_address_add_form").toggle(),$(".address-editing-form-container").remove()}),$(document).on("click",".btn-remove-address-book",function(e){var addressID;addressID=$(this).attr("data-address-id"),ACC.address.openRemoveAddressModal(addressID)}),$(document).on("click",".btn-remove-address",function(e){var addressID=$(this).attr("data-address-id");ACC.address.deleteAddress(addressID)}),$(document).on("click",".close-profile-update-form",function(e){$(this).parent(this).slideUp()}),$(document).on("click",".btn-update-address-book",function(e){e.preventDefault(),$(".address-editing-form-container").slideDown()}),$(document).on("change",".js-1click-change-status",function(e){var flag="";"none"==$(".js-1click-change-status-off").css("display")?flag=!0:"none"==$(".js-1click-change-status-on").css("display")&&(flag=!1),ACC.address.update1ClickCheckout(flag)}),$(document).on("blur","#vatCompanyTaxCode",function(e){$(this).val($(this).val().trim())}),$(document).on("blur","#vatCompanyName",function(e){$(this).val($(this).val().trim())}),$(document).on("blur","#vatAddress",function(e){$(this).val($(this).val().trim())}),"undefined"!=typeof updatedAddressFlag&&updatedAddressFlag&&$("#modal-cpp-success-update-info").modal("show"),void 0!==$("#isAddressAdded")&&"true"==$("#isAddressAdded").val()&&$("#modal-cpp-success-add-info").modal("show")},handleChangeAddressButtonClick:function(){return ACC.address.addressID=$(this).data("address")?$(this).data("address"):"",$("#summaryDeliveryAddressFormContainer").show(),$("#summaryOverlayViewAddressBook").show(),$("#summaryDeliveryAddressBook").hide(),$.getJSON(getDeliveryAddressesUrl,ACC.address.handleAddressDataLoad),!1},handleAddressDataLoad:function(data){ACC.address.setupDeliveryAddressPopupForm(data),$.colorbox.open({inline:!0,href:"#summaryDeliveryAddressOverlay",overlayClose:!1,onOpen:function(){var $domDefaultAddress=$("#defaultAddress");ACC.address.emptyAddressForm(),$(document).on("change","#saveAddress",function(){var saveAddressChecked=$(this).prop("checked");$domDefaultAddress.prop("disabled",!saveAddressChecked),saveAddressChecked||$domDefaultAddress.prop("checked",!1)})}})},setupDeliveryAddressPopupForm:function(data){var $domSumDeliveryAddressBook=$("#summaryDeliveryAddressBook");$domSumDeliveryAddressBook.html($("#deliveryAddressesTemplate").tmpl({addresses:data})),$domSumDeliveryAddressBook.find("button.use_address").click(ACC.address.handleSelectExistingAddressClick),$domSumDeliveryAddressBook.find("button.edit").click(ACC.address.handleEditAddressClick),$domSumDeliveryAddressBook.find("button.default").click(ACC.address.handleDefaultAddressClick)},emptyAddressForm:function(){var options={url:getDeliveryAddressFormUrl,data:{addressId:ACC.address.addressID,createUpdateStatus:""},type:"GET",success:function(data){$("#summaryDeliveryAddressFormContainer").html(data),ACC.address.bindCreateUpdateAddressForm()}};$.ajax(options)},handleSelectExistingAddressClick:function(){var addressId=$(this).attr("data-address");return $.postJSON(setDeliveryAddressUrl,{addressId:addressId},ACC.address.handleSelectExitingAddressSuccess),!1},handleEditAddressClick:function(){$("#summaryDeliveryAddressFormContainer").show(),$("#summaryOverlayViewAddressBook").show(),$("#summaryDeliveryAddressBook").hide();var addressId=$(this).attr("data-address"),options={url:getDeliveryAddressFormUrl,data:{addressId:addressId,createUpdateStatus:""},target:"#summaryDeliveryAddressFormContainer",type:"GET",success:function(data){ACC.address.bindCreateUpdateAddressForm(),ACC.colorbox.resize()},error:function(xht,textStatus,ex){alert("Failed to update cart. Error details ["+xht+", "+textStatus+", "+ex+"]")}};return $(this).ajaxSubmit(options),!1},handleDefaultAddressClick:function(){var addressId=$(this).attr("data-address"),options={url:setDefaultAddressUrl,data:{addressId:addressId},type:"GET",success:function(data){ACC.address.setupDeliveryAddressPopupForm(data)},error:function(xht,textStatus,ex){alert("Failed to update address book. Error details ["+xht+", "+textStatus+", "+ex+"]")}};return $(this).ajaxSubmit(options),!1},handleSelectExitingAddressSuccess:function(data){null!=data?(ACC.refresh.refreshPage(data),ACC.colorbox.close()):alert("Failed to set delivery address")},bindCreateUpdateAddressForm:function(){$(".create_update_address_form").each(function(){var options={type:"POST",beforeSubmit:function(){$("#checkout_delivery_address").block({message:ACC.address.spinner})},success:function(data){$("#summaryDeliveryAddressFormContainer").html(data);var status=$(".create_update_address_id").attr("status");null!=status&&"success"===status.toLowerCase()?(ACC.refresh.getCheckoutCartDataAndRefreshPage(),ACC.colorbox.close()):(ACC.address.bindCreateUpdateAddressForm(),ACC.colorbox.resize())},error:function(xht,textStatus,ex){alert("Failed to update cart. Error details ["+xht+", "+textStatus+", "+ex+"]")},complete:function(){$("#checkout_delivery_address").unblock()}};$(this).ajaxForm(options)})},refreshDeliveryAddressSection:function(data){$(".summaryDeliveryAddress").replaceWith($("#deliveryAddressSummaryTemplate").tmpl(data))},bindSuggestedDeliveryAddresses:function(){var status=$(".add_edit_delivery_address_id").attr("status");null!=status&&"hasSuggestedAddresses"==status&&ACC.address.showSuggestedAddressesPopup()},showSuggestedAddressesPopup:function(){ACC.colorbox.open("",{href:"#popup_suggested_delivery_addresses",inline:!0,overlayClose:!1,width:525})},bindDistrictByProvince:function(addressId){var tagId="#address-province_"+addressId,targetTag="#address-district_"+addressId;ACC.address.bindDistrictsByProvince($(tagId+" option:selected"),$(targetTag))},bindWardByDistrict:function(addressId){var tagId="#address-district_"+addressId,targetTag="#address-ward_"+addressId;ACC.address.bindDistrictsByProvince($(tagId+" option:selected"),$(targetTag))},bindStreetByWard:function(addressId){var tagId="#address-ward_"+addressId,targetTag="#address-street_"+addressId;ACC.address.bindDistrictsByProvince($(tagId+" option:selected"),$(targetTag))},openRemoveAddressModal:function(addressID,target){void 0===addressID&&(addressID=$(this).attr("data-address-id")),void 0===target&&(target="#modal-cpp-remove-address"),$(target).modal("show"),$(target).on("shown.bs.modal",function(){$(target).find(".btn-remove-address").attr("data-address-id",addressID)})},deleteAddress:function(addressId){var tagItem="#acc_address_item_"+addressId;$.ajax({url:ACC.config.encodedContextPath+"/my-account/delete-address/"+addressId,async:!0,type:"POST",dataType:"JSON"}).done(function(response){$(tagItem).remove(),"success"==response&&$("#modal-cpp-remove-address").modal("hide")})},addAddress:function(){e.preventDefault();var element=this;$.ajax({url:"/Home/SaveDetailedInfo",type:"POST",data:JSON.stringify({Options:someData}),dataType:"json",traditional:!0,contentType:"application/json; charset=utf-8",success:function(response){"success"==response?$(element).closest("form").submit():alert("Error occurs on the Database level!")},error:function(){alert("An error has occured!!!")}})},bindCountrySpecificAddressForms:function(){ACC.address.bindCountrySpecificAddressFormsFor("vinAddressForm"),ACC.address.bindCountrySpecificAddressFormsFor("vinAddressEditingForm"),$(document).on("click",".acc_address_edit_show",function(e){var options=$(this).data("options");$("#acc_address_edit_form_"+options.addressId).length>0||ACC.address.displayAddressEditingForm(options,null)})},bindCountrySpecificAddressFormsFor:function(parent){$(document).on("change","#"+parent+' select[name="provinceIso"]',function(){ACC.address.bindDistrictsByProvince($(this),$("#"+parent+' select[name="districtIso"]'))}),$(document).on("change","#"+parent+' select[name="districtIso"]',function(){ACC.address.bindWardsByDistrict($(this),$("#"+parent+' select[name="wardIso"]'))}),$(document).on("change","#"+parent+' select[name="wardIso"]',function(){ACC.address.bindStreetsByWard($(this),$("#"+parent+' select[name="streetIso"]'))})},bindDistrictsByProvince:function(source,target){ACC.address.queryAddressDataFromServer("my-account/districts-by-province",{p:$(source).val()},target)},bindWardsByDistrict:function(source,target){ACC.address.queryAddressDataFromServer("my-account/wards-by-district",{d:$(source).val()},target)},bindStreetsByWard:function(source,target){ACC.address.queryAddressDataFromServer("my-account/streets-by-ward",{w:$(source).val()},target)},displayAddressEditingForm:function(options,callback){var parent=$("#acc_address_item_"+options.addressId);$.ajax({url:ACC.config.encodedContextPath+"/my-account/address-book/edit/form",async:!0,data:options,dataType:"html",beforeSend:function(){}}).done(function(data){$(".address-editing-form-container").remove(),$("#acc_address_add_form").hide(),$(parent).append(data),"function"==typeof callback&&callback.call()})},queryAddressDataFromServer:function(requestUrl,params,target){$.ajax({url:ACC.config.encodedContextPath+"/"+requestUrl,async:!0,data:params,dataType:"JSON"}).done(function(data){ACC.address.bindAddressDataToControl(data,target)})},bindAddressDataToControl:function(data,target){if(data){$(target).find("option").remove();var items=$.parseJSON(data);$.each(items,function(idx,item){$(target).append("<option value="+item.code+">"+item.name+"</option>")}),$(target).change()}},showAddressFormButtonPanel:function(){""!==$("#countrySelector :input").val()&&$("#addressform_button_panel").show()},bindToColorboxClose:function(){$(document).on("click",".closeColorBox",function(){ACC.colorbox.close()})},displayCountrySpecificAddressForm:function(options,callback){$.ajax({url:ACC.config.encodedContextPath+"/my-account/addressform",async:!0,data:options,dataType:"html",beforeSend:function(){$("#i18nAddressForm").html(ACC.address.spinner)}}).done(function(data){$("#i18nAddressForm").html($(data).html()),"function"==typeof callback&&callback.call()})},bindToChangeAddressButton:function(){$(document).on("click",".summaryDeliveryAddress .editButton",ACC.address.handleChangeAddressButtonClick)},bindViewAddressBook:function(){$(document).on("click",".js-address-book",function(e){e.preventDefault(),ACC.colorbox.open("Saved Addresses",{href:"#addressbook",inline:!0,width:"380px"})}),$(document).on("click","#summaryOverlayViewAddressBook",function(){$("#summaryDeliveryAddressFormContainer").hide(),$("#summaryOverlayViewAddressBook").hide(),$("#summaryDeliveryAddressBook").show(),ACC.colorbox.resize()})},showRemoveAddressFromBookConfirmation:function(){$(document).on("click",".removeAddressFromBookButton",function(){var addressId=$(this).data("addressId"),popupTitle=$(this).data("popupTitle");ACC.colorbox.open(popupTitle,{inline:!0,height:!1,href:"#popup_confirm_address_removal_"+addressId,onComplete:function(){$(this).colorbox.resize()}})})},showChangeAddressConfirmation:function(){$(".oneClickConfirmLink").click(function(e){e.preventDefault(),$("#changeAddressDialog").modal("show")}),$("#agree").click(function(e){e.preventDefault(),window.location="address-book"})},backToListAddresses:function(){$(".addressBackBtn").on("click",function(){var sUrl=$(this).data("backToAddresses");window.location=sUrl})},bindShiipingZone:function(){$(document).on("click",".js-mini-cart-link",function(e){e.preventDefault();var url=$(this).data("miniCartUrl"),cartName=0!=$(this).find(".js-mini-cart-count").html()?$(this).data("miniCartName"):$(this).data("miniCartEmptyName");ACC.colorbox.open(cartName,{href:url,maxWidth:"100%",width:"380px",initialWidth:"380px"})}),$(document).on("click",".js-mini-cart-close-button",function(e){e.preventDefault(),ACC.colorbox.close()})},update1ClickCheckout:function(flag){$.ajax({url:ACC.config.encodedContextPath+"/my-account/1click-checkout/update/"+flag,async:!0,type:"POST",dataType:"JSON"}).done(function(response){})}},ACC.autocomplete={_autoload:["bindSearchAutocomplete","bindTriggerUrlAutocomplete"],bindSearchAutocomplete:function(){$.widget("custom.yautocomplete",$.ui.autocomplete,{_create:function(){var option=this.element.data("options");this._setOptions({minLength:option.minCharactersBeforeRequest,displayProductImages:option.displayProductImages,delay:option.waitTimeBeforeRequest,autocompleteUrl:option.autocompleteUrl,source:this.source}),$.ui.autocomplete.prototype._create.call(this)},options:{cache:{},focus:function(){return!1},select:function(event,ui){window.location.href=ui.item.url}},_renderItem:function(ul,item){if("autoSuggestion"==item.type){var itemUrl=item.url.replace("'","%27"),renderHtml="<a href='"+itemUrl+"' ><div class='name'><span class='suggestion'>"+item.value+"</span></div></a>";return $("<li class='suggestion'>").data("item.autocomplete",item).append(renderHtml).appendTo(ul)}if("categoryResult"==item.type){var itemUrl=item.url.replace("'","%27"),renderHtml="<a href='"+itemUrl+"' ><div class='name'><span class='suggestion'>"+item.term.trim()+"<span class='related'> trong </span><span class='related__category'>"+item.value+"</span></div></a>";return $("<li class='related__suggestion-category'>").data("item.autocomplete",item).append(renderHtml).appendTo(ul)}if("productResult"==item.type){var itemUrl=item.url.replace("'","%27"),renderHtml="<a href='"+itemUrl+"' ><div class='name'>"+item.value+"</div></a>";return $("<li class='related__suggestion--product'>").data("item.autocomplete",item).append(renderHtml).appendTo(ul)}},source:function(request,response){var self=this,term=request.term.toLowerCase();if((term=ACC.requests.searchPattern(term))in self.options.cache)return response(self.options.cache[term]);$.getJSON(self.options.autocompleteUrl,{term:term},function(data){var autoSearchData=[],termSearch=term.trim(),searchPrefix=ACC.config.encodedContextPath+"/search",searchTextPrefix=searchPrefix+"?text=",triggerPrefix=searchPrefix+"/relatedkeyword?term=";return _.isEmpty(data.suggestions)||$.each(data.suggestions,function(i,obj){autoSearchData.push({value:obj.term,url:searchTextPrefix+obj.term,triggerurl:triggerPrefix+obj.term,type:"autoSuggestion"})}),_.isEmpty(data.categories)||$.each(data.categories,function(i,obj){autoSearchData.push({value:obj.name,triggerurl:triggerPrefix+termSearch+"&category="+obj.code,url:searchTextPrefix+termSearch+"&category="+obj.code,term:term,type:"categoryResult"})}),_.isEmpty(data.products)||$.each(data.products,function(i,obj){autoSearchData.push({value:obj.name,code:obj.code,desc:obj.description,manufacturer:obj.manufacturer,url:searchTextPrefix+obj.name,price:obj.price.formattedValue,type:"productResult",image:!_.isEmpty(obj.images)&&self.options.displayProductImages?obj.images[0].url:null})}),self.options.cache[term]=autoSearchData,response(autoSearchData)})}}),$search=$(".js-site-search-input"),$search.length>0&&$search.yautocomplete()},bindTriggerUrlAutocomplete:function(urlDataUpdate){if(void 0!==urlDataUpdate)return $.ajax({url:urlDataUpdate,method:"get",dataType:"json",success:function(result){console.log("my message"+urlDataUpdate)}})}},ACC.carousel={_autoload:[["bindCarousel",$(".js-swiper-carousel").length>0]],carouselConfig:{"category-products-carousel":{slidesPerView:10,spaceBetween:8,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",pagination:".swiper-pagination",preventClicks:!1,paginationClickable:!0,onSlideChangeEnd:function(e){$(e.wrapper.context).find(".swiper-pagination").html(e.bullets)},onInit:function(e){var $parent=$(e.wrapper.context).parent();e.snapGrid.length<2?($parent.addClass("no-loop"),$parent.find(".swiper-button-prev").hide(),$parent.find(".swiper-button-next").hide()):($parent.removeClass("no-loop"),$parent.find(".swiper-button-prev").show(),$parent.find(".swiper-button-next").show())},breakpoints:{1024:{slidesPerView:6},640:{slidesPerView:4},480:{slidesPerView:2.2,pagination:".swiper-pagination",paginationClickable:!0}}},"home-stores":{slidesPerView:2,spaceBetween:0,preventClicks:!1,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",breakpoints:{1234:{slidesPerView:2},1023:{slidesPerView:2.5,pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:16},768:{slidesPerView:2.5,pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:16},640:{slidesPerView:1.2,pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:8},480:{spaceBetween:8,slidesPerView:1.2,pagination:".swiper-pagination",paginationClickable:!0}}},"good-products-carousel":{slidesPerView:6,spaceBetween:8,preventClicks:!1,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",breakpoints:{1234:{slidesPerView:6},768:{slidesPerView:4,pagination:".swiper-pagination",paginationClickable:!0},640:{slidesPerView:4,pagination:".swiper-pagination",paginationClickable:!0},480:{slidesPerView:2.2,pagination:".swiper-pagination",paginationClickable:!0}},onSliderMove:function(){$(window).trigger("scroll")}},"gift-code":{slidesPerView:6,spaceBetween:8,preventClicks:!1,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",pagination:".swiper-pagination",paginationClickable:!0,breakpoints:{1234:{slidesPerView:6},768:{slidesPerView:4},640:{slidesPerView:4},480:{slidesPerView:2.2}},onSliderMove:function(){$(window).trigger("scroll")}},"product-suggestion":{slidesPerView:2.5,spaceBetween:12,preventClicks:!1,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",breakpoints:{1024:{slidesPerView:3.2},640:{slidesPerView:3.5},480:{slidesPerView:3.5}}},"product-detail__merchant":{slidesPerView:6,spaceBetween:8,preventClicks:!1,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",pagination:".swiper-pagination",paginationClickable:!0,onSlideChangeEnd:function(e){$(e.wrapper.context).find(".swiper-pagination").html(e.bullets)},breakpoints:{1024:{slidesPerView:4},640:{slidesPerView:3.5},480:{slidesPerView:2.5}}},"product-detail__related":{slidesPerView:4,spaceBetween:8,preventClicks:!1,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",breakpoints:{1024:{slidesPerView:4},640:{slidesPerView:3.5},480:{slidesPerView:2.5,pagination:".swiper-pagination",paginationClickable:!0}},onInit:function(e){var $parent=$(e.wrapper.context).parent();e.snapGrid.length<5&&($parent.find(".swiper-button-prev").hide(),$parent.find(".swiper-button-next").hide())}},"product-detail__related-deal":{slidesPerView:4,spaceBetween:15,preventClicks:!1,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",breakpoints:{1400:{slidesPerView:4},1024:{slidesPerView:3.5},640:{slidesPerView:2.25},480:{slidesPerView:1.25}},loop:!0,onInit:function(e){var $parent=$(e.wrapper.context).parent();if(e.snapGrid.length<10){$parent.find(".swiper-button-prev").hide(),$parent.find(".swiper-button-next").hide();$(".js-swiper-product-detail__related-deal")[0].swiper.destroy(!1,!0)}}},"lp-banner-slider":{slidesPerView:1,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",loop:!0,pagination:".swiper-pagination",autoplay:5e3,preventClicks:!1},"lp-banner-slider-map":{slidesPerView:1,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",loop:!0,pagination:".swiper-pagination",autoplay:!1,preventClicks:!1},"lp-product-slider":{slidesPerView:6,spaceBetween:8,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",pagination:!1,preventClicks:!1,breakpoints:{1234:{slidesPerView:5},1024:{slidesPerView:4.5,pagination:".swiper-pagination",paginationClickable:!0},768:{slidesPerView:4,pagination:".swiper-pagination",paginationClickable:!0},640:{slidesPerView:3.5,pagination:".swiper-pagination",paginationClickable:!0},480:{slidesPerView:2.2,pagination:".swiper-pagination",paginationClickable:!0}}}},bindCarousel:function(){$(".js-owl-carousel").each(function(){var $c=$(this);$.each(ACC.carousel.carouselConfig,function(key,config){if($c.hasClass("js-owl-"+key)){$(".js-owl-"+key).owlCarousel(config)}})}),$.each(ACC.carousel.carouselConfig,function(key,config){config.preloadImages=!1,config.lazyLoading=!0,$(".js-swiper-"+key).each(function(){var $this=$(this);if($this.hasClass("js-swiper-carousel")){$this.swiper(config);var $parent=$this.parents(".adr-swiper-wrapper");$parent.length>0&&$this.find(".swiper-button-next, .swiper-button-prev").appendTo($parent)}})});var $swiperCarousel=$(".js-swiper-carousel");if(_.isElement($swiperCarousel[0])&&void 0!==$swiperCarousel[0].swiper){$swiperCarousel[0].swiper.on("slideChangeEnd",function(){$("img.lazy").lazyload()})}}},ACC.cart={_config:{element:{removeItemBtn:".js-remove-entry-button",quantityInput:".js-update-entry-quantity-input"}},_autoload:["initElements","bindCartPage","bindMultiDEntryRemoval","bindMultidCartProduct",["bindApplyVoucher",0!=$("#js-voucher-apply-btn").length],["bindToReleaseVoucher",0!=$("#js-applied-vouchers").length],"bindRemoveItem","bindQuantityChange","bindQuantityFocus","bindQuantityPaste","bindQtySelector","initCart"],prevEntryQuantity:0,initCart:function(){$(document).on("click",".js-cart-total-toggle",function(event){var $detail,$this=$(this);event.preventDefault(),$detail=$this.parents(".cart-total__promotion").find(".cart-total__promotion-detail"),$detail.is(":visible")?($detail.stop().slideUp(300,function(){ACC.colorbox.resize()}),$this.find(".adr-icon").attr("class","adr-icon icon-expand")):($detail.stop().slideDown(300,function(){ACC.colorbox.resize()}),$this.find(".adr-icon").attr("class","adr-icon icon-collapse"))})},initElements:function(){ACC.common.loadModuleElements(ACC.cart),ACC.minicart.isMiniCart=!1,$(document).on("submit",".js-shopping-cart .js-qty-form,.js-mini-cart .js-qty-form",function(event){event.preventDefault();var form=$(this),select=form.find(".cart-qty-select"),entryClass="."+select.data("entryId");form.find(entryClass+" .cart-qty-input").blur()}),$(document).on("click",".js-cart-reload",function(e){e.preventDefault(),window.location.reload(!0)})},bindQuantityFocus:function(){$(document).on("focus",".js-shopping-cart .cart-qty-input,.js-mini-cart .cart-qty-input",function(event){ACC.cart.prevEntryQuantity=$(this).val()})},bindQuantityPaste:function(){$(document).on("paste",".js-shopping-cart .cart-qty-input,.js-mini-cart .cart-qty-input",function(event){event.preventDefault()})},bindQuantityChange:function(){$(document).on("change",".js-shopping-cart .cart-qty-input,.js-mini-cart .cart-qty-input",function(event){event.preventDefault();var self=$(this),form=self.closest("form"),select=(form.find("input[name=productCode]").val(),form.find(".cart-qty-select")),entryClass="."+select.data("entryId");$(entryClass+" .cart-qty-input").val(self.val());var entryNumber=form.find("input[name=entryNumber]").val(),quantity=self.val(),isASM=form.find("input[name=isASM]").val(),maxDisplayItems=self.data("maxDisplayItems"),ats=self.data("ats"),currentEntryItemsClass=".entry-item-"+entryNumber,currentWarningMessageElm=$(currentEntryItemsClass).find(".js-item-invalid");void 0!==currentWarningMessageElm&&currentWarningMessageElm.remove();var currentValue=$(this).attr("data-original-value");if(self.parents().hasClass("js-shopping-cart")&&parseInt(currentValue)>parseInt(quantity))self.val(currentValue),quantity=currentValue;else{var isMiniCart=1===$(this).closest(".js-mini-cart").length;isMiniCart?$(".js-mini-cart").block():$.blockUI(),ACC.cart._showSessionTimeoutMessage(!1),ACC.cartitem.updateQuantities(entryNumber,quantity,isASM).then(function(response){isMiniCart?$(".js-mini-cart").unblock():$.unblockUI();var inputs=$(entryClass+" .cart-qty-input"),selects=$(entryClass+" .cart-qty-select");quantity<maxDisplayItems?(inputs.val(quantity),selects.val(quantity),$(entryClass+" .cart-qty-input-section").hide(),$(entryClass+" .cart-qty-select-section").show()):quantity<ats?(inputs.val(quantity),selects.val(quantity)):(inputs.val(ats),selects.val(ats)),ACC.cart.updateCartInfo(response),ACC.selectize.initSelectize(),ACC.cart._showSessionTimeoutMessage(!1)},function(error){if(isMiniCart?$(".js-mini-cart").unblock():$.unblockUI(),403===error.status)return void ACC.cart._showSessionTimeoutMessage(!0);var errorObj=JSON.parse(error.responseText);ACC.cart.addErrorMessageToCartItem($(currentEntryItemsClass),errorObj.message);var checkoutBtn=$(".js-cart-checkout-button");ACC.cart.disableButton(checkoutBtn);var expressBtn=$(".js-cart-express-buy-button");ACC.cart.disableButton(expressBtn)})}})},bindQtySelector:function(){function handleChangeQty(target,parent){var entryClass="."+$(target).data("entryId"),input=$(parent+" "+entryClass+" .cart-qty-input"),qty=$(target).val();"overDisplayValue"===qty?($(entryClass+" .cart-qty-input-section").show(),$(entryClass+" .cart-qty-select-section").hide(),$(entryClass+" .cart-qty-input").val(10),$(entryClass+" .cart-qty-input").focus()):($(entryClass+" .cart-qty-select").val(qty),input.val(qty),input.change())}$(document).on("change",".js-shopping-cart .cart-qty-select",function(){handleChangeQty(this,".js-shopping-cart")}),$(document).on("click",".js-shopping-cart .cart-qty-select",function(){var value=$(this).parent().parent().find(".cart-qty-input").attr("data-original-value");$(this).find("option").attr("disabled",!1);for(var i=1;i<value;i++)$(this).find("option[value="+i+"]").attr("disabled",!0)}),$(document).on("change",".js-mini-cart .cart-qty-select",function(){handleChangeQty(this,".js-mini-cart")})},bindRemoveItem:function(){$(document).on("click",".js-shopping-cart .js-remove-entry-button,.js-mini-cart .js-remove-entry-button",function(event){event.preventDefault();var entry=$(this).attr("id").split("_"),form=$("#updateCartForm"+entry[1]),code=form.find("input[name=productCode]").val(),entryNumber=form.find("input[name=entryNumber]").val();form.find("input[name=quantity]").val(),$(this);ACC.cart.gtmRemoveFromCart(form),$.blockUI(),ACC.cart._showSessionTimeoutMessage(!1),ACC.cartitem.deleteQuantities(entryNumber).then(function(response){$.unblockUI(),ACC.cart.updateCartInfo(response),ACC.track.trackEmaticRemoveFromCart(code),ACC.cart._showSessionTimeoutMessage(!1)},function(error){if($.unblockUI(),403===error.status)return void ACC.cart._showSessionTimeoutMessage(!0)}),ACC.minicart.updateMiniCartDisplay()})},_showSessionTimeoutMessage:function(isShow){if(isShow){var html='<div class="alert alert-danger"><i class="adr-icon icon-danger"></i>'+SESSION_TIMEOUT_WARNING_MESSAGE+"</div>";$(".js-cart-session-timeout").html(html)}else $(".js-cart-session-timeout").html("")},checkEntryQtyOver:function(){},updateCartInfo:function(cartUpdateHtml){var cartUpdate=$($(cartUpdateHtml)[0]);"true"===cartUpdate.find("#isCartEmpty").html()?$(".js-cart--container").html(cartUpdate.find("#cartEmpty").html()):($(".js-cart-total-unit").text(cartUpdate.find("#totalUnits").text()),$(".js-cart-items--container").html(cartUpdate.find("#cartItems").html()),$(".js-cart-total--container").html(cartUpdate.find("#cartTotals").html())),ACC.minicart.updateMiniCartDisplay(),$(".mini-cart .cart-coupon").remove()},bindCartPage:function(){$(document).on("click",".js-show-editable-grid",function(event){ACC.cart.populateAndShowEditableGrid(this,event)})},bindMultiDEntryRemoval:function(){$(document).on("click",".js-submit-remove-product-multi-d",function(){var itemIndex=$(this).data("index"),$form=$("#updateCartForm"+itemIndex),initialCartQuantity=$form.find("input[name=initialQuantity]"),cartQuantity=$form.find("input[name=quantity]"),productCode=($form.find("input[name=entryNumber]").val(),$form.find("input[name=productCode]").val());cartQuantity.val(0),initialCartQuantity.val(0),ACC.track.trackRemoveFromCart(productCode,initialCartQuantity,cartQuantity.val());var method=$form.attr("method")?$form.attr("method").toUpperCase():"GET";$.ajax({url:$form.attr("action"),data:$form.serialize(),type:method,success:function(data){location.reload()},error:function(){alert("Failed to remove quantity. Error details ["+xht+", "+textStatus+", "+ex+"]")}})})},populateAndShowEditableGrid:function(element,event){var readOnly=$(element).data("readOnlyMultidGrid"),itemIndex=$(element).data("index");grid=$("#ajaxGrid"+itemIndex);var gridEntries=$("#grid"+itemIndex),strSubEntries=gridEntries.data("sub-entries"),arrSubEntries=strSubEntries.split(","),firstVariantCode=arrSubEntries[0].split(":")[0];$(element).toggleClass("open");for(var targetUrl=gridEntries.data("target-url"),mapCodeQuantity=new Object,i=0;i<arrSubEntries.length;i++){var arrValue=arrSubEntries[i].split(":");mapCodeQuantity[arrValue[0]]=arrValue[1]}if(grid.children("#cartOrderGridForm").length>0)grid.slideToggle("slow");else{$.ajax({url:targetUrl,data:{productCode:firstVariantCode,readOnly:readOnly},type:"GET",success:function(data){grid.html(data),$("#ajaxGrid").removeAttr("id");for(var $gridContainer=grid.find(".product-grid-container"),numGrids=$gridContainer.length,i=0;i<numGrids;i++)ACC.cart.getProductQuantity($gridContainer.eq(i),mapCodeQuantity,i);grid.slideDown("slow"),ACC.cart.coreCartGridTableActions(element,mapCodeQuantity),ACC.productorderform.coreTableScrollActions(grid.children("#cartOrderGridForm"))},error:function(xht,textStatus,ex){alert("Failed to get variant matrix. Error details ["+xht+", "+textStatus+", "+ex+"]")}})}},coreCartGridTableActions:function(element,mapCodeQuantity){ACC.productorderform.bindUpdateFutureStockButton(".update_future_stock_button"),ACC.productorderform.bindVariantSelect($(".variant-select-btn"),"cartOrderGridForm");var itemIndex=$(element).data("index"),quantityBefore=0,grid=$("#ajaxGrid"+itemIndex+" .product-grid-container");grid.on("focusin",".sku-quantity",function(event){quantityBefore=jQuery.trim(this.value),$(this).parents("tr").next(".variant-summary").remove(),$(this).parents("table").data(ACC.productorderform.selectedVariantData)?ACC.productorderform.selectedVariants=$(this).parents("table").data(ACC.productorderform.selectedVariantData):ACC.productorderform.selectedVariants=[],""==quantityBefore&&(quantityBefore=0,this.value=0)}),grid.on("focusout",".sku-quantity",function(event){var quantityAfter=0,gridLevelTotalPrice="",currentIndex=parseInt($(this).attr("id").match("[0-9]+"));this.value=ACC.productorderform.filterSkuEntry(this.value),quantityAfter=jQuery.trim(this.value);var variantCode=$("input[id='cartEntries["+currentIndex+"].sku']").val();isNaN(jQuery.trim(this.value))&&(this.value=0),""==quantityAfter&&(quantityAfter=0,this.value=0);var $gridTotalValue=grid.find("[data-grid-total-id=total_value_"+currentIndex+"]"),currentPrice=$("input[id='productPrice["+currentIndex+"]']").val()
;quantityAfter>0&&(gridLevelTotalPrice=ACC.productorderform.formatTotalsCurrency(parseFloat(currentPrice)*parseInt(quantityAfter))),$gridTotalValue.html(gridLevelTotalPrice);var _this=this,priceSibling=$(this).siblings(".price"),propSibling=$(this).siblings(".variant-prop"),currentSkuId=$(this).next(".td_stock").data("sku-id"),currentBaseTotal=$(this).siblings(".data-grid-total");if(this.value!=quantityBefore){var newVariant=!0;ACC.productorderform.selectedVariants.forEach(function(item,index){item.id===currentSkuId&&(newVariant=!1,"0"===_this.value||0===_this.value?ACC.productorderform.selectedVariants.splice(index,1):(ACC.productorderform.selectedVariants[index].quantity=_this.value,ACC.productorderform.selectedVariants[index].total=ACC.productorderform.updateVariantTotal(priceSibling,_this.value,currentBaseTotal)))}),newVariant&&this.value>0&&ACC.productorderform.selectedVariants.push({id:currentSkuId,size:propSibling.data("variant-prop"),quantity:_this.value,total:ACC.productorderform.updateVariantTotal(priceSibling,_this.value,currentBaseTotal)})}if(ACC.productorderform.showSelectedVariant($(this).parents("table")),this.value>0&&this.value!=quantityBefore?$(this).parents("table").addClass("selected"):0===ACC.productorderform.selectedVariants.length&&$(this).parents("table").removeClass("selected").find(".variant-summary").remove(),quantityBefore!=quantityAfter){$.ajax({url:ACC.config.encodedContextPath+"/cart/updateMultiD",data:{productCode:variantCode,quantity:quantityAfter,entryNumber:-1},type:"POST",success:function(data,textStatus,xhr){ACC.cart.refreshCartData(data,-1,quantityAfter,itemIndex),mapCodeQuantity[variantCode]=quantityAfter},error:function(xhr,textStatus,error){var redirectUrl=xhr.getResponseHeader("redirectUrl"),connection=xhr.getResponseHeader("Connection");null!==redirectUrl?window.location=redirectUrl:"close"===connection&&window.location.reload()}})}})},refreshCartData:function(cartData,entryNum,quantity,itemIndex){if(0==cartData.entries.length)location.reload();else{var form;if(-1==entryNum){form=$(".js-qty-form"+itemIndex);for(var productCode=form.find("input[name=productCode]").val(),quantity=0,entryPrice=0,i=0;i<cartData.entries.length;i++){var entry=cartData.entries[i];if(entry.product.code==productCode){quantity=entry.quantity,entryPrice=entry.totalPrice;break}}0==quantity?location.reload():(form.find(".qtyValue").html(quantity),form.parent().parent().find(".js-item-total").html(entryPrice.formattedValue))}ACC.cart.refreshCartPageWithJSONResponse(cartData)}},refreshCartPageWithJSONResponse:function(cartData){ACC.minicart.updateMiniCartDisplay(),$(".js-cart-top-totals").html($("#cartTopTotalSectionTemplate").tmpl(cartData)),$("div .cartpotproline").remove(),$("div .cartproline").remove(),$(".js-cart-totals").remove(),$("#ajaxCartPotentialPromotionSection").html($("#cartPotentialPromotionSectionTemplate").tmpl(cartData)),$("#ajaxCartPromotionSection").html($("#cartPromotionSectionTemplate").tmpl(cartData)),$("#ajaxCart").html($("#cartTotalsTemplate").tmpl(cartData))},getProductQuantity:function(gridContainer,mapData,i){var tables=gridContainer.find("table");$.each(tables,function(index,currentTable){var skus=jQuery.map($(currentTable).find("input[type='hidden'].sku"),function(o){return o.value}),quantities=jQuery.map($(currentTable).find("input[type='textbox'].sku-quantity"),function(o){return o}),selectedVariants=[];$.each(skus,function(index,skuId){var quantity=mapData[skuId];if(void 0!=quantity){quantities[index].value=quantity;var currentIndex=parseInt(quantities[index].id.match("[0-9]+")),gridTotalValue=gridContainer.find("[data-grid-total-id=total_value_"+currentIndex+"]"),gridLevelTotalPrice="",currentPrice=$("input[id='productPrice["+currentIndex+"]']").val();quantity>0&&(gridLevelTotalPrice=ACC.productorderform.formatTotalsCurrency(parseFloat(currentPrice)*parseInt(quantity))),gridTotalValue.html(gridLevelTotalPrice),selectedVariants.push({id:skuId,size:$(quantities[index]).siblings(".variant-prop").data("variant-prop"),quantity:quantity,total:gridLevelTotalPrice})}}),0!=selectedVariants.length&&($.tmpl(ACC.productorderform.$variantSummaryTemplate,{variants:selectedVariants}).appendTo($(currentTable).addClass("selected")),$(currentTable).find(".variant-summary .variant-property").html($(currentTable).find(".variant-detail").data("variant-property")),$(currentTable).data(ACC.productorderform.selectedVariantData,selectedVariants))})},bindMultidCartProduct:function(){$(document).on("click",".showQuantityProduct",function(event){ACC.multidgrid.populateAndShowGrid(this,event,!0)}),$(document).on("click",".showQuantityProductOverlay",function(event){ACC.multidgrid.populateAndShowGridOverlay(this,event)})},bindApplyVoucher:function(){$(document).on("click","#js-voucher-apply-btn",function(e){ACC.cart.handleApplyVoucher(e)}),$(document).on("keypress","#js-voucher-code-text",function(e){13==(e.keyCode?e.keyCode:e.which)&&ACC.cart.handleApplyVoucher(e)})},handleApplyVoucher:function(e){var voucherCode=$.trim($("#js-voucher-code-text").val());""!=voucherCode&&voucherCode.length>0&&$("#applyVoucherForm").submit()},bindToReleaseVoucher:function(){$(document).on("click",".js-release-voucher-remove-btn",function(event){$(this).closest("form").submit()})},addErrorMessageToCartItem:function(cartItem,errorMsg){if(cartItem){var warningEl=cartItem.find(".js-item-warnings");warningEl.prepend("<div class='js-item-invalid alert alert-warning'><i class='adr-icon icon-warning'></i> "+errorMsg+"</div>"),warningEl.show()}},disableButton:function(button){button&&button.addClass("disabled")},enableButton:function(button){button&&button.removeClass("disabled")},updateCartPage:function(){$.ajax({url:ACC.config.cartInfoUrl,cache:!1,type:"GET",success:function(htmlData){$(".js-shopping-cart > .container > .cart").html(htmlData)}})},gtmRemoveFromCart:function(form){if(void 0!==form&&void 0!==ACC.track.gtmRemoveFromCart&&"function"==typeof ACC.track.gtmRemoveFromCart){var offer={};offer.id=form.find("input[name=productCode]").val(),offer.quantity=form.find("input[name=initialQuantity]").val();var data=form.data("cart");offer.name=data.productName,offer.price=null;var price=data.productPostPrice;if(void 0!==price){var dotPosition=price.indexOf(".",0);dotPosition>-1&&(offer.price=price.substr(0,dotPosition))}offer.brand=data.brand,offer.variant=data.variant,offer.category=data.breadcrumb,ACC.track.gtmRemoveFromCart(offer)}}},ACC.cartitem={_autoload:[],submitTriggered:!1,updateQuantities:function(entryNumber,quantity,isASM){var formData={quantity:quantity,entryNumber:entryNumber,isASM:isASM};return $.ajax({url:ACC.config.cartUpdateUrl,type:"post",data:JSON.stringify(formData),dataType:"html",contentType:"application/json; charset=utf-8"})},deleteQuantities:function(entryNumber){return $.ajax({url:ACC.config.cartDeleteUrl+"?entryNumber="+entryNumber,type:"post",dataType:"html",contentType:"application/json; charset=utf-8"})},deleteQuantitiesWithSourcing:function(entryNumber){return $.ajax({url:ACC.config.cartDeleteUrl+"?entryNumber="+entryNumber+"&sourcing=true",type:"post",dataType:"html",contentType:"application/json; charset=utf-8"})},bindCartItem:function(){$(".js-remove-entry-button").on("click",function(){var entryNumber=$(this).attr("id").split("_"),form=$("#updateCartForm"+entryNumber[1]),productCode=form.find("input[name=productCode]").val(),initialCartQuantity=form.find("input[name=initialQuantity]"),cartQuantity=form.find("input[name=quantity]");ACC.track.trackRemoveFromCart(productCode,initialCartQuantity.val()),cartQuantity.val(0),initialCartQuantity.val(0),form.submit(),ACC.minicart.updateMiniCartDisplay()}),$(".js-update-entry-quantity-input").on("blur",function(e){ACC.cartitem.handleUpdateQuantity(this,e)}).on("keyup",function(e){return ACC.cartitem.handleKeyEvent(this,e)}).on("keydown",function(e){return ACC.cartitem.handleKeyEvent(this,e)})},handleKeyEvent:function(elementRef,event){return 13!=event.which||ACC.cartitem.submitTriggered?!ACC.cartitem.submitTriggered:(ACC.cartitem.submitTriggered=ACC.cartitem.handleUpdateQuantity(elementRef,event),ACC.cartitem.submitTriggered)},handleUpdateQuantity:function(elementRef,event){var form=$(elementRef).closest("form"),productCode=form.find("input[name=productCode]").val(),initialCartQuantity=form.find("input[name=initialQuantity]").val(),newCartQuantity=form.find("input[name=quantity]").val();return initialCartQuantity!=newCartQuantity&&(ACC.track.trackUpdateCart(productCode,initialCartQuantity,newCartQuantity),form.submit(),!0)}},ACC.deliverydata=ACC.deliverydata||{},ACC.delivery={_autoload:["initLocationModule"],pageType:_.isEmpty(ACC.deliverydata.pageType)?"":ACC.deliverydata.pageType,selectedProvince:_.isEmpty(ACC.deliverydata.selectedProvince)?"":ACC.deliverydata.selectedProvince,selectedDistrict:_.isEmpty(ACC.deliverydata.selectedDistrict)?"":ACC.deliverydata.selectedDistrict,selectedWard:_.isEmpty(ACC.deliverydata.selectedWard)?"":ACC.deliverydata.selectedWard,selectedProvinceName:_.isEmpty(ACC.deliverydata.selectedProvinceName)?"":ACC.deliverydata.selectedProvinceName,selectedDistrictName:_.isEmpty(ACC.deliverydata.selectedDistrictName)?"":ACC.deliverydata.selectedDistrictName,selectedWardName:_.isEmpty(ACC.deliverydata.selectedWardName)?"":ACC.deliverydata.selectedWardName,selectedStreet:"",missingMessage:_.isEmpty(ACC.deliverydata.missingMessage)?"":ACC.deliverydata.missingMessage,successMessage:_.isEmpty(ACC.deliverydata.successMessage)?"":ACC.deliverydata.successMessage,showTextValue:"",firstTimeUser:_.isEmpty(ACC.deliverydata.firstTimeUser)?"":ACC.deliverydata.firstTimeUser,suggestionFrom:_.isEmpty(ACC.deliverydata.suggestionFrom)?"":ACC.deliverydata.suggestionFrom,scrollFrom:_.isEmpty(ACC.deliverydata.scrollFrom)?"":ACC.deliverydata.scrollFrom,popup:function(state,elem){void 0===state&&(state="hide"),void 0===elem&&(elem="#shipping--zone"),$(elem).modal(state)},initLocationModule:function(){var currentLocation={province:ACC.delivery.selectedProvince,district:ACC.delivery.selectedDistrict,ward:ACC.delivery.selectedWard,provinceName:ACC.delivery.selectedProvinceName,districtName:ACC.delivery.selectedDistrictName,wardName:ACC.delivery.selectedWardName};if(!_.isEmpty(currentLocation.province)&&!_.isEmpty(currentLocation.district)&&!_.isEmpty(currentLocation.ward)){var prodShipping={headerLocation:$("#js-user--location span.delivery-zone-value"),changeDelivery:$(".js-change_delivery"),status:$("#product-shipping-status"),form:$("#product-shipping-section")},mobileSideNav={userLocationText:$("#deliveryTextMobile"),userLocationBtn:$("#deliveryBtnMobile")};ACC.delivery.locationStatus=1,ACC.delivery.shippingFormClass=" hidden",ACC.requests.deliveryZone.byDefault(currentLocation.province,currentLocation.district,currentLocation.ward);ACC.requests.requestLocationText(currentLocation.province,currentLocation.district,currentLocation.ward).done(function(res){prodShipping.status.find("strong").text(res)});ACC.requests.requestLocationPlainText(currentLocation.provinceName,currentLocation.districtName,currentLocation.wardName).done(function(res){prodShipping.headerLocation.text(res),prodShipping.changeDelivery.text(ACC.deliverydata.changeLocationText),mobileSideNav.userLocationBtn.addClass("hidden"),mobileSideNav.userLocationText.removeClass("hidden"),mobileSideNav.userLocationText.find(".delivery-zone-value span").text(res)}),prodShipping.status.removeClass("hidden"),prodShipping.form.addClass(ACC.delivery.shippingFormClass),prodShipping.form.find(".js-location-message").hide()}$("#shipping--zone-city").length>0&&ACC.delivery.deliveryZone.initSelectize(),$("#product--detail-city").length>0&&ACC.delivery.productDelivery.initSelectize()},deliveryZone:{elements:{address:"#deliveryRecentAddress a",city:"#shipping--zone-city",street:"#shipping--zone-street",district:"#shipping--zone-district",ward:"#shipping--zone-ward",submit:"#btnSubmit"},initSelectize:function(){var els;els=ACC.delivery.deliveryZone.elements,ACC.delivery.deliveryZone.checkState(),ACC.delivery.deliveryZone.binding(),ACC.requests.triggerComboLocation(els.city,els.district,els.ward,els.street,{province:ACC.delivery.selectedProvince,district:ACC.delivery.selectedDistrict,ward:ACC.delivery.selectedWard},1)},checkState:function(){"true"!==ACC.requests.getUrlParameter("nopopup")&&"true"===ACC.deliverydata.firstTimeUser&&"true"===ACC.config.autoShowPopup&&$(window).load(_.debounce(function(){ACC.delivery.popup("show")},10*ACC.requests.timeout))},binding:function(){var els;els=ACC.delivery.deliveryZone.elements;var deliverySubmit=function(city,district,ward){var res;res=ACC.requests.deliveryZone.byDefault(city,district,ward),res.always(function(){ACC.delivery.popup("hide")}).done(function(response){if("success"===response){0===ACC.requests.getUrlParameter("page").length?window.location.reload():window.location.href=ACC.requests.removeUrlParam("page",window.location.href)}})};$(document).on("click",".js-change_delivery, .js-change_delivery_pdp, .js-change_delivery_nonTextChange, .js-shippingArea",function(e){e.preventDefault(),ACC.delivery.popup("show"),$("#shipping--zone").on("shown.bs.modal",function(){_.isEmpty(ACC.delivery.selectedProvince)&&ACC.selectize.focus(els.city)})}),$(document).on("change",els.ward,function(e){_.isEmpty(ACC.selectize.get(els.ward))||($(els.submit).removeClass("btn-disabled"),$(".js-confirm-delivery-updated").html(""))}),$(document).on("click",els.address,function(e){var city,district,ward,$this=$(this);city=$this.data("city"),district=$this.data("district"),ward=$this.data("ward"),deliverySubmit(city,district,ward)}),$(document).on("click",els.submit,function(e){if(e.preventDefault(),_.isEmpty($(els.street).val())&&(_.isEmpty($(els.district).val())||_.isEmpty($(els.ward).val())))return void $(".js-confirm-delivery-updated").html(ACC.delivery.missingMessage);var city,district,ward;city=$(els.city).val(),district=$(els.district).val(),ward=$(els.ward).val(),deliverySubmit(city,district,ward)})}},productDelivery:{elements:{form:"#product-shipping-section",title:".product-detail__sidebar__title",city:"#product--detail-city",district:"#product--detail-district",ward:"#product--detail-ward",status:"#product-shipping-status"},initSelectize:function(){var els;els=ACC.delivery.productDelivery.elements,ACC.delivery.productDelivery.binding(),ACC.requests.triggerComboLocation(els.city,els.district,els.ward,els.district_only,{province:ACC.delivery.selectedProvince,district:ACC.delivery.selectedDistrict,ward:ACC.delivery.selectedWard})},binding:function(){var els;els=ACC.delivery.productDelivery.elements,$(document).on("change",els.ward,function(e){e.preventDefault();var ward=ACC.selectize.get(els.ward);if(!_.isEmpty(ward)){ACC.requests.deliveryZone.byDefault($(els.city).val(),$(els.district).val(),$(els.ward).val()).done(function(response){"success"===response&&window.location.reload()})}}),_.isElement($(els.ward)[0])&&!_.isUndefined($(els.ward)[0].selectize)&&$(els.ward)[0].selectize.on("blur",function(){var ward=ACC.selectize.get(els.ward);if(!_.isEmpty(ward)){ACC.requests.deliveryZone.byDefault($(els.city).val(),$(els.district).val(),$(els.ward).val()).done(function(response){"success"===response&&window.location.reload()})}}),$(document).on("click",".js-change-location .change-location",function(e){e.preventDefault(),$(els.status).addClass("hidden"),$(els.form).removeClass("hidden")})}}},ACC.checkout={_autoload:["bindCheckO","bindForms","bindSavedPayments","initBlock","initPopover","initCalendar","bindCalenderCell",["initCheckoutAddress",$("#provinceIso").length>0],"initVatInfo","bindExpressShippingForm",["initPaymentOptions",$("#vinPaymentDetailsForm").length>0],["initInstallmentPeriod",$('[name="installmentPaymentMode"]').length>0],"handleAsmOrderDeliveryTime",["checkShowSidebarProductNotify",$("#right-sidebar-product__list .sidebar-product__notify-content-box").length>0]],bindForms:function(){$(document).on("click",".sidebar-product__item .js-remove-entry-button",function(event){event.preventDefault();var entryNumber=$(this).attr("remove-entry"),sourcing=$(this).attr("sourcing");$.blockUI(),void 0!=sourcing&&"true"==sourcing?ACC.cartitem.deleteQuantitiesWithSourcing(entryNumber).then(function(response){ACC.checkout.updateCheckoutSummary(null,ACC.config.isAsmModify).done(function(){$(".checkout-sidebar .sidebar-product__list").length<1&&location.reload()}),$.unblockUI()},function(error){$.unblockUI()}):ACC.cartitem.deleteQuantities(entryNumber).then(function(response){ACC.checkout.updateCheckoutSummary(null,ACC.config.isAsmModify).done(function(){$(".checkout-sidebar .sidebar-product__list").length<1&&location.reload()}),$.unblockUI()},function(error){$.unblockUI()})}),$(document).on("click","#checkoutAddressSubmit",function(e){var entryNumber=$(".sidebar-product__item .js-remove-entry-button").attr("remove-entry"),disEntryNumber=$(".disable-entry-block").attr("disable-entry");void 0==entryNumber&&void 0==disEntryNumber&&(e.preventDefault(),$("#vinCheckoutAddressForm").submit())}),$(document).on("click","#to-checkout-method",function(e){var entryNumber=$(".sidebar-product__item .js-remove-entry-button").attr("remove-entry"),disEntryNumber=$(".disable-entry-block").attr("disable-entry");void 0==entryNumber&&void 0==disEntryNumber&&(e.preventDefault(),$("#vinCheckoutAddressForm").submit())}),$(document).on("click","#previewOrder",function(e){var entryNumber=$(".sidebar-product__item .js-remove-entry-button").attr("remove-entry"),disEntryNumber=$(".disable-entry-block").attr("disable-entry");void 0==entryNumber&&void 0==disEntryNumber&&(e.preventDefault(),$("#vinCheckoutAddressForm").submit())}),$(document).on("click","#deliveryMethodSubmit",function(e){e.preventDefault(),$("#selectDeliveryMethodForm").submit()}),$(document).on("click",".js-link-change-cart",function(e){e.preventDefault(),IS_TOPUP_CHECKOUT?$("#checkoutHeaderData").attr("data-checkout-header-homeurl",ACC.config.encodedContextPath+"/napthe"):$("#checkoutHeaderData").attr("data-checkout-header-homeurl",ACC.config.encodedContextPath+"/cart")}),$(document).on("click","#js-checkout-header-logo",function(e){e.preventDefault(),$("#checkoutHeaderData").attr("data-checkout-header-homeurl","/")}),$(document).on("click",".js-payment-method",function(e){var $this=$(this),$input=$this.find(".adr-radio-input"),$parent=$this.parents(".checkout-payment-methods"),$detail=$this.siblings(".checkout-payment-method-detail");$this.hasClass("is-active")||(!$this.hasClass("has-error")&&$input.is(":checked")?(void 0!==ACC.track.gtmOnCheckoutOption&&"function"==typeof ACC.track.gtmOnCheckoutOption&&ACC.track.gtmOnCheckoutOption("2",$input.val()),"undefined"!=typeof gtmOnCheckout&&"function"==typeof gtmOnCheckout&&gtmOnCheckout("2",$input.val()),$(".js-payment-method").removeClass("is-active"),$this.addClass("is-active"),$detail.slideDown(),$parent.find(".checkout-payment-method-detail").not($detail).slideUp(),$parent.find(".checkout-block-warning").addClass("hidden"),$this.parent().find(".checkout-block-warning.alert-danger").removeClass("hidden")):$this.parent().find(".checkout-block-warning.alert-danger").removeClass("hidden"))});$(document).on("change",".js-payment-method .adr-radio-input",function(e){if($(this).is(":checked")){var paymentType=$(this).data("paytype"),_this=$(this),$parentLi=$(this).parent().parent(),data=$(ACC.otpCheckout._config.element.paymentForm).serialize();$.blockUI(),$.ajax({url:ACC.config.encodedContextPath+"/checkout/multi/payment-method/validatepayment",method:"post",data:data,complete:function(){setTimeout(function(){$.unblockUI()},2e3)},success:function(response){if(void 0!=response.cartDataView&&null!=response.cartDataView&&""!==response.cartDataView){var cartView=$("<div></div>").html(response.cartDataView).text();$(ACC.giftcoderedeem._config.element.cartDetail).html(cartView)}if(void 0!=response.giftcodeView&&null!=response.giftcodeView&&""!==response.giftcodeView){var giftView=$("<div></div>").html(response.giftcodeView).text();$(ACC.giftcoderedeem._config.element.giftcodeDiv).html(giftView)}if(null!=response.newInstallmentPeriod&&"undefined"!==response.newInstallmentPeriod&&response.newInstallmentPeriod.length>0){var newInstallmentPeriodView=$("<div></div>").html(response.newInstallmentPeriod).text();ACC.checkout.initInstallmentPeriod(JSON.parse(newInstallmentPeriodView))}response.shouldRefreshPaymentOptions&&window.mediator.publish("refreshPaymentOptionsInPaymentMethod");var vinIdCheckbox=$("#vinIDCheckBox"),originalRedeemable=vinIdCheckbox.data("redeemable"),shouldDisableVinId=!(originalRedeemable&&!response.shouldDisableVinID);if("PAYMENT_DISCOUNT"==paymentType){if(!response.appliedPromotion&&null!=response.paymentModeWarningView){var warningView=$("<div></div>").html(response.paymentModeWarningView).text();$parentLi.find(".js-discountpayment-error").html(warningView)}response.shouldDisableOption&&(_this.attr("disabled",!0),_this.attr("checked",!1))}$("#vinIDCheckBox").attr("disabled",shouldDisableVinId)}})}}),$(".js-payment-method .adr-radio-input").trigger("change"),$(document).on("click",".js-payment-method .adr-radio-icon.has-warning",function(e){var $this=$(this),$parent=$this.parents(".checkout-payment-methods"),$detail=$this.parents(".js-payment-method").siblings(".checkout-block-warning");$detail.removeClass("hidden"),$parent.find(".checkout-block-warning").not($detail).addClass("hidden")}),$(document).on("change",".checkout-payment-method-detail .adr-radio-input",function(e){var $this=$(this),$parent=$this.parents(".checkout-payment-method-detail"),$detail=$parent.find(".js-payment-checkbox");!$this.is(":checked")||void 0!=$this.val()&&""!=$this.val()?$detail.slideUp():$detail.slideDown()})},initPaymentOptions:function(){$(".js-payment-method .adr-radio-input").each(function(index){var $parent=$(this).parents(".checkout-payment-methods"),$detail=$(this).parents(".js-payment-method").siblings(".checkout-payment-method-detail");$(this).is(":checked")&&($detail.slideDown(),$parent.find(".checkout-payment-method-detail").not($detail).slideUp())})},afterSetShippingAddress:function(){},sendShippingAddress:function(data){var isASM=$("input[name='isASM']").val(),$isDisableDeliveryCalendar=$("#delivery-calendar"),$isDisableAdressSubmit=$("#checkoutAddressSubmit");if(void 0!==data&&!isASM){return $.ajax({url:ACC.config.encodedContextPath+"/checkout/multi/delivery-address/update",method:"post",contentType:"application/json; charset=UTF-8",data:JSON.stringify(data),beforeSend:function(){$(".checkout-main .iconLoad").show(),$isDisableDeliveryCalendar.attr("disabled","true"),$isDisableAdressSubmit.attr("disabled","true"),$("#checkoutAddressWrapper *").attr("disabled",!0)},complete:function(){$(".checkout-main .iconLoad").hide(),$isDisableDeliveryCalendar.removeAttr("disabled"),$isDisableAdressSubmit.removeAttr("disabled"),$("#checkoutAddressWrapper *").removeAttr("disabled")},success:function(response){if(response.success){var encoded=$("<div></div>").html(response.cartData.deliveryInformation).text();$("#deliveryInformation").html(encoded),ACC.checkout.updateCheckoutSummary(null,ACC.config.isAsmModify)}}})}},updateCheckoutSummary:function(checkoutStep,isAsmModify){var beforeUpdate=$("#checkoutData").data("checkoutShowPopup");return $.ajax({url:ACC.config.encodedContextPath+"/checkout/multi/deliveryaddress/updateCheckoutSummary",method:"post",dataType:"json",data:{checkoutStep:checkoutStep,isAsmModify:isAsmModify||!1},success:function(response){var encoded=$("<div></div>").html(response.checkoutSummaryInformation).text();$("#checkoutSummaryInformation1").html(encoded),$("#checkoutData").data("checkoutShowPopup")&&!beforeUpdate&&($("#checkout-step-confirm").modal("show"),ACC.checkout.initCheckoutSummaryPopup())}})},bindSavedPayments:function(){$(document).on("click",".js-saved-payments",function(e){e.preventDefault();var title=$("#savedpaymentstitle").html();$.colorbox({href:"#savedpaymentsbody",inline:!0,maxWidth:"100%",opacity:.7,title:title,close:'<span class="glyphicon glyphicon-remove"></span>',onComplete:function(){}})})},bindCheckO:function(){var cartEntriesError=!1;$(".doFlowSelectedChange").change(function(){"multistep-pci"==$("#selectAltCheckoutFlow").attr("value")?$("#selectPciOption").css("display",""):$("#selectPciOption").css("display","none")}),$(".js-continue-shopping-button").click(function(){var checkoutUrl=$(this).data("continueShoppingUrl");window.location=checkoutUrl}),$(".expressCheckoutButton").click(function(){document.getElementById("expressCheckoutCheckbox").checked=!0}),$(document).on("input",".confirmGuestEmail,.guestEmail",function(){$(".guestEmail").val()===$(".confirmGuestEmail").val()?$(".guestCheckoutBtn").removeAttr("disabled"):$(".guestCheckoutBtn").attr("disabled","disabled")}),$(".js-continue-checkout-button").click(function(){var checkoutUrl=$(this).data("checkoutUrl");if(!(cartEntriesError=ACC.pickupinstore.validatePickupinStoreCartEntires())){var expressCheckoutObject=$(".express-checkout-checkbox");if(expressCheckoutObject.is(":checked"))window.location=expressCheckoutObject.data("expressCheckoutUrl");else{var flow=$("#selectAltCheckoutFlow").attr("value");if(void 0==flow||""==flow)window.location=checkoutUrl;else{"multistep-pci"==flow&&(flow="multistep");var pci=$("#selectPciOption").attr("value"),redirectUrl=checkoutUrl+"/select-flow?flow="+flow+"&pci="+pci;window.location=redirectUrl}}}return!1})},initVatInfo:function(){var showForm=function(){var $detail=$(".checkout-vat-info");$(".checkout-export-vat-form").stop().slideDown(),$detail.stop().slideUp(),$("#vat-adr-icon").attr("class","adr-icon icon-minimize-circle")},hideForm=function(){var $detail=$(".checkout-vat-info");$(".checkout-export-vat-form").stop().slideUp(),$detail.stop().slideDown(),$("#vat-adr-icon").attr("class","adr-icon icon-edit-circle")};$("#vat-adr-checkbox-input").is(":checked")&&($("#vat_checkout-block__body").stop().slideDown(),$(".js-checkout-vat-btn").fadeIn(),"1"===$("#vatInfoMode").val()?showForm():hideForm(),$(".checkout-export-vat-form .error-message").length>0?showForm():hideForm()),$(".js-export-vat-checkbox .adr-checkbox-input").on("change",function(){$(this).is(":checked")?($(".js-checkout-vat-btn").fadeIn(),showForm()):$(".js-checkout-vat-btn").fadeOut()}),$(".js-checkout-vat-btn").on("click",function(event){event.preventDefault();var $this=$(this),$detail=$(".checkout-vat-info"),$form=$(".checkout-export-vat-form");$form.is(":visible")?($form.stop().slideUp(),$detail.stop().slideDown(),$this.find(".adr-icon").attr("class","adr-icon icon-edit-circle")):($form.stop().slideDown(),$detail.stop().slideUp(),$this.find(".adr-icon").attr("class","adr-icon icon-minimize-circle"))}),$(".js-checkout-block input").on("change",function(){var checked=$(this).is(":checked"),$block=$(this).closest(".checkout-block").find(".checkout-block__body");checked?$block.stop().slideDown():$block.stop().slideUp()})},initShippingForm:function(){var $selected=$(".js-checkout-receiver-address .adr-radio-input.js-adr-shipping-noaddress");if($selected.is(":checked")){var $li=$selected.parents("li");$li.addClass("active").siblings(".active").each(function(){$(this).removeClass("active").find(".checkout-receiver-address__form").stop().slideUp()}),$li.find(".checkout-receiver-address__form").stop().slideDown()}},initCheckoutHeader:function(){var checkoutHeader={agree:"#checkout-header-agree",cancel:"#checkout-header-cancel"};$(document).on("click",checkoutHeader.agree,function(){$(this).prop("disabled",!0),$.ajax({url:ACC.config.encodedContextPath+"/checkout/multi/delivery-address/clearSourcing",method:"post",success:function(res){window.location=$("#checkoutHeaderData").data("checkoutHeaderHomeurl")}})}),$(document).on("click",checkoutHeader.cancel,function(){$("#checkout-header-confirm").modal("hide")}),$("#checkoutData").data("checkoutShowPopup")&&$("#checkout-step-confirm").modal("show")},initCheckoutLogInLogOut:function(){var checkoutHeader={login:"#checkout-header-login",logout:"#checkout-header-logout"};$(document).on("click",checkoutHeader.login,function(){$(this).prop("disabled",!0),$.ajax({url:ACC.config.encodedContextPath+"/checkout/multi/delivery-address/clearSourcing",method:"post",success:function(res){window.location=$("#checkoutHeaderLoginData").data("checkoutHeaderLoginurl")}})}),$(document).on("click",checkoutHeader.logout,function(){$(this).prop("disabled",!0),$.ajax({url:ACC.config.encodedContextPath+"/checkout/multi/delivery-address/clearSourcing",method:"post",success:function(res){var logouUrl=$("#checkoutHeaderLogoutData").data("checkoutHeaderLogouturl");IS_TOPUP_CHECKOUT&&(logouUrl+="?topupLogout=true"),window.location=logouUrl}})})},initCheckoutSummaryPopup:function(){$("#checkout-step-cancel").on("click",function(){$("#checkout-step-confirm").modal("hide")}),$("#checkout-step-agree").on("click",function(){var index=0,removeItems=$(".sidebar-product__item .js-remove-entry-button"),removeLength=removeItems.length;removeItems.each(function(i,el){var entryNumber=$(this).attr("remove-entry");index>0&&(entryNumber-=index),index+=1;var product="remove-product_"+$(this).attr("remove-entry");$.blockUI(),$("#"+product).remove(),ACC.cartitem.deleteQuantitiesWithSourcing(entryNumber).then(function(response){$("#"+product).remove(),ACC.checkout.updateCheckoutSummary(null,ACC.config.isAsmModify),i==removeLength-1&&$("#vinCheckoutAddressForm").length>0&&($("#vinCheckoutAddressForm").append('<input type="hidden" name="reloadPageAfterRemoveEntry" value="true" />'),$("#vinCheckoutAddressForm").submit())},function(error){}),$("#checkout-step-confirm").modal("hide")}),setTimeout(function(){$.unblockUI()},1e3*index)})},initBlock:function(){this.initShippingForm(),this.initCheckoutHeader(),this.initCheckoutSummaryPopup(),this.initCheckoutLogInLogOut(),$(".js-vinid-txt").on("keyup",function(){$("#modal-checkout-vinid-point").modal()}),$(".js-checkout-receiver-address-btn").on("click",function(event){event.preventDefault();var $this=$(this),$detail=$(".checkout-receiver-address-info"),$form=$(".checkout-receiver-address__form");$form.is(":visible")?($form.stop().slideUp(),$detail.stop().slideDown(),$this.find(".adr-icon").attr("class","adr-icon icon-edit-circle")):($form.stop().slideDown(),$detail.stop().slideUp(),$this.find(".adr-icon").attr("class","adr-icon icon-minimize-circle"))}),$(".js-checkout-payment-method-btn").on("click",function(event){event.preventDefault();var $this=$(this),$detail=$(".checkout-payment-method-info"),$form=$(".checkout-payment-method-form");$form.is(":visible")?($form.stop().slideUp(),$detail.stop().slideDown(),$this.find(".adr-icon").attr("class","adr-icon icon-edit-circle")):($form.stop().slideDown(),$detail.stop().slideUp(),$this.find(".adr-icon").attr("class","adr-icon icon-minimize-circle"))}),$(".js-checkout-receiver-address .adr-radio-input").on("change",function(){var $li=$(this).parents("li");$li.addClass("active").siblings(".active").each(function(){$(this).removeClass("active").find(".checkout-receiver-address__form").stop().slideUp()}),$li.find(".checkout-receiver-address__form").stop().slideDown()}),$(".js-payment-method .adr-radio-input").on("change",function(){var $this=$(this),$parent=$this.parents(".checkout-payment-methods"),$detail=$this.parents(".js-payment-method").siblings(".checkout-payment-method-detail");$this.is(":checked")&&($detail.slideDown(),$parent.find(".checkout-payment-method-detail").not($detail).slideUp(),"cod"===$this.val()&&$("#modal-checkout-otp").modal())}),$(document).on("click",".js-toggle-panel",function(event){event.preventDefault();var target,$this=$(this);target=$this.attr("data-target");var $target=$(target);$target.length>0&&($target.is(":visible")?($target.slideUp(),$this.find(".adr-icon").attr("class","adr-icon icon-view-menu-down")):($target.slideDown(),$this.find(".adr-icon").attr("class","adr-icon icon-view-menu-up")))});!function(){
var $elem=$(".js-checkout-buyer-information-header .adr-checkbox-input"),$parent=$(".js-checkout-buyer-information-content"),hasnoBuyerAddress=$parent.data("hasno-buyeraddress"),error=$parent.data("error"),$form=$parent.find(".checkout-buyer-information-form"),$detail=$parent.find(".checkout-buyer-detail"),$button=$(".js-checkout-buyer-information-btn");error?($parent.stop().slideDown(),$button.fadeOut(),$form.show(),$detail.hide()):hasnoBuyerAddress?($parent.stop().slideDown(),$detail.hide(),$form.show(),$button.fadeOut()):($parent.stop().slideDown(),$detail.show(),$form.hide(),$button.fadeIn()),$(".js-checkout-buyer-information-header .adr-checkbox-input").on("change",function(){$elem.is(":checked")?($parent.stop().slideUp(),$button.fadeOut()):($parent.stop().slideDown(),error||hasnoBuyerAddress||$button.fadeIn())}),$(".js-checkout-buyer-information-header .adr-checkbox-input").trigger("change")}(),$(".js-checkout-buyer-information-btn").on("click",function(event){event.preventDefault(),ACC.checkout.buyerAddressSlideUpAndDown($(this))})},buyerAddressSlideUpAndDown:function(self){var $this=self,$parent=$(".js-checkout-buyer-information-content"),$form=$parent.find(".checkout-buyer-information-form"),$detail=$parent.find(".checkout-buyer-detail");$form.is(":visible")?($form.stop().slideUp(),$detail.stop().slideDown(),$this.find(".adr-icon").attr("class","adr-icon icon-edit-circle")):($form.stop().slideDown(),$detail.stop().slideUp(),$this.find(".adr-icon").attr("class","adr-icon icon-minimize-circle"))},initPopover:function(){$('.section__checkout [data-toggle="popover"], .cart-products [data-toggle="popover"]').popover({trigger:"manual",container:"body",animation:!0,viewport:{selector:".section__checkout > .container",padding:20},html:!0,content:function(){var target,$this=$(this);return target=$this.attr("data-target"),target?$(target).html():$this.attr("data-content")}}).on("click",function(e){e.preventDefault()}).on("mouseenter",function(){var _this=this;$(this).popover("show"),$(".popover").on("mouseleave",function(){$(_this).popover("hide")})}).on("mouseleave",function(){var _this=this;$(".popover:hover").length||$(_this).popover("hide")})},initCalendar:function(){$(document).on("click",".js-delivery-calendar",function(e){e.preventDefault(),$(this).closest(".checkout-delivery__item").find(".checkout-delivery__item-calendar").stop().slideToggle()}),$(document).on("click",".js-delivery-day",function(e){e.preventDefault();var day=$(this).attr("data-delivery-day");$("[data-delivery-day]").removeClass("active"),$('[data-delivery-day="'+day+'"]').addClass("active")})},initCheckoutAddress:function(){var els,bels;els={city:"#provinceIso",district_only:"#districtOnly",district:"#districtIso",ward:"#wardIso",street:"#streetIso"},bels={city:"#buyerAddress\\.provinceIso",district_only:"#buyerAddress\\.districtOnly",district:"#buyerAddress\\.districtIso",ward:"#buyerAddress\\.wardIso",street:"#buyerAddress\\.streetIso"};var locationData,bLocationData,delayCheckLoginAddress=$.Deferred(),currentAddress=($.Deferred(),ACC.requests.getCurrentAddress());locationData={province:$(els.city).attr("data-current-code"),district:$(els.district).attr("data-current-code"),ward:$(els.ward).attr("data-current-code"),street:$(els.street).val()},bLocationData={province:$(bels.city).attr("data-current-code"),district:$(bels.district).attr("data-current-code"),ward:$(bels.ward).attr("data-current-code"),street:$(bels.street).val()},_.isEmpty(locationData.province)||_.isEmpty(locationData.district)||_.isEmpty(locationData.ward)?currentAddress.done(function(addresses){_.isEmpty(addresses.province)||(locationData.province=addresses.province.code),_.isEmpty(addresses.district)||(locationData.district=addresses.district.code),_.isEmpty(addresses.ward)||(locationData.ward=addresses.ward.code),_.isEmpty(addresses.street)||(locationData.street=addresses.street.code),delayCheckLoginAddress.resolve(locationData)}):delayCheckLoginAddress.resolve(locationData),ACC.checkout.bindingCheckoutAddressAction(),delayCheckLoginAddress.done(function(locationData){ACC.requests.triggerComboLocation(els.city,els.district,els.ward,els.district_only,locationData)}),ACC.requests.triggerComboLocation(bels.city,bels.district,bels.ward,bels.district_only,bLocationData)},bindingCheckoutAddressAction:function(){var els;els={city:"#provinceIso",district_only:"#districtOnly",district:"#districtIso",ward:"#wardIso",street:"#streetIso"},$(document).on("change",els.ward,_.debounce(function(){if(!_.isEmpty(ACC.selectize.get(els.ward))){var data={provinceIso:ACC.selectize.get(els.city),districtIso:ACC.selectize.get(els.district),wardIso:ACC.selectize.get(els.ward),streetIso:""};ACC.checkout.sendShippingAddress(data)}},3*ACC.requests.timeout));$(document).on("change","input[name='shippingAddressCode']",function(){var data={};data.shippingAddressCode=$(this).val(),void 0!==data.shippingAddressCode&&data.shippingAddressCode.length<1&&void 0!==$(els.ward).val()&&""!==$(els.ward).val()&&(data={provinceIso:$(els.city).val(),districtIso:$(els.district).val(),wardIso:$(els.ward).val(),streetIso:""}),ACC.checkout.sendShippingAddress(data)})},debounceSendShippingAddress:function(elsCity,elsDistrict,elsWard){ACC.requests.debounce(function(){var data={provinceIso:$(elsCity).val(),districtIso:$(elsDistrict).val(),wardIso:$(elsWard).val(),streetIso:""};null!=data.provinceIso&&null!=data.districtIso&&null!=data.wardIso&&ACC.checkout.sendShippingAddress(data)},ACC.requests.timeout)()},bindCalenderCell:function(){var deliveryTimeDom,$isDisableAdressSubmit=$("#checkoutAddressSubmit");deliveryTimeDom=".checkout-delivery__item-calendar__table-cell",deliveryTimeItemBody=".js-delivery-time",$(document).on("click",deliveryTimeItemBody,function(){var deliveryDay,ajaxUrl,id,shipmentId,deliveryFromHour,deliveryToHour,rushHour,preSelected=!1;id="#"+$(this).attr("id"),shipmentId=$(this).attr("data-shipment-id"),deliveryDay=$(this).attr("data-delivery-day"),deliveryFromHour=$(this).attr("data-delivery-from-hour"),deliveryToHour=$(this).attr("data-delivery-to-hour"),rushHour=$(this).attr("data-delivery-rush-hour"),ajaxUrl=ACC.config.encodedContextPath+"/checkout/multi/delivery-address/selectDeliveryTime",$(id).hasClass("selected")&&($(id).removeClass("selected"),$(id).find(".hot-time").addClass("hide"),preSelected=!0);var res=$.ajax({url:ajaxUrl,method:"post",beforeSend:function(){$.blockUI(),$isDisableAdressSubmit.attr("disabled","true"),$("#checkoutAddressWrapper *").attr("disabled",!0)},complete:function(){$.unblockUI(),$isDisableAdressSubmit.removeAttr("disabled"),$("#checkoutAddressWrapper *").removeAttr("disabled")},data:{shipmentId:shipmentId,deliveryDate:deliveryDay,fromTime:deliveryFromHour,toTime:deliveryToHour,rushHour:rushHour}});res.fail(function(response){console.log("Select Delivery Time Failed")}),res.done(function(response){if(response.success){var shipmentId="#"+response.shipmentData.shipmentId+" ";if($(shipmentId).find(".checkout-delivery__item-time").html(response.shipmentData.shipmentTimeMsg),ACC.checkout.bindAsmOrderDeliveryCalendarInput(shipmentId,deliveryDay,deliveryFromHour,deliveryToHour),$(shipmentId+".delivery-time-error").remove(),$(shipmentId+".required-field-error").remove(),response.shipmentData.selectedTime){if($(shipmentId).find(deliveryTimeDom).not(id).removeClass("selected"),$(shipmentId).find(".hot-time").addClass("hide"),!preSelected){$(id).addClass("selected");var reason=$(shipmentId+"#rescheduleReasonOpt option:selected").val();ACC.config.isAsmModify&&""==reason&&$(shipmentId+".js-delivery__time-asm").append("<div class='col-md-12 required-field-error has-error'><span class='help-block'>Lý do không được để trống</span></div>")}$(id).find(".hot-time").removeClass("hide"),$(shipmentId).find("#"+response.shipmentData.deliveryDay).addClass("selected"),ACC.checkout.updateCheckoutSummary(null,ACC.config.isAsmModify)}else $(shipmentId).find(".hot-time").addClass("hide"),ACC.checkout.updateCheckoutSummary(null,ACC.config.isAsmModify)}else console.log("Select Delivery Time Unsuccess")})})},bindExpressShippingForm:function(){$(document).on("click",".js-express-shipping",function(e){ACC.checkout.submitExpressShippingForm($(this))})},submitExpressShippingForm:function(self){var checked=self.is(":checked"),poCode=self.attr("data-po-code"),$isDisableAdressSubmit=$("#checkoutAddressSubmit");$.ajax({type:"POST",url:ACC.config.encodedContextPath+"/checkout/multi/delivery-address/selectExpressShipping",dataType:"json",data:{CSRFToken:ACC.config.CSRFToken,poCode:poCode,expressShipping:checked},beforeSend:function(){$.blockUI(),$isDisableAdressSubmit.attr("disabled","true"),$("#checkoutAddressWrapper *").attr("disabled",!0)},complete:function(){$.unblockUI(),$isDisableAdressSubmit.removeAttr("disabled"),$("#checkoutAddressWrapper *").removeAttr("disabled")},success:function(response){if(response.success){console.log(response,"Changed Shippng Mode Successful");var encoded=$("<div></div>").html(response.cartData.deliveryInformation).text();$("#deliveryInformation").html(encoded),ACC.checkout.updateCheckoutSummary(null,ACC.config.isAsmModify)}else{var encoded=$("<div></div>").html(response.cartData.deliveryInformation).text();$("#deliveryInformation").html(encoded);var htmlPopup=$("<div></div>").html(response.message).text();$.colorbox({html:htmlPopup,width:"870px",onComplete:function(){$loader.css({display:"none"})}}),console.log(response,"Changed Shippng Mode Unsuccessful")}}})},bindFocusVAT:function(){$(document).on("click",".js-focus-vat",function(e){$("html, body").animate({scrollTop:$("#vat_checkout-block__body").offset().top-190},500),$("#reviewComment").focus()})},initInstallmentPeriod:function(installmentGroupJsonParam){if(void 0!==installmentGroupJsonParam&&(installmentGroupJson=installmentGroupJsonParam),"undefined"!=typeof installmentGroupJson&&!_.isNull(installmentGroupJson.banks)){var checkInstallmentOptions=function(bankCode,selectedPeriod){var $domInstallmentOptions=$('select[name="installmentOption"]'),bankPeriods=installmentGroupJson.banks[bankCode].period,optsMarkup="";console.log(bankPeriods),void 0===selectedPeriod&&(selectedPeriod=!1);for(var i in bankPeriods){var selected="";bankPeriods[i].code==selectedPeriod&&(selected=" selected"),optsMarkup+=_.template('<option data-target="#<%= bankCode %>" <%= selected %> value="<%= code %>"><%= value %></option>')({code:bankPeriods[i].code,value:bankPeriods[i].value,selected:selected,bankCode:bankCode})}$domInstallmentOptions.html(optsMarkup),$(".js-adayroi-term-msg").html(installmentGroupJson.banks[bankCode].termConditionMsg)};checkInstallmentOptions(installmentGroupJson.selectedBank,installmentGroupJson.selectedPeriod),$(document).on("change",'select[name="installmentOption"]',function(){$('select[name="installmentOption"] option:selected').attr("data-target");$('input[name="installmentPaymentMode"]').attr("data-prev",$(this).val())}),$(document).on("change",'input[name="installmentPaymentMode"]',function(){var selectedBank=$('input[name="installmentPaymentMode"]:checked').val(),selectedPeriod=$(this).attr("data-prev");checkInstallmentOptions(selectedBank,selectedPeriod)})}},handleAsmOrderDeliveryTime:function(){Number.prototype.between=function(a,b){var min=Math.min(a,b),max=Math.max(a,b);return this>min&&this<max};var keyUpHandler=function(e){var evt=e||window.event,target=evt.target||evt.srcElement,key=e.keyCode||e.which,number=($(this).val(),e.which),condition1=number.between(47,58,!0),condition2=number.between(95,106,!0);!1===condition1&&!1===condition2&&8!==e.which&&(e.preventDefault(),$(this).val("")),insertTimingColor(target,key),$("#"+target.getAttribute("data-shipment-id")+" .checkout-delivery__item-calendar .checkout-delivery__item-calendar__table-cell").removeClass("selected"),$("#"+target.getAttribute("data-shipment-id")+" .checkout-delivery__item-calendar .checkout-delivery__item-calendar__table-cell").find(".hot-time").addClass("hide")},insertTimingColor=function(element,key){element.value;if(2==element.value.trim().length&&8!==key&&(element.value>23&&(element.value=23),element.value=element.value+":"),5==element.value.trim().length&&8!==key){var m=element.value.slice(-2),hr=element.value.substring(0,element.value.length-3);m>59&&(m=59),element.value=hr+":"+m}},onChangeHandler=function(id){$(id+".delivery-time-error").remove(),$(id+".required-field-error").remove();var oderCode=$(id+".js-delivery__time-asm").attr("data-order-code"),shipmentIdSelected=$(id+".js-delivery__time-asm").attr("data-shipment-id"),dateSelected=$(id+"#asmOrderDeliveryTime").val(),timeFromSelected=$(id+".js-asm-order-delivery-from").val(),timeToSelected=$(id+".js-asm-order-delivery-to").val(),reason=$(id+"#rescheduleReasonOpt option:selected").val(),isComplain=$(id+"#isComplaintChk").prop("checked"),htmlDeliveryErrorString="<div class='col-md-12 delivery-time-error has-error'><span class='help-block'>Giờ giao hàng không hợp lệ</span></div>",htmlRequiredErrorString="<div class='col-md-12 required-field-error has-error'><span class='help-block'>##ERROR_MESSAGE##</span></div>",regex=/^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$/;if(""==dateSelected)return console.log("check required field for the delivery date"),void $(id+".js-delivery__time-asm").append(htmlRequiredErrorString.replace("##ERROR_MESSAGE##","Ngày giao hàng không được để trống"));if(""==timeToSelected)return console.log("check required field for the time to"),void $(id+".js-delivery__time-asm").append(htmlRequiredErrorString.replace("##ERROR_MESSAGE##","Giờ giao hàng không được để trống"));if(""!=timeToSelected&&!timeToSelected.match(regex))return console.log("check value for the time from if user entered value"),void $(id+".js-delivery__time-asm").append(htmlDeliveryErrorString);if(""!=timeFromSelected&&!timeFromSelected.match(regex))return console.log("check valid the selected time from"),void $(id+".js-delivery__time-asm").append(htmlDeliveryErrorString);if(""==reason)return console.log("check required field for reason"),void $(id+".js-delivery__time-asm").append(htmlRequiredErrorString.replace("##ERROR_MESSAGE##","Lý do không được để trống"));var dateSelectedFormatted=null;dateSelectedFormatted=null!=$(id+"#asmOrderDeliveryTime").datepicker("getDate")?$.datepicker.formatDate("yy-mm-dd",$(id+"#asmOrderDeliveryTime").datepicker("getDate")):$(id+"#asmOrderDeliveryTime").attr("data-date-iso");var dateTimeToSelected=new Date(dateSelectedFormatted+" "+timeToSelected).getTime(),dateTimeFromSelected=""!=timeFromSelected?new Date(dateSelectedFormatted+" "+timeFromSelected).getTime():null,unavailableSlots=$(id+"div.disabled[id*="+dateSelected.replace(/\//g,"")+"]");if(dateTimeFromSelected&&dateTimeFromSelected>dateTimeToSelected)return console.log("delivery time from is greater than delivery time to"),void $(id+".js-delivery__time-asm").append(htmlDeliveryErrorString);var $firstSlot=$(id+"div[id*="+dateSelected.replace(/\//g,"")+"]").not(".disabled").first();if(new Date(dateSelectedFormatted+" "+$firstSlot.attr("data-delivery-from-hour")).getTime()>=dateTimeToSelected)return console.log("the selected time totally outside the first available slot"),$(id+".js-delivery__time-asm").append(htmlDeliveryErrorString),!1;var $lastSlot=$(id+"div[id*="+dateSelected.replace(/\//g,"")+"]").last(),timeToLastSlot=new Date(dateSelectedFormatted+" "+$lastSlot.attr("data-delivery-to-hour")).getTime();if(dateTimeFromSelected&&dateTimeFromSelected>timeToLastSlot)return console.log("the selected time range totally outside the defined time range"),$(id+".js-delivery__time-asm").append(htmlDeliveryErrorString),!1;if(dateTimeToSelected>timeToLastSlot)return console.log("the selected time to totally outside the defined time range"),$(id+".js-delivery__time-asm").append(htmlDeliveryErrorString),!1;$(id+".checkout-delivery__item-calendar").find(unavailableSlots).each(function(index){var unavailableTimeFromSlot=new Date(dateSelectedFormatted+" "+$(this).attr("data-delivery-from-hour")).getTime(),unavailableTimeToSlot=new Date(dateSelectedFormatted+" "+$(this).attr("data-delivery-to-hour")).getTime();if(dateTimeFromSelected){if(dateTimeFromSelected>=unavailableTimeFromSlot&&dateTimeFromSelected<=unavailableTimeToSlot&&dateTimeToSelected>=unavailableTimeFromSlot&&dateTimeToSelected<=unavailableTimeToSlot)return console.log("the selected date time range inside the unavailable time range"),$(id+".js-delivery__time-asm").append(htmlDeliveryErrorString),!1;if(unavailableTimeFromSlot>dateTimeFromSelected&&unavailableTimeFromSlot<dateTimeToSelected||unavailableTimeToSlot>dateTimeFromSelected&&unavailableTimeToSlot<dateTimeToSelected)return console.log("the unavailable date time range inside the selected date time range"),$(id+".js-delivery__time-asm").append(htmlDeliveryErrorString),!1}else if(dateTimeToSelected>unavailableTimeToSlot||dateTimeToSelected>unavailableTimeFromSlot)return console.log("the selected time to is greater than the last unavailable time slot"),$(id+".js-delivery__time-asm").append(htmlDeliveryErrorString),!1});var res=$.ajax({url:ACC.config.encodedContextPath+"/my-account/edit/"+oderCode+"/updateDeliveryTimeWithReason",method:"post",data:{shipmentId:shipmentIdSelected,deliveryDate:dateSelected,fromTime:timeFromSelected,toTime:timeToSelected,reason:reason,isComplain:isComplain}});res.fail(function(response){console.log("Update delivery time failed")}),res.done(function(response){if(response.success){var shipmentId="#"+response.shipmentData.shipmentId+" ";$(shipmentId).find(".checkout-delivery__item-time").html(response.shipmentData.shipmentTimeMsg)}else console.log("Update delivery time unsuccess")})};$(document).on("keyup",".js-asm-order-delivery-time input",keyUpHandler),$(document).on("change",".js-asm-order-delivery-time input",function(){var id="#"+$(this).attr("data-shipment-id")+" ";onChangeHandler(id)}),$(document).on("change","#asmOrderDeliveryTime",function(){var id="#"+$(this).attr("data-shipment-id")+" ";$(id+".checkout-delivery__item-calendar .checkout-delivery__item-calendar__table-cell").removeClass("selected"),onChangeHandler(id)}),$(document).on("change","#rescheduleReasonOpt",function(){var id="#"+$(this).attr("data-shipment-id")+" ";onChangeHandler(id)}),$(document).on("change","#isComplaintChk",function(){var id="#"+$(this).attr("data-shipment-id")+" ";onChangeHandler(id)})},bindAsmOrderDeliveryCalendarInput:function(id,date,from,to){var $jsDeliveryTimeAsm=$(id+" .js-delivery__time-asm");$jsDeliveryTimeAsm.find("#asmOrderDeliveryTime").val(date),$jsDeliveryTimeAsm.find("#asmOrderDeliveryTime").datepicker("update"),$jsDeliveryTimeAsm.find(".js-asm-order-delivery-to").val(to),$jsDeliveryTimeAsm.find(".js-asm-order-delivery-from").val(from)},checkShowSidebarProductNotify:function(){$(".js-toggle-panel").trigger("click")}},ACC.checkoutaddress={spinner:$("<img src='"+ACC.config.commonResourcePath+"/images/spinner.gif' />"),addressID:"",showAddressBook:function(){$(document).on("click","#viewAddressBook",function(){var data=$("#savedAddressListHolder").html();$.colorbox({height:!1,html:data,onComplete:function(){$(this).colorbox.resize()}})})},showRemoveAddressConfirmation:function(){$(document).on("click",".removeAddressButton",function(){var addressId=$(this).data("addressId");$.colorbox({inline:!0,height:!1,href:"#popup_confirm_address_removal_"+addressId,onComplete:function(){$(this).colorbox.resize()}})})}},$(document).ready(function(){with(ACC.checkoutaddress)showAddressBook(),showRemoveAddressConfirmation()}),ACC.checkoutsteps={_autoload:["permeateLinks"],permeateLinks:function(){$(document).on("click",".js-checkout-step",function(e){e.preventDefault(),window.location=$(this).closest("a").attr("href")})}},ACC.cms={_autoload:[["bindAjaxComponent",$(".js-ajax-component-data").length>0],["initProductGroupAjaxComponent",$(".js-product-group-loader").length>0]],loadComponent:function(id,type,target,onSuccess,onError){var self=this;id&&$.ajax({url:ACC.config.encodedContextPath+"/cms/component?componentUid="+id,cache:!1,type:"GET",success:function(result){reprocess=result.indexOf("js-responsive-image")>-1,self.insertHtml(result,target,reprocess),onSuccess&&onSuccess(result,id,type,target)},error:function(result){onError&&onError(result,id,type,target)}})},bindAjaxComponent:function(){elements=$(".js-ajax-component-data"),elements.each(function(){void 0!==$(this).data("componentuid")&&(componentuid=$(this).data("componentuid")),controllerName="VinAjaxComponentController",url=ACC.config.encodedContextPath+"/view/"+controllerName+"/component?componentUid="+componentuid,void 0!==$(this).data("component-controller")&&""!=$(this).data("component-controller")?(controllerName=$(this).data("component-controller"),url=ACC.config.encodedContextPath+"/view/"+controllerName+"?componentUid="+componentuid):void 0!==$(this).data("component-url")&&""!=$(this).data("component-url")&&(url=$(this).data("component-url")),ACC.cms.loadAjaxComponent(componentuid,"GET","js-ajax-component-"+componentuid,url,controllerName,!0,!0)})},loadAjaxComponent:function(id,type,target,url,controllerName,onSuccess,onError){var self=this;id&&$.ajax({url:url,cache:!0,type:type,success:function(result){onSuccess&&$("#"+target).replaceWith(result),reprocess=result.indexOf("js-responsive-image")>-1,self.reprocessResponsiveImages(result,target,reprocess),self.reprocessCarouselImages(result,target,$(".js-swiper-carousel").length>-1)},error:function(result){onError&&onError(result,id,type,target)}})},reprocessResponsiveImages:function(html,target,reprocess){target&&reprocess&&ACC.global.reprocessImages()},reprocessCarouselImages:function(html,target,reprocess){target&&reprocess&&ACC.carousel.bindCarousel()},initProductGroupAjaxComponent:function(){var $container,pageOps={};$container=$(".js-product-group-loader"),$container.each(function(){var $componentContainer,productGroup,componentId,prodEl,pagingEl;componentId=$(this).attr("id"),$componentContainer=$("#"+componentId),prodEl="productGroupContainer"+componentId,pagingEl="productGroupPagination"+componentId,productGroup=ACC.productGroup[componentId],$componentContainer.prepend(_.template('<div class="container"><div class="product-list__container"><div id="<%= id %>" class="row"></div></div></div>')({id:prodEl})),$componentContainer.append(_.template('<div id="<%= id %>"></div>')({id:pagingEl}));var defaultImage={imgLoaderSrc:productGroup.data.defaultImage.url,imgSrc:productGroup.data.defaultImage.url,imgAlt:productGroup.data.defaultImage.altText,imgTitle:productGroup.data.defaultImage.description,imgBigSrc:""},productHtml="";(productHtml+=ACC.template.productGroup.item(productGroup.data.products,defaultImage,productGroup.data.superSaleImage,productGroup.data.giftImage),$("#"+prodEl).html(productHtml),parseInt(productGroup.data.numberOfPages)>1)&&(pageOps[componentId]={currentPage:0,numberOfPages:productGroup.data.numberOfPages,numberPagesShown:productGroup.data.numberPagesShown,componentId:componentId},$("#"+pagingEl).append(ACC.template.pagination(pageOps[componentId],componentId)))}),$(document).on("click",".js-ajax-pagination a",function(e){e.preventDefault();var currentPageNo,isDisabled,componentId,$pagingContainer;(isDisabled=$(this).parent().hasClass("disabled"))||(componentId=$(this).attr("data-component-id"),$pagingContainer=$("#productGroupPagination"+componentId),pageOps[componentId].currentPage=$(this).data("current-page-number"),$pagingContainer.html(ACC.template.pagination(pageOps[componentId],componentId)),currentPageNo=$(this).data("current-page-number"),ACC.requests.requestProductGroup(currentPageNo,componentId))})}};var cboxOptions={width:"95%",height:"95%",maxWidth:"960px",maxHeight:"960px"};$(".cbox-link").colorbox(cboxOptions),$(window).resize(function(){$("#colorbox").hasClass("variantSelectMobile")||$.colorbox.resize({width:window.innerWidth>parseInt(cboxOptions.maxWidth)?cboxOptions.maxWidth:cboxOptions.width,height:window.innerHeight>parseInt(cboxOptions.maxHeight)?cboxOptions.maxHeight:cboxOptions.height})}),ACC.colorbox={config:{opacity:.7,width:"auto",transition:"none",close:'<span class="color-box-close"></span>',title:'<div class="headline"><span class="headline-text">{title}</span></div>',overlayClose:!0,onComplete:function(){$.colorbox.resize(),ACC.common.refreshScreenReaderBuffer()},onClosed:function(){ACC.common.refreshScreenReaderBuffer()}},open:function(title,config){var config=$.extend({},ACC.colorbox.config,config);config.title=config.title.replace(/{title}/g,title),$.colorbox(config),ACC.selectize.initSelectize(),ACC.colorbox.resize()},resize:function(){$.colorbox.resize()},close:function(){$.colorbox.close()}},ACC.common={currentCurrency:$("main").data("currencyIsoCode")||"USD",processingMessage:$("<img src='"+ACC.config.commonResourcePath+"/images/spinner.gif'/>"),blockFormAndShowProcessingMessage:function(submitButton){submitButton.parents("form:first").block({message:ACC.common.processingMessage})},refreshScreenReaderBuffer:function(){$("#accesibility_refreshScreenReaderBufferField").attr("value",(new Date).getTime())},checkAuthenticationStatusBeforeAction:function(actionCallback){$.ajax({url:ACC.config.authenticationStatusUrl,statusCode:{401:function(){location.href=ACC.config.loginUrl}},success:function(data){"authenticated"==data&&actionCallback()}})},stepEventModal:function(sel,step){$(sel).trigger("next.m."+step)},attachCaptchaParameter:function(parentId,url){if(parent&&url){var recaptchaVal=$(parentId+" .g-recaptcha-response").val();return recaptchaVal?url+"?g-recaptcha-response="+recaptchaVal:url}},resetForm:function($form){$form&&($form.find("input:text, input:password, input:file, select, textarea").not(":hidden").val(""),$form.find("input:radio, input:checkbox").removeAttr("checked").removeAttr("selected"),$form.find(".error-message").html(""))},hidePhoneNumber:function(phone){var result=phone;phone&&phone.length>4&&(result=phone.slice(phone.length-4));for(var i=0;i<4;i++)result="x"+result;return result},formatVinIdNumber:function(vindId){var result;return result=vindId.substring(0,4)+" ",result=result+vindId.substring(4,8)+" ",result=result+vindId.substring(8,12)+" ",result+=vindId.substring(12,16)},loadModuleElements:function(obj){obj&&obj._config&&obj._config.element&&$.each(obj._config.element,function(key,value){obj[key]=$(value)})},formatThousands:function(nStr){nStr+="",x=nStr.split(","),x1=x[0],x2=x.length>1?","+x[1]:"";for(var rgx=/(\d+)(\d{3})/;rgx.test(x1);)x1=x1.replace(rgx,"$1.$2");return x1+x2},getUrlForAjaxWithAllLocationSearchParams:function(originUrl){var url=originUrl;if(void 0!==url&&url.indexOf("adrIC")<0){var searchParamsQuery=window.location.search;if(""!=searchParamsQuery&&void 0!==searchParamsQuery&&searchParamsQuery.indexOf("?")>=0){var splitSearchQuery=searchParamsQuery.split("?");if(2==splitSearchQuery.length){var searchParams=splitSearchQuery[1],params=ACC.common._parseParams(searchParams),cartCode=params.adrIC;void 0!==cartCode&&(url=url.indexOf("?")<0?url+"?adrIC="+cartCode:url+"&adrIC="+cartCode)}}}return url},_parseParams:function(searchParams){for(var params={},splitParams=searchParams.split("&"),i=0;i<splitParams.length;i++){var p=splitParams[i].split("=");null!=p&&void 0!=typeof p&&2==p.length&&(params[p[0]]=p[1])}return params}},jQuery.extend({postJSON:function(url,data,callback){return jQuery.post(ACC.common.getUrlForAjaxWithAllLocationSearchParams(url),data,callback,"json")},postJSONCallback:function(url,data,success,error){return jQuery.ajax({type:"post",url:ACC.common.getUrlForAjaxWithAllLocationSearchParams(url),data:data,dataType:"json",contentType:"application/json; charset=utf-8",headers:{CSRFToken:ACC.config.CSRFToken},success:success,error:error})},postJSONCallbackWithLoading:function(url,data,successHander,errorHandler,blockContainer){var beforeSendHandler=function(){blockContainer&&blockContainer.find(".ui-ajax-block").block()},completeHandler=function(){blockContainer&&blockContainer.find(".ui-ajax-block").unblock()};return jQuery.ajax({type:"post",url:ACC.common.getUrlForAjaxWithAllLocationSearchParams(url),data:data,dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:beforeSendHandler,complete:completeHandler,success:successHander,error:errorHandler})}}),$.ajaxPrefilter(function(options,originalOptions,jqXHR){if("post"===options.type||"POST"===options.type){if(void 0===options.data)options.data="CSRFToken="+ACC.config.CSRFToken;else{/application\/json/i.test(options.contentType)?jqXHR.setRequestHeader("CSRFToken",ACC.config.CSRFToken):-1===options.data.indexOf("CSRFToken")?options.data=options.data+"&CSRFToken="+ACC.config.CSRFToken:void 0!==window.FormData&&options.data instanceof window.FormData&&options.data.append("CSRFToken",ACC.config.CSRFToken)}}options.url=ACC.common.getUrlForAjaxWithAllLocationSearchParams(options.url)}),$(document).ready(function(){if($(document).on("keydown","input[number-only]",function(e){-1!==$.inArray(e.keyCode,[46,8,9,27,13,110,190,189,173,109])||65==e.keyCode&&(!0===e.ctrlKey||!0===e.metaKey)||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}),$(document).fb("749384515190849",{status:!0,cookie:!0,xfbml:!0,oauth:!0}),$(window).scroll(function(){$(this).scrollTop()>50?$("#back-to-top").fadeIn():$("#back-to-top").fadeOut()}),$("#back-to-top").click(function(){return $("#back-to-top").tooltip("hide"),$("body,html").animate({scrollTop:0},800),!1}),$("#back-to-top").tooltip("show"),$(window).load(function(){setTimeout(function(){$(".loader").hide()},500)}),$(".tooltip .icon-hint").on("click",function(event){$(".tooltiptext").toggle()}),$(".js-button-cancel-modification,.js-button-revert").on("click",function(event){$("this").attr("disabled",!0)}),$(document).on("click",".js-enquire-offcanvas-navigation .js-enquire-has-sub .js_nav__link--drill__down",function(e){$(".navigation__overflow").scrollTop(0)}),$(".nav-tabs li .call-witch-tab").click(function(e){e.preventDefault(),e.stopImmediatePropagation(),$(this).tab("show")}),$("img[usemap]").length>0&&$("img[usemap]").rwdImageMaps(),this.utils={isIOS:function(version){return/iPad|iPhone|iPod/.test(navigator.userAgent)},isIOS11:function(){return/OS 11_/.test(navigator.userAgent)}},this.utils.isIOS()&&this.utils.isIOS11()&&$("body").addClass("ios ios-11"),$(document).on("click",".js-ajax-pagination li a",function(e){var $target,componentId,scrollTop=0;componentId=$(this).attr("data-component-id"),_.isEmpty(componentId)||($target=$(_.template("#<%= id %>")({id:componentId})),_.isElement($target[0])&&(scrollTop=$target.offset().top-$("header").height())),$("body,html").scrollTop(scrollTop)}),$(".product__list-slider-setion").each(function(e){$(".product-group-carousel .swiper-slide").length>6&&$(".product-group-carousel .swiper-button-next").removeClass("swiper-button-disabled")}),$(".mobile-charge").length>0){$("#number-phone").val()>9&&$("#js-card-submit").removeAttr("disabled")}$(".product-detail__section").length>0&&$(window).width()<1024&&$(".product-detail__sidebar").appendTo(".product-detail__right--mobile")}),$(window).load(function(){$("html,body").trigger("scroll"),$(".mobile-charge").length>0&&window.performance&&2===window.performance.navigation.type&&(console.log("Reloading"),window.location.reload())}),ACC.forgottenpassword={_config:{element:{popupRequest:"#forgot-password-request",popupChange:"#forgot-password-change",popupRequestBlock:"#forgot-password-request .modal-content",popupChangeBlock:"#forgot-password-change .modal-content"}},_autoload:["initElements","bindLink"],initElements:function(){ACC.common.loadModuleElements(ACC.forgottenpassword),this.popupRequest.on("hidden.bs.modal",function(){ACC.captcha.reset("js-forgot-password-request-captcha")})},bindLink:function(){$(document).on("click",".js-forgot-password-link",function(e){e.preventDefault();var currentPopup=$(this).closest(".modal");currentPopup?currentPopup.modal("hide"):$.colorbox.close(),
ACC.forgottenpassword._openRequestPopup()}),$(document).on("click",".js-fp-resend-otp",function(e){e.preventDefault(),ACC.forgottenpassword.popupChangeBlock.block(),$.ajax({url:ACC.config.forgotPasswordResendOtpUrl,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",success:function(result){ACC.forgottenpassword.popupChangeBlock.unblock(),$(".js-fp-otp-error").html(""),$(".js-fp-otp-resend-msg").html(result)},error:function(jqXHR){ACC.forgottenpassword.popupChangeBlock.unblock(),$(".js-fp-otp-error").html(jqXHR.responseJSON.message),$(".js-fp-otp-resend-msg").html("")}})}),$("#js-forgot-password-form").submit(function(event){event.preventDefault(),ACC.forgottenpassword._sendOtp()}),$("#js-otp-forgot-password-confirm").submit(function(event){event.preventDefault();var requestUrl=ACC.config.forgotPasswordChangeUrl+"?g-recaptcha-response="+ACC.captcha.getResponse("js-forgot-password-captcha");ACC.forgottenpassword.popupChangeBlock.block(),$.ajax({url:requestUrl,type:"POST",data:JSON.stringify({otpCode:$(".js-forgot-password-otp").val(),newPassword:$(".js-forgot-password-new-otp").val(),newPasswordConfirm:$(".js-forgot-password-new-confirm-otp").val()}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(result){ACC.forgottenpassword.popupChangeBlock.unblock(),result.success?(ACC.forgottenpassword._closeChangePopup(),ACC.login.show()):(ACC.forgottenpassword._resetChangePopup(result),ACC.captcha.reset("js-forgot-password-captcha"))},error:function(jqXHR){ACC.forgottenpassword.popupChangeBlock.unblock(),$(".js-fp-otp-error").html(jqXHR.responseJSON.message),ACC.captcha.reset("js-forgot-password-captcha")}})})},_closeRequestPopup:function(){this.popupRequest.modal("hide"),ACC.captcha.reset("js-forgot-password-request-captcha")},_openRequestPopup:function(){ACC.captcha.renderWidget("js-forgot-password-request-captcha"),$(".js-forgot-password-username").val(""),$(".js-fp-request-username-error").html(""),$(".js-fp-request-captcha-error").html(""),this.popupRequest.modal("show")},_closeChangePopup:function(){this.popupChange.modal("hide"),ACC.captcha.reset("js-forgot-password-captcha")},_openChangePopup:function(isEmail){$(".js-forgot-password-otp").val(""),this._resetChangePopup(),isEmail?($(".js-fp-change-sms").addClass("hide"),$(".js-fp-change-email").removeClass("hide")):($(".js-fp-change-sms").removeClass("hide"),$(".js-fp-change-email").addClass("hide")),this.popupChange.modal("show"),ACC.captcha.renderWidget("js-forgot-password-captcha")},_resetChangePopup:function(result){$(".js-forgot-password-new-otp").val(""),$(".js-forgot-password-new-confirm-otp").val(""),$(".js-fp-otp-resend-msg").html(""),result?($(".js-fp-otp-error").html(result.otpMsg),$(".js-fp-new-pwd-error").html(result.newPasswordMsg),$(".js-fp-new-pwd-confirm-error").html(result.newPasswordConfirmMsg),$(".js-fp-captcha-error").html(result.captchaMsg)):($(".js-fp-otp-error").html(""),$(".js-fp-new-pwd-error").html(""),$(".js-fp-new-pwd-confirm-error").html(""),$(".js-fp-captcha-error").html(""))},_sendOtp:function(){var requestUrl=ACC.config.forgotPasswordUrl+"?otpfunc="+ACC.otp.func.resetPass;requestUrl+="&g-recaptcha-response="+ACC.captcha.getResponse("js-forgot-password-request-captcha");var requestData={type:ACC.config.otpRequestType.FORGOTTEN_PASSWORD,username:$(".js-forgot-password-username").val()};ACC.forgottenpassword.popupRequestBlock.block(),$.ajax({url:requestUrl,type:"POST",data:JSON.stringify(requestData),dataType:"json",contentType:"application/json; charset=utf-8",success:function(result){ACC.forgottenpassword.popupRequestBlock.unblock(),result.success?(ACC.forgottenpassword._closeRequestPopup(),ACC.forgottenpassword._openChangePopup(result.email)):($(".js-fp-request-username-error").html(result.usernameMsg),$(".js-fp-request-captcha-error").html(result.captchaMsg),ACC.captcha.reset("js-forgot-password-request-captcha"))},error:function(jqXHR){ACC.forgottenpassword.popupRequestBlock.unblock(),$(".js-fp-request-username-error").html(jqXHR.responseJSON.message),ACC.captcha.reset("js-forgot-password-request-captcha")}})}},ACC.global={_autoload:["formatNumber","formatInput",["passwordStrength",$(".password-strength").length>0],"bindToggleOffcanvas","bindToggleXsSearch","initImager","backToHome",["categoryMenu",$(".category-menu").length>0],"selectboxRedirect",["selectFormSubmit",$(".js-form-submit").length>0],"initActionFooterClickMobile","bindAccordion",["initColorboxVideo",$(".js-youtube").length>0],["preventScriptInjection",$(".js-script-check").length>0],["imgLazyLoad",$(".pageType-CategoryPage, .pageType-MerchantPage, .pageType-BrandPage, .page-search, .js-swiper-lp-product-slider, .home__banner").length>0],["imgLazyLoadAppendClass",$(".js-lazy-img-class").length>0],["handleSearchSubmit",$(".js-search-form").length>0]],formatNumber:function(){$(".js-parse-float").each(function(){var val=$(this).text();void 0!==val&&$(this).html(parseFloat(val))})},formatInput:function(){$('.js-input-range[type="number"]').each(function(){$(this).on("blur",function(){var current,max;current=parseInt($(this).val()),parseInt($(this).attr("min")),max=parseInt($(this).attr("max")),current>max&&$(this).val(max)})})},closeModal:function(){$(".modal").on("click",function(e){($(e.target).hasClass("modal-dialog")||$(e.target).hasClass("modal")||$(e.target).hasClass("step-1"))&&$(".modal").modal("hide")})},passwordStrength:function(){$(".password-strength").pstrength({verdicts:[ACC.pwdStrengthTooShortPwd,ACC.pwdStrengthVeryWeak,ACC.pwdStrengthWeak,ACC.pwdStrengthMedium,ACC.pwdStrengthStrong,ACC.pwdStrengthVeryStrong],minCharText:ACC.pwdStrengthMinCharText})},bindAccordion:function(){$(".js-accordion .accordion-item .accordion-title").on("click",function(){$(this).parents().siblings().removeClass("open"),$(this).parents().addClass("open")})},bindToggleOffcanvas:function(){$(document).on("click",".js-toggle-sm-navigation",function(){ACC.global.toggleClassState($("main"),"offcanvas"),ACC.global.toggleClassState($("html"),"offcanvas"),ACC.global.toggleClassState($("body"),"offcanvas"),ACC.global.resetXsSearch(),$(".bg-overlay").show(),$("body").toggleClass("show--mobile")}),$(document).on("click",".js-close-mobile",function(){ACC.global.toggleClassState($("main"),"offcanvas"),ACC.global.toggleClassState($("html"),"offcanvas"),ACC.global.toggleClassState($("body"),"offcanvas"),ACC.global.resetXsSearch(),$(".bg-overlay").hide(),$("body").toggleClass("show--mobile")}),$(document).on("click",".bg-overlay",function(){ACC.global.toggleClassState($("main"),"offcanvas"),ACC.global.toggleClassState($("html"),"offcanvas"),ACC.global.toggleClassState($("body"),"offcanvas"),ACC.global.resetXsSearch(),$(this).hide(),$("body").toggleClass("show--mobile")}),$(document).on("click",".js__change-delivery--mobile",function(e){e.preventDefault(),ACC.global.toggleClassState($("main"),"offcanvas"),ACC.global.toggleClassState($("html"),"offcanvas"),ACC.global.toggleClassState($("body"),"offcanvas"),ACC.global.resetXsSearch(),$(".bg-overlay").hide(),$("body").toggleClass("show--mobile"),ACC.delivery.popup("show")}),$(document).on("click",".js-login-btn",function(e){e.preventDefault(),ACC.global.toggleClassState($("main"),"offcanvas"),ACC.global.toggleClassState($("html"),"offcanvas"),ACC.global.toggleClassState($("body"),"offcanvas"),$(".bg-overlay").hide()})},bindToggleXsSearch:function(){$(document).on("click",".js-toggle-xs-search",function(){ACC.global.toggleClassState($(".site-search"),"active"),ACC.global.toggleClassState($(".js-mainHeader .navigation--middle"),"search-open")})},resetXsSearch:function(){$(".site-search").removeClass("active"),$(".js-mainHeader .navigation--middle").removeClass("search-open")},toggleClassState:function($e,c){return $e.hasClass(c)?$e.removeClass(c):$e.addClass(c),$e.hasClass(c)},initImager:function(elems){elems=elems||".js-responsive-image",this.imgr=new Imager(elems)},reprocessImages:function(elems){elems=elems||".js-responsive-image",void 0==this.imgr?this.initImager(elems):this.imgr.checkImagesNeedReplacing($(elems))},addGoogleMapsApi:function(callback){void 0!=callback&&0==$(".js-googleMapsApi").length?$("head").append('<script class="js-googleMapsApi" type="text/javascript" src="//maps.googleapis.com/maps/api/js?key='+ACC.config.googleApiKey+"&sensor=false&callback="+callback+'"><\/script>'):void 0!=callback&&eval(callback+"()")},backToHome:function(){$(".backToHome").on("click",function(){var sUrl=ACC.config.contextPath;window.location=sUrl})},categoryMenu:function(){$(".category-menu li").each(function(){var $self;$self=$(this),$self.hasClass("active")&&($self.addClass("category-tree"),$self.parents("li.category-item").addClass("category-tree"),$self.hasClass("category-item_lv2")?$self.addClass("has-arrow"):$self.parents("li.category-item_lv2").addClass("has-arrow")),$self.hasClass("parent-arrow")&&$self.addClass("has-arrow")}),ACC.global.categoryMenuShowMore(25)},categoryMenuShowMore:function(maxRow){var totalRow,extraRow=[];if((totalRow=$(".category-item:visible").length)>maxRow){for(var i=0;i<totalRow;i++)i>maxRow-1&&extraRow.push($(".category-item:visible")[i]);if($(".section__category").append('<span class="category-showmore">Xem thêm</span><span class="category-showless hidden">Thu gọn</span>'),extraRow.length>0)for(var r=0;r<extraRow.length;r++)$(extraRow[r]).addClass("category-extra hidden");$("body").on("click",".category-showmore",function(){$self=$(this).addClass("hidden"),$(".category-showless").removeClass("hidden"),$(".category-item").removeClass("hidden")}),$("body").on("click",".category-showless",function(){$self=$(this).addClass("hidden"),$(".category-showmore").removeClass("hidden"),$(".category-item.category-extra").addClass("hidden")})}},selectboxRedirect:function(){$("body").on("change",".js-select-redirect",function(){var redirectPath,redirectUrl;redirectPath=$(this).find("option:selected").attr("data-url"),redirectUrl=window.location.origin+redirectPath,window.location.href=redirectUrl})},selectFormSubmit:function(){$("body").on("click",".js-form-submit",function(){var dataForm,dataFor,dataValue;dataForm=$(this).attr("data-form"),dataFor=$(this).attr("data-for"),dataValue=$(this).attr("data-value"),$(dataFor).val(dataValue),$(dataForm).submit()})},initActionFooterClickMobile:function(){$(".footer__nav-container .footer__nav-list .title, .footer__credit--title").prepend('<span class="nav-click"><i class="nav-arrow"></i></span>'),$(window).width()<=1023&&($(".footer__nav-container .footer__nav-list").on("click",".title",function(e){e.preventDefault();var self=$(this);self.siblings(".footer__nav-links").slideToggle(),self.find(".nav-click").children(".nav-arrow").toggleClass("nav-rotate")}),$(".footer__credit").on("click",".footer__credit--title",function(e){e.preventDefault();var self=$(this);self.siblings(".footer__credit--content").slideToggle(),self.find(".nav-click").children(".nav-arrow").toggleClass("nav-rotate")}))},initColorboxVideo:function(){$(".js-youtube").colorbox({iframe:!0,innerWidth:640,innerHeight:390})},preventScriptInjection:function(){var $input=$(".js-script-check");$input.on("blur",function(){var v=$(this).val();v=v.replace(/(<([^>]+)>)/gi,""),v=v.replace(/[!@#~_=+;<>,.?$%^&*]/g,""),v=v.replace(/[\])}[{(]/g,""),_.isString(v)&&!_.isFunction(v)&&$(this).val(v)}),$input.on("paste",function(e){e.preventDefault()})},imgLazyLoad:function(){$("img.lazy").lazyload({threshold:50,skip_invisible:!1,effect:"fadeIn"})},imgLazyLoadAppendClass:function(){$("img.js-lazy-img-class").each(function(){var uniqueEvent=_.uniqueId("lazyImg_");$(this).lazyload({event:uniqueEvent,threshold:50,skip_invisible:!1}),$(this).trigger(uniqueEvent),$(this).load(function(){var appendClass=$(this).attr("data-append");void 0!=appendClass&&$(this).addClass(appendClass)})})},handleSearchSubmit:function(){var searchEls={form:".js-search-form",input:".js-site-search-input"};$(document).on("submit",searchEls.form,function(e){var v=$(searchEls.input).val();v=ACC.requests.searchPattern(v),$(searchEls.input).val(v),v?$(this).unbind("submit").submit():(e.preventDefault(),setTimeout(function(){$(searchEls.form).find('[type="submit"]').trigger("click")},ACC.requests.timeout))})}},ACC.hopdebug={bindAll:function(){this.bindShowDebugMode()},bindShowDebugMode:function(){$("#hopDebugMode").data("hopDebugMode")||$("#showDebugPage").attr("value")||$("#hostedOrderPagePostForm").submit()}},$(document).ready(function(){ACC.hopdebug.bindAll()}),ACC.imagegallery={_autoload:["bindImageGallery"],bindImageGallery:function(){$(".js-gallery").each(function(){function startZoom(e){$(e).zoom({url:$(e).find("img.lazyOwl").data("zoomImage"),touch:!0,on:"grab",touchduration:300,onZoomIn:function(){},onZoomOut:function(){$image.data("owlCarousel").dragging(!0),$image.data("zoomEnable",!0)},zoomEnableCallBack:function(){var bool=$image.data("zoomEnable"),owl=$image.data("owlCarousel");return 0==bool?owl.dragging(!0):owl.dragging(!1),bool}})}var $image=$(this).find(".js-gallery-image"),$carousel=$(this).find(".js-gallery-carousel");$image.owlCarousel({singleItem:!0,pagination:!0,navigation:!0,lazyLoad:!0,navigationText:["<span class='glyphicon glyphicon-chevron-left'></span>","<span class='glyphicon glyphicon-chevron-right'></span>"],afterAction:function(){ACC.imagegallery.syncPosition($image,$carousel,this.currentItem),$image.data("zoomEnable",!0)},startDragging:function(){$image.data("zoomEnable",!1)},afterLazyLoad:function(e){var b=$image.data("owlCarousel")||{};b.currentItem||(b.currentItem=0),startZoom($($image.find("img.lazyOwl")[b.currentItem]).parent())}}),$carousel.owlCarousel({navigation:!0,navigationText:["<span class='glyphicon glyphicon-chevron-left'></span>","<span class='glyphicon glyphicon-chevron-right'></span>"],pagination:!1,items:2,itemsDesktop:[5e3,7],itemsDesktopSmall:[1200,5],itemsTablet:[768,4],itemsMobile:[480,3],lazyLoad:!0,afterAction:function(){}}),$carousel.on("click","a.item",function(e){e.preventDefault(),$image.trigger("owl.goTo",$(this).parent(".owl-item").data("owlItem"))})})},syncPosition:function($image,$carousel,currentItem){$carousel.trigger("owl.goTo",currentItem)}},ACC.langcurrency={_autoload:["bindLangCurrencySelector"],bindLangCurrencySelector:function(){$("#lang-selector").change(function(){$("#lang-form").submit()}),$("#currency-selector").change(function(){$("#currency-form").submit()})}},ACC.minicart={_autoload:[["bindMiniCart",$(".js-mini-cart-link").length>0]],miniColorbox:"",bindMiniCart:function(){$(document).on("click",".js-mini-cart-link",function(e){e.preventDefault();var url=$(this).data("miniCartUrl");0!==$(this).find(".js-mini-cart-count").html()?$(this).data("miniCartName"):$(this).data("miniCartEmptyName");ACC.minicart.showMiniCart(url)}),$(document).on("click",".js-mini-cart-close-button, .js-mini-cart-off",function(e){var $body=$("body");e.preventDefault(),ACC.colorbox.close(),$body.removeClass("modal-open")}),$(document).on("click",".js-cart-continue-shopping-button",function(e){ACC.isMiniCart&&(ACC.isMiniCart=!1,e.preventDefault(),ACC.colorbox.close())}),$(document).on("click","#js-cart-continue-shopping-button",function(e){ACC.isMiniCart&&(ACC.isMiniCart=!1,e.preventDefault(),ACC.colorbox.close())}),$(document).on("click",".js-remove-entry-button",function(e){e.preventDefault(),$.colorbox.resize()})},showMiniCart:function(miniCartUrl){var $body=($(".cart-product").length,$("body")),$width=$(window).width(),$colorboxOptions={href:miniCartUrl,maxWidth:"100%",width:"800px",initialWidth:"800px",reposition:!0,className:"miniCartPopup",onComplete:function(){$("#cboxClose").show(),$width>767&&ACC.minicart.bindScrollMinicart(),$.colorbox.resize(),ACC.minicart.updateMiniCartDisplay()},onClosed:function(){$("#cboxClose").hide(),$body.removeClass("modal-open")}};ACC.isMiniCart=!0,$.colorbox($colorboxOptions),$(window).on("resize",function(){$.colorbox.resize()})},bindScrollMinicart:function(){var self=$("#cboxContent").height(),heightpromotion=$(".cart-total__promotion-detail").height(),niceScrollOptions={cursorwidth:"5px",cursorborderradius:"0",cursorborder:"1px solid transparent",cursorcolor:"#cc2023",autohidemode:!1,background:"#d8d8d8",horizrailenabled:!1,railpadding:{top:1,right:1,left:1,bottom:1}};if(self>380){var $cartProductBody=$("#cboxContent .cart-products__body");$cartProductBody.css("max-height","280px"),$cartProductBody.css("margin","15px 0"),$cartProductBody.css("padding","0 15px 0 5px"),$(".miniCartPopup .cart-products__body").niceScroll(niceScrollOptions)}if(heightpromotion>60){var $cartTotalPromotion=$(".cart-total__promotion");$cartTotalPromotion.css("max-height","60px"),$cartTotalPromotion.css("padding","0 15px 0 0px"),$(".miniCartPopup .cart-total__promotion").niceScroll(niceScrollOptions)}},updateMiniCartDisplay:function(){var miniCartRefreshUrl=($(".js-mini-cart-link").data("miniCartItemsText"),$(".js-mini-cart-link").data("miniCartRefreshUrl"));$(".miniCartPopup").height();ACC.minicart.preventScrollOutside(),miniCartRefreshUrl&&$.ajax({url:miniCartRefreshUrl,cache:!1,type:"GET",success:function(jsonData){var miniCartCount=jsonData.miniCartCount,$cartTotalUnits=$(".mini-cart-icon .js-cart-total-unit"),$body=$("body"),width=$(window).width();console.log("item cart"+miniCartRefreshUrl),jsonData.miniCartCount>99&&(miniCartCount="99+"),jsonData.totalEntries>2&&width>1023?$body.removeClass("modal-open"):$body.addClass("modal-open"),0===miniCartCount?$cartTotalUnits.remove():$cartTotalUnits.length?$cartTotalUnits.html(miniCartCount):$(".mini-cart-icon").append('<span class="mini-cart-price js-cart-total-unit">'+miniCartCount+"</span>")}}),ACC.minicart.bindScrollMinicart(),$.colorbox.resize()},preventScrollOutside:function(){$(".miniCartPopup .cart-products").on("mousewheel DOMMouseScroll",function(e){var scrollTo=null;"mousewheel"===e.type?scrollTo=-1*e.originalEvent.wheelDelta:"DOMMouseScroll"===e.type&&(scrollTo=40*e.originalEvent.detail),scrollTo&&(e.preventDefault(),$(this).scrollTop(scrollTo+$(this).scrollTop()))})}};var oDoc=document;ACC.navigation={_autoload:[["offcanvasNavigation",$(".js-mainHeader").length>0],["myAccountNavigation",$(".js-mainHeader").length>0],["headerSticky",$(".pageType-ProductPage").length<1],["searchBarCategorySelected",$(".js-mainHeader").length>0],["topNavDisplay",$(".js-mainHeader").length>0],"initMainNavigation"],offcanvasNavigation:function(){enquire.register("screen and (max-width:"+screenSmMax+")",{match:function(){$(document).on("click",".js-enquire-offcanvas-navigation .js-enquire-has-sub .js_nav__link--drill__down",function(e){e.preventDefault(),$(".js-userAccount-Links").hide(),$(".js-enquire-offcanvas-navigation ul.js-offcanvas-links").addClass("active"),$(".js-enquire-offcanvas-navigation .js-enquire-has-sub").removeClass("active"),$(this).parent(".js-enquire-has-sub").addClass("active")}),$(document).on("click",".js-enquire-offcanvas-navigation .js-enquire-sub-close",function(e){e.preventDefault(),$(".js-userAccount-Links").show(),$(".js-enquire-offcanvas-navigation ul.js-offcanvas-links").removeClass("active"),$(".js-enquire-offcanvas-navigation .js-enquire-has-sub").removeClass("active")}),$(document).on("click",".js_nav__link--go-child .title",function(){$(this).hasClass("view-all")||($(this).parent().siblings().hide(),$(this).parent().find(".sub-navigation-list").show(),$(this).hide(),$(".js-enquire-sub-close").hide())}),$(document).on("click",".js-enquire-go-child-close",function(){$(this).parent().parent().siblings().show(),$(this).parent().hide(),$(".js_nav__link--go-child .title").show(),$(".js-enquire-sub-close").show()})},unmatch:function(){$(".js-userAccount-Links").show(),$(".js-enquire-offcanvas-navigation ul.js-offcanvas-links").removeClass("active"),$(".js-enquire-offcanvas-navigation .js-enquire-has-sub").removeClass("active"),$(document).off("click",".js-enquire-offcanvas-navigation .js-enquire-has-sub > a"),$(document).off("click",".js-enquire-offcanvas-navigation .js-enquire-sub-close")}})},myAccountNavigation:function(){$(".js-mobile-logo").html($(".js-site-logo a").clone()),$(".nav-form").html($('<span class="glyphicon glyphicon-list-alt"></span>'));var aAcctData=[],sSignBtn="",oMyAccountData=$(".accNavComponent");$(".js-secondaryNavAccount > ul"),$(".navigation--bottom > ul.nav__links.nav__links--products");if(oMyAccountData)for(var aLinks=oMyAccountData.find("a"),i=0;i<aLinks.length;i++)aAcctData.push({link:aLinks[i].href,text:aLinks[i].title});$(".liOffcanvas a")&&$(".liOffcanvas a").length>0&&(sSignBtn+='<li class="auto liUserSign" ><a class="userSign" href="'+$(".liOffcanvas a")[0].href+'"><img src="'+ACC.config.themeResourcePath+'/images/user-left-menu.png" title="" alt="" /><span class="js-sign-in__popup">Đăng nhập</span> / <span class="js-sign-up__popup_button">Đăng ký</span></a></li>');var oUserInfo=$(".nav__right ul li.logged_in");if(oUserInfo&&1===oUserInfo.length){var sUserBtn="";sUserBtn+='<li class="auto ">',sUserBtn+='<div class="userGroup">',sUserBtn+='<span class="glyphicon glyphicon-user myAcctUserIcon"></span>',sUserBtn+='<div class="userName">'+oUserInfo[0].innerHTML+"</div>",aAcctData.length>0&&(sUserBtn+='<a class="collapsed js-nav-collapse" id="signedInUserOptionsToggle" data-toggle="collapse"  data-target=".offcanvasGroup1">',sUserBtn+='<span class="glyphicon glyphicon-chevron-up myAcctExp"></span>',sUserBtn+="</a>"),sUserBtn+="</div>",sUserBtn+="",$(".js-sticky-user-group").html(sUserBtn),$(".js-userAccount-Links").append(sSignBtn),$(".js-userAccount-Links").append($('<li class="auto"><div class="myAccountLinksContainer js-myAccountLinksContainer"></div></li>'));var myAccountHook=$('<a class="myAccountLinksHeader collapsed js-myAccount-toggle" data-toggle="collapse" data-parent=".nav__right" href="#accNavComponentDesktopOne">'+oMyAccountData.data("title")+"</a>");myAccountHook.insertBefore(oMyAccountData);var myAccountHook=[];myAccountHook.push('<div class="sub-nav">'),myAccountHook.push('<a id="signedInUserAccountToggle" class="myAccountLinksHeader collapsed js-myAccount-toggle" data-toggle="collapse" data-target=".offcanvasGroup2">'),myAccountHook.push(oMyAccountData.data("title")),myAccountHook.push('<span class="glyphicon glyphicon-chevron-down myAcctExp"></span>'),myAccountHook.push("</a>"),myAccountHook.push("</div>"),$(".js-myAccountLinksContainer").append(myAccountHook.join("")),$(".js-myAccountLinksContainer").append($('<ul data-trigger="#signedInUserAccountToggle" class="offcanvasGroup2 offcanvasNoBorder collapse js-nav-collapse-body subNavList js-myAccount-root sub-nav"></ul>'));for(var i=aAcctData.length-1;i>=0;i--){var oLink=oDoc.createElement("a");oLink.title=aAcctData[i].text,oLink.href=aAcctData[i].link,oLink.innerHTML=aAcctData[i].text;var oListItem=oDoc.createElement("li");oListItem.appendChild(oLink),oListItem=$(oListItem),oListItem.addClass("auto "),$(".js-myAccount-root").append(oListItem)}}else{var navButtons=sSignBtn.substring(0,sSignBtn.length-5)+"</li>";$(".js-sticky-user-group").html(navButtons)}},headerSticky:function(){if($("header .navigation--middle").length>0){var top=$("header .navigation--middle").offset().top,height=$("header .navigation--middle").height(),addStickyClass=function(){var scrollTop=$(window).scrollTop();scrollTop>=top+height&&$("header").addClass("fixed"),scrollTop<=top&&$("header").removeClass("fixed")};addStickyClass(),$(window).scroll(function(event){$(this).scrollTop(),addStickyClass()})}},searchBarCategorySelected:function(){$(document).on("click",".js-select-category .dropdown-menu a",function(){var content=$(this).text(),value=$(this).attr("data-value");$(".js-select-category .category-selected").html(content),$(".js-select-category .input-selected").val(value)}),$(document).on("mouseleave",".dropdown-menu ",function(){$(this).parent(this).removeClass("open")})},topNavDisplay:function(){ACC.navigation.topNavChecking(),$(window).bind("resize",function(){$(".top_nav-item").removeClass("hidden"),ACC.navigation.topNavChecking()})},topNavChecking:function(){var allLevels,maxLevels,allSelectors;if(allLevels=[],allSelectors={},$(".top_nav-item").length<1?$(".section__sale").addClass("hidden"):$(".section__sale").removeClass("hidden"),$(".top_nav-item:visible").each(function(){var key=$(this).attr("data-level");allLevels.push($(this).attr("data-level")),allSelectors[key]={level:$(this).attr("data-level"),order:$(this).attr("data-order"),priority:$(this).attr("data-priority")},maxLevels=Math.max.apply(Math,allLevels)}),$(".js-top-nav").height()>36)return $('.top_nav-item[data-level="'+maxLevels+'"]:visible:last').addClass("hidden"),ACC.navigation.topNavChecking();$(".js-top-nav").removeClass("disabled")},initMainNavigation:function(){var $menuCatParentLink,menuState={};$menuCatParentLink=$(".menu__cat-list--parent a.menu__cat-link"),$(".menu__cat-list--child"),menuState={normal:function(){$(".feature__sec.feature__sec-banner").removeClass("hidden"),$(".feature__sec.feature__sec-cat").addClass("hidden"),$(".menu__cat-list--parent li.menu__cat-item").removeClass("is-active")},hover:function(imgCatList){if($(".feature__sec.feature__sec-banner").addClass("hidden"),$(".feature__sec.feature__sec-cat").removeClass("hidden"),!_.isEmpty(imgCatList)&&!_.isUndefined(imgCatList)){var $catFeature=$(".feature__sec.feature__sec-cat .feature__sec-focus img"),$catThumb=$(".feature__sec.feature__sec-cat .feature__sec-thumbs img");$catFeature.attr("src",imgCatList.image1),$catFeature.parent().attr("href",imgCatList.imageUrl1);for(var i=0;i<=5;i++){var pAttrName,pHrefName;pAttrName="image"+(i+2),pHrefName="imageUrl"+(i+2),$catThumb.eq(i).attr("src",imgCatList[pAttrName]),$catThumb.eq(i).parent().attr("href",imgCatList[pHrefName])}}}},$menuCatParentLink.hover(_.debounce(function(){for(var imgCatList={},dummy={img:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",href:"javascript:void(0);"},i=1;i<=7;i++){var pAttrName,pAttr,pHrefName,pHref;pAttrName="image"+i,pAttr="data-"+pAttrName+"-url",pHrefName="imageUrl"+i,pHref="data-"+pAttrName+"-href",imgCatList[pAttrName]=$(this).attr(pAttr)?$(this).attr(pAttr):dummy.img,imgCatList[pHrefName]=_.isEmpty($(this).attr(pHref))?dummy.href:$(this).attr(pHref)}menuState.hover(imgCatList),$(".menu__cat-list--parent li.menu__cat-item").removeClass("is-active"),$(this).parent().addClass("is-active")},ACC.requests.timeout/2),function(){}),$(document).mousemove(function(event){$(event.target).closest(".menu__cat,.menu__cat *").length||$(event.target).closest(".feature__sec,.feature__sec *").length||menuState.normal()}),$('[data-toggle="hover"]').each(function(){var divTarget,ootb;divTarget=$(this).attr("data-target"),ootb='[data-toggle="hover"][data-target="'+divTarget+'"], '+divTarget+", "+divTarget+" *",$(divTarget).length>0&&$(this).mouseover(function(){$(divTarget).removeClass("hidden")}),$(document).mousemove(function(event){$(event.target).closest(ootb).length||$(divTarget).addClass("hidden")})})},mainNavHandle:{request:function(){$(document).on("mouseover",".menu__cat-list a.menu__cat-link",function(){var $this,ajaxUrl,cached,res;return $this=$(this),res=$.Deferred(),ajaxUrl=$this.attr("data-url"),cached=ACC.requests.getLocalCache(ajaxUrl),null!==cached&&cached.length>0?res.resolve(JSON.parse(cached)):(res=$.get(ajaxUrl),res.done(function(menus){ACC.requests.setLocalCache(ajaxUrl,menus)})),res.done(function(menus){var $menuCatChild=$(".menu__cat-list.menu__cat-list--child"),html=ACC.navigation.mainNavHandle.render(menus);$menuCatChild.html(html)}),res})},render:function(menus){var menuHtml="";return _.isEmpty(menus)||(menuHtml+='<h3 class="text-uppercase">vinpear giá mới</h3>',menuHtml+="<hr>",_.each(menus,function(menu){menuHtml+='<p><a href="#'+menu.uid+'">'+menu.name+"</a></p>",menu.hasChildren&&(menuHtml+="<ul>",_.each(menu.entries,function(entry){menuHtml+='<li><a href="#'+entry.itemId+'">'+entry.itemName+"</a></li>"}),menuHtml+="</ul>")}),menuHtml+='<a href="#" class="menu__cat-link--all">Tất cả danh mục »</a>'),menuHtml}}},ACC.order={_autoload:["backToOrderHistory","bindMultidProduct","previewOrderModification","orderCancelPopup","confirmCancel","customerOrderCancelPopup","customerConfirmCancel","partialCancelConfirm","confirmOrderModification","confirmNotifyDeliveryTimeChanged","confirmCancelNotifyDeliveryTimeChanged","cancel","initUpdateOrderStatus","bindShowRefundRequestPopup","bindCloseRefundRequestPopup","showRefundRequestPopupAuto","init"],init:function(){var cc=ACC.order.getQueryVariable("cc");"true"==cc&&($("#modal-success-cancel-order").on("hidden.bs.modal",function(){ACC.order.processUrl()}).modal("show"),$("#modal-unsuccess-cancel-order").modal("hide"),$("#modal-notify-cancel-order").modal("hide")),"false"==cc&&($("#modal-success-cancel-order").modal("hide"),$("#modal-unsuccess-cancel-order").on("hidden.bs.modal",function(){ACC.order.processUrl()}).modal("show"),$("#modal-notify-cancel-order").modal("hide")),"not"==cc&&($("#modal-success-cancel-order").modal("hide"),$("#modal-unsuccess-cancel-order").modal("hide"),$("#modal-notify-cancel-order").on("hidden.bs.modal",function(){ACC.order.processUrl()}).modal("show")),$(document).on("click",".showMultiDGridInOrderOverlay",function(event){ACC.multidgrid.populateAndShowGridOverlay(this,event)})},initUpdateOrderStatus:function(){$(".js-order-modification").length>0&&(ACC.order._reloadOrderInterval=window.setInterval(this.updateOrderStatus,1e4))},backToOrderHistory:function(){$(".orderBackBtn > button").on("click",function(){var sUrl=$(this).data("backToOrders");window.location=sUrl})},bindMultidProduct:function(){$(document).on("click",".js-show-multiD-grid-in-order",function(event){return ACC.multidgrid.populateAndShowGrid(this,event,!0),!1}),$(document).on("click",".showMultiDGridInOrderOverlay",function(event){ACC.multidgrid.populateAndShowGridOverlay(this,event)})},previewOrderModificationRequest:function(previewParam){var $loader=($.Deferred(),$(".js #loader")),confirm=0;"false"==$(".js-preview-order-popup").attr("data-from-preview")&&(confirm=1),$.ajax({type:"POST",url:ACC.config.encodedContextPath+"/my-account/edit/preview?confirm="+confirm,data:$("#vinCheckoutAddressForm").serialize()+previewParam,beforeSend:function(){$("#loader").css({display:"block"}).removeClass("hidden")},complete:function(){$("#loader").css({display:"none"}).addClass("hidden")},success:function(response){if($(".js-confirm-section").html(""),$loader.css({display:"none"}),response.hasError){var encoded=$("<div></div>").html(response.cartData.deliveryInformation).text();$(".checkout-receiver-address__form").html(encoded),ACC.checkout.initCheckoutAddress()}else{var htmlPopup="";if(response.warningInstallment)htmlPopup=$("<div></div>").html(response.warningInstallmentView).text();else{htmlPopup="<h1>Delivery time changing notification</h1>";response.showPopup?htmlCartShipments=$("<div id='fakeID1'></div>").html(ACC.order.renderPreviewOrderModification(response.cartShipments)).text():htmlCartShipments=$("<div id='fakeID2'></div>").html(ACC.order.renderPreviewOrderModification(response.notification)).text(),htmlPopup=htmlCartShipments;var htmlDeliveryInformation=$("<div></div>").html(response.deliveryInformation).text();$("#deliveryInformation").html(htmlDeliveryInformation);var htmlCheckoutInformation=$("<div></div>").html(response.checkoutSummaryInformation).text();$("#checkoutSummaryInformation1").html(htmlCheckoutInformation)}$.colorbox({html:htmlPopup,width:"870px",onComplete:function(){$loader.css({display:"none"})},onClosed:function(){0==confirm&&location.reload()}})}}})},updateOrderStatus:function(){var orderCode=$("#order-code").text();"true"==$("#order-info").attr("need-to-reload")&&$.ajax({type:"GET",headers:{"Content-Type":"application/json"},url:ACC.config.encodedContextPath+"/my-account/edit/orderdata/"+orderCode,success:function(response){$("#order-info").attr("need-to-reload",response.needToReload),$("#order-status").text(response.originalStatus)
;var encoded=$("<div></div>").html(response.orderAmount).text();$("#order-amount").html(encoded);for(var key in response.consignmentStatus)if(response.consignmentStatus.hasOwnProperty(key)){var val=response.consignmentStatus[key];$("#"+key).text(val)}}})},previewOrderModification:function(){$(document).on("click",".js-preview-order-popup",function(){$(this).attr("data-order-code");$(".js #loader").css({display:"block",opacity:"0.5"}),$(".required-field-error").length>0||($(".js-preview-order-popup").attr("data-from-preview",!0),ACC.order.previewOrderModificationRequest(""))}),ACC.order.previewOrderModificationConfirmWarningInstallment()},previewOrderModificationConfirmWarningInstallment:function(){$(document).on("click",".js-accept-warning-installment-popup",function(){ACC.order.previewOrderModificationRequest("&acceptWarning=true")})},renderPreviewOrderModification:function(data){var markupArg=data.split("|"),markup="";markup+="<ul>";for(var i in markupArg)markup+="<li>"+markupArg[i]+"</li>";return markup+="</ul>"},orderCancelPopup:function(data){$(document).on("click",".js-cancel-order-popup",function(){var orderCode=$(this).data("order-code");$.ajax({type:"GET",url:ACC.config.encodedContextPath+"/my-account/edit/"+orderCode+"/cancelorder/request",success:function(cancellationHtml){$.colorbox({html:cancellationHtml,title:!1,onComplete:function(){$("#cboxTitle, #cboxCurrent").hide()}})}})})},customerOrderCancelPopup:function(){var _this=this;$(document).on("click",".js-customer-cancel-order-popup",function(){clearTimeout(_this._timeout),_this._timeout=setTimeout(function(){$("#loader").css({display:"block"}).removeClass("hidden")},200);var orderCode=$(this).data("order-code");$.ajax({type:"GET",url:ACC.config.encodedContextPath+"/my-account/edit/"+orderCode+"/customercancelorder/request",success:function(cancellationHtml){clearTimeout(_this._timeout),$("#loader").css({display:"none"}).addClass("hidden");var $modal=$("#modal-order-cancellation");$modal.find(".modal-body").html(cancellationHtml),$modal.find(".js-selectize").on("change",function(){_this.checkValidation()}).selectize(),$modal.find('input[name="confirm"]').on("change",function(){_this.checkValidation()}),$modal.modal()},error:function(){clearTimeout(_this._timeout),$("#loader").css({display:"none"}).addClass("hidden")}})})},checkValidation:function(){var canceltable=$("#cancel-order-table"),cancelReason=canceltable.find('select[name="cancel_reason"]').val(),confirm=canceltable.find('input[name="confirm"]').is(":checked");cancelReason&&confirm?$(".js-customer-confirm-cancel").removeClass("disabled"):$(".js-customer-confirm-cancel").addClass("disabled")},confirmCancel:function(data){$(document).on("click",".js-confirm-cancel",function(){var orderCode=$(this).data("order-code"),canceltable=$("#cancel-order-table"),cancelData={entry:{cancelReason:canceltable.find('select[name="cancel_reason"]').val(),comment:canceltable.find('input[name="comment"]').val()}};$.ajax({type:"POST",headers:{"Content-Type":"application/json"},url:ACC.config.encodedContextPath+"/my-account/edit/"+orderCode+"/cancelorder/confirm?CSRFToken="+ACC.config.CSRFToken,data:JSON.stringify(cancelData),success:function(data){ACC.order.processCancleOrderFlow(data)}})})},customerConfirmCancel:function(data){var _this=this;$(document).on("click",".js-customer-confirm-cancel",function(){var canceltable=$("#cancel-order-table"),orderCode=$(this).data("order-code"),cancelData={entry:{cancelReason:canceltable.find('select[name="cancel_reason"]').val(),comment:canceltable.find('input[name="comment"]').val()}};if(!cancelData.entry.cancelReason)return!1;clearTimeout(_this._timeout),_this._timeout=setTimeout(function(){$("#loader").css({display:"block"}).removeClass("hidden")},200),$.ajax({type:"POST",headers:{"Content-Type":"application/json"},url:ACC.config.encodedContextPath+"/my-account/edit/"+orderCode+"/customercancelorder/confirm?CSRFToken="+ACC.config.CSRFToken,data:JSON.stringify(cancelData),success:function(data){clearTimeout(_this._timeout),$("#loader").css({display:"none"}).addClass("hidden"),ACC.order.processCustomerCancleOrderFlow(data)},error:function(){clearTimeout(_this._timeout),$("#loader").css({display:"none"}).addClass("hidden")}})})},cancel:function(data){$(document).on("click",".js-cancel",function(){$.colorbox.close()})},partialCancelConfirm:function(data){$(document).on("click",".js-confirm-entry-cancel",function(){var cancelData={},orderCode=$(this).data("order-code");cancelData.entries=[];var isQuantityByZero=!1;$("#cancel-product-collapse-"+$(this).data("consignment-entry")).find("tr.consigment-entry").each(function(entry){var quantity=$(this).find('input[name="quantity"]').val();if(""!=quantity&&0==Number(quantity))return isQuantityByZero=!0,$(this).find('input[name="comment"]').val(""),$(this).find('input[name="quantity"]').val(""),!1;cancelData.entries.push({consignmentEntryPk:$(this).data("pk"),cancelReason:$(this).find('select[name="cancel_reason"]').val(),quantity:Number(quantity),comment:$(this).find('input[name="comment"]').val()})}),isQuantityByZero||$.ajax({type:"POST",headers:{"Content-Type":"application/json"},url:ACC.config.encodedContextPath+"/my-account/edit/"+orderCode+"/cancelpartialentry/confirm?CSRFToken="+ACC.config.CSRFToken,data:JSON.stringify(cancelData),success:function(cancellationHtml){location.reload()}})})},confirmOrderModification:function(){$(document).on("click",".confirm-btn",function(){$(".required-field-error").length>0||($(".js-preview-order-popup").attr("data-from-preview",!1),$("#loader").css({display:"block"}).removeClass("hidden"),ACC.order.previewOrderModificationRequest(""))}),$(document).on("click",".btn-confirm-change",function(e){$.fn.colorbox.close();var res=$.ajax({type:"POST",headers:{"Content-Type":"application/json"},url:ACC.config.encodedContextPath+"/my-account/edit/"+$(".confirm-btn").attr("data-order-code")+"/checkIfDeliveryTimeChanged"});res.fail(function(response){console.log("Checking delivery time failed")}),res.done(function(response){if(response.changedDeliveryTime&&ACC.order.validateReasonInformMethod())$("#modalConfirmDeliveryTime").modal("show");else{console.log("Checking delivery time unsuccess");var href=ACC.config.encodedContextPath+"/my-account/edit/"+$(".confirm-btn").attr("data-order-code")+"/confirm?notifyDeliveryTimeChanged=false";window.location.href=href}$("#loader").css({display:"none"}).addClass("hidden")})}),$(document).on("click",".btn-not-change",function(){return $.fn.colorbox.close(),!1})},confirmNotifyDeliveryTimeChanged:function(){$(document).on("click",".js-notify-delivery-time-submit",function(){var href=ACC.config.encodedContextPath+"/my-account/edit/"+$(this).attr("data-order-code")+"/confirm?notifyDeliveryTimeChanged=true";window.location.href=href})},confirmCancelNotifyDeliveryTimeChanged:function(){$(document).on("click",".js-notify-delivery-time-cancel",function(){var href=ACC.config.encodedContextPath+"/my-account/edit/"+$(this).attr("data-order-code")+"/confirm?notifyDeliveryTimeChanged=false";window.location.href=href})},validateReasonInformMethod:function(){var allowShowingPopup=!1;return $("#deliveryInformation #rescheduleReasonOpt option:selected").each(function(index){if("EMAIL"===$(this).attr("data-inform-method")||"SMS"===$(this).attr("data-inform-method")||"BOTH"===$(this).attr("data-inform-method"))return allowShowingPopup=!0,!1}),allowShowingPopup},bindShowRefundRequestPopup:function(){$("#refundRequestContent").length>0&&($("#refundRequest-section").on("show.bs.modal",function(e){clearInterval(ACC.order._reloadOrderInterval)}),$(document).on("click","#btn_refundRequests",function(){clearInterval(ACC.order._reloadOrderInterval)}))},bindCloseRefundRequestPopup:function(){$("#refundRequestContent").length>0&&$("#refundRequest-section").on("hide.bs.modal",function(e){ACC.order.initUpdateOrderStatus()})},showRefundRequestPopupAuto:function(){$("#showRefundPopup").length>0&&$("#refundRequestContent").length>0&&$("#refundRequest-section").modal("show")},processCancleOrderFlow:function(data){var url=window.location.href+"?cancelled=true";null!=data&&1==data.refundPossible?(console.log("refundPossible: "+data.refundPossible),setTimeout(function(){window.location.href=url},3e3)):window.location.href=url},processCustomerCancleOrderFlow:function(data){var url=window.location.href+"?cc=true";window.location.href=url},processUrl:function(){window.location.href.indexOf("?")>-1&&history.pushState("",document.title,window.location.pathname)},getQueryVariable:function(variable){for(var query=window.location.search.substring(1),vars=query.split("&"),i=0;i<vars.length;i++){var pair=vars[i].split("=");if(decodeURIComponent(pair[0])==variable)return decodeURIComponent(pair[1])}}},ACC.paginationsort={downUpKeysPressed:!1,bindAll:function(){this.bindPaginationSort(),this.showSelectSortText()},showSelectSortText:function(){var text=$(".js-product-list__order").find(".dropdown-menu .js-form-submit.selected").text();text&&$(".js-product-list__order").find(".dropdown-toggle_text").html(text)},bindPaginationSort:function(){with(ACC.paginationsort)bindSortForm($("#sortForm1")),bindSortForm($("#sortForm2"))},bindSortForm:function(sortForm){sortForm.change(function(){ACC.paginationsort.downUpPressed||this.submit(),ACC.paginationsort.downUpPressed=!1})},sortFormIEFix:function(sortOptions,selectedOption){sortOptions.keydown(function(e){38===e.keyCode||40===e.keyCode?ACC.paginationsort.downUpPressed=!0:13===e.keyCode&&selectedOption!==$(this).val()?$(this).parent().submit():ACC.paginationsort.downUpPressed=!1})}},$(document).ready(function(){ACC.paginationsort.bindAll()}),ACC.payment={activateSavedPaymentButton:function(){$(document).on("click",".js-saved-payments",function(e){e.preventDefault();var title=$("#savedpaymentstitle").html();$.colorbox({href:"#savedpaymentsbody",inline:!0,maxWidth:"100%",opacity:.7,width:"320px",title:title,close:'<span class="glyphicon glyphicon-remove"></span>',onComplete:function(){}})})},bindPaymentCardTypeSelect:function(){ACC.payment.filterCardInformationDisplayed(),$("#card_cardType").change(function(){"024"==$(this).val()?$("#startDate, #issueNum").show():$("#startDate, #issueNum").hide()})},filterCardInformationDisplayed:function(){"024"==$("#card_cardType").val()?$("#startDate, #issueNum").show():$("#startDate, #issueNum").hide()}},$(document).ready(function(){with(ACC.payment)activateSavedPaymentButton(),bindPaymentCardTypeSelect()}),ACC.paymentDetails={_autoload:["showRemovePaymentDetailsConfirmation"],showRemovePaymentDetailsConfirmation:function(){$(document).on("click",".js-delete-payment-method",function(){var modalId,paymentId;if(modalId=$(this).attr("data-modal-id"),paymentId=$(this).attr("data-payment-id"),$(this).attr("data-popup-title"),_.isEmpty(paymentId))return void console.log("No Payment ID");$('#removePaymentDetails input[name="paymentInfoId"]').val(paymentId),$(modalId).modal("show")})}},ACC.product={_autoload:["bindToAddToCartForm","enableStorePickupButton","enableVariantSelectors","bindFacets","bindOneClickButton",["bindRemoveViewedProduct",$(".product__reviewed").length>0],["bindNiceScrollDropdownSearch",$(".product-list__filter").length>0],["bindReviewAjax",$(".js-review-submit").length>0],"confirmOrderModificationOnlyPrepaid"],bindFacets:function(){$(document).on("click",".js-show-facets",function(e){e.preventDefault();var selectRefinementsTitle=$(this).data("selectRefinementsTitle");ACC.colorbox.open(selectRefinementsTitle,{href:".js-product-facet",inline:!0,width:"480px",onComplete:function(){$(document).on("click",".js-product-facet .js-facet-name",function(e){e.preventDefault(),$(".js-product-facet  .js-facet").removeClass("active"),$(this).parents(".js-facet").addClass("active"),$.colorbox.resize()})},onClosed:function(){$(document).off("click",".js-product-facet .js-facet-name")}})})},enableAddToCartButton:function(){$(".js-enable-btn").each(function(){$(this).hasClass("outOfStock")||$(this).hasClass("out-of-stock")||$(this).removeAttr("disabled")})},enableVariantSelectors:function(){$(".variant-select").removeAttr("disabled")},bindToAddToCartForm:function(){var $addToCart=$("#addToCartButton, .btn-add-to-cart, #sticky_add_to_cart");$(document).on("submit",".add_to_cart_form",function(e){e.preventDefault()}),$(document).on("click",".js-sticky-atc",function(){$(".add_to_cart_form").eq(0).ajaxSubmit({success:ACC.product.processAddToCartSuccess})}),$addToCart.on("click",function(e){if($(this).parent().ajaxSubmit({success:ACC.product.processAddToCartSuccess}),e.preventDefault(),"undefined"!=typeof gtmAddToCart&&"function"==typeof gtmAddToCart){var quantity=$("#pdpAddtoCartSelect").val();void 0!==quantity&&gtmAddToCart(quantity)}})},processAddToCartSuccess:function(cartResult,statusText,xhr,formElement){var showCart=!1;("false"===ACC.cartASM.allowRedirect||cartResult.hasError||cartResult.modifyOrderWithOnlyPrepaid)&&(showCart=!0),showCart?ACC.product.displayAddToCartPopup(cartResult,statusText,xhr,formElement):window.location.href=ACC.config.contextPath+cartResult},bindOneClickButton:function(){$(document).on("click","#btn-1click-checkout",function(e){ACC.product.redirectToConfirmationPage()}),$(document).on("click","#btn-1click-checkout-sticky-header",function(e){$(this).hasClass("has-variants")||ACC.product.redirectToConfirmationPage()})},bindToAddToCartStorePickUpForm:function(){$("#colorbox #add_to_cart_storepickup_form").ajaxForm({success:ACC.product.displayAddToCartPopup})},enableStorePickupButton:function(){$(".js-pickup-in-store-button").removeAttr("disabled")},sendCartValidation:function(){if($("#startReferredDateStr").length>0){var code=$("input[name*='productCodePost']").val(),startDate=$("#startReferredDateStr").val(),endDate=$("#endReferredDateStr").val(),dataString={productCode:code,startReferredDateStr:startDate,endReferredDateStr:endDate};$.ajax({url:ACC.config.encodedContextPath+"/cart/validate",type:"POST",contentType:"application/json; charset=UTF-8",data:JSON.stringify(dataString),dataType:"json",success:function(response){if("OK"==response.status)$("#addtocartErrorMsg").text(""),$(".addtocartErrorMsg").addClass("hidden"),ACC.product.callConfirmationPageAjax();else{var errors=response.fieldValidations;void 0!=errors&&($(".addtocartErrorMsg").removeClass("hidden"),$("#addtocartErrorMsg").text(errors.startReferredDate))}}})}else ACC.product.callConfirmationPageAjax()},redirectToConfirmationPage:function(){void 0!==$("#addToCartButton")&&ACC.product.sendCartValidation()},callConfirmationPageAjax:function(){$.ajax({url:ACC.config.encodedContextPath+"/cart/add",type:"post",beforeSend:function(){$.blockUI()},complete:function(){$.unblockUI()},data:$("#addToCartForm").serialize(),success:function(data){$(location).attr("href",ACC.config.encodedContextPath+"/checkout/multi/express")}})},displayAddToCartPopup:function(cartResult,statusText,xhr,formElement){if(void 0!==cartResult.modifyOrderWithOnlyPrepaid&&1==cartResult.modifyOrderWithOnlyPrepaid){var productCode=$("[name=productCodePost]",formElement).val(),res=$.ajax({type:"POST",headers:{"Content-Type":"application/json"},url:ACC.config.encodedContextPath+"/cart/add/"+productCode+"/checkIfShowOnlyPrepaidPopUp",data:$("#addToCartForm").serialize()});res.fail(function(response){console.log("Not show popup")}),res.done(function(response){response.showPopUp&&$("#modalConfirmOnlyPrepaid").modal("show")})}else{if(_.isEmpty(cartResult))return;if($("#addToCartLayer").remove(),"function"==typeof ACC.minicart.updateMiniCartDisplay&&ACC.minicart.updateMiniCartDisplay(),!0===cartResult.hasError)$.colorbox({html:cartResult.addToCartLayer,maxWidth:"100%",width:"335px",initialWidth:"120px",className:"error-limit-quanity",closeButton:!1});else{var url=ACC.config.cartMiniUrl;$('[name="mini-cart-url"]').length>0&&(url=$('[name="mini-cart-url"]').val()),url+="?recalculation=false",ACC.minicart.showMiniCart(url)}var productCode=$("[name=productCodePost]",formElement).val(),quantityField=$("[name=qty]",formElement).val(),quantity=1;void 0!==quantityField&&(quantity=quantityField);var cartAnalyticsData=cartResult.cartAnalyticsData;_.defaults(cartAnalyticsData,{cartCode:"",productName:"",productPostPrice:""});var cartData={cartCode:_.isUndefined(cartAnalyticsData)||_.isEmpty(cartAnalyticsData.cartCode)?null:cartAnalyticsData.cartCode,productCode:productCode,quantity:quantity,productPrice:cartAnalyticsData.productPostPrice,productName:cartAnalyticsData.productName};ACC.track.trackAddToCart(productCode,quantity,cartData)}},bindRemoveViewedProduct:function(){$(document).on("click",".js-remove-viewed-product",function(e){console.log($(this).data("productcode"));var productCode=$(this).data("productcode"),options=($(this).parent(),{productCode:$(this).data("productcode")});$.ajax({url:ACC.config.encodedContextPath+"/viewedproduct/remove",type:"GET",dataType:"json",contentType:"application/json",data:options,async:!1,complete:function(response){console.log(productCode),$("#js-viewed-product-"+productCode).remove(),ACC.carousel.swiperItem["category-products-carousel"].update(ACC.carousel.carouselConfig["category-products-carousel"])}})})},bindNiceScrollDropdownSearch:function(){var $self=$(".product-list__filter .dropdown-menu li"),$parentself=$(".product-list__filter .dropdown-menu");$self.length>5&&($parentself.css("max-height","152px"),$parentself.niceScroll({cursorwidth:"4px",cursorborder:"none",autohidemode:!1,cursorcolor:"#dddddd",background:"transparent",railpadding:{top:3,right:1,left:1,bottom:3}}))},countDownDate:function(){var today=new Date,dd=today.getDate()+1,mm=today.getMonth()+1,yyyy=today.getFullYear(),date=mm+"-"+dd+"-"+yyyy+" 00:00:00",countDownDate=new Date(date).getTime();console.log("countDownDate"),$(".time-deal .countdown-one-day").each(function(){var $self=$(this),interval=setInterval(function(){var now=(new Date).getTime(),distance=countDownDate-now,hours=Math.floor(distance%864e5/36e5),minutes=Math.floor(distance%36e5/6e4),seconds=Math.floor(distance%6e4/1e3);$self.html(hours+":"+minutes+":'"+seconds+"''"),distance<0&&clearInterval(interval)},1e3)})},bindReviewAjax:function(){$(document).on("click",".js-review-submit",function(){ACC.product.reviewAjax($(this).attr("data-url"))})},reviewAjax:function(url){$.ajax({url:url,type:"post",beforeSend:function(){$.blockUI()},complete:function(){$.unblockUI()},data:$("#vinReviewForm").serialize(),success:function(data){var json=JSON.parse(data),status=json.status,anonymous_user=json.anonymous_user;if("invalidData"==status){var aliasError=json.alias,placeHolder=$("#alias").attr("placeholder");if(""!=aliasError){var aliasFormHasError='<div class="form-group has-error"><label class="control-label invisible-label hidden" for="alias"></label> <input id="alias" name="alias" class="form-control form-control" placeholder= \''+placeHolder+'\' type="text" value=\'\'><div class="help-block"><span id="alias.errors">'+aliasError+"</span></div></div>";$("#alias-comment-process").html(aliasFormHasError)}else{var aliasValue=$("#alias").val(),aliasFormNoError='<div class="form-group"> <label class="control-label invisible-label hidden" for="alias"> </label> <input id="alias" name="alias" class="form-control form-control" placeholder=\''+placeHolder+"' type=\"text\" value='"+aliasValue+"'></div>";$("#alias-comment-process").html(aliasFormNoError)}if("false"==json.recaptchaChallangeAnswered){var captcha_error_msg=json.captcha_error;$(".g-recaptcha_incorrect").html(captcha_error_msg)}else $(".error-captcha").html("");var errorRating=json.rating;""!=errorRating&&(0==$("#rating-errors").length&&($("div.vertical-align-center > div.form-group").append('<div class="help-block"><span id="rating-errors">'+errorRating+"</span></div></div>"),$("div.vertical-align-center > div.form-group").addClass("has-error")),$(".error-captcha").html(""))}else $("div.form-group > div.help-block").remove();if($("#comment-form__message--sucess").html(""),"overCommentLenght"==status){var overMaximumCommentMsg=json.overMaximumCommentMsg,placeHolder=$("#alias").attr("placeholder"),aliasFormNoError='<div class="form-group"> <label class="control-label invisible-label hidden" for="alias"> </label> <input id="alias" name="alias" class="form-control form-control" placeholder=\''+placeHolder+"' type=\"text\" value=''></div>";$("#alias-comment-process").html(aliasFormNoError),$(".error-captcha").html(""),$("div.form-group > div.help-block").remove(),$("#comment-form__message--sucess").html('<i class="adr-icon icon-error-comment"></i> '+overMaximumCommentMsg).addClass("comment-form__message-error")}if("success"==status){var success_msg=json.success_msg,placeHolder=$("#alias").attr("placeholder"),aliasFormNoError='<div class="form-group"> <label class="control-label invisible-label hidden" for="alias"> </label> <input id="alias" name="alias" class="form-control form-control" placeholder=\''+placeHolder+"' type=\"text\" value=''></div>";$("#alias-comment-process").html(aliasFormNoError),$(".error-captcha").html(""),$("div.form-group > div.help-block").remove(),$("#reviewComment").val(""),$(".comment-form__submit").attr("disabled","disabled"),$("#currentCommentCounter").html("0"),$(".js-writeReviewStars").find("span").removeClass("active"),$(".js-ratingSetInput").val("0");var numberOfReview=json.reviewsTotal;$("#comment-form__message--sucess").html('<i class="adr-icon icon-success"> </i>'+success_msg).addClass("comment-form__message"),$("#alias-comment-process").html(aliasFormNoError);var comment=json.reviewDataGson.comment.replace(/\n/g,"<br>"),reviewDate=json.reviewDate,userName=json.reviewDataGson.alias,rating=json.rating,uniqId=_.uniqueId("review_"),reviewItem='<div class=\'product-comment__item\' ><div class="clearfix"><div class="comment-item__left">'+userName.substring(0,1)+'</div><div class="comment-item__right"><div class="clearfix"><h3 class="comment-item__user">'+userName+'</h3><div class="rating"><div id=\''+uniqId+'\' class="rating-stars pull-left js-ratingCalc" data-rating=\'{"rating":'+rating+',"total":5}\' ><div class="greyStars"> <span class="glyphicon glyphicon-star"></span> <span class="glyphicon glyphicon-star"></span> <span class="glyphicon glyphicon-star"></span> <span class="glyphicon glyphicon-star"></span> <span class="glyphicon glyphicon-star"></span> </div><div class="greenStars js-greenStars"><span class="glyphicon glyphicon-star active"></span> <span class="glyphicon glyphicon-star active"></span> <span class="glyphicon glyphicon-star active"></span> <span class="glyphicon glyphicon-star active"></span> <span class="glyphicon glyphicon-star active"></span> </div>\t</div>   </div>\t</div>\t<div class="comment-item__content">'+comment+'</div>\t<div class="comment-item__action clearfix">\t<div class="comment-item__time">\t<span class="date">'+reviewDate+"</span></div>\t</div>\t</div>  </div></div>";if($(".review-list").prepend(reviewItem),ACC.ratingstars.renderRatingStars(uniqId),$(".product-comment__item").length>15&&$(".review-list.product-comment__item").last().hide(),numberOfReview>15&&0==$(".btn-view-more-review").length){var labelForViewMoreLink=json.labelForViewMoreLink,viewMoreLink='<a href="javascript:;" class="btn btn-white btn-view-more-review">'+labelForViewMoreLink+"</a>";$(".review-list").append(viewMoreLink)}}"true"==anonymous_user&&"undefined"!=typeof grecaptcha&&grecaptcha.reset(),$.unblockUI()}})},confirmOrderModificationOnlyPrepaid:function(){$(document).on("click",".js-order-modification-onlyprepaid-submit",function(){var offerCode=$(this).data("offercode");$.ajax({type:"POST",headers:{"Content-Type":"application/json"},url:ACC.config.encodedContextPath+"/cart/add/"+offerCode+"/confirm?modifyOnlyPrepaid=true",data:$("#addToCartForm").serialize(),complete:function(response){$("#modalConfirmOnlyPrepaid").modal("hide"),$(".js-mini-cart-link").click()}})})}},$(document).ready(function(){ACC.product.enableAddToCartButton()}),ACC.productDetail={_autoload:["initPageEvents","bindVariantOptions"],checkQtySelector:function(self,mode){var input=$(self).parents(".js-qty-selector").find(".js-qty-selector-input"),inputVal=parseInt(input.val()),max=input.data("max"),minusBtn=$(self).parents(".js-qty-selector").find(".js-qty-selector-minus"),plusBtn=$(self).parents(".js-qty-selector").find(".js-qty-selector-plus");$(self).parents(".js-qty-selector").find(".btn").removeAttr("disabled"),"minus"==mode?1!=inputVal?(ACC.productDetail.updateQtyValue(self,inputVal-1),inputVal-1==1&&minusBtn.attr("disabled","disabled")):minusBtn.attr("disabled","disabled"):"reset"==mode?ACC.productDetail.updateQtyValue(self,1):"plus"==mode?"FORCE_IN_STOCK"==max?ACC.productDetail.updateQtyValue(self,inputVal+1):inputVal<=max?(ACC.productDetail.updateQtyValue(self,inputVal+1),inputVal+1==max&&plusBtn.attr("disabled","disabled")):plusBtn.attr("disabled","disabled"):"input"==mode?1==inputVal?minusBtn.attr("disabled","disabled"):"FORCE_IN_STOCK"==max&&inputVal>0?ACC.productDetail.updateQtyValue(self,inputVal):inputVal==max?plusBtn.attr("disabled","disabled"):inputVal<1?(ACC.productDetail.updateQtyValue(self,1),minusBtn.attr("disabled","disabled")):inputVal>max&&(ACC.productDetail.updateQtyValue(self,max),plusBtn.attr("disabled","disabled")):"focusout"==mode&&(isNaN(inputVal)?(ACC.productDetail.updateQtyValue(self,1),minusBtn.attr("disabled","disabled")):inputVal>=max&&plusBtn.attr("disabled","disabled"))},updateQtyValue:function(self,value){var input=$(self).parents(".js-qty-selector").find(".js-qty-selector-input"),addtocartQty=$(self).parents(".addtocart-component").find("#addToCartForm").find(".js-qty-selector-input");input.val(value),addtocartQty.val(value)},initPageEvents:function(){function changeOnVariantOptionSelection(optionSelected){window.location.href=optionSelected.attr("value")}$(document).on("click",".js-qty-selector .js-qty-selector-minus",function(){ACC.productDetail.checkQtySelector(this,"minus")}),$(document).on("click",".js-qty-selector .js-qty-selector-plus",function(){ACC.productDetail.checkQtySelector(this,"plus")}),$(document).on("keydown",".js-qty-selector .js-qty-selector-input",function(e){e.shiftKey&&e.preventDefault()," "!=$(this).val()&&(e.which>=48&&e.which<=57||e.which>=96&&e.which<=105)||8==e.which||46==e.which||37==e.which||39==e.which||9==e.which||(38==e.which?ACC.productDetail.checkQtySelector(this,"plus"):40==e.which?ACC.productDetail.checkQtySelector(this,"minus"):e.preventDefault())}),$(document).on("blur",".js-qty-selector .js-qty-selector-input",function(e){var initVal=$(this).val();outputVal=initVal.replace(/[^0-9]/g,""),initVal!=outputVal&&$(this).val(outputVal)}),$(document).on("keyup",".js-qty-selector .js-qty-selector-input",function(e){ACC.productDetail.checkQtySelector(this,"input"),ACC.productDetail.updateQtyValue(this,$(this).val())}),$(document).on("focusout",".js-qty-selector .js-qty-selector-input",function(e){ACC.productDetail.checkQtySelector(this,"focusout"),ACC.productDetail.updateQtyValue(this,$(this).val())}),$(document).on("change","#pdpAddtoCartSelect",function(){var qty=$(this).val();if("pdpAddtoCartInput"===qty){$("#pdpAddtoCartInputSection").toggle(),$("#pdpAddtoCartSelectSection").toggle(),$("#pdpAddtoCartInput").focus();var defaultQty=$("#pdpAddtoCartInput").data("default-value");ACC.productDetail.updateQtyValue(this,defaultQty)}else ACC.productDetail.updateQtyValue(this,qty)}),$("#pdpAddtoCartSelect").change(),$("#Size").change(function(){changeOnVariantOptionSelection($("#Size option:selected"))}),$("#variant").change(function(){changeOnVariantOptionSelection($("#variant option:selected"))}),$(".selectPriority").change(function(){window.location.href=$(this[this.selectedIndex]).val()})},bindVariantOptions:function(){ACC.productDetail.bindCurrentStyle(),ACC.productDetail.bindCurrentSize(),ACC.productDetail.bindCurrentType()},bindCurrentStyle:function(){var currentStyle=$("#currentStyleValue").data("styleValue"),styleSpan=$(".styleName");null!=currentStyle&&styleSpan.text(": "+currentStyle)},bindCurrentSize:function(){var currentSize=$("#currentSizeValue").data("sizeValue"),sizeSpan=$(".sizeName");null!=currentSize&&sizeSpan.text(": "+currentSize)},bindCurrentType:function(){var currentSize=$("#currentTypeValue").data("typeValue"),sizeSpan=$(".typeName");null!=currentSize&&sizeSpan.text(": "+currentSize)},initImageBroken:function(element){"together-viewed-product"==$(element).attr("id")&&($(element).show(),$(element).attr("src",$("#data").data("missingImageProduct")))}},ACC.quickview={_autoload:["bindToUiCarouselLink"],initQuickviewLightbox:function(){ACC.product.enableAddToCartButton(),ACC.product.bindToAddToCartForm(),ACC.product.enableStorePickupButton()},refreshScreenReaderBuffer:function(){$("#accesibility_refreshScreenReaderBufferField").attr("value",(new Date).getTime())},bindToUiCarouselLink:function(){var titleHeader=$("#quickViewTitle").html();$(".js-owl-carousel-reference .js-reference-item").colorbox({close:'<span class="glyphicon glyphicon-remove"></span>',title:titleHeader,maxWidth:"100%",onComplete:function(){ACC.quickview.refreshScreenReaderBuffer(),ACC.quickview.initQuickviewLightbox(),ACC.ratingstars.bindRatingStars($(".quick-view-stars"))},onClosed:function(){ACC.quickview.refreshScreenReaderBuffer()}})}},ACC.ratingstars={_autoload:[["bindRatingStars",$(".js-ratingCalc").length>0],["bindRatingStarsSet",$(".js-ratingCalcSet").length>0]],bindRatingStars:function(){$(".js-ratingCalc").each(function(){var rating=$(this).data("rating");$(this).find(".js-greenStars").width($(this).width()*(parseFloat(rating.rating,10)/5)),$(this).find(".js-yellowStars").width(parseFloat(100*rating/5)+"%")})},renderRatingStars:function(id){var $dom=$("#"+id),rating=$dom.data("rating");console.log($dom),$dom.find(".js-greenStars").width($dom.width()*(parseFloat(rating.rating,10)/rating.total)),$dom.find(".js-yellowStars").width(parseFloat(100*rating/5)+"%")},bindRatingStarsSet:function(){$(".js-writeReviewStars").on({mouseleave:function(){clearReviewState();var sV=2*parseFloat($(".js-ratingSetInput").val(),10);"number"!=typeof sV||isNaN(sV)?clearReviewState():setReviewState(sV)}});var ratingIcons=$(".js-writeReviewStars .js-ratingIcon"),setReviewState=function(index){ratingIcons.slice(0,parseFloat(index,10)).addClass("active")},clearReviewState=function(){ratingIcons.removeClass("active")};ratingIcons.on({mouseenter:function(){clearReviewState(),setReviewState($(this).index()+1)},mouseleave:function(){$(this).removeClass("active")},click:function(){$(".js-ratingSetInput").val(($(this).index()+1)/2)}})}},ACC.refinements={_autoload:[["bindMoreLessToggles",0!=$(".js-facet-form").length],["bindMoreStoresToggles",0!=$(".js-facet-form").length],["bindSearch",0!=$(".js-facet-form").length]],coords:{},storeSearchData:{},bindSearch:function(){$(document).on("submit","#user_location_form",function(e){e.preventDefault();var q=$(".js-shop-stores-facet .js-shop-store-search-input").val();q.length>0&&ACC.refinements.getInitStoreData(q)}),$(document).on("click","#findStoresNearMeAjax",function(e){e.preventDefault(),ACC.refinements.getInitStoreData(null,ACC.refinements.coords.latitude,ACC.refinements.coords.longitude)})},getInitStoreData:function(q,latitude,longitude){$(".alert").remove(),data={q:"",page:"0"},null!=q&&(data.q=q),null!=latitude&&(data.latitude=latitude),null!=longitude&&(data.longitude=longitude),ACC.refinements.storeSearchData=data,ACC.refinements.getStoreData()},getStoreData:function(){url=$(".js-facet-form").data("url"),$.ajax({url:url,data:ACC.refinements.storeSearchData,type:"get",success:function(response){window.location.reload()}})},bindMoreLessToggles:function(){$(document).on("click",".js-shop-stores-facet .js-facet-change-link",function(e){e.preventDefault(),$(".js-shop-stores-facet .js-facet-container").hide(),$(".js-shop-stores-facet .js-facet-form").show()}),$(document).on("change",".js-product-facet .js-facet-checkbox",function(){$(this).parents("form").submit()}),
$(document).on("click",".js-product-facet .js-more-facet-values-link",function(e){e.preventDefault(),$(this).parents(".js-facet").find(".js-facet-top-values").hide(),$(this).parents(".js-facet").find(".js-facet-list-hidden").show(),$(this).parents(".js-facet").find(".js-more-facet-values").hide(),$(this).parents(".js-facet").find(".js-less-facet-values").show()}),$(document).on("click",".js-product-facet .js-less-facet-values-link",function(e){e.preventDefault(),$(this).parents(".js-facet").find(".js-facet-top-values").show(),$(this).parents(".js-facet").find(".js-facet-list-hidden").hide(),$(this).parents(".js-facet").find(".js-more-facet-values").show(),$(this).parents(".js-facet").find(".js-less-facet-values").hide()})},bindMoreStoresToggles:function(){$(document).on("click",".js-shop-stores-facet .js-more-stores-facet-values",function(e){e.preventDefault(),$(".js-shop-stores-facet ul.js-facet-list li.hidden").slice(0,5).removeClass("hidden").first().find(".js-facet-checkbox").focus(),0==$(".js-shop-stores-facet ul.js-facet-list li.hidden").length&&$(".js-shop-stores-facet .js-more-stores-facet-values").hide()})}},ACC.silentorderpost={spinner:$("<img src='"+ACC.config.commonResourcePath+"/images/spinner.gif' />"),bindUseDeliveryAddress:function(){if($("#useDeliveryAddress").on("change",function(){if($("#useDeliveryAddress").is(":checked")){var options={countryIsoCode:$("#useDeliveryAddressData").data("countryisocode"),useDeliveryAddress:!0};ACC.silentorderpost.enableAddressForm(),ACC.silentorderpost.displayCreditCardAddressForm(options,ACC.silentorderpost.useDeliveryAddressSelected),ACC.silentorderpost.disableAddressForm()}else ACC.silentorderpost.clearAddressForm(),ACC.silentorderpost.enableAddressForm()}),$("#useDeliveryAddress").is(":checked")){var options={countryIsoCode:$("#useDeliveryAddressData").data("countryisocode"),useDeliveryAddress:!0};ACC.silentorderpost.enableAddressForm(),ACC.silentorderpost.displayCreditCardAddressForm(options,ACC.silentorderpost.useDeliveryAddressSelected),ACC.silentorderpost.disableAddressForm()}},bindSubmitSilentOrderPostForm:function(){$(".submit_silentOrderPostForm").click(function(){ACC.common.blockFormAndShowProcessingMessage($(this)),$(".billingAddressForm").filter(":hidden").remove(),ACC.silentorderpost.enableAddressForm(),$("#silentOrderPostForm").submit()})},bindCycleFocusEvent:function(){$("#lastInTheForm").blur(function(){$('#silentOrderPostForm [tabindex$="10"]').focus()})},isEmpty:function(obj){return void 0===obj||null===obj||""===obj},disableAddressForm:function(){$('input[id^="address\\."]').prop("disabled",!0),$('select[id^="address\\."]').prop("disabled",!0)},enableAddressForm:function(){$('input[id^="address\\."]').prop("disabled",!1),$('select[id^="address\\."]').prop("disabled",!1)},clearAddressForm:function(){$('input[id^="address\\."]').val(""),$('select[id^="address\\."]').val("")},useDeliveryAddressSelected:function(){$("#useDeliveryAddress").is(":checked")?($("#address\\.country").val($("#useDeliveryAddressData").data("countryisocode")),ACC.silentorderpost.disableAddressForm()):(ACC.silentorderpost.clearAddressForm(),ACC.silentorderpost.enableAddressForm())},bindCreditCardAddressForm:function(){$("#billingCountrySelector :input").on("change",function(){var countrySelection=$(this).val(),options={countryIsoCode:countrySelection,useDeliveryAddress:!1};ACC.silentorderpost.displayCreditCardAddressForm(options)})},displayCreditCardAddressForm:function(options,callback){$.ajax({url:ACC.config.encodedContextPath+"/checkout/multi/sop/billingaddressform",async:!0,data:options,dataType:"html",beforeSend:function(){$("#billingAddressForm").html(ACC.silentorderpost.spinner)}}).done(function(data){$("#billingAddressForm").html(data),"function"==typeof callback&&callback.call()})}},$(document).ready(function(){with(ACC.silentorderpost)bindUseDeliveryAddress(),bindSubmitSilentOrderPostForm(),bindCreditCardAddressForm();$("#useDeliveryAddress").click()}),ACC.tabs={_autoload:[["hideReviewBtn",$(".panel-product-comment").length>0],["determineToDisplayReviews",$(".panel-product-comment").length>0],["loadComments",$(".panel-product-comment").length>0],["bindCommentCounter",$(".panel-product-comment").length>0],["scrollToCommentSection",$(".panel-product-comment").length>0]],showReviewsAction:function(s){var stt,$reviews;if(stt=!1,$reviews=$("#reviews"),console.log("Show reviews actions",s),_.isUndefined(s))return void console.log("Show reviews actions","no review url",s);$reviews.length>0&&!_.isUndefined($reviews.data(s))&&(stt=!0),stt&&$.get($reviews.data(s),function(result){$reviews.html(result),$(".js-ratingCalc").length>0&&(ACC.ratingstars.bindRatingStars(),ACC.tabs.showingAllReviews())})},hideReviewBtn:function(btnClass){btnClass=void 0===btnClass?".less-reviews-btn":btnClass,$(btnClass).hide()},showReviewBtn:function(btnClass){$(btnClass).show()},showingAllReviews:function(){$("#showingAllReviews").data("showingallreviews")&&ACC.tabs.hideReviewBtn(".all-reviews-btn")},determineToDisplayReviews:function(){"#tabreview"===location.hash&&ACC.tabs.showReviewsAction("reviews")},loadComments:function(){ACC.tabs.showReviewsAction("reviews")},bindCommentCounter:function(){var text,$reviewComment=$("#reviewComment"),$form=$(".js-validation-10-charactor");$(".comment-form__container .help-block").addClass("hidden");var switchHelpBlock=function(text,flag){text.length>500?($form.find(".over-character-block").removeClass("hidden"),$form.find(".new-block").addClass("hidden"),$form.find(".comment-form__submit").attr("disabled","true")):text.length<10?($form.find(".new-block").removeClass("hidden"),$form.find(".over-character-block").addClass("hidden"),$form.find(".comment-form__submit").attr("disabled","true"),0===text.length&&($form.find(".new-block").addClass("hidden"),$form.find(".over-character-block").addClass("hidden"),$form.find(".comment-form__submit").attr("disabled","true"))):($form.find(".new-block").addClass("hidden"),$form.find(".over-character-block").addClass("hidden"),$form.find(".comment-form__submit").removeAttr("disabled"))};void 0!==$reviewComment.val()&&(text=$reviewComment.val().trim(),$("#currentCommentCounter").html(text.length),switchHelpBlock(text)),$reviewComment.keyup(function(){text=$(this).val().trim(),$("#currentCommentCounter").html(text.length),switchHelpBlock(text)})},scrollToCommentSection:function(){$("#commented").length>0&&($("html, body").animate({scrollTop:$("#reviewComment").offset().top-190},500),$("#reviewComment").focus())}},ACC.termsandconditions={bindTermsAndConditionsLink:function(){$(document).on("click",".termsAndConditionsLink",function(e){e.preventDefault(),$.colorbox({maxWidth:"100%",maxHeight:"80%",width:"870px",scrolling:!0,href:$(this).attr("href"),close:'<span class="glyphicon glyphicon-remove"></span>',title:'<div class="headline"><span class="headline-text">Terms and Conditions</span></div>',onComplete:function(){ACC.common.refreshScreenReaderBuffer()},onClosed:function(){ACC.common.refreshScreenReaderBuffer()}})})}},$(function(){with(ACC.termsandconditions)bindTermsAndConditionsLink()}),ACC.gtmdata=ACC.gtmdata||{},ACC.track={_autoload:["gtmClickBanner","gtmClickCheckoutSteps"],trackAddToCart:function(productCode,quantity,cartData){window.mediator.publish("trackAddToCart",{productCode:productCode,quantity:quantity,cartData:cartData})},trackRemoveFromCart:function(productCode,initialCartQuantity){window.mediator.publish("trackRemoveFromCart",{productCode:productCode,initialCartQuantity:initialCartQuantity})},trackUpdateCart:function(productCode,initialCartQuantity,newCartQuantity){window.mediator.publish("trackUpdateCart",{productCode:productCode,initialCartQuantity:initialCartQuantity,newCartQuantity:newCartQuantity})},trackEmaticAddToCart:function(data){window.mediator.publish("trackEmaticAddToCart",data)},trackEmaticRemoveFromCart:function(id){window.mediator.publish("trackEmaticRemoveFromCart",id)},trackEmatickUpdateCart:function(id,quantity){window.mediator.publish("trackEmaticUpdateCart",{id:id,quantity:quantity})},trackEmaticBeginCheckout:function(products){window.mediator.publish("trackEmaticBeginCheckout",products)},trackEmaticBeginPayment:function(products){window.mediator.publish("trackEmaticBeginPayment",products)},resetCart:function(products){window.mediator.publish("resetCart",products)},productBrowse:function(product){window.mediator.publish("productBrowse",product)},gtmRemoveFromCart:function(offer){dataLayer.push({event:"removeFromCart",ecommerce:{remove:{products:[{name:offer.name,id:offer.id,price:offer.price,brand:offer.brand,category:offer.category,variant:offer.variant,quantity:offer.quantity}]}}})},gtmClickBanner:function(){$(document).on("click",".js-gtm-track-click-banner",function(e){if($(this).data("istrackable")){var promoObj={};promoObj.id=$(this).data("trackbannerid"),promoObj.name=$(this).data("trackbannername"),promoObj.creative=$(this).data("trackbannercreative"),promoObj.position=$(this).data("trackbannerposition"),promoObj.url=$(this).data("trackbannerurl"),ACC.track.gtmOnPromoClick(promoObj)}})},gtmOnPromoClick:function(promoObj){dataLayer.push({event:"promotionClick",ecommerce:{promoClick:{promotions:[{id:promoObj.id,name:promoObj.name,creative:promoObj.creative,position:promoObj.position}]}},eventCallback:function(){document.location=promoObj.url}})},gtmClickCheckoutSteps:function(){void 0!==ACC.gtmdata.step&&void 0!==ACC.gtmdata.option&&(ACC.track.gtmOnCheckoutOption(ACC.gtmdata.step,ACC.gtmdata.option),"undefined"!=typeof gtmOnCheckout&&"function"==typeof gtmOnCheckout&&gtmOnCheckout(ACC.gtmdata.step,ACC.gtmdata.option))},gtmOnCheckoutOption:function(step,option){dataLayer.push({event:"checkoutOption",ecommerce:{checkout_option:{actionField:{step:step,option:option}}}})}},ACC.futurelink={_autoload:["bindFutureStockLink"],bindFutureStockLink:function(){$(document).on("click",".futureStockLink",function(e){e.preventDefault();var url=$(this).attr("href"),title=$(this).attr("title");ACC.colorbox.open(title,{href:url,maxWidth:"100%",width:"320px",height:"320px",initialWidth:"320px"})})}},ACC.productorderform={_autoload:["headerActions","coreTableActions","addToCartOrderGridForm"],$addToCartOrderForm:$("#AddToCartOrderForm"),$addToCartBtn:$("#addToCartBtn"),$omsErrorMessageContainer:$("#globalMessages"),$emptySkuQuantityInputs:$(".sku-quantity[value]"),$nonEmptySkuQuantityInputs:$(".sku-quantity[value]"),$totalGridValues:$("[data-grid-total-id]"),$futureTooltipTemplate:$("#future-stock-template"),$futureTooltipErrorTemplate:$("#future-tooltip-error-template"),$omsErrorMessageTemplate:$("#oms-error-message-template"),$variantSummaryTemplate:$("#variant-summary"),selectedVariantData:"selected-variant",selectedVariants:[],quantityTotal:0,scrollTopPos:0,headerActions:function(){ACC.productorderform.bindProductDetailToggle($(".product-details-toggle"))},coreTableActions:function(){ACC.productorderform.coreTableScrollActions(ACC.productorderform.$addToCartOrderForm),ACC.productorderform.bindUpdateFutureStockButton(".update_future_stock_button"),ACC.productorderform.bindHideFutureStockInfo(".hide_future_stock_info"),ACC.productorderform.bindVariantSelect($(".variant-select-btn"),"AddToCartOrderForm"),ACC.productorderform.cancelVariantModal(".closeVariantModal");var quantityBefore=0,quantityAfter=0;ACC.productorderform.$addToCartOrderForm.on("click",".sku-quantity",function(event){$(this).select()}),ACC.productorderform.$addToCartOrderForm.on("focusin",".sku-quantity",function(event){quantityBefore=jQuery.trim(this.value),$(this).parents("tr").next(".variant-summary").remove(),$(this).parents("table").data(ACC.productorderform.selectedVariantData)?ACC.productorderform.selectedVariants=$(this).parents("table").data(ACC.productorderform.selectedVariantData):ACC.productorderform.selectedVariants=[],""==quantityBefore&&(quantityBefore=0,this.value=0)}),$(".sku-quantity").on("blur",function(event){var currentIndex=parseInt($(this).attr("id").match("[0-9]+")),totalPrice=0,_this=this,currentPrice=$("input[id='productPrice["+currentIndex+"]']").val();this.value=ACC.productorderform.filterSkuEntry(this.value);var $currentTotalItems=$(".js-total-items-count"),currentTotalItemsValue=$currentTotalItems.html(),currentTotalPrice=$(".js-total-price-value").val(),$gridGroup=$(this).parents(".orderForm_grid_group");if(isNaN(jQuery.trim(this.value))&&(this.value=0),quantityAfter=jQuery.trim(this.value),""==quantityAfter&&(quantityAfter=0,this.value=0),ACC.orderform)void 0!==sessionStorage.totalItems&&void 0!==sessionStorage.totalPriceVal&&(currentTotalItemsValue=sessionStorage.totalItems,currentTotalPrice=sessionStorage.totalPriceVal),0==quantityBefore?($currentTotalItems.html(parseInt(currentTotalItemsValue)+parseInt(quantityAfter)),totalPrice=parseFloat(currentTotalPrice)+parseFloat(currentPrice)*parseInt(quantityAfter)):($currentTotalItems.html(parseInt(currentTotalItemsValue)+(parseInt(quantityAfter)-parseInt(quantityBefore))),totalPrice=parseFloat(currentTotalPrice)+parseFloat(currentPrice)*(parseInt(quantityAfter)-parseInt(quantityBefore))),sessionStorage.totalPrice=ACC.productorderform.formatTotalsCurrency(totalPrice),sessionStorage.totalItems=$currentTotalItems.html(),sessionStorage.totalPriceVal=totalPrice,ACC.orderform.addToSkuQtyInput(_this);else if($gridGroup&&$gridGroup.length>0){var $closestQuantityValue=$gridGroup.find("#quantityValue"),$closestAvgPriceValue=$gridGroup.find("#avgPriceValue"),$closestSubtotalValue=$gridGroup.find("#subtotalValue"),currentQuantityValue=$closestQuantityValue.val(),currentSubtotalValue=$closestSubtotalValue.val();0==quantityBefore?($closestQuantityValue.val(parseInt(currentQuantityValue)+parseInt(quantityAfter)),$closestSubtotalValue.val(parseFloat(currentSubtotalValue)+parseFloat(currentPrice)*parseInt(quantityAfter)),$currentTotalItems.html(parseInt(currentTotalItemsValue)+parseInt(quantityAfter)),totalPrice=parseFloat(currentTotalPrice)+parseFloat(currentPrice)*parseInt(quantityAfter)):($closestQuantityValue.val(parseInt(currentQuantityValue)+(parseInt(quantityAfter)-parseInt(quantityBefore))),$closestSubtotalValue.val(parseFloat(currentSubtotalValue)+parseFloat(currentPrice)*(parseInt(quantityAfter)-parseInt(quantityBefore))),$currentTotalItems.html(parseInt(currentTotalItemsValue)+(parseInt(quantityAfter)-parseInt(quantityBefore))),totalPrice=parseFloat(currentTotalPrice)+parseFloat(currentPrice)*(parseInt(quantityAfter)-parseInt(quantityBefore))),ACC.productorderform.enableBeforeUnloadEvent(quantityAfter,$currentTotalItems.text()),0!=$currentTotalItems.length&&0==$currentTotalItems.text()?(ACC.productorderform.$addToCartBtn.attr("disabled","disabled"),$(window).off("beforeunload",ACC.productorderform.beforeUnloadHandler)):ACC.productorderform.$addToCartBtn.removeAttr("disabled"),parseInt($closestQuantityValue.val())>0?$closestAvgPriceValue.val(parseFloat($closestSubtotalValue.val())/parseInt($closestQuantityValue.val())):$closestAvgPriceValue.val(0)}if($gridGroup&&$gridGroup.length>0){var gridLevelTotalPrice="",$gridTotalValue=$gridGroup.find("[data-grid-total-id=total_value_"+currentIndex+"]");quantityAfter>0&&(gridLevelTotalPrice=ACC.productorderform.formatTotalsCurrency(parseFloat(currentPrice)*parseInt(quantityAfter))),$gridTotalValue.html(gridLevelTotalPrice),ACC.productorderform.updateSelectedVariantGridTotal(this,quantityBefore,!1,!1)}$(".js-total-price").html(ACC.productorderform.formatTotalsCurrency(totalPrice)),$(".js-total-price-value").val(totalPrice)}),$("body").on("focusin","#cboxContent .sku-quantity",function(){quantityBefore=jQuery.trim(this.value);var currentVariantId=$(this).data("variant-id"),currentBaseInput=$("#AddToCartOrderForm, #cartOrderGridForm").find("[data-variant-id='"+currentVariantId+"']");currentBaseInput.trigger("focusin"),currentBaseInput.parents("table").find(".variant-summary").remove(),currentBaseInput.parents("table").data(ACC.productorderform.selectedVariantData)?ACC.productorderform.selectedVariants=currentBaseInput.parents("table").data(ACC.productorderform.selectedVariantData):ACC.productorderform.selectedVariants=[],""==quantityBefore&&(quantityBefore=0,this.value=0)}),$("body").on("blur","#cboxContent .sku-quantity",function(){var priceSibling=$(this).siblings(".price"),totalSibling=$(this).siblings(".data-grid-total"),currentVariantId=$(this).data("variant-id"),currentBaseInput=$("#AddToCartOrderForm, #cartOrderGridForm").find("[data-variant-id='"+currentVariantId+"']");this.value=ACC.productorderform.filterSkuEntry(this.value),(isNaN(jQuery.trim(this.value))||this.value<0||""==this.value)&&(this.value=0),currentBaseInput.val(this.value),currentBaseInput.trigger("blur"),ACC.productorderform.updateVariantTotal(priceSibling,this.value,totalSibling),this.value>0&&this.value!=quantityBefore?(currentBaseInput.parents("table").addClass("selected"),currentBaseInput.trigger("change")):0===ACC.productorderform.selectedVariants.length&&currentBaseInput.parents("table").removeClass("selected")})},updateSelectedVariantGridTotal:function(_this,quantityBefore,isFillQty,resetSummary){var priceSibling=$(_this).siblings(".price"),propSibling=$(_this).siblings(".variant-prop"),currentSkuId=$(_this).next(".td_stock").data("sku-id"),currentBaseTotal=$(_this).siblings(".data-grid-total");if(isFillQty&&(ACC.productorderform.selectedVariants=[]),_this.value!=quantityBefore){var newVariant=!0;ACC.productorderform.selectedVariants.forEach(function(item,index){item.id===currentSkuId&&(newVariant=!1,"0"===_this.value||0===_this.value?ACC.productorderform.selectedVariants.splice(index,1):(ACC.productorderform.selectedVariants[index].quantity=_this.value,ACC.productorderform.selectedVariants[index].total=ACC.productorderform.updateVariantTotal(priceSibling,_this.value,currentBaseTotal)))}),newVariant&&_this.value>0&&ACC.productorderform.selectedVariants.push({id:currentSkuId,size:propSibling.data("variant-prop"),quantity:_this.value,total:ACC.productorderform.updateVariantTotal(priceSibling,_this.value,currentBaseTotal)})}resetSummary&&$(_this).parents("table").find(".variant-summary").remove(),ACC.productorderform.showSelectedVariant($(_this).parents("table")),_this.value>0&&_this.value!=quantityBefore?$(_this).parents("table").addClass("selected"):0===ACC.productorderform.selectedVariants.length&&$(_this).parents("table").removeClass("selected").find(".variant-summary").remove()},updateVariantTotal:function(priceSibling,quantity,totalElement){var variantTotal=parseFloat(priceSibling.data("variant-price"))*parseInt(quantity);return totalElement.html(ACC.productorderform.formatTotalsCurrency(variantTotal)),ACC.productorderform.formatTotalsCurrency(variantTotal)},bindUpdateFutureStockButton:function(updateFutureStockButton){$("body").on("click",updateFutureStockButton,function(event){event.preventDefault();var $gridContainer=$(this).parents(".orderForm_grid_group").find(".product-grid-container"),$skus=jQuery.map($gridContainer.find("input[type='hidden'].sku"),function(o){return o.value}),skusId=$(this).data("skusId"),futureStockUrl=$(this).data("skusFutureStockUrl"),postData={skus:$skus,productCode:skusId},hideFutureStockInfo=$(this).parent().find(".hide_future_stock_info"),showFutureStockLink=$(this);$.ajax({url:futureStockUrl,type:"POST",data:postData,traditional:!0,dataType:"json",success:function(data){ACC.productorderform.updateFuture($gridContainer,$skus,data,skusId,showFutureStockLink,hideFutureStockInfo)},error:function(xht,textStatus,ex){alert("Failed to get delivery modes. Error details ["+xht+", "+textStatus+", "+ex+"]")}})})},bindHideFutureStockInfo:function(hideFutureStockInfoLink){$("body").on("click",hideFutureStockInfoLink,function(event){event.preventDefault();var gridContainer=$(this).parent().parent().find(".product-grid-container");$(this).parent().find(".update_future_stock_button").show(),$(this).hide(),gridContainer.find("[data-sku-id]").children(".future_stock, .out-of-stock").remove()})},updateFuture:function(gridContainer,skus,freshData,callerId,showFutureStockInfoLink,hideFutureStockInfo){ACC.productorderform.$omsErrorMessageContainer.find("div").remove(),null!==freshData&&void 0!==freshData["basket.page.viewFuture.unavailable"]?$.tmpl(ACC.productorderform.$omsErrorMessageTemplate,{errorMessage:freshData["basket.page.viewFuture.unavailable"]}).appendTo(ACC.productorderform.$omsErrorMessageContainer):function(obj){return Object.keys(obj).length<=0}(freshData)||(showFutureStockInfoLink.hide(),hideFutureStockInfo.css("display","block"),$.each(skus,function(index,skuId){var stocks=freshData[skuId],cell=gridContainer.find("[data-sku-id='"+skuId+"']"),isCurrentlyInStock=-1!=cell[0].attributes.class.nodeValue.indexOf("in-stock"),futureStockPresent=void 0!==stocks&&null!==stocks&&null!==stocks[0]&&void 0!==stocks[0];cell.children(".future_stock, .out-of-stock").remove(),futureStockPresent?(isCurrentlyInStock||cell.addClass("future-stock"),$.tmpl(ACC.productorderform.$futureTooltipTemplate,{formattedDate:stocks[0].formattedDate,availabilities:stocks}).appendTo(cell)):isCurrentlyInStock||(cell[0].attributes.class.nodeValue="td_stock out-of-stock")}))},toJSON:function(gridForm,skipZeroQuantity){for(var skus=gridForm.find("input.sku").map(function(index,element){return element.value}),skuQuantities=gridForm.find("input.sku-quantity").map(function(index,element){return parseInt(element.value)}),skusAsJSON=[],i=0;i<skus.length;i++)skipZeroQuantity&&0===skuQuantities[i]||skusAsJSON.push({product:{code:skus[i]},quantity:skuQuantities[i]});return JSON.stringify({cartEntries:skusAsJSON})},formatTotalsCurrency:function(amount){return Currency.formatMoney(Number(amount).toFixed(2),Currency.money_format[ACC.common.currentCurrency])},cleanValues:function(){if(0!==$(".orderForm_grid_group").length){var formattedTotal=ACC.productorderform.formatTotalsCurrency("0.00");$(".js-total-price").html(formattedTotal),$("#quantity, .js-total-items-count").html(0),$("#quantityValue, #avgPriceValue, #subtotalValue, .js-total-price-value").val(0),ACC.productorderform.$emptySkuQuantityInputs.val(0),ACC.productorderform.$totalGridValues.html("")}},calculateGrid:function(){ACC.productorderform.$nonEmptySkuQuantityInputs.trigger("focusout")},bindProductDetailToggle:function(productDetailToggle){productDetailToggle.on("click",function(event){event.preventDefault(),$(this).parents(".product-details").toggleClass("open")})},showSelectedVariant:function(currentVariant){$.tmpl(ACC.productorderform.$variantSummaryTemplate,{variants:ACC.productorderform.selectedVariants}).appendTo(currentVariant),$(".variant-summary .variant-property").html($(".variant-detail").data("variant-property")),currentVariant.data(ACC.productorderform.selectedVariantData,ACC.productorderform.selectedVariants),currentVariant.removeClass("currentVariant")},bindVariantSelect:function(variantSelectBtn,parentId){variantSelectBtn.on("click",function(event){event.preventDefault();var currentVariant=$(this).parents("table");currentVariant.data(ACC.productorderform.selectedVariantData)?ACC.productorderform.selectedVariants=currentVariant.data(ACC.productorderform.selectedVariantData):ACC.productorderform.selectedVariants=[];var titleHeader=variantSelectBtn.html(),tableWrap=$("#"+parentId).clone().empty().attr("id",parentId+"Variant");currentVariant.addClass("currentVariant");var popupContent=$(this).parents(".orderForm_grid_group").clone();currentVariant.removeClass("currentVariant"),$(popupContent).find(".currentVariant").siblings().remove(),tableWrap.html(popupContent),tableWrap.find(".hidden-xs").removeClass("hidden-xs"),tableWrap.find(".hide").removeClass("hide"),scrollTopPos=$("body").scrollTop(),$("body").scrollTop(0),ACC.colorbox.open(titleHeader,{html:tableWrap,width:"100%",reposition:!1,className:"variantSelectMobile",onCleanup:function(){ACC.productorderform.$addToCartOrderForm.find(".selected").length>0?ACC.productorderform.$addToCartBtn.removeAttr("disabled"):ACC.productorderform.$addToCartBtn.attr("disabled","disabled"),$("body").scrollTop(scrollTopPos)}})})},cancelVariantModal:function(closeVariantModal){$("body").on("click",closeVariantModal,function(event){event.preventDefault(),ACC.colorbox.close()})},resetSelectedVariant:function(){ACC.productorderform.selectedVariants=[],$(".product-grid-container table").removeData(ACC.productorderform.selectedVariantData).removeClass("selected").removeClass("currentVariant")},addToCartOrderGridForm:function(){$("#AddToCartOrderForm").keypress(function(event){"13"==event.which&&event.preventDefault()}),ACC.productorderform.$addToCartBtn.click(function(){ACC.productorderform.$addToCartBtn.attr("disabled","disabled"),$.ajax({url:ACC.productorderform.$addToCartOrderForm.attr("action"),type:"POST",dataType:"json",contentType:"application/json",data:ACC.productorderform.toJSON(ACC.productorderform.$addToCartOrderForm,!0),async:!1,success:function(response){$(window).off("beforeunload",ACC.productorderform.beforeUnloadHandler),ACC.product.displayAddToCartPopup(response),ACC.productorderform.cleanValues(),ACC.productorderform.resetSelectedVariant()},error:function(jqXHR,textStatus,errorThrown){console.log("The following error occured: "+textStatus,errorThrown)}})})},beforeUnloadHandler:function(){return ACC.productorderform.$addToCartOrderForm.attr("data-grid-confirm-message")},enableBeforeUnloadEvent:function(quantityAfter,currentTotalItems){ACC.orderform||quantityAfter>0&&currentTotalItems>0&&$(window).off("beforeunload",ACC.productorderform.beforeUnloadHandler).on("beforeunload",ACC.productorderform.beforeUnloadHandler)},filterSkuEntry:function(quantityInput){return/\D/g.test(quantityInput)?quantityInput.replace(/\D/g,""):quantityInput},coreTableScrollActions:function($scrollContent){if($scrollContent.hasClass("visible")){ACC.productorderform.orderGridScroll($scrollContent);var scrollRight=$scrollContent.parent().find(".order-form-scroll.right"),scrollLeft=$scrollContent.parent().find(".order-form-scroll.left"),scrollUp=$scrollContent.parent().find(".order-form-scroll.up"),scrollDown=$scrollContent.parent().find(".order-form-scroll.down"),widthReference=$scrollContent.find(".widthReference").outerWidth(),heightReference=$scrollContent.find(".product-grid-container table").eq(0).height()/2,maxWidth=0,maxHeight=0,widthDiff=0,heightDiff=0;$scrollContent.find(".product-grid-container table").each(function(){$(this).outerWidth()>maxWidth&&(maxWidth=$(this).outerWidth())}),$scrollContent.find(".orderForm_grid_group").each(function(){maxHeight+=$(this).height()}),widthDiff=maxWidth-$scrollContent.outerWidth(),heightDiff=maxHeight-$scrollContent.height()+14,$scrollContent.scroll(function(){$(this).scrollLeft()>0?scrollLeft.show():scrollLeft.hide(),$(this).scrollLeft()>=widthDiff?scrollRight.hide():scrollRight.show(),$(this).scrollTop()>0?scrollUp.show():scrollUp.hide(),$(this).scrollTop()>=heightDiff?scrollDown.hide():scrollDown.show(),$scrollContent.find(".update-future-stock").css("margin-right",-$(this).scrollLeft())}),$scrollContent.parent().find(".order-form-scroll").click(function(){var pos={left:$scrollContent.scrollLeft(),top:$scrollContent.scrollTop()};$(this).hasClass("right")?$scrollContent.scrollLeft(pos.left+widthReference):$(this).hasClass("left")?$scrollContent.scrollLeft(pos.left-widthReference):$(this).hasClass("up")?$scrollContent.scrollTop(pos.top-heightReference):$scrollContent.scrollTop(pos.top+heightReference)})}},orderGridScroll:function(scrollContent){var showRight=!1,calcHeight=0,maxWidth=$(scrollContent).find(".orderForm_grid_group").innerWidth(),maxHeight=$(scrollContent).innerHeight()-18;$(scrollContent).find(".product-grid-container table").each(function(){$(this).width()>maxWidth&&(showRight=!0),calcHeight+=$(this).height()}),showRight&&$(scrollContent).parent().find(".order-form-scroll.right").show(),calcHeight>maxHeight&&$(scrollContent).parent().find(".order-form-scroll.down").show()},calculateVariantTotal:function(_this,quantityToAdd){var $gridGroup=_this.parents(".orderForm_grid_group"),currentIndex=parseInt(_this.attr("id").match("[0-9]+")),currentPrice=$("input[id='productPrice["+currentIndex+"]']").val(),$gridTotalValue=$gridGroup.find("[data-grid-total-id=total_value_"+currentIndex+"]");quantityToAdd>0&&$gridTotalValue.html(ACC.productorderform.formatTotalsCurrency(parseFloat(currentPrice)*parseInt(quantityToAdd)))}},ACC.savedcarts={_autoload:[["bindRestoreSavedCartClick",0!=$(".js-restore-saved-cart").length],["bindDeleteSavedCartLink",0!=$(".js-delete-saved-cart").length],["bindDeleteConfirmLink",0!=$(".js-savedcart_delete_confirm").length],["bindSaveCartForm",0!=$(".js-save-cart-link").length||0!=$(".js-update-saved-cart").length],["bindUpdateUploadingSavedCarts",0!=$(".js-uploading-saved-carts-update").length]],$savedCartRestoreBtn:{},$currentCartName:{},bindRestoreSavedCartClick:function(){$(".js-restore-saved-cart").click(function(event){event.preventDefault();var popupTitle=$(this).data("restore-popup-title"),cartId=$(this).data("savedcart-id"),url=ACC.config.encodedContextPath+"/my-account/saved-carts/"+cartId+"/restore";$.get(url).done(function(data){ACC.colorbox.open(popupTitle,{html:data,width:500,onComplete:function(){ACC.common.refreshScreenReaderBuffer(),ACC.savedcarts.bindRestoreModalHandlers(),ACC.savedcarts.bindPostRestoreSavedCartLink()},onClosed:function(){ACC.common.refreshScreenReaderBuffer()}})})})},bindRestoreModalHandlers:function(){ACC.savedcarts.$savedCartRestoreBtn=$(".js-save-cart-restore-btn"),ACC.savedcarts.$currentCartName=$(".js-current-cart-name"),$(".js-prevent-save-active-cart").on("change",function(event){if(!0===$(this).prop("checked"))ACC.savedcarts.$currentCartName.attr("disabled","disabled"),ACC.savedcarts.$savedCartRestoreBtn.removeAttr("disabled");else{ACC.savedcarts.$currentCartName.removeAttr("disabled");var inputVal=ACC.savedcarts.$currentCartName.val();""==inputVal&&0===inputVal.length&&ACC.savedcarts.$savedCartRestoreBtn.attr("disabled","disabled")}}),ACC.savedcarts.$currentCartName.on("focus",function(event){$(".js-restore-current-cart-form").removeClass("has-error"),$(".js-restore-error-container").html("")}),ACC.savedcarts.$currentCartName.on("blur",function(event){""==this.value&&0===this.value.length?ACC.savedcarts.$savedCartRestoreBtn.attr("disabled","disabled"):ACC.savedcarts.$savedCartRestoreBtn.removeAttr("disabled")})},bindPostRestoreSavedCartLink:function(){var keepRestoredCart=!0,preventSaveActiveCart=!1;$(document).on("click",".js-keep-restored-cart",function(event){keepRestoredCart=$(this).prop("checked")}),$(document).on("click",".js-prevent-save-active-cart",function(event){preventSaveActiveCart=$(this).prop("checked")}),$(document).on("click",".js-save-cart-restore-btn",function(event){event.preventDefault();var cartName=$("#activeCartName").val(),url=$(this).data("restore-url"),postData={preventSaveActiveCart:preventSaveActiveCart,keepRestoredCart:keepRestoredCart,cartName:cartName};$.post(url,postData).done(function(result,data,status){if("200"==result){var url=ACC.config.encodedContextPath+"/cart";window.location.replace(url)}else{var errorMsg=status.responseText.slice(1,-1);$(".js-restore-current-cart-form").addClass("has-error"),$(".js-restore-error-container").html(errorMsg),$(".js-savedcart_restore_confirm_modal").colorbox.resize()}})}),$(document).on("click",".js-cancel-restore-btn",function(event){ACC.colorbox.close()})},bindDeleteSavedCartLink:function(){$(document).on("click",".js-delete-saved-cart",function(event){event.preventDefault();var cartId=$(this).data("savedcart-id"),popupTitle=$(this).data("delete-popup-title");ACC.colorbox.open(popupTitle,{inline:!0,className:"js-savedcart_delete_confirm_modal",href:"#popup_confirm_savedcart_delete_"+cartId,width:"500px",onComplete:function(){$(this).colorbox.resize()}})})},bindDeleteConfirmLink:function(){$(document).on("click",".js-savedcart_delete_confirm",function(event){event.preventDefault()
;var cartId=$(this).data("savedcart-id"),url=ACC.config.encodedContextPath+"/my-account/saved-carts/"+cartId+"/delete";$.ajax({url:url,type:"DELETE",success:function(response){ACC.colorbox.close();var url=ACC.config.encodedContextPath+"/my-account/saved-carts";window.location.replace(url)}})}),$(document).on("click",".js-savedcart_delete_confirm_cancel",function(event){ACC.colorbox.close()})},bindSaveCartForm:function(){var form=$("#saveCartForm"),saveCart=!1,showSaveCartFormCallback=function(){var title=$("#saveCart").data("saveCartTitle");ACC.colorbox.open(title,{href:"#saveCart",inline:!0,width:"620px",onOpen:function(){$("#saveCartName").val()&&ACC.savedcarts.disableSaveCartButton(!1)},onComplete:function(){$(this).colorbox.resize(),saveCart=!1},onClosed:function(){saveCart&&form.submit(),document.getElementById("saveCartForm").reset(),ACC.savedcarts.disableSaveCartButton(!0)}})};$(document).on("click",".js-save-cart-link, .js-update-saved-cart",function(e){e.preventDefault(),ACC.common.checkAuthenticationStatusBeforeAction(showSaveCartFormCallback)}),$(document).on("click","#saveCart #cancelSaveCartButton",function(e){e.preventDefault(),$.colorbox.close()}),$("#saveCartName").keyup(function(){$("#saveCart #saveCartButton").prop("disabled",""==this.value.trim());var tlength=$(this).val().length;$(this).val($(this).val().substring(0,255));var tlength=$(this).val().length;remain=255-parseInt(tlength),$("#saveCartName").text(remain)}),$(document).on("click","#saveCart #saveCartButton",function(e){e.preventDefault(),saveCart=!0,$.colorbox.close()})},disableSaveCartButton:function(value){$("#saveCart #saveCartButton").prop("disabled",value)},bindUpdateUploadingSavedCarts:function(){var cartIdRowMapping=$(".js-uploading-saved-carts-update").data("idRowMapping"),refresh=$(".js-uploading-saved-carts-update").data("refreshCart");if(cartIdRowMapping&&refresh){var interval=$(".js-uploading-saved-carts-update").data("refreshInterval"),arrCartIdAndRow=cartIdRowMapping.split(","),mapCartRow=new Object,cartCodes=[];for(i=0;i<arrCartIdAndRow.length;i++){var arrValue=arrCartIdAndRow[i].split(":");""!=arrValue&&(mapCartRow[arrValue[0]]=arrValue[1],cartCodes.push(arrValue[0]))}cartCodes.length>0&&setTimeout(function(){ACC.savedcarts.refreshWorker(cartCodes,mapCartRow,interval)},interval)}},refreshWorker:function(cartCodes,mapCartRow,interval){$.ajax({dataType:"json",url:ACC.config.encodedContextPath+"/my-account/saved-carts/uploadingCarts",data:{cartCodes:cartCodes},type:"GET",traditional:!0,success:function(data){if(void 0!=data){for(i=0;i<data.length;i++){var cart=data[i],index=$.inArray(cart.code,cartCodes);index>-1&&cartCodes.splice(index,1);var rowIdIndex=mapCartRow[cart.code];if(void 0!=rowIdIndex){var rowSelector="#row-"+rowIdIndex;$(rowSelector+" .js-saved-cart-name").removeClass("not-active"),$(rowSelector+" .js-saved-cart-date").removeClass("hidden"),$(rowSelector+" .js-file-importing").remove(),$(rowSelector+" .js-saved-cart-description").text(cart.description);var numberOfItems=cart.entries.length;$(rowSelector+" .js-saved-cart-number-of-items").text(numberOfItems),$(rowSelector+" .js-saved-cart-total").text(cart.totalPrice.formattedValue),numberOfItems>0&&$(rowSelector+" .js-restore-saved-cart").removeClass("hidden"),$(rowSelector+" .js-delete-saved-cart").removeClass("hidden")}}}cartCodes.length>0&&setTimeout(function(){ACC.savedcarts.refreshWorker(cartCodes,mapCartRow,interval)},interval)}})}},ACC.multidgrid={populateAndShowGridOverlay:function(element,event){event.preventDefault();var itemIndex=$(element).data("index"),gridEntries=$("#grid"+itemIndex),strSubEntries=gridEntries.data("sub-entries"),productName=gridEntries.data("product-name"),arrSubEntries=strSubEntries.split(","),firstVariantCode=arrSubEntries[0].split(":")[0],targetUrl=gridEntries.data("target-url")+"?productCode="+firstVariantCode;ACC.colorbox.open(productName,{href:targetUrl,className:"read-only-grid",close:'<span class="glyphicon glyphicon-remove"></span>',width:window.innerWidth>parseInt(cboxOptions.maxWidth)?cboxOptions.maxWidth:cboxOptions.width,height:window.innerHeight>parseInt(cboxOptions.maxHeight)?cboxOptions.maxHeight:cboxOptions.height,onComplete:function(){$("body").addClass("offcanvas");var oH=$("#cboxLoadedContent").height();$("#cboxLoadedContent").height(oH-$("#cboxTitle").height()+"px")},onClosed:function(){$("body").removeClass("offcanvas")}})},populateAndShowGrid:function(element,event,readOnly){var itemIndex=$(element).data("index");grid=$("#ajaxGrid"+itemIndex);var gridEntries=$("#grid"+itemIndex);if($(element).toggleClass("open"),!grid.is(":hidden"))return void grid.slideUp();if(""!=grid.html())return void grid.slideToggle("slow");var strSubEntries=gridEntries.data("sub-entries"),arrSubEntries=strSubEntries.split(","),firstVariantCode=arrSubEntries[0].split(":")[0],targetUrl=gridEntries.data("target-url");$.ajax({url:targetUrl,data:{productCode:firstVariantCode},type:"GET",success:function(data){grid.html(data),grid.slideDown("slow")},error:function(xht,textStatus,ex){alert("Failed to get variant matrix. Error details ["+xht+", "+textStatus+", "+ex+"]")}})}};var ACC=ACC||{};$("#quickOrder").length>0&&(ACC.quickorder={_autoload:["bindClearQuickOrderRow","bindAddSkuInputRow","bindResetFormBtn","bindAddToCartClick"],$quickOrderContainer:$(".js-quick-order-container"),$quickOrderMinRows:Number($(".js-quick-order-container").data("quickOrderMinRows")),$quickOrderMaxRows:Number($(".js-quick-order-container").data("quickOrderMaxRows")),$productExistsInFormMsg:$(".js-quick-order-container").data("productExistsInFormMsg"),$quickOrderLeavePageMsg:$("#quickOrder").data("gridConfirmMessage"),$hiddenSkuInput:"input.js-hidden-sku-field",$addToCartBtn:$("#js-add-to-cart-quick-order-btn-top, #js-add-to-cart-quick-order-btn-bottom"),$resetFormBtn:$("#js-reset-quick-order-form-btn-top, #js-reset-quick-order-form-btn-bottom"),$productInfoContainer:".js-product-info",$skuInputField:".js-sku-input-field",$qtyInputField:".js-quick-order-qty",$jsLiContainer:"li.js-li-container",$removeQuickOrderRowBtn:".js-remove-quick-order-row",$skuValidationContainer:".js-sku-validation-container",$qtyValidationContainer:".js-qty-validation-container",$productItemTotal:".js-quick-order-item-total",$classHasError:"has-error",bindResetFormBtn:function(){ACC.quickorder.$resetFormBtn.on("click",ACC.quickorder.clearForm)},bindAddToCartClick:function(){ACC.quickorder.$addToCartBtn.on("click",ACC.quickorder.addToCart)},bindAddSkuInputRow:function(){$(ACC.quickorder.$skuInputField).on("focusin",ACC.quickorder.addInputRow).on("focusout",ACC.quickorder.handleFocusOutOnSkuInput)},bindClearQuickOrderRow:function(){$(ACC.quickorder.$removeQuickOrderRowBtn).on("mousedown",ACC.quickorder.clearQuickOrderRow)},addToCart:function(){$.ajax({url:ACC.quickorder.$quickOrderContainer.data("quickOrderAddToCartUrl"),type:"POST",dataType:"json",contentType:"application/json",data:ACC.quickorder.getJSONDataForAddToCart(),async:!1,success:function(response){ACC.quickorder.handleAddToCartSuccess(response)},error:function(jqXHR,textStatus,errorThrown){console.log("The following error occurred: "+textStatus,errorThrown)}})},handleAddToCartSuccess:function(response){$(response.quickOrderErrorData).size()>0&&ACC.quickorder.disableBeforeUnloadEvent();var lookup={};response.quickOrderErrorData.forEach(function(el){lookup[el.sku]=el.errorMsg}),$(ACC.quickorder.$qtyInputField).each(function(){var parentLi=ACC.quickorder.getCurrentParentLi(this),sku=ACC.quickorder.findElement(parentLi,ACC.quickorder.$skuInputField).val(),errorMsg=lookup[sku];errorMsg?ACC.quickorder.findElement(parentLi,ACC.quickorder.$skuValidationContainer).text(errorMsg):ACC.quickorder.findElement(parentLi,ACC.quickorder.$removeQuickOrderRowBtn).trigger("mousedown")}),ACC.quickorder.handleBeforeUnloadEvent(),ACC.product.displayAddToCartPopup(response)},getJSONDataForAddToCart:function(){var skusAsJSON=[];return $(ACC.quickorder.$qtyInputField).each(function(){var qty=Number($(this).val());if(qty>0){var sku=jQuery.trim(ACC.quickorder.findElementInCurrentParentLi(this,ACC.quickorder.$skuInputField).val());skusAsJSON.push({product:{code:sku},quantity:qty})}}),JSON.stringify({cartEntries:skusAsJSON})},handleFocusOutOnSkuInput:function(event){ACC.quickorder.handleGetProduct(event),ACC.quickorder.handleBeforeUnloadEvent()},handleFocusOutOnQtyInput:function(event){ACC.quickorder.validateAndUpdateItemTotal(event),ACC.quickorder.enableDisableAddToCartBtn()},clearForm:function(){window.location.reload()},validateAndUpdateItemTotal:function(event){var parentLi=ACC.quickorder.getCurrentParentLi(event.target),qtyValue=jQuery.trim(ACC.productorderform.filterSkuEntry($(event.target).val()));if(isNaN(qtyValue)||""==qtyValue)qtyValue=0,$(event.target).removeClass(ACC.quickorder.$classHasError),ACC.quickorder.findElement(parentLi,ACC.quickorder.$qtyValidationContainer).text(""),$(event.target).val(0);else{qtyValue=Number(qtyValue),$(event.target).val(qtyValue);var maxQty=jQuery.trim(ACC.quickorder.findElement(parentLi,ACC.quickorder.$qtyInputField).data("maxProductQty")),stockLevelStatus=jQuery.trim(ACC.quickorder.findElement(parentLi,ACC.quickorder.$qtyInputField).data("stockLevelStatus"));if(maxQty=$.isEmptyObject(maxQty)&&"inStock"==stockLevelStatus?"FORCE_IN_STOCK":Number(maxQty),!isNaN(maxQty)&&qtyValue>maxQty){$(event.target).addClass(ACC.quickorder.$classHasError);var qtyValidationContainer=ACC.quickorder.findElement(parentLi,ACC.quickorder.$qtyValidationContainer);qtyValidationContainer.text(qtyValidationContainer.data("maxProductQtyMsg")),qtyValue=maxQty,$(event.target).val(maxQty)}else $(event.target).removeClass(ACC.quickorder.$classHasError),ACC.quickorder.findElement(parentLi,ACC.quickorder.$qtyValidationContainer).text("")}if(qtyValue>0){var itemPrice=parseFloat(ACC.quickorder.findElement(parentLi,".js-product-price").data("productPrice"));ACC.quickorder.findElement(parentLi,ACC.quickorder.$productItemTotal).html(ACC.productorderform.formatTotalsCurrency(itemPrice*qtyValue))}else ACC.quickorder.findElement(parentLi,ACC.quickorder.$productItemTotal).text("")},clearQuickOrderRow:function(){var quickOrderMinRows=ACC.quickorder.$quickOrderMinRows,parentLi=ACC.quickorder.getCurrentParentLi(this);$(".js-ul-container li.js-li-container").length>quickOrderMinRows?(parentLi.remove(),ACC.quickorder.bindClearQuickOrderRow()):(ACC.quickorder.findElement(parentLi,ACC.quickorder.$productInfoContainer).remove(),ACC.quickorder.findElement(parentLi,ACC.quickorder.$skuValidationContainer).text(""),ACC.quickorder.findElement(parentLi,ACC.quickorder.$skuInputField).val(""),ACC.quickorder.findElement(parentLi,ACC.quickorder.$hiddenSkuInput).val("")),ACC.quickorder.enableDisableAddToCartBtn(),ACC.quickorder.handleBeforeUnloadEvent()},addInputRow:function(event){if($(".js-quick-order-container li.js-li-container:last-child").find(ACC.quickorder.$skuInputField).is($(event.target))&&$(ACC.quickorder.$jsLiContainer).length<ACC.quickorder.$quickOrderMaxRows){var liClone=$(".js-quick-order-container li.js-li-container:first").clone();ACC.quickorder.findElement(liClone,ACC.quickorder.$productInfoContainer).remove(),ACC.quickorder.findElement(liClone,ACC.quickorder.$skuValidationContainer).text(""),ACC.quickorder.findElement(liClone,ACC.quickorder.$hiddenSkuInput).val("");var currentSkuInputField=ACC.quickorder.findElement(liClone,ACC.quickorder.$skuInputField);currentSkuInputField.val(""),currentSkuInputField.focusin(ACC.quickorder.addInputRow).focusout(ACC.quickorder.handleFocusOutOnSkuInput),ACC.quickorder.findElement(liClone,ACC.quickorder.$removeQuickOrderRowBtn).click(ACC.quickorder.clearQuickOrderRow),$(".js-ul-container").append(liClone)}},handleGetProduct:function(event){var parentLi=ACC.quickorder.getCurrentParentLi(event.target),productCode=$.trim(event.target.value);$(event.target).val(productCode),ACC.quickorder.isCurrentSkuSameAsPrevious(parentLi,productCode)||(productCode.length>0?(ACC.quickorder.findElement(parentLi,ACC.quickorder.$productInfoContainer).remove(),ACC.quickorder.isDuplicateSku(event.target,productCode)?ACC.quickorder.findElement(parentLi,ACC.quickorder.$skuValidationContainer).text(ACC.quickorder.$productExistsInFormMsg):ACC.quickorder.getAndDisplayProductInfo(event,parentLi,productCode),ACC.quickorder.findElement(parentLi,ACC.quickorder.$hiddenSkuInput).val(productCode)):($(event.target).removeClass(ACC.quickorder.$classHasError),ACC.quickorder.findElement(parentLi,ACC.quickorder.$skuValidationContainer).text(""),ACC.quickorder.findElement(parentLi,ACC.quickorder.$productInfoContainer).remove()))},isCurrentSkuSameAsPrevious:function(parentLi,productCode){return ACC.quickorder.findElement(parentLi,ACC.quickorder.$hiddenSkuInput).val()==productCode},isDuplicateSku:function(currentInput,productCode){var exists=!1;return $(ACC.quickorder.$skuInputField).each(function(){if($(this).val()==productCode&&!$(this).is($(currentInput)))return exists=!0,!1}),exists},getAndDisplayProductInfo:function(event,parentLi,productCode){var url=ACC.config.encodedContextPath+"/quickOrder/productInfo?code="+productCode;$.getJSON(url,function(result){if(null!=result.errorMsg&&result.errorMsg.length>0)$(event.target).addClass(ACC.quickorder.$classHasError),ACC.quickorder.findElement(parentLi,ACC.quickorder.$skuValidationContainer).text(result.errorMsg);else{$(event.target).removeClass(ACC.quickorder.$classHasError),ACC.quickorder.findElement(parentLi,ACC.quickorder.$skuValidationContainer).text(""),$("#quickOrderRowTemplate").tmpl(result.productData).insertAfter(ACC.quickorder.findElement(parentLi,".js-sku-container"));var qtyInputField=ACC.quickorder.findElement(parentLi,ACC.quickorder.$qtyInputField);qtyInputField.focusout(ACC.quickorder.handleFocusOutOnQtyInput);"outOfStock"==result.productData.stock.stockLevelStatus.code?(qtyInputField.val(0),qtyInputField.prop("disabled",!0)):qtyInputField.focus().select(),ACC.quickorder.enableDisableAddToCartBtn()}})},handleBeforeUnloadEvent:function(){ACC.quickorder.isAnySkuPresent()?(ACC.quickorder.disableBeforeUnloadEvent(),ACC.quickorder.enableBeforeUnloadEvent()):ACC.quickorder.disableBeforeUnloadEvent()},disableBeforeUnloadEvent:function(){$(window).off("beforeunload",ACC.quickorder.beforeUnloadHandler)},enableBeforeUnloadEvent:function(){$(window).on("beforeunload",ACC.quickorder.beforeUnloadHandler)},beforeUnloadHandler:function(){return ACC.quickorder.$quickOrderLeavePageMsg},enableDisableAddToCartBtn:function(){ACC.quickorder.shouldAddToCartBeEnabled()?ACC.quickorder.$addToCartBtn.removeAttr("disabled"):ACC.quickorder.$addToCartBtn.attr("disabled","disabled")},shouldAddToCartBeEnabled:function(){var sum=0,enable=!1;return $(ACC.quickorder.$qtyInputField).each(function(){var str=this.value.trim();if(str&&(sum+=parseInt(str,10)),sum>=1)return enable=!0,!1}),enable},isAnySkuPresent:function(){var present=!1;return $(ACC.quickorder.$skuInputField).each(function(){if(jQuery.trim(this.value))return present=!0,!1}),present},getCurrentParentLi:function(currentElement){return $(currentElement).closest(ACC.quickorder.$jsLiContainer)},findElement:function(currentElement,toFind){return $(currentElement).find(toFind)},findElementInCurrentParentLi:function(currentElement,toFind){return $(currentElement).closest(ACC.quickorder.$jsLiContainer).find(toFind)}}),ACC.login={_config:{element:{popup:"#sign-in__popup",sentEmailPopup:"#js-sent-email-popup",globalMsgWrapper:".js-login-global-msg-wrapper",globalMsg:".js-login-global-msg",usernameMsg:".js-login-username-msg",passwordMsg:".js-login-pwd-msg",verifyBtn:".js-login-verify-btn",loginBtn:".js-login-btn",username:"#j_username",password:"#j_password",phoneVerify:".js-verify-phone",captchaMsg:".js-login-captcha-miss",otpCaptchaMsg:".js-login-otp-captcha-miss",loginForm:".js-login-form",userInfo:".js-user--info",blockContent:"#sign-in__popup .modal-content"}},_autoload:[["initDefaultForm",document.location.pathname.indexOf("delivery-address")<0],["bindSigninButton",document.location.pathname.indexOf("delivery-address")<0],["bindLoginSubmit",document.location.pathname.indexOf("delivery-address")<0],["bindVerifyAccount",document.location.pathname.indexOf("delivery-address")<0],["bindFormSignUp",document.location.pathname.indexOf("delivery-address")<0],["updateUserInfo",document.location.pathname.indexOf("delivery-address")<0]],data:{accountType:"",account:"",localIp:""},initDefaultForm:function(){if(ACC.common.loadModuleElements(ACC.login),this.popup.on("hidden.bs.modal",function(){ACC.login.refreshLoginForm(!0)}),this.popup.on("shown.bs.modal",function(){ACC.login.username.focus()}),this.refreshLoginForm(!0),ACC.login.data.localIp="_UNDEFINED_",window.RTCPeerConnection=window.RTCPeerConnectiaccon||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,void 0!==window.RTCPeerConnection){var pc=new RTCPeerConnection({iceServers:[]}),noop=function(){};void 0!==pc.createDataChannel&&(pc.createDataChannel(""),pc.createOffer(pc.setLocalDescription.bind(pc),noop),pc.onicecandidate=function(ice){var ipRegex,myIP;ice&&ice.candidate&&ice.candidate.candidate&&(ipRegex=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(ice.candidate.candidate),myIP="","object"==typeof ipRegex&&ipRegex.length>1&&(myIP=ipRegex[1]),ACC.login.data.localIp=myIP,pc.onicecandidate=noop)})}},bindSigninButton:function(){$(".js-sign-in__popup").click(function(e){ACC.login.show()})},bindLoginSubmit:function(){this.loginBtn.click(function(event){event.preventDefault();var username=ACC.login.username.val().trim(),password=ACC.login.password.val(),url=ACC.common.attachCaptchaParameter("#sign-in__popup",ACC.config.localLoginUrl),data={j_username:username,j_password:password,localIp:ACC.login.data.localIp};ACC.login.block(),$.postJSONCallback(url,JSON.stringify(data),function(result){ACC.login.refreshLoginForm(),ACC.login.unblock(),result&&(result.showCaptcha&&ACC.captcha.renderWidget("js-login-captcha"),1===result.code?(ACC.login.globalMsg.html(result.globalMsg),ACC.login.globalMsgWrapper.show(),ACC.login.verifyBtn.show(),ACC.login.data.accountType=result.accountType,ACC.login.data.account=username,ACC.login.loginForm.addClass("has-error")):2===result.code?(ACC.login.globalMsg.html(result.globalMsg),ACC.login.globalMsgWrapper.show(),ACC.login.loginForm.addClass("has-error")):3===result.code?(ACC.login.usernameMsg.html(result.usernameMsg),ACC.login.passwordMsg.html(result.passwordMsg),ACC.login.loginForm.addClass("has-error"),ACC.captcha.showError("js-login-captcha",result.captchaMsg)):4===result.code&&ACC.login.handleLoginSuccess(username))},function(){ACC.login.unblock()})})},bindVerifyAccount:function(){this.verifyBtn.click(function(event){event.preventDefault(),ACC.login.data.accountType&&"email"===ACC.login.data.accountType.toLowerCase()&&ACC.login.data.account?$.get(ACC.config.sendLoginEmailUrl+"?username="+ACC.login.data.account,function(result){ACC.login.popup.modal("hide"),ACC.login.sentEmailPopup.modal("show")}):(ACC.login.block(),ACC.otp.sendADROTP({username:ACC.login.data.account,type:ACC.config.otpRequestType.SIGNIN_VERIFY_PHONE},ACC.otp.func.signInUp).then(function(response){ACC.login.unblock(),ACC.login.hide(),ACC.adrOtpPopup.showInSuccess({phone:ACC.login.data.account},ACC.login.handleConfirmOtp)},function(jqXHR){ACC.login.unblock(),ACC.login.hide(),ACC.adrOtpPopup.showInError({phone:ACC.login.data.account},jqXHR.responseJSON.message,ACC.login.handleConfirmOtp)}))})},refreshLoginForm:function(all){all&&this.username.val(""),ACC.captcha.reset("js-login-captcha"),this.usernameMsg.html(""),this.passwordMsg.html(""),this.password.val(""),this.globalMsg.html(""),this.globalMsgWrapper.hide(),this.verifyBtn.hide()},handleLoginSuccess:function(username){this.hide(),location.reload(),this.updateUserInfo(!0),this.handleCommentForm(),"CART"===ACC.config.currentPageType&&ACC.cart.updateCartPage()},handlePageLoaded:function(){window.addEventListener("load",function(){})},handleCommentForm:function(){$("#anonymous-info").hide()},handleConfirmOtp:function(phone,otpCode){var data=JSON.stringify({otpCode:otpCode,username:phone}),url=ACC.adrOtpPopup.attachCaptchaData(ACC.config.verifyLoginOTPUrl);ACC.adrOtpPopup.block(),$.postJSONCallback(url,data,function(result){ACC.adrOtpPopup.unblock(),ACC.adrOtpPopup.hide(),location.reload(),ACC.login.updateUserInfo(!0),ACC.suggestvinid.processSuggestVinID(phone)},function(jqXHR){ACC.adrOtpPopup.unblock(),ACC.adrOtpPopup.errorMsg.html(jqXHR.responseJSON.message),ACC.adrOtpPopup.successMsg.hide(),ACC.adrOtpPopup.resetCaptCha()})},updateUserInfo:function(isForce){!isForce&&"true"!==ACC.config.isLogin||($(document).on("show.bs.dropdown","#userInfoDropdown",function(){ACC.requests.requestVinidInfo(),ACC.requests.requestUserMeta()}),enquire.register("(max-width: 768px)",{match:function(){ACC.requests.requestVinidInfo()},deferSetup:!0}))},hide:function(){this.refreshLoginForm(!0),this.popup.modal("hide")},show:function(){$.get(ACC.config.checkCaptchaUrl+"?localip="+ACC.login.data.localIp,function(result){result&&ACC.captcha.renderWidget("js-login-captcha")}),ACC.login.loginForm.removeClass("has-error"),this.popup.modal("show")},block:function(){this.blockContent.block()},unblock:function(){this.blockContent.unblock()},bindFormSignUp:function(){$(".js--open-sign-in__popup").click(function(e){ACC.login.hide(),ACC.register.show()})},updateUserEmail:function(email){window.mediator.publish("updateUserEmail",email)}},ACC.socialLogin={_config:{element:{popup:"#sign-in-social__popup",existing_popup:"#social-login-existing"}},_autoload:["initElements","initPageEvents","initResendOnClick"],initElements:function(){ACC.common.loadModuleElements(ACC.socialLogin)},showNotSupport:function(){this.popup.modal("show")},showExistingPopup:function(email,provider,externalid,name,autoLogin){this.existing_popup.modal("show"),$("#userId1").text(email),$("#userId2").text(email),$("#providerId").text(provider),$("#externalId").text(externalid),$("#name").text(name),$("#autoLogin").val(autoLogin);var formData={type:ACC.config.otpRequestType.SIGNIN_VERIFY_EMAIL,username:email,name:name};ACC.otp.sendADROTP(formData,"SOCIAL")},initPageEvents:function(){$(document).on("click","#verificationAccountId",function(){var otpCode=$("#inputVerifyCodeId").val(),email=$("#userId2").text(),provider=$("#providerId").text(),externalId=$("#externalId").text(),autoLogin=$("#autoLogin").val(),url=ACC.config.verifyOTPEmailUrl;$("#social-login-existing").block(),ACC.otp.verifyADROTPEmail(otpCode,email,provider,externalId,url,autoLogin).then(function(response){$("#social-login-existing").unblock(),$("#social-login-existing").modal("hide"),ACC.common.resetForm($("#social-login-existing")),autoLogin?window.location.href="/checkout":ACC.suggestvinid.processSuggestVinID(email)},function(jqXHR){$("#social-login-existing").unblock(),ACC.suggestvinid.addErrorMessageToField($("#inputVerifyCodeId"),jqXHR.responseJSON.message)})})},addErrorMessageToField:function(fieldGroup,error){var parentElement=fieldGroup.parent(),errorContainer=parentElement.find("p.error-message");"OK"===error?errorContainer.text(""):errorContainer.text(error)},initResendOnClick:function(){$(document).on("click","#resendOTPEmailId",function(event){event.preventDefault(),ACC.suggestvinid.addErrorMessageToField($("#inputVerifyCodeId"),""),ACC.common.resetForm($("#social-login-existing"));var email=$("#userId2").text(),name=$("#name").text(),formData={type:ACC.config.otpRequestType.SIGNIN_VERIFY_EMAIL,username:email,name:name};$("#social-login-existing").block(),ACC.otp.sendADROTP(formData,"SOCIAL").then(function(response){$("#social-login-existing").unblock(),$(".js-social-otp-resend-msg").removeClass("hide")},function(jqXHR){$(".js-social-otp-resend-msg").addClass("hide"),$("#social-login-existing").unblock(),ACC.suggestvinid.addErrorMessageToField($("#inputVerifyCodeId"),jqXHR.responseJSON.message)})})}},ACC.register={_autoload:["initElements","funcForwardLoginPage","funcForwardSignUpByVinIdPage","funcOptResend","funcSubmitVinIdForm","funcSubmitAccExistingForm","funcSubmitVinEmailMissing","functionSubmitVerifyOtp","loadNormalSignup"],formData:{signUpForm:"#sign-up__popup",modalContent:"#sign-up__popup .modal-content",formVinIdInfo:".signup-by-vinid__form",formAccountExisting:".signup-acc-existed__form",formEmailMissing:".sign-up-missing-email__form",formVerifyOtp:".sign-up-verifyotp__form",formControl:"input.form-control",formErrValidate:".error-message",signupRegisterVinForm:"#sign-up__registerVINID_form",itemVinId:".vinIdAccount__item",itemPwd:".pwd__item",itemCheckPwd:".checkPwd__item",itemEmailMiss:".email-missing__item",itemAccExisted:".account-existed__item",itemOtp:".otp__item",itemPhoneNumer:".phone__item",itemPhoneNumberHidden:".phone-hidden__item",itemEmailHidden:".email-hidden__item",itemCardNumberHidden:".card-hidden__item",itemOKOTPMessage:".vin03-otp-success",btnResendOtp:".resend-otp__button",btnForwardSignUpByVinId:".forward-signup-by-vinid__button",btnForwardLogin:".forward-login__button",btnForwardForgotPwd:".forward-forgotpwd__button",captchaVerifyOtpForm:"verify-otp-form__captcha",captchaVinIdForm:"vinid-form__captcha",captchaAccExistingForm:"account-existing-form__captcha",captchaNormalSignupForm:"js-signup-normal-register-captcha",captchaPhoneRegisterForm:"js-signup-phone-register-captcha",captchaErr:"VIN_CORE_010",otpNotMatch:"VIN_CORE_006",otpEmpty:"VIN_CORE_004",labelInfo2:".info2__label",labelInfo3:".info3__label",labelThanksRegistration:".thanks_registration_label",labelThanksMapping:".thanks_registration_mapping_label"},dataTranfer:{customerFullName:"",email:"",emailHidden:"",password:"",confirmPassword:"",vinID:"",vinIdHidden:"",phoneNumber:"",phoneNumberHidden:"",identifyNumber:"",verifyOtpCode:"",verifyOtpType:ACC.config.otpRequestType.SINGUP_MAPPING_EXISTED_VINID_TO_NEW_ADR,gender:"",dateOfBirth:""},initElements:function(){ACC.common.loadModuleElements(ACC.register)},funcForwardLoginPage:function(){$(ACC.register.formData.signUpForm).find(ACC.register.formData.btnForwardLogin).click(function(event){event.preventDefault(),$(ACC.register.formData.signUpForm).modal("hide"),ACC.login.show()})},funcForwardSignUpByVinIdPage:function(){$(ACC.register.formData.signUpForm).find(ACC.register.formData.btnForwardSignUpByVinId).click(function(event){event.preventDefault();var elements=$(ACC.register.formData.signUpForm).find(ACC.register.formData.formControl);elements&&elements.val("");var formClear=$(ACC.register.formData.signUpForm).find(ACC.register.formData.formVinIdInfo);ACC.register.clearFormErrorMessage(formClear,ACC.register.formData.captchaVinIdForm),ACC.captcha.renderWidget(ACC.register.formData.captchaVinIdForm),ACC.captcha.reset(ACC.register.formData.captchaVinIdForm),ACC.common.stepEventModal(ACC.register.formData.signUpForm,10)})},funcOptResend:function(){$(ACC.register.formData.signUpForm).find(ACC.register.formData.btnResendOtp).click(function(event){event.preventDefault(),$(ACC.register.formData.modalContent).block(),ACC.register.senADROTP(!0).then(function(response){ACC.captcha.renderWidget(ACC.register.formData.captchaVerifyOtpForm),$(ACC.register.formData.modalContent).unblock(),ACC.register.showSentOTPOkMessage(),ACC.register.removeErrorsOnVerifyOTP()},function(error){ACC.register.hideSentOTPOkMessage(),ACC.captcha.reset(ACC.register.formData.captchaVerifyOtpForm),ACC.register.showOTPError(error.responseJSON.message),$(ACC.register.formData.modalContent).unblock()})})},showOTPError:function(mes){ACC.register.clearFormErrorMessage($(ACC.register.formData.formVerifyOtp),ACC.register.formData.captchaVerifyOtpForm),$(ACC.register.formData.formVerifyOtp).find(ACC.register.formData.itemOtp).after("<p class='error-message'>"+mes+"</p>")},removeErrorsOnVerifyOTP:function(){ACC.register.clearFormErrorMessage($(ACC.register.formData.formVerifyOtp),ACC.register.formData.captchaVerifyOtpForm)},funcSubmitVinIdForm:function(){$(ACC.register.formData.signUpForm).find(ACC.register.formData.formVinIdInfo).submit(function(event){event.preventDefault();var form=ACC.register.formData.formVinIdInfo;ACC.register.funcRegisterSend(form,ACC.register.formData.captchaVinIdForm)})},funcSubmitAccExistingForm:function(){$(ACC.register.formData.signUpForm).find(ACC.register.formData.formAccountExisting).submit(function(event){event.preventDefault();var form=ACC.register.formData.formAccountExisting;ACC.register.funcRegisterSend(form,ACC.register.formData.captchaAccExistingForm)})},funcSubmitVinEmailMissing:function(){$(ACC.register.formData.signUpForm).find(ACC.register.formData.formEmailMissing).submit(function(event){event.preventDefault(),$(ACC.register.formData.modalContent).block();var url=ACC.config.validateVinIdEmailMissingUrl,formEmailMiss=$(ACC.register.formData.signUpForm).find(ACC.register.formData.formEmailMissing),inputEmail=formEmailMiss.find(ACC.register.formData.itemEmailMiss),data={email:inputEmail.val()};$.postJSONCallback(url,JSON.stringify(data),function(result){if($(ACC.register.formData.modalContent).unblock(),"ERROR"==result){return void ACC.common.stepEventModal(ACC.register.formData.signUpForm,31)}var jsonObj=($(ACC.register.formData.signUpForm).find(ACC.register.formData.formEmailMissing),JSON.parse(result));if(jsonObj.exc){Number(jsonObj.exc.code);return ACC.register.dataTranfer.email=data.email,ACC.register.dataTranfer.emailHidden=jsonObj.exc.content.emailHidden,ACC.register.clearFormErrorMessage($(ACC.register.formData.formVerifyOtp),ACC.register.formData.captchaVerifyOtpForm),void ACC.register.moveToScreenVerifyOTP()}ACC.register.clearFormErrorMessage(formEmailMiss,"capchaId"),inputEmail.after("<p class='error-message'>"+jsonObj.content+"</p>")})})},functionSubmitVerifyOtp:function(){$(ACC.register.formData.signUpForm).find(ACC.register.formData.formVerifyOtp).submit(function(event){event.preventDefault(),$(ACC.register.formData.modalContent).block();var itemOtp=$(ACC.register.formData.signUpForm).find(ACC.register.formData.itemOtp);ACC.register.dataTranfer.verifyOtpCode=itemOtp.val();var formVerifyOtp=ACC.register.formData.formVerifyOtp,url=ACC.common.attachCaptchaParameter(formVerifyOtp,ACC.config.registerValidateOTPUrl);$.postJSONCallback(url,JSON.stringify(ACC.register.dataTranfer),function(result){if($(ACC.register.formData.modalContent).unblock(),"SUCCESS"==result)return $(ACC.register.formData.signUpForm).find(ACC.register.formData.itemEmailHidden).html(ACC.register.dataTranfer.email),void ACC.common.stepEventModal(ACC.register.formData.signUpForm,4);if("ERROR"==result)return void ACC.common.stepEventModal(ACC.register.formData.signUpForm,31);ACC.captcha.reset(ACC.register.formData.captchaVerifyOtpForm);var msgArr=JSON.parse(result).msg;if(msgArr&&msgArr.length>0)for(var i=0;i<msgArr.length;i++)msgArr[i].code==ACC.register.formData.captchaErr&&ACC.captcha.showError(ACC.register.formData.captchaVerifyOtpForm,msgArr[i].content),msgArr[i].code==ACC.register.formData.otpNotMatch?ACC.register.showOTPError(msgArr[i].content):msgArr[i].code==ACC.register.formData.otpEmpty&&ACC.register.showOTPError(msgArr[i].content)},function(error){ACC.captcha.reset(ACC.register.formData.captchaVerifyOtpForm),ACC.register.showOTPError(error.responseJSON.message),$(ACC.register.formData.modalContent).unblock()})})},funcRegisterSend:function(identifyForm,captchaId){$(ACC.register.formData.modalContent).block();var url=ACC.common.attachCaptchaParameter(identifyForm,ACC.config.validateVinIdFormUrl),formSelector=$(identifyForm),data={vinIdAccount:formSelector.find(ACC.register.formData.itemVinId).val(),pwd:formSelector.find(ACC.register.formData.itemPwd).val(),checkPwd:formSelector.find(ACC.register.formData.itemCheckPwd).val()};$.postJSONCallback(url,JSON.stringify(data),function(result){if(ACC.captcha.reset(captchaId),result){var jsonObj=JSON.parse(result),excNextScreen=jsonObj.exc;if(excNextScreen){var nextScreen=Number(excNextScreen.code),data=excNextScreen.content
;if($(ACC.register.formData.modalContent).unblock(),12==nextScreen)return void ACC.common.stepEventModal(ACC.register.formData.signUpForm,nextScreen);if(11==nextScreen&&(ACC.register.clearFormErrorMessage($(ACC.register.formData.formEmailMissing),ACC.register.formData.captchaVerifyOtpForm),ACC.common.stepEventModal(ACC.register.formData.signUpForm,nextScreen)),ACC.register.dataTranfer.customerFullName=data.customerFullName,ACC.register.dataTranfer.email=data.email,ACC.register.dataTranfer.emailHidden=data.emailHidden,ACC.register.dataTranfer.vinID=data.vinID,ACC.register.dataTranfer.vinIdHidden=data.vinIdHidden,ACC.register.dataTranfer.password=data.password,ACC.register.dataTranfer.confirmPassword=data.confirmPassword,ACC.register.dataTranfer.phoneNumber=data.phoneNumber,ACC.register.dataTranfer.phoneNumberHidden=data.phoneNumberHidden,ACC.register.dataTranfer.identifyNumber=data.identifyNumber,3==nextScreen)return ACC.register.clearFormErrorMessage($(ACC.register.formData.formVerifyOtp),ACC.register.formData.captchaVerifyOtpForm),ACC.register.dataTranfer.customerFullName=data.customerFullName,ACC.register.dataTranfer.email=data.email,void ACC.register.moveToScreenVerifyOTP();13==nextScreen&&(ACC.captcha.renderWidget(ACC.register.formData.captchaAccExistingForm),data.emailHidden?$(ACC.register.formData.signUpForm).find(ACC.register.formData.itemAccExisted).html(data.emailHidden):data.phoneHidden&&$(ACC.register.formData.signUpForm).find(ACC.register.formData.itemAccExisted).html(data.phoneHidden),ACC.common.stepEventModal(ACC.register.formData.signUpForm,nextScreen))}else{ACC.register.clearFormErrorMessage(formSelector,captchaId);var msgArr=jsonObj.msg;if(msgArr&&msgArr.length>0)for(var i=0;i<msgArr.length;i++)"captcha"==msgArr[i].code&&ACC.captcha.showError(captchaId,msgArr[i].content),formSelector.find("."+msgArr[i].code+"__item").after("<p class='error-message'>"+msgArr[i].content+"</p>");$(ACC.register.formData.modalContent).unblock()}}})},showSentOTPOkMessage:function(){var container=$(ACC.register.formData.signUpForm).find(ACC.register.formData.itemOKOTPMessage);container.hasClass("hidden")&&container.removeClass("hidden")},hideSentOTPOkMessage:function(){var container=$(ACC.register.formData.signUpForm).find(ACC.register.formData.itemOKOTPMessage);container.hasClass("hidden")||container.addClass("hidden")},_config:{element:{popup:"#sign-up__popup",form:"#sign-up__popup_normal_register_form",buttonContinue:".js_button_normal_signup_continue",missedPhoneError:"#infor-missedPhone-error",buttonSignup:".js-sign-up__popup_button",normalSignupPassword:".js-normal-signup-password",clearTexts:".clearText"}},loadNormalSignup:function(){this.buttonSignup.off("click"),this.buttonSignup.click(function(event){event.preventDefault(),ACC.register.refreshSignupForm(),ACC.register.show()}),this.buttonContinue.off("click"),this.buttonContinue.click(function(event){event.preventDefault(),ACC.register.validateNormalSignupForm()}),this.form.submit(function(event){event.preventDefault(),ACC.register.validateNormalSignupForm()})},showLoginPage:function(){this.hide(),ACC.login.show()},validateNormalSignupForm:function(){var form=this.form,formDom=form.get(0),fullname=formDom.fullname.value,email=formDom.email.value,password=formDom.password.value,confirmPassword=formDom.confirmPassword.value,handleSuccessRespond=function(respond){ACC.captcha.reset(ACC.register.formData.captchaNormalSignupForm),ACC.register.refeshNormalSignupError();var clearPassword=!0,data=respond.data,status=respond.status,errorCode=respond.errorCode,nextStep=respond.nextStep,errorMessage=(respond.title,respond.error);if(ACC.register.dataTranfer=data,"OK"==status)"createVINID"==nextStep?ACC.register.moveToScreenRegisterVinID():"verifyOTP"==nextStep&&ACC.register.moveToScreenSuggestToConnect();else if("FIELD_ERROR"==status){var fields=respond.fieldValidations;$.each(fields,function(name){"captcha"==name?ACC.captcha.showError(ACC.register.formData.captchaNormalSignupForm,fields[name]):ACC.register.addErrorMessageToField(formDom[name],fields[name])})}else if("FORM_MESSAGE"==status){if(ACC.register.showFormErrorMessage(errorMessage),"duplicatedEmail"==errorCode){var customerNeedToLogin=$(".js-normal-signup-login");customerNeedToLogin.off("click"),customerNeedToLogin.click(function(event){event.preventDefault(),ACC.register.showLoginPage()})}else if("existedVincard"==errorCode){clearPassword=!1;var verifyOTP=$(".js-normal-signup-continue-to-connect");verifyOTP.off("click"),verifyOTP.click(function(event){event.preventDefault(),ACC.register.moveToScreenVerifyOTP()})}}else"POP_UP_MESSAGE"==status&&ACC.common.stepEventModal(ACC.register.formData.signUpForm,12);clearPassword&&ACC.register.clearPasswordNormalSignup()};$.postJSONCallbackWithLoading(ACC.common.attachCaptchaParameter("#sign-up__popup_normal_register_form",ACC.config.validateNormalSignupUrl),JSON.stringify({customerFullName:fullname,email:email,pwd:password,checkPwd:confirmPassword}),handleSuccessRespond,void 0,ACC.register.popup)},verifyADROTP:function(formVerifyOtp,successHandler,errorHandler){var url=ACC.common.attachCaptchaParameter(formVerifyOtp,ACC.config.signupValidateADROTPUrl);$.postJSONCallback(url,JSON.stringify(ACC.register.dataTranfer),function(result){successHandler(result),ACC.register.showSuccessData(),ACC.common.stepEventModal(ACC.register.formData.signUpForm,4)},function(error){errorHandler(error)})},verifyADROTPWithLoading:function(formVerifyOtp,successHandler,errorHandler){var url=ACC.common.attachCaptchaParameter(formVerifyOtp,ACC.config.signupValidateADROTPUrl);$.postJSONCallbackWithLoading(url,JSON.stringify(ACC.register.dataTranfer),function(result){successHandler(result),ACC.register.showSuccessData(),ACC.common.stepEventModal(ACC.register.formData.signUpForm,4)},function(error){errorHandler(error)},ACC.register.popup)},refeshNormalSignupError:function(){var form=this.form,formDom=form.get(0);ACC.register.addErrorMessageToField(formDom.fullname,""),ACC.register.addErrorMessageToField(formDom.email,""),ACC.register.addErrorMessageToField(formDom.password,""),ACC.register.addErrorMessageToField(formDom.confirmPassword,""),ACC.register.showFormErrorMessage(""),ACC.captcha.reset(ACC.register.formData.captchaNormalSignupForm)},showPopupUpError:function(){this.hide(),this.missedPhoneError.modal("show")},addErrorMessageToField:function(fieldGroup,error){$(fieldGroup).parent().find("p.error-message").text(error)},showFormErrorMessage:function(errorMessage){this.form.parent().find("div.errorContainer").html(errorMessage)},clearFormErrorMessage:function(formClear,captchaId){formClear.find(ACC.register.formData.itemPwd).val(""),formClear.find(ACC.register.formData.itemCheckPwd).val("");var errField=formClear.find(ACC.register.formData.formErrValidate).not("#"+captchaId+"-error");errField&&errField.remove()},moveToScreenVerifyOTP:function(){ACC.register.removeErrorsOnVerifyOTP(),ACC.register.hideSentOTPOkMessage(),$(ACC.register.formData.formVerifyOtp).find(ACC.register.formData.itemOtp).val(""),$(ACC.register.formData.signUpForm).find(ACC.register.formData.itemPhoneNumberHidden).html(ACC.register.dataTranfer.phoneNumberHidden),ACC.captcha.renderWidget(ACC.register.formData.captchaVerifyOtpForm),ACC.captcha.reset(ACC.register.formData.captchaVerifyOtpForm),ACC.common.stepEventModal(ACC.register.formData.signUpForm,3);ACC.register.dataTranfer.vinID,ACC.config.otpRequestType.SINGUP_MAPPING_EXISTED_VINID_TO_NEW_ADR;ACC.register.senADROTP().then(function(response){$(ACC.register.formData.modalContent).unblock()},function(error){var errField=$(ACC.register.formData.formVerifyOtp).find(ACC.register.formData.formErrValidate).not("#"+ACC.register.formData.captchaVerifyOtpForm+"-error");errField&&errField.remove(),ACC.captcha.reset(ACC.register.formData.captchaVerifyOtpForm),$(ACC.register.formData.signUpForm).find(ACC.register.formData.itemOtp).after("<p class='error-message'>"+error.responseJSON.message+"</p>")})},senADROTP:function(resend){var dataForSend={vinId:ACC.register.dataTranfer.vinID,type:ACC.config.otpRequestType.SINGUP_MAPPING_EXISTED_VINID_TO_NEW_ADR};return resend&&(dataForSend.resend=!0),ACC.otp.sendADROTP(dataForSend,ACC.otp.func.signInUp)},sendADROTPWithLoading:function(successHandler,errorHandler,resend){var dataForSend={vinId:ACC.register.dataTranfer.vinID,type:ACC.config.otpRequestType.SINGUP_MAPPING_EXISTED_VINID_TO_NEW_ADR};resend&&(dataForSend.resend=!0);var url=ACC.config.sendOTPUrl+"?otpfunc="+ACC.otp.func.signInUp;$.postJSONCallbackWithLoading(url,JSON.stringify(dataForSend),function(result){successHandler(result)},function(error){errorHandler(error)},ACC.register.popup)},moveToScreenRegisterVinID:function(){ACC.captcha.renderWidget(ACC.register.formData.captchaPhoneRegisterForm),ACC.captcha.reset(ACC.register.formData.captchaPhoneRegisterForm),ACC.common.stepEventModal(ACC.register.formData.signUpForm,ACC.registerVinID.id),ACC.registerVinID.initData()},moveToScreenSuggestToConnect:function(){ACC.registerSuggestConnect.initData(),ACC.common.stepEventModal(ACC.register.formData.signUpForm,ACC.registerSuggestConnect.id),ACC.register.senADROTP().then(function(data){},function(error){var message=error.responseJSON.message;ACC.registerSuggestConnect.showOTPError(message)})},clearPasswordNormalSignup:function(){this.normalSignupPassword.val("")},showSuccessData:function(){$(ACC.register.formData.signUpForm).find(ACC.register.formData.itemEmailHidden).html(ACC.register.dataTranfer.email)},hide:function(){this.popup.modal("hide")},show:function(){ACC.captcha.renderWidget(ACC.register.formData.captchaNormalSignupForm),this.popup.modal("show"),this.popup.on("shown.bs.modal",function(){$('#sign-up__popup_normal_register_form [name="fullname"]').focus()})},refreshSignupForm:function(){ACC.register.clearTexts.val(""),ACC.register.refeshNormalSignupError()}},ACC.registerVinID={id:2,canSubmit:!0,_config:{element:{popup:"#sign-up__popup",form:"#sign-up__registerVINID_form",customerPhoneInput:".vinID-customer-phone",errorExistedPhoneContainer:".js-phone-number-existed",errorExistedMappingAdr:".js-existed-vin-mapped-with-adr",customerNeedToLogin:".js_register_vinid_need_to_login",buttonRegisterVinID:".js-sign-up-button-register-vin-id",errorVinIDCardContainer:".js-vinID17-card-number",errorEmailContainer:".js-vinID17-email",clickToConnectWithVinID:".js-vinID17-connectWithVinID",serverErrorContainer:".js-server-errorContainer"}},vinIDData:{fullname:"",identificationCardNumber:"",dob:"",email:"",hiddenEmail:"",phoneNumber:"",hiddenPhoneNumber:"",gender:"",address:"",subcribePromotion:"",vinIDCardNumber:"",hiddenVinIDCardNumber:""},_autoload:["initElements","initRegisterVinIDForm"],initElements:function(){ACC.common.loadModuleElements(ACC.registerVinID)},showServerErrorMessage:function(error){error?(ACC.registerVinID.serverErrorContainer.hasClass("hidden")&&ACC.registerVinID.serverErrorContainer.removeClass("hidden"),ACC.registerVinID.serverErrorContainer.text(error)):(ACC.registerVinID.serverErrorContainer.addClass("hidden"),ACC.registerVinID.serverErrorContainer.text(""))},initData:function(){this.customerPhoneInput.focusin(),this.resetForm()},initRegisterVinIDForm:function(){this.customerPhoneInput.off("change"),this.customerPhoneInput.change(function(event){event.preventDefault();var value=this.value;$.getJSON(ACC.config.validateVinIDPhoneURL,{phone:value},function(data){var object=$.parseJSON(data);"NOT_OK"==object.status?(ACC.registerVinID.canSubmit=!1,ACC.registerVinID.showErrorExistedPhoneInADRSystem(object.data)):(ACC.registerVinID.canSubmit=!0,ACC.registerVinID.hideErrorExistedPhoneInADRSystem())})}),this.customerNeedToLogin.off("change"),this.customerNeedToLogin.click(function(event){event.preventDefault(),ACC.registerVinID.showLoginPage()}),this.buttonRegisterVinID.click(function(event){event.preventDefault(),ACC.registerVinID.handlerFormSubumit()}),this.form.submit(function(event){event.preventDefault(),ACC.registerVinID.handlerFormSubumit()}),this.clickToConnectWithVinID.off("click"),this.clickToConnectWithVinID.click(function(event){event.preventDefault(),ACC.register.dataTranfer.vinID=ACC.registerVinID.vinIDData.vinIDCardNumber,ACC.register.dataTranfer.vinIdHidden=ACC.registerVinID.vinIDData.hiddenVinIDCardNumber,ACC.register.dataTranfer.phoneNumber=ACC.registerVinID.vinIDData.phoneNumber,ACC.register.dataTranfer.phoneNumberHidden=ACC.registerVinID.vinIDData.hiddenPhoneNumber,ACC.register.moveToScreenVerifyOTP()})},handlerFormSubumit:function(){if(ACC.registerVinID.canSubmit){var form=ACC.registerVinID.form,phoneNumber=form.find("input[name=phoneNumber]").val(),day=form.find("select[name=day]").val(),month=form.find("select[name=month]").val(),year=form.find("select[name=year]").val(),gender=form.find("input:radio[name=gender]:checked").val(),identityNumber=form.find("input[name=identityCardNumber]").val(),address=form.find("input[name=address]").val(),subcribePromotion=form.find("input:checkbox[name=subcribePromotion]:checked").val(),url=ACC.common.attachCaptchaParameter("#sign-up__registerVINID_form",ACC.config.validateVinIDFormURL);$.postJSONCallbackWithLoading(url,JSON.stringify({email:ACC.register.dataTranfer.email,fullname:ACC.register.dataTranfer.customerFullName,phoneNumber:phoneNumber,dayOfBirth:day,monthOfBirth:month,yearOfBirth:year,gender:gender,address:address,identityCardNumber:identityNumber,subscribeVINIDPromotion:subcribePromotion}),ACC.registerVinID.handleRegisterVinID,function(error){error.responseJSON.code&&ACC.registerVinID.showServerErrorMessage(error.responseJSON.message)},ACC.registerVinID.popup)}},handleRegisterVinID:function(respond){ACC.registerVinID.resetErrors();var status=respond.status,nextStep=respond.nextStep,data=(respond.errorCode,respond.data);if(ACC.registerVinID.vinIDData=data,"OK"==status)ACC.register.dataTranfer.gender=ACC.registerVinID.vinIDData.gender,ACC.register.dataTranfer.dateOfBirth=ACC.registerVinID.vinIDData.dob,"verifyByVinOTP"==nextStep?ACC.registerVinID.moveToScreenVerifyByVinID():"suggestToConnect"==nextStep&&(ACC.register.dataTranfer.vinID=ACC.registerVinID.vinIDData.vinIDCardNumber,ACC.register.dataTranfer.vinIdHidden=ACC.registerVinID.vinIDData.hiddenVinIDCardNumber,ACC.register.dataTranfer.phoneNumber=ACC.registerVinID.vinIDData.phoneNumber,ACC.register.dataTranfer.phoneNumberHidden=ACC.registerVinID.vinIDData.hiddenPhoneNumber,ACC.register.dataTranfer.identifyNumber=ACC.registerVinID.vinIDData.identificationCardNumber,ACC.register.moveToScreenSuggestToConnect());else if("FIELD_ERROR"==status){var fields=respond.fieldValidations;ACC.registerVinID.showFieldErrors(fields)}else"FORM_MESSAGE"==status?ACC.registerVinID.showErrorExistedVinIDMappedWithADR():"POP_UP_MESSAGE"==status&&ACC.common.stepEventModal(ACC.register.formData.signUpForm,12)},moveToScreenVerifyByVinID:function(){ACC.verifyVinOTP.initData(),ACC.common.stepEventModal(ACC.register.formData.signUpForm,ACC.verifyVinOTP.id)},showFieldErrors:function(fields){var formDom=ACC.registerVinID.form.get(0);$.each(fields,function(name){"captcha"==name?ACC.captcha.showError(ACC.register.formData.captchaPhoneRegisterForm,fields[name]):ACC.registerVinID.addErrorMessageToField(formDom[name],fields[name])})},resetForm:function(){var form=ACC.registerVinID.form;form.find("input.clearText,select").val(""),form.find("select").val(""),form.find("input[name=gender]").val([""]),form.find("input[name=subcribePromotion]").prop("checked",!0),ACC.registerVinID.customerPhoneInput.val(""),ACC.registerVinID.customerPhoneInput.focusin(),ACC.registerVinID.resetErrors(),ACC.captcha.reset(ACC.register.formData.captchaPhoneRegisterForm)},resetErrors:function(){ACC.registerVinID.showFieldErrors({phoneNumber:"",dob:"",identityCardNumber:"",genderError:""}),ACC.registerVinID.hideErrorExistedVinIDMappedWithADR(),ACC.registerVinID.hideErrorExistedPhoneInADRSystem(),ACC.registerVinID.showServerErrorMessage(!1),ACC.captcha.reset(ACC.register.formData.captchaPhoneRegisterForm)},showErrorExistedVinIDMappedWithADR:function(){ACC.registerVinID.errorExistedMappingAdr.removeClass("hidden"),ACC.registerVinID.errorVinIDCardContainer.text(ACC.registerVinID.vinIDData.hiddenVinIDCardNumber),ACC.registerVinID.errorEmailContainer.text(ACC.registerVinID.vinIDData.hiddenEmail)},hideErrorExistedVinIDMappedWithADR:function(){ACC.registerVinID.errorExistedMappingAdr.addClass("hidden"),ACC.registerVinID.errorVinIDCardContainer.text(""),ACC.registerVinID.errorEmailContainer.text("")},showErrorExistedPhoneInADRSystem:function(phoneNumber){ACC.registerVinID.errorExistedPhoneContainer.removeClass("hidden"),ACC.registerVinID.errorExistedPhoneContainer.find("span.js-registerVinid-existed-phoneNumber").text(phoneNumber)},hideErrorExistedPhoneInADRSystem:function(){ACC.registerVinID.errorExistedPhoneContainer.addClass("hidden"),ACC.registerVinID.errorExistedPhoneContainer.find("span.js-registerVinid-existed-phoneNumber").text("")},addErrorMessageToField:function(fieldGroup,error){$(fieldGroup).parent().find("p.error-message").text(error)},showLoginPage:function(){this.hide(),ACC.login.show()},hide:function(){this.popup.modal("hide")},show:function(){this.popup.modal("show")}},ACC.registerSuggestConnect={_autoload:["initElements","initForm"],id:17,captchaFormID:"#sign-up_suggestVinID",captchaID:"js-vin17-captcha",_config:{element:{popup:"#sign-up__popup",form:"#sign-up_suggestVinID",resendOTPButton:"#js-vin17-adr-otp-resend",otpInput:"#js-vin17-otp-input",btnVerifyOtp:"#js-vin17-verify-otp-btn",cardNumberContainer:".js-vin17-cardNumber",phoneNumberContainer:".js-vin17-phoneNumber",otpErrorContainer:".js-vin17-errorOTPContainer",okMessageContainer:".vin17-ok"}},initElements:function(){ACC.common.loadModuleElements(ACC.registerSuggestConnect)},showOTPError:function(mes){ACC.registerSuggestConnect.otpErrorContainer.text(mes)},verifyOtp:function(){ACC.register.dataTranfer.verifyOtpCode=ACC.registerSuggestConnect.otpInput.val(),ACC.register.verifyADROTPWithLoading(ACC.registerSuggestConnect.captchaFormID,function(data){},function(error){error.responseJSON&&ACC.registerSuggestConnect.showOTPError(error.responseJSON.message)})},initForm:function(){ACC.registerSuggestConnect.resendOTPButton.click(function(event){event.preventDefault(),ACC.registerSuggestConnect.sendOTP(),ACC.registerSuggestConnect.resetForm()}),ACC.registerSuggestConnect.btnVerifyOtp.click(function(event){event.preventDefault(),ACC.registerSuggestConnect.verifyOtp(),ACC.registerSuggestConnect.resetForm()})},initData:function(){ACC.captcha.renderWidget(ACC.registerSuggestConnect.captchaID),ACC.registerSuggestConnect.cardNumberContainer.text(ACC.register.dataTranfer.vinIdHidden),ACC.registerSuggestConnect.phoneNumberContainer.text(ACC.register.dataTranfer.phoneNumberHidden),ACC.registerSuggestConnect.resetForm()},sendOTP:function(){var okHandler=function(data){ACC.registerSuggestConnect.resetForm(),ACC.registerSuggestConnect.showOKMessage()},errorHandler=function(error){ACC.registerSuggestConnect.resetForm(),ACC.registerSuggestConnect.showOTPError(error.responseJSON.message),ACC.registerSuggestConnect.hideOKMessage()};ACC.register.sendADROTPWithLoading(okHandler,errorHandler,!0)},showOKMessage:function(){ACC.registerSuggestConnect.okMessageContainer.hasClass("hidden")&&ACC.registerSuggestConnect.okMessageContainer.removeClass("hidden")},hideOKMessage:function(){ACC.registerSuggestConnect.okMessageContainer.addClass("hidden")},resetForm:function(){ACC.captcha.reset(ACC.registerSuggestConnect.captchaID),ACC.registerSuggestConnect.otpInput.val(""),ACC.registerSuggestConnect.otpErrorContainer.text(""),ACC.registerSuggestConnect.hideOKMessage()}},ACC.verifyVinOTP={id:33,captchaID:"verify-vinotp-form__captcha",_config:{element:{form:"#step-33-sign-up-verify-vinotp__form",btnResend:".vin-33-resend-vinotp__button",itemVinOtp:".vin-33-vinotp__item",btnVerify:".vin-33-verify-vinotp-form__button",phoneHidden:".vin-33-phone-hidden__item",successOTPMessage:".vin-33-send-vinotp-success"}},_autoload:["initElements","bindResendVinOTP","bindVerifyVinOTP"],initElements:function(){ACC.common.loadModuleElements(ACC.verifyVinOTP)},initData:function(){ACC.captcha.renderWidget(ACC.verifyVinOTP.captchaID),ACC.register.dataTranfer.gender=ACC.registerVinID.vinIDData.gender,ACC.register.dataTranfer.dateOfBirth=ACC.registerVinID.vinIDData.dob,ACC.register.dataTranfer.phoneNumber=ACC.registerVinID.vinIDData.phoneNumber,ACC.register.dataTranfer.phoneNumberHidden=ACC.registerVinID.vinIDData.phoneNumberHidden,ACC.register.dataTranfer.identifyNumber=ACC.registerVinID.vinIDData.identificationCardNumber,ACC.verifyVinOTP.phoneHidden.text(ACC.registerVinID.vinIDData.hiddenPhoneNumber),ACC.verifyVinOTP.resetForm()},reSendVinIdOTP:function(){$(ACC.register.formData.modalContent).block(),$(".send-vinotp-success").attr("style","display:none"),ACC.otp.resendVinIdOTP({phoneNumber:ACC.register.dataTranfer.phoneNumber,identifyNumber:ACC.register.dataTranfer.identifyNumber},ACC.otp.func.signInUp).then(function(response){ACC.verifyVinOTP.showOKMessage(),$(ACC.register.formData.modalContent).unblock()},function(error){$(ACC.register.formData.modalContent).unblock(),error.responseJSON&&($(ACC.verifyVinOTP._config.element.form).find(".vin-33-vinotp-error").html(error.responseJSON.message),ACC.verifyVinOTP.hideOKMessage())})},bindResendVinOTP:function(){ACC.verifyVinOTP.btnResend.click(function(event){event.preventDefault(),ACC.verifyVinOTP.reSendVinIdOTP()})},bindVerifyVinOTP:function(){ACC.verifyVinOTP.btnVerify.click(function(event){event.preventDefault();var otpCode=ACC.verifyVinOTP.itemVinOtp.val();ACC.register.dataTranfer.verifyOtpCode=otpCode,ACC.register.dataTranfer;var url=ACC.common.attachCaptchaParameter(ACC.verifyVinOTP._config.element.form,ACC.config.signupValidateVinOTPUrl);$(ACC.register.formData.modalContent).block(),ACC.otp.verifyVinIdOTP(ACC.register.dataTranfer,url).then(function(response){$(ACC.register.formData.modalContent).unblock(),ACC.register.showSuccessData(),ACC.common.stepEventModal(ACC.register.formData.signUpForm,4)},function(error){$(ACC.register.formData.modalContent).unblock(),ACC.captcha.reset(ACC.verifyVinOTP.captchaID),error.responseJSON&&(error.responseJSON.message.includes("captcha")?ACC.captcha.showError(ACC.verifyVinOTP.captchaID,error.responseJSON.message):$(ACC.verifyVinOTP._config.element.form).find(".vin-33-vinotp-error").text(error.responseJSON.message))})})},resetForm:function(){ACC.verifyVinOTP.itemVinOtp.val(""),$(ACC.verifyVinOTP._config.element.form).find(".vin-33-vinotp-error").html(""),ACC.verifyVinOTP.hideOKMessage(),ACC.captcha.reset(ACC.verifyVinOTP.captchaID)},showOKMessage:function(){ACC.verifyVinOTP.successOTPMessage.hasClass("hidden")&&ACC.verifyVinOTP.successOTPMessage.removeClass("hidden")},hideOKMessage:function(){ACC.verifyVinOTP.successOTPMessage.hasClass("hidden")||ACC.verifyVinOTP.successOTPMessage.addClass("hidden")}},ACC.otp={func:{signInUp:"SIGN_IN_UP",resetPass:"RESET_PASS",social:"SOCIAL",checkout:"CHECKOUT",autoCreate:"AUTO_CREATE"},sendADROTP:function(formData,otpFunc){return $.ajax({url:ACC.config.sendOTPUrl+"?otpfunc="+otpFunc,type:"post",data:JSON.stringify(formData),dataType:"json",contentType:"application/json; charset=utf-8"})},verifyADROTP:function(otpCode,url){var formData={otpCode:otpCode};return $.ajax({url:url||ACC.config.verifyOTPUrl,type:"post",data:JSON.stringify(formData),dataType:"json",contentType:"application/json; charset=utf-8"})},verifyVinIdOTP:function(formData,url){return $.ajax({url:url||ACC.config.verifyVinIdOTPUrl,type:"post",data:JSON.stringify(formData),dataType:"json",contentType:"application/json; charset=utf-8"})},resendVinIdOTP:function(formData,otpFunc){return $.ajax({url:ACC.config.reSendVinIdOTPUrl+"?otpfunc="+otpFunc,type:"post",data:JSON.stringify(formData),dataType:"json",contentType:"application/json; charset=utf-8"})},verifyAndMapADROTP:function(formData,url){return $.ajax({url:url||ACC.config.verifyOTPUrl,type:"post",data:JSON.stringify(formData),dataType:"json",contentType:"application/json; charset=utf-8"})},verifyAndMapADROTPFromProfile:function(formData,url){return $.ajax({url:url||ACC.config.connectVinIdFromProfileUrl,type:"post",data:JSON.stringify(formData),dataType:"json",contentType:"application/json; charset=utf-8"})},verifyADROTPEmail:function(otpCode,email,provider,externalid,url,autoLogin){var formData={otpCode:otpCode,username:email,provider:provider,externalId:externalid,autoLogin:autoLogin};return $.ajax({url:url||ACC.config.verifyOTPUrl,type:"post",data:JSON.stringify(formData),dataType:"json",contentType:"application/json; charset=utf-8"})},verifyADRVinIDRedeemOTP:function(formData,url){return $.ajax({url:url||ACC.config.verifyOTPADRRedeemUrl,type:"post",data:JSON.stringify(formData),dataType:"html",contentType:"application/json; charset=utf-8"})}},ACC.adrOtpPopup={_config:{element:{popup:"#js-otp-popup",phoneLabel:".js-phone-number",resendOtpBtn:".js-resend-otp",confirmOtpBtn:".js-confirm-otp",otpTxt:".js-otp-txt",errorMsg:".js-otp-error-msg",successMsg:".js-otp-success-msg",rightPanel:".js-otp-right-panel",blockContent:"#js-otp-popup .modal-content"}},_autoload:["init","bindConfirmOtp","bindResendOtp"],phone:null,onConfirm:null,init:function(){ACC.common.loadModuleElements(ACC.adrOtpPopup),this.popup.on("hidden.bs.modal",function(){ACC.adrOtpPopup.refresh()}),this.refresh()},bindConfirmOtp:function(){this.confirmOtpBtn.click(function(event){event.preventDefault();var otp=ACC.adrOtpPopup.otpTxt.val();ACC.adrOtpPopup.phone&&ACC.adrOtpPopup.onConfirm&&""!==otp.trim()&&ACC.adrOtpPopup.onConfirm(ACC.adrOtpPopup.phone,otp)})},bindResendOtp:function(){this.resendOtpBtn.click(function(event){event.preventDefault(),ACC.adrOtpPopup.phone&&(ACC.adrOtpPopup.block(),ACC.otp.sendADROTP({username:ACC.adrOtpPopup.phone,type:ACC.config.otpRequestType.SIGNIN_VERIFY_PHONE,resend:!0},ACC.otp.func.signInUp).then(function(response){ACC.adrOtpPopup.unblock(),ACC.adrOtpPopup.successMsg.show(),ACC.adrOtpPopup.errorMsg.html("")},function(jqXHR){ACC.adrOtpPopup.unblock(),jqXHR.responseJSON&&(ACC.adrOtpPopup.errorMsg.html(jqXHR.responseJSON.message),ACC.adrOtpPopup.successMsg.hide())}))})},refresh:function(){this.errorMsg.html(""),this.otpTxt.val(""),this.successMsg.hide()},hide:function(){this.refresh(),this.popup.modal("hide")},showInSuccess:function(opt,onConfirm){this.phone=opt.phone,opt.ignoreRightPanel&&this.rightPanel.hide(),this.onConfirm=onConfirm,ACC.captcha.renderWidget("js-otp-captcha"),this.phoneLabel.html(ACC.common.hidePhoneNumber(opt.phone)),this.popup.modal("show")},showInError:function(opt,errorMsg,onConfirm){this.phone=opt.phone,opt.ignoreRightPanel&&this.rightPanel.hide(),this.onConfirm=onConfirm,ACC.captcha.renderWidget("js-otp-captcha"),this.phoneLabel.html(ACC.common.hidePhoneNumber(opt.phone)),this.errorMsg.html(errorMsg),this.successMsg.hide(),this.popup.modal("show")},attachCaptchaData:function(url){return ACC.common.attachCaptchaParameter("#js-otp-popup",url)},resetCaptCha:function(){ACC.captcha.reset("js-otp-captcha")},block:function(){this.blockContent.block()},unblock:function(){this.blockContent.unblock()}},ACC.otpCheckout={_config:{element:{paymentForm:"#vinPaymentDetailsForm"}},_autoload:["initElements","_bindOtpCheckout","_bindConfirmOtp","_bindResendOtp","_bindOtpReviewCheckout","_bindClose"],onConfirm:null,vinId:null,initElements:function(){ACC.common.loadModuleElements(ACC.otpCheckout)},_bindOtpCheckout:function(){$(document).on("click",".js-payment-checkout",function(e){e.preventDefault(),$(this).data("isoneclick")?$(ACC.otpCheckout._config.element.paymentForm).submit():ACC.otpCheckout.open({onFinish:function(){$(ACC.otpCheckout._config.element.paymentForm).submit()}})}),$(document).on("click",".js-payment-checkout-thankyou",function(e){e.preventDefault(),ACC.otpCheckout.validateCart({onFinish:function(){ACC.otpCheckout.open({onFinish:function(){$(ACC.otpCheckout._config.element.paymentForm).submit()}})}})})},_bindOtpReviewCheckout:function(){$(document).on("click",".js-payment-checkout-review",function(e){var entryNumber=$(".sidebar-product__item .js-remove-entry-button").attr("remove-entry"),disEntryNumber=$(".disable-entry-block").attr("disable-entry");void 0==entryNumber&&void 0==disEntryNumber&&(e.preventDefault(),ACC.otpCheckout.open({onFinish:function(){$(ACC.otpCheckout._config.element.paymentForm).submit()}}))})},_bindConfirmOtp:function(){$(document).on("submit","#js-otp-checkout-confirm-form",function(e){e.preventDefault(),$.colorbox.resize();var otp=$(".js-otp-checkout-otp-input").val();if(""!==otp.trim()){var onFinish=ACC.otpCheckout.onFinish?ACC.otpCheckout.onFinish:function(){},data=JSON.stringify({otpCode:otp}),url=ACC.config.otpCheckoutVerifyUrl+"?g-recaptcha-response="+ACC.captcha.getResponse("js-otp-checkout-captcha");$.postJSONCallback(url,data,function(result){ACC.colorbox.close(),onFinish()},function(jqXHR){$(".js-otp-checkout-error-msg").html(jqXHR.responseJSON.message),$(".js-otp-checkout-success-msg").hide(),ACC.captcha.reset("js-otp-checkout-captcha"),$.colorbox.resize()})}})},_bindResendOtp:function(){$(document).on("click",".js-otp-checkout-resend-btn",function(e){e.preventDefault(),ACC.otp.sendADROTP({type:ACC.config.otpRequestType.CHECKOUT_VERIFY_PHONE,resend:!0},ACC.otp.func.checkout).then(function(response){$(".js-otp-checkout-error-msg").html(""),$(".js-otp-checkout-success-msg").show(),ACC.colorbox.resize()},function(jqXHR){$(".js-otp-checkout-error-msg").html(jqXHR.responseJSON.message),$(".js-otp-checkout-success-msg").hide(),ACC.colorbox.resize()})})},_bindClose:function(){$(document).on("click",".js-otp-checkout-close",function(e){e.preventDefault(),ACC.colorbox.close()})},open:function(options){this.onFinish=options.onFinish,$.blockUI();var onFinish=this.onFinish?this.onFinish:function(){};if("true"===ACC.config.checkout.requireCheckOtp){var data=$(ACC.otpCheckout._config.element.paymentForm).serialize();$.ajax({url:ACC.config.otpCheckoutNeededUrl,type:"POST",data:data,success:function(result){result?($.unblockUI(),ACC.otp.sendADROTP({type:ACC.config.otpRequestType.CHECKOUT_VERIFY_PHONE},ACC.otp.func.checkout).then(function(response){ACC.otpCheckout._display(!1)},function(jqXHR){ACC.otpCheckout._display(!0,jqXHR.responseJSON.message)})):onFinish()}})}else onFinish()},validateCart:function(options){this.onFinish=options.onFinish,$.blockUI();var onFinish=this.onFinish?this.onFinish:function(){},data=$(ACC.otpCheckout._config.element.paymentForm).serialize();$.ajax({url:ACC.config.validateCartUrl,type:"POST",data:data,success:function(result){result?onFinish():$(ACC.otpCheckout._config.element.paymentForm).submit()}})},close:function(){ACC.colorbox.close()},_display:function(error,message){ACC.otpCheckout.colorbox=ACC.colorbox.open("",{href:ACC.config.otpCheckoutPopupUrl,maxWidth:"100%",width:"375px",reposition:!0,className:"popup-otp",scrolling:!1,onComplete:function(){ACC.captcha.renderWidgetForPopup("js-otp-checkout-captcha"),error&&($(".js-otp-checkout-success-msg").hide(),$(".js-otp-checkout-error-msg").html(message),$(".js-otp-checkout-error-msg").show()),$.colorbox.resize()},onOpen:function(){$("body").addClass("modal-open")},onClosed:function(){$("body").removeClass("modal-open")}})}},ACC.checkoutLogin={_config:{element:{txt_username:"#username",txt_password:"#password",f_form:"#js-checkout-login-form",btn_submit:"#js-checkout-login-form button[type=submit]",hidden_disabledUsername:"#disabledUsername",label_error:"#js-checkout-login-form .error-message",label_global_error:".checkout-block .alert.alert-warning"}},_autoload:["initDefaultForm","autoFocusHandling"],initDefaultForm:function(){ACC.common.loadModuleElements(ACC.checkoutLogin);var jsUserType=$("#js-checkout-login-form input[name=userType]"),jsPwd=$("#js-checkout-login-form .js-pwd");"G"==$("#js-checkout-login-form input[name=userType]:checked").val()&&jsPwd.hide(),jsUserType.on("change",function(){ACC.checkoutLogin.removeErrorMessage(),
"C"==$("#js-checkout-login-form input[name=userType]:checked").val()?(jsPwd.show(),ACC.checkoutLogin.btn_submit.html(ACC.checkoutLogin.btn_submit.data("txt-login"))):(jsPwd.hide(),ACC.checkoutLogin.btn_submit.html(ACC.checkoutLogin.btn_submit.data("txt-payment")))}),$("#js-checkout-notacc").click(function(event){ACC.checkoutLogin.removeErrorMessage(),ACC.checkoutLogin.txt_username.prop("readonly",!1),ACC.checkoutLogin.txt_username.val(""),ACC.checkoutLogin.txt_username.focus(),ACC.checkoutLogin.hidden_disabledUsername.val(!1),$("#login-type-selector").removeClass("hide")}),$("#login-type-selector").on("click",function(){$("#js-checkout-login-form #username").focus()}),$(".js-checkout-login-verify-btn").on("click",function(e){e.preventDefault();var username=$("#unverifiedUsername").val();"true"===$("#isEmailType").val()?($.blockUI(),$.get(ACC.config.sendLoginEmailUrl+"?username="+username,function(result){$.unblockUI(),$("#js-sent-email-popup").modal("show")})):($.blockUI(),ACC.otp.sendADROTP({username:username,type:ACC.config.otpRequestType.SIGNIN_VERIFY_PHONE},ACC.otp.func.signInUp).then(function(response){$.unblockUI(),ACC.adrOtpPopup.showInSuccess({phone:username},ACC.checkoutLogin.handleConfirmOtp)},function(jqXHR){$.unblockUI(),ACC.adrOtpPopup.showInError({phone:username},jqXHR.responseJSON.message,ACC.checkoutLogin.handleConfirmOtp)}))})},autoFocusHandling:function(){ACC.checkoutLogin.f_form.find(":text, :password").each(function(){if(!this.disabled&&!this.readOnly)return this.focus(),!1})},removeErrorMessage:function(){ACC.checkoutLogin.label_global_error.remove(),ACC.checkoutLogin.label_error.remove()},handleConfirmOtp:function(phone,otpCode){var data=JSON.stringify({otpCode:otpCode,username:phone}),url=ACC.adrOtpPopup.attachCaptchaData(ACC.config.verifyLoginOTPUrl);ACC.adrOtpPopup.block(),$.postJSONCallback(url,data,function(result){ACC.adrOtpPopup.unblock(),ACC.adrOtpPopup.hide(),location.reload()},function(jqXHR){ACC.adrOtpPopup.unblock(),ACC.adrOtpPopup.errorMsg.html(jqXHR.responseJSON.message),ACC.adrOtpPopup.successMsg.hide(),ACC.adrOtpPopup.resetCaptCha()})}},ACC.adrFacet={_autoload:[["initFacet",$(".js-facet").length>0]],initScroll:function($elem){var $list=$elem.find(".js-facet-list");$list.hasClass("facet-list-scroll")&&($list.css({"max-height":"250px"}),$list.niceScroll({cursorwidth:"4px",cursorborder:"none",autohidemode:!1,cursorcolor:"#dddddd",background:"transparent"}))},initMore:function($elem){var $list=$elem.find(".js-facet-list"),$items=$list.find(">li").not(".facet-btn");$items.length<=5||($items.filter(function(index,item){return index>=5}).hide(),$list.find(".js-facet-more").on("click",function(){$(this).toggleClass("is-more"),$items.filter(function(index,item){return index>=5}).toggle()}))},initFilter:function($elem){var $input,_this=this;$input=$elem.find(".js-facet-filter-input"),$input.on("input",function(){var txt,$this=$(this);txt=ACC.helpers.removeUnicode($.trim($this.val())),_this.applyFilter({keyword:txt,$list:$elem.find(".js-facet-list li")})})},initColor:function($elem){$elem.find(".facet-color").on("mouseover",function(){$(this).addClass("hover")}).on("mouseleave",function(){$(this).removeClass("hover")})},applyFilter:function(options){var $list=options.$list,keyword=options.keyword;$list.each(function(){var label,$item=$(this);label=ACC.helpers.removeUnicode($.trim($item.attr("data-label"))),label.match(keyword)?$item.removeClass("hidden"):$item.addClass("hidden")})},initFacet:function(){var _this=this;_this.$elem=$(".js-facet"),_this.$groups=_this.$elem.find(".js-facet-group"),_this.$groups.each(function(){var $this=$(this);$("body").width()>1023?_this.initScroll.call(_this,$this):_this.initMore.call(_this,$this),_this.initFilter.call(_this,$this),_this.initColor.call(_this,$this),_this.initEvent.call(_this,$this)})},initEvent:function(){$(".js-open-filter").on("click",function(e){e.preventDefault(),$("#sidebar-wrapper").addClass("open"),$("body").addClass("overflow-hidden")}),$(".js-close-filter").on("click",function(e){e.preventDefault(),$("#sidebar-wrapper").removeClass("open"),$("body").removeClass("overflow-hidden")}),$(".js-open-sort").on("click",function(e){e.preventDefault(),$(".sort-menu__items").addClass("open"),$(".sort-menu__backdrop").addClass("show"),$("body").addClass("overflow-hidden")}),$(".js-close-sort").on("click",function(e){e.preventDefault(),$(".sort-menu__items").removeClass("open"),$(".sort-menu__backdrop").removeClass("show"),$("body").removeClass("overflow-hidden")}),$(".js-filter-price").on("click",function(){var from=$("input[name='formPrice']").val(),to=$("input[name='toPrice']").val();if(from&&to){var path=window.location.href;path=-1!==path.indexOf("Arelevance")?window.location.href+"%3AcustomPriceRange%3A["+from+"+-+"+to+"đ]":-1!==path.indexOf("?")?window.location.href+"&q=%3Arelevance%3AcustomPriceRange%3A["+from+"+-+"+to+"đ]":window.location.href+"?q=%3Arelevance%3AcustomPriceRange%3A["+from+"+-+"+to+"đ]",window.location.href=path}}),$(".js-facet-form").on("mousewheel DOMMouseScroll",function(e){var scrollTo=null;"mousewheel"===e.type?scrollTo=-1*e.originalEvent.wheelDelta:"DOMMouseScroll"===e.type&&(scrollTo=40*e.originalEvent.detail),scrollTo&&(e.preventDefault(),$(this).scrollTop(scrollTo+$(this).scrollTop()))})}},ACC.helpers={_autoload:["init",["initPopover",$(".js-pop-hover").length>0],["initShippingArea",$(".js-shippingArea").length>0],["initBootstrapDropDownForComponent",$('[data-toggle="dropdown"]').length>0]],init:function(){$(document).on("click","#btnCustomerSubmitRequest",function(e){e.preventDefault(),ACC.helpers.createTicketForCustomer()}),this.initEventListener()},createTicketForCustomer:function(){var name=$("#contact-name").val(),phoneNumber=$("#phoneNumber").val(),email=$("#contact-email").val(),orderNumber=$("#contact-order-number").val(),title=$("#contact-title").val(),question=$("#contact-question").val();$.ajax({type:"POST",url:"/view/ContactUsFormComponentController/ContactUsPage-contactUsPage",data:"name="+name+"&phoneNumber="+phoneNumber+"&email="+email+"&orderNumber="+orderNumber+"&title="+title+"&question="+question,success:function(response){if($("#nameError").html(""),$("#phoneError").html(""),$("#emailError").html(""),"success"==response.status){var string=$("#successText").html(),new_string=string.replace("Anonymous",name);$("#successText").html(new_string),$("#modal-request-success").modal("show"),$("#contactUsForm").trigger("reset")}if("fail"==response.status){for(errorInfo="",i=0;i<response.result.length;i++)"name"==response.result[i].field&&($("#nameError").html(response.result[i].code),$("#nameError").show("slow")),"phoneNumber"==response.result[i].field&&($("#phoneError").html(response.result[i].code),$("#phoneError").show("slow")),"email"==response.result[i].field&&($("#emailError").html(response.result[i].code),$("#emailError").show("slow"));$("#info").hide("slow"),$("#error").show("slow")}},error:function(e){}})},initEventListener:function(){$("#js-toggle-help-menu").on("click",function(event){event.stopPropagation(),$(".section__sidebar-help").toggleClass("open")}),$(document).click(function(e){var container=$(".section__sidebar-help");container.is(e.target)||0!==container.has(e.target).length||container.removeClass("open")})},removeUnicode:function(str){return str?(str=str.toLowerCase(),str=str.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g,"a"),str=str.replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g,"e"),str=str.replace(/ì|í|ị|ỉ|ĩ/g,"i"),str=str.replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g,"o"),str=str.replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g,"u"),str=str.replace(/ỳ|ý|ỵ|ỷ|ỹ/g,"y"),str=str.replace(/đ/g,"d")):""},initPopover:function(argument){$(document).on("click",".js-pop-hover",function(e){const $target=$(e.target);($target.is(".pop-hover-static")||$target.parents(".pop-hover-static").length)&&e.stopPropagation()})},initBootstrapDropDownForComponent:function(){$('[data-toggle="dropdown"]').each(function(){var $parent=$(this).parent(),component=$(this).data("component"),idTmp=_.uniqueId("dropDown_");_.isEmpty($parent.attr("id"))&&(void 0!==component&&(idTmp=_.uniqueId(component+"_")),$parent.attr("id",idTmp))})},initShippingArea:function(){var els={contentSel:$("#content"),blockingEl:{overlay:".blockOverlay",message:".blockMsg"},floatEl:{sel:$(".pop-hover-floating"),closeBtn:".location-notify .close",openBtn:".open-shipping-area"},mainEl:".js-shippingArea",shipping:{address:"#deliveryRecentAddress a",city:"#shipping--zone-city",street:"#shipping--zone-street",district:"#shipping--zone-district",ward:"#shipping--zone-ward",submit:"#btnSubmit"}},overlay={active:function(){els.contentSel.block({message:null,onBlock:function(){$(els.blockingEl.overlay).addClass("is-shipping-active"),$(els.blockingEl.message).addClass("is-shipping-active")},onUnblock:function(){$(els.blockingEl.overlay).removeClass("is-shipping-active"),$(els.blockingEl.message).removeClass("is-shipping-active")}})}},setShippingAddress=function(){_.isEmpty(ACC.delivery.selectedProvince)||(ACC.selectize.set(els.shipping.city,ACC.delivery.selectedProvince,"silent"),ACC.selectize.unblock(els.shipping.city)),_.isEmpty(ACC.delivery.selectedDistrict)||(ACC.requests.location.district(els.shipping.district,ACC.delivery.selectedProvince,0),ACC.selectize.set(els.shipping.district,ACC.delivery.selectedDistrict,"silent"),ACC.selectize.unblock(els.shipping.district)),_.isEmpty(ACC.delivery.selectedWard)||(ACC.requests.location.ward(els.shipping.ward,ACC.delivery.selectedProvince,ACC.delivery.selectedDistrict,0),ACC.selectize.set(els.shipping.ward,ACC.delivery.selectedWard,"silent"),ACC.selectize.unblock(els.shipping.ward))};$(document).on("click",".js-change_delivery, .js-change_delivery_pdp, .js-change_delivery_nonTextChange",function(e){e.preventDefault(),e.stopPropagation();const id="#shippingArea_2";$(id).hasClass("open")||($(id).addClass("open"),$(els.mainEl).removeClass("is-default-active"),overlay.active(),setShippingAddress()),$("html, body").animate({scrollTop:0},"fast")}),$(document).on("show.bs.dropdown",els.mainEl,function(e){$(els.mainEl).removeClass("is-default-active"),overlay.active(),setShippingAddress()}),$(document).on("hidden.bs.dropdown",els.mainEl,function(e){els.contentSel.unblock()}),$(document).on("click",els.floatEl.closeBtn,function(e){$(els.mainEl).removeClass("is-default-active"),els.floatEl.sel.css("display","none")}),$(document).on("click",els.floatEl.openBtn,function(e){e.stopPropagation(),$(els.mainEl).removeClass("is-default-active"),$(els.mainEl).addClass("open"),setShippingAddress()})}},ACC.csvimport={TEXT_CSV_CONTENT_TYPE:"text/csv",APP_EXCEL_CONTENT_TYPE:"application/vnd.ms-excel",_autoload:[["changeFileUploadAppearance",0!=$(".js-file-upload").length],["bindImportCSVActions",0!=$(".js-import-csv").length]],changeFileUploadAppearance:function(){$(".js-file-upload__input").on("change",function(){$(".js-file-upload__file-name").text(this.value.toLowerCase().replace(/c:\\fakepath\\/g,"")),$(".js-file-upload").parents("#cboxLoadedContent").length>0&&ACC.colorbox.resize()})},bindImportCSVActions:function(){$("#chooseFileButton").on("click",function(event){ACC.csvimport.clearGlobalAlerts()}),$("#importButton").on("click",function(event){if(event.preventDefault(),ACC.csvimport.clearGlobalAlerts(),!($(".js-file-upload__input").val().trim().length>0))return void ACC.csvimport.displayGlobalAlert({type:"error",messageId:"import-csv-no-file-chosen-error-message"});var selectedFile=document.getElementById("csvFile").files[0];if(ACC.csvimport.isSelectedFileValid(selectedFile)){var form=document.getElementById("importCSVSavedCartForm"),formData=new window.FormData(form);formData.append("csvFile",selectedFile),ACC.csvimport.displayGlobalAlert({type:"warning",messageId:"import-csv-upload-message"}),ACC.csvimport.enableDisableActionButtons(!1),$.ajax({url:form.action,type:"POST",data:formData,contentType:!1,processData:!1,success:function(){ACC.csvimport.displayGlobalAlert({type:"info",message:""}),$("#import-csv-alerts .alert-info").append($("#import-csv-success-message").html()),ACC.csvimport.clearChosenFile()},error:function(jqXHR){if(400==jqXHR.status&&jqXHR.responseJSON)return void ACC.csvimport.displayGlobalAlert({type:"error",message:jqXHR.responseJSON});ACC.csvimport.displayGlobalAlert({type:"error",messageId:"import-csv-generic-error-message"})},complete:function(){ACC.csvimport.enableDisableActionButtons(!0)}})}})},isSelectedFileValid:function(selectedFile){if(window.File&&window.Blob){if(selectedFile){if(selectedFile.type!=ACC.csvimport.TEXT_CSV_CONTENT_TYPE&&selectedFile.type!=ACC.csvimport.APP_EXCEL_CONTENT_TYPE)return ACC.csvimport.displayGlobalAlert({type:"error",messageId:"import-csv-file-csv-required"}),!1;var fileName=selectedFile.name;if(!fileName||!/\.csv$/i.test(fileName))return ACC.csvimport.displayGlobalAlert({type:"error",messageId:"import-csv-file-csv-required"}),!1}var fileMaxSize=$(".js-file-upload__input").data("file-max-size");if($.isNumeric(fileMaxSize)&&selectedFile&&selectedFile.size>parseFloat(fileMaxSize))return ACC.csvimport.displayGlobalAlert({type:"error",messageId:"import-csv-file-max-size-exceeded-error-message"}),!1}return!0},displayGlobalAlert:function(options){ACC.csvimport.clearGlobalAlerts();var alertTemplateSelector;switch(options.type){case"error":alertTemplateSelector="#global-alert-danger-template";break;case"warning":alertTemplateSelector="#global-alert-warning-template";break;default:alertTemplateSelector="#global-alert-info-template"}void 0!==options.message&&$("#import-csv-alerts").append($(alertTemplateSelector).tmpl({message:options.message})),void 0!==options.messageId&&$("#import-csv-alerts").append($(alertTemplateSelector).tmpl({message:$("#"+options.messageId).text()}))},clearGlobalAlerts:function(){$("#import-csv-alerts").empty()},clearChosenFile:function(){document.getElementById("csvFile").value="",$(".js-file-upload__file-name").text("")},enableDisableActionButtons:function(enable){$("#chooseFileButton").attr("disabled",!enable),$("#importButton").prop("disabled",!enable)}},ACC.suggestvinid={_config:{element:{connectCurrentVinIDBtn:"#js-connect-current-vinid-btn",connectOtherVinIDLink:"#js-connect-other-vinid-link",connectOtherVinIDBtn:"#js-connect-other-vinid-btn",resendOTPBtn:"#js-adr-otp-resend",resendOTP2Btn:"#js-adr-otp-resend2",resendOTPVinIdSystemBtn:"#js-vinid-system-otp-resend",verifyOTPBtn:"#js-verify-otp-btn",verifyOTP2Btn:"#js-verify-otp2-btn",registerVinIdBtn:"#js-signin-register-vinid-btn",verifyOTPVinIdSystemBtn:"#js-verify-otp-vinid-system-btn",optionConnectVinIdPopup:"#sign-in__suggest_connect",connectVinIdPopup:"#sign-in__connect_vinid",verifyOTPConnectVinIdPopup:"#sign-in__verify_opt_connect_vinid",verifyOTPConnectVinIdPopup2:"#sign-in__verify_opt_connect_vinid2",verifyOTPConnectVinIdSystemPopup:"#sign-in__verify_opt_connect_vinid_system",registerVinIdCardPopup:"#sign-in__register_vinid_card",vinidCardErrorPopup:"#sign-in__vinid_card_error",registerVinIdCardSuccessPopup:"#sign-in__register_vinid_card_success",suggestConnectSuccessPopup:"#sign-in__suggest_connect_success",registerRewardBlock:"#js-register-reward",registerRewardPoint:"#js-register-reward-point",connectRewardBlock:"#js-connect-reward",connectRewardPoint:"#js-connect-reward-point",optionConnectRewardBlock:"#js-option-connect-reward",optionConnectRewardPoint:"#js-option-connect-reward-point",username:"",phoneNumber:"",formDataVinId:""}},_autoload:["initElements","submitConnectCurrentVinId","submitConnectOtherVinId","bindConnectOtherVinId","bindResendADROTP","bindResendADROTP2","bindResendVinIdOTP","bindRegisterVinId","verifyADROTP","verifyADROTP2","verifyOTPVinIdSystem","initDataForPopup"],initElements:function(){ACC.common.loadModuleElements(ACC.suggestvinid)},processSuggestVinID:function(username){ACC.suggestvinid.username=username,ACC.suggestvinid.isConnectADR="true",$.getJSON(ACC.config.suggestVinIDUrl+"?username="+username,function(result){"REGISTER_VINID_CARD"===result.page?ACC.suggestvinid.showRegisterVinIdPopup():"CONNECT_OPTION_PAGE"===result.page?ACC.suggestvinid.showPopupOptionConnectVinId(result):"CONNECT_VINID_PAGE"===result.page?(ACC.suggestvinid.sendADROTP2(result.vinId),ACC.suggestvinid.showPopupVerifyADROTP2(result)):"VIN_CARD_ERROR"===result.page&&ACC.suggestvinid.showVinCardErrorPopup(),$.unblockUI()})},submitConnectCurrentVinId:function(){ACC.suggestvinid.connectCurrentVinIDBtn.click(function(event){event.preventDefault(),$("#sign-in__suggest_connect .modal-content").block();var userNameHasVinID=$(".js-customerid-suggest").val();ACC.suggestvinid.hideOptionConnectVinIdPopup(),$.get(ACC.config.connectCurrentVinIDUrl+"?username="+ACC.suggestvinid.username+"&userNameHasVinID="+userNameHasVinID,function(result){"CONNECT_SUCCESS_PAGE"===result&&ACC.suggestvinid.showSuggestConnectSuccessPopup(),$("#sign-in__suggest_connect .modal-content").unblock()})})},submitConnectOtherVinId:function(){ACC.suggestvinid.connectOtherVinIDBtn.click(function(event){event.preventDefault(),$("#sign-in__connect_vinid .modal-content").block();var errorMsgs=$("#js-connect-other-vinid-form").find("p.error-message");errorMsgs&&errorMsgs.remove();var formData={vinId:$("#js-connect-other-vinid-vinid").val()},url=ACC.common.attachCaptchaParameter("#sign-in__connect_vinid",ACC.config.connectOtherVinIDUrl);$.ajax({url:url,type:"post",data:JSON.stringify(formData),dataType:"json",contentType:"application/json; charset=utf-8",success:function(result){ACC.suggestvinid.sendADROTP(result.vinId),ACC.suggestvinid.hideConnectOtherVinIdPopup(),ACC.suggestvinid.showPopupVerifyADROTP(result),$("#sign-in__connect_vinid .modal-content").unblock()},error:function(error,textStatus,errorThrown){if(ACC.captcha.reset("js-connect-other-vinid-captcha"),error.responseJSON){var errors=JSON.parse(error.responseJSON.errorMessage);for(var key in errors)$("#js-connect-other-vinid-"+key).after("<p class='error-message'>"+errors[key]+"</p>")}$("#sign-in__connect_vinid .modal-content").unblock()}})})},mapADRAndVinId:function(vinId){var formData={vinId:vinId};$.ajax({url:ACC.config.mapADRAndVinIDUrl,type:"post",data:JSON.stringify(formData),dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){ACC.suggestvinid.showSuggestConnectSuccessPopup()},error:function(data,textStatus,errorThrown){}})},bindConnectOtherVinId:function(){ACC.suggestvinid.connectOtherVinIDLink.click(function(event){event.preventDefault(),ACC.suggestvinid.hideOptionConnectVinIdPopup(),ACC.suggestvinid.showPopupConnectVinId()})},bindResendADROTP:function(){ACC.suggestvinid.resendOTPBtn.click(function(event){event.preventDefault();var vinId=$(".js-vinid-send-opt").val();ACC.suggestvinid.sendADROTP(vinId,!0)})},bindResendADROTP2:function(){ACC.suggestvinid.resendOTP2Btn.click(function(event){event.preventDefault();var vinId=$(".js-vinid-send-opt2").val();ACC.suggestvinid.sendADROTP2(vinId,!0)})},bindResendVinIdOTP:function(){ACC.suggestvinid.resendOTPVinIdSystemBtn.click(function(event){event.preventDefault(),ACC.suggestvinid.formDataVinId.identifyNumber=ACC.suggestvinid.formDataVinId.identify,ACC.suggestvinid.reSendVinIdOTP()})},verifyADROTP:function(){ACC.suggestvinid.verifyOTPBtn.click(function(event){event.preventDefault(),$("#sign-in__verify_opt_connect_vinid .modal-content").block();var otpCode=$("#js-otp-input").val(),vinId=$(".js-vinid-send-opt").val(),formData={otpCode:otpCode,vinId:vinId},url=ACC.common.attachCaptchaParameter("#sign-in__verify_opt_connect_vinid",ACC.config.verifyOTPADRUrl);ACC.otp.verifyAndMapADROTP(formData,url).then(function(response){ACC.suggestvinid.hideVerifyADROTPPopup(),ACC.suggestvinid.showSuggestConnectSuccessPopup(),$("#sign-in__verify_opt_connect_vinid .modal-content").unblock()},function(error){ACC.captcha.reset("js-captcha-sign-in__verify_otp"),error.responseJSON&&(error.responseJSON.message.includes("captcha")?ACC.captcha.showError("js-captcha-sign-in__verify_otp",error.responseJSON.message):ACC.suggestvinid.addErrorMessageToField($("#js-otp-input"),error.responseJSON.message)),$("#sign-in__verify_opt_connect_vinid .modal-content").unblock()})})},verifyADROTP2:function(){ACC.suggestvinid.verifyOTP2Btn.click(function(event){event.preventDefault(),$("#sign-in__verify_opt_connect_vinid2 .modal-content").block();var otpCode=$("#js-otp-input2").val(),vinId=$(".js-vinid-send-opt2").val(),formData={otpCode:otpCode,vinId:vinId},url=ACC.common.attachCaptchaParameter("#sign-in__verify_opt_connect_vinid2",ACC.config.verifyOTPADRUrl);ACC.otp.verifyAndMapADROTP(formData,url).then(function(response){ACC.suggestvinid.hideVerifyADROTP2Popup(),ACC.suggestvinid.showSuggestConnectSuccessPopup(),$("#sign-in__verify_opt_connect_vinid2 .modal-content").unblock()},function(error){ACC.captcha.reset("js-captcha-sign-in__verify_otp2"),error.responseJSON&&(error.responseJSON.message.includes("captcha")?ACC.captcha.showError("js-captcha-sign-in__verify_otp2",error.responseJSON.message):ACC.suggestvinid.addErrorMessageToField($("#js-otp-input2"),error.responseJSON.message)),$("#sign-in__verify_opt_connect_vinid2 .modal-content").unblock()})})},verifyOTPVinIdSystem:function(){ACC.suggestvinid.verifyOTPVinIdSystemBtn.click(function(event){event.preventDefault(),$("#sign-in__verify_opt_connect_vinid_system .modal-content").block();var otpCode=$("#js-otp-input-vinid-system").val(),identifyNumber=$(".js-identify-number-otp").val(),formData={otpCode:otpCode,identifyNumber:identifyNumber,phoneNumber:ACC.suggestvinid.phoneNumber,isConnectADR:ACC.suggestvinid.isConnectADR},url=ACC.common.attachCaptchaParameter("#sign-in__verify_opt_connect_vinid_system",ACC.config.verifyOTPVinIDSystemUrl);ACC.otp.verifyVinIdOTP(formData,url).then(function(response){ACC.suggestvinid.hideVerifyVinIdOTPPopup(),ACC.suggestvinid.hideVerifyADROTPPopup(),window.location.pathname.indexOf("profile")>=0?location.reload():window.location.pathname.indexOf("checkout")>=0&&window.location.pathname.indexOf("orderConfirmation")<0?ACC.vinidredeem.refreshVinIDRedeem():ACC.suggestvinid.showRegisterVinIdSuccessPopup(response),$("#sign-in__verify_opt_connect_vinid_system .modal-content").unblock()},function(error){ACC.captcha.reset("js-captcha-sign-in__verify_otp3"),error.responseJSON&&(error.responseJSON.message.includes("captcha")?ACC.captcha.showError("js-captcha-sign-in__verify_otp3",error.responseJSON.message):ACC.suggestvinid.addErrorMessageToField($("#js-otp-input-vinid-system"),error.responseJSON.message)),$("#sign-in__verify_opt_connect_vinid_system .modal-content").unblock()})})},bindRegisterVinId:function(){ACC.suggestvinid.registerVinIdBtn.click(function(event){event.preventDefault(),$("#sign-in__register_vinid_card .modal-content").block();var errorMsgs=$("#js-register-vinid-card-form").find("p.error-message");errorMsgs&&errorMsgs.remove(),ACC.suggestvinid.isConnectADR="true";var email=$("#js-register-vinid-card-email").val(),phoneNumber=$("#js-register-vinid-card-phone").val(),dayOfBirth=$("#js-register-vinid-card-day option:selected").val(),monthOfBirth=$("#js-register-vinid-card-month option:selected").val(),yearOfBirth=$("#js-register-vinid-card-year option:selected").val(),gender=$("input[name=js-register-vinid-card-gender]:checked").val(),address=$("#js-register-vinid-card-address").val(),identityCardNumber=$("#js-register-vinid-card-indentity").val(),isRecievePromotion="checked"===$("#js-register-vinid-card-promotion").attr("checked"),formData={email:$("#js-register-vinid-card-email").val(),phoneNumber:$("#js-register-vinid-card-phone").val(),dayOfBirth:$("#js-register-vinid-card-day option:selected").val(),monthOfBirth:$("#js-register-vinid-card-month option:selected").val(),yearOfBirth:$("#js-register-vinid-card-year option:selected").val(),gender:$("input[name=js-register-vinid-card-gender]:checked").val(),address:$("#js-register-vinid-card-address").val(),identityCardNumber:$("#js-register-vinid-card-indentity").val(),isRecievePromotion:$("#js-register-vinid-card-promotion").attr("checked"),captchaEnabled:$("#captcha-enabled").val()},url=ACC.config.validateRegisterVinIDUrl;url=ACC.common.attachCaptchaParameter("#js-register-vinid-card-form",ACC.config.validateRegisterVinIDUrl),$.ajax({url:url,type:"post",data:JSON.stringify(formData),dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){var formDataVinId={fullName:data.fullName,phoneNumber:phoneNumber,email:email,birthday:yearOfBirth+monthOfBirth+dayOfBirth,gender:gender,address:address,identify:identityCardNumber,isRecievePromotion:isRecievePromotion};ACC.suggestvinid.formDataVinId=formDataVinId,ACC.suggestvinid.sendVinIdOTP(formDataVinId),ACC.suggestvinid.hideRegisterVinIdPopup(),ACC.suggestvinid.showPopupVerifyVinIdOTP(identityCardNumber,phoneNumber),$("#sign-in__register_vinid_card .modal-content").unblock()},error:function(data,textStatus,errorThrown){ACC.captcha.reset("js-register-vinid-card-captcha"),$("#sign-in__register_vinid_card .modal-content").unblock();var errors=JSON.parse(data.responseJSON.errorMessage);for(var key in errors)$("#js-register-vinid-card-"+key).after("<p class='error-message'>"+errors[key]+"</p>")}})})},addErrorMessageToField:function(fieldGroup,error){var parentElement=fieldGroup.parent(),errorContainer=parentElement.find("p.error-message");"OK"===error?errorContainer.text(""):errorContainer.text(error)},showPopupConnectVinId:function(){ACC.captcha.renderWidget("js-connect-other-vinid-captcha"),this.connectVinIdPopup.modal("show")},showPopupVerifyADROTP:function(result){ACC.captcha.renderWidget("js-captcha-sign-in__verify_otp"),$("#js-phone-opt").text(result.phoneEncrypt),$(".js-vinid-send-opt").val(result.vinId),this.verifyOTPConnectVinIdPopup.modal("show")},showPopupVerifyADROTP2:function(result){ACC.captcha.renderWidget("js-captcha-sign-in__verify_otp2"),$("#js-vinid-opt2").text(result.vinIdEncrypt),$("#js-phone-opt2").text(result.phoneEncrypt),$(".js-vinid-send-opt2").val(result.vinId);var orderCode=$(ACC.vinidDetail.formData.orderCodeHidden).val();if(orderCode&&0!=Object.keys(orderCode).length){var rewardPointUrl=ACC.config.suggestRewardPointUrl+"?orderCode="+orderCode;$.get(rewardPointUrl,function(result){""!=result?(ACC.suggestvinid.optionConnectRewardPoint.text(result),ACC.suggestvinid.optionConnectRewardBlock.show()):ACC.suggestvinid.optionConnectRewardBlock.hide(),ACC.suggestvinid.verifyOTPConnectVinIdPopup2.modal("show")})}else ACC.suggestvinid.optionConnectRewardBlock.hide(),this.verifyOTPConnectVinIdPopup2.modal("show")},showPopupVerifyVinIdOTP:function(identityCardNumber,phoneNumber){ACC.captcha.renderWidget("js-captcha-sign-in__verify_otp3"),$(".js-identify-number-otp").val(identityCardNumber),$("#js-phone-opt-vinid-system").text(ACC.common.hidePhoneNumber(phoneNumber)),ACC.suggestvinid.phoneNumber=phoneNumber,this.verifyOTPConnectVinIdSystemPopup.modal("show")},showPopupOptionConnectVinId:function(result){ACC.suggestvinid.bindKeyPressEvent(this.optionConnectVinIdPopup),$("#js-vinid-suggest").text(result.vinIdEncrypt),$("#js-customerid-suggest").text(result.customerIdEncrypt),$(".js-customerid-suggest").val(result.customerId);var orderCode=$(ACC.vinidDetail.formData.orderCodeHidden).val();if(orderCode&&0!=Object.keys(orderCode).length){var rewardPointUrl=ACC.config.suggestRewardPointUrl+"?orderCode="+orderCode;$.get(rewardPointUrl,function(result){ACC.suggestvinid.connectRewardPoint.text(result),ACC.suggestvinid.connectRewardBlock.show(),ACC.suggestvinid.optionConnectVinIdPopup.modal("show")})}else ACC.suggestvinid.connectRewardBlock.hide(),ACC.suggestvinid.optionConnectVinIdPopup.modal("show")},showRegisterVinIdPopup:function(){ACC.captcha.renderWidget("js-register-vinid-card-captcha");var orderCode=$(ACC.vinidDetail.formData.orderCodeHidden).val();if(orderCode&&0!=Object.keys(orderCode).length){var rewardPointUrl=ACC.config.suggestRewardPointUrl+"?orderCode="+orderCode;$.get(rewardPointUrl,function(result){""!=result?(ACC.suggestvinid.registerRewardPoint.text(result),ACC.suggestvinid.registerRewardBlock.show(),ACC.suggestvinid.registerVinIdCardPopup.modal("show")):(ACC.suggestvinid.registerRewardBlock.hide(),ACC.suggestvinid.registerVinIdCardPopup.modal("show"))})}else ACC.suggestvinid.registerRewardBlock.hide(),ACC.suggestvinid.registerVinIdCardPopup.modal("show")},showVinCardErrorPopup:function(){this.vinidCardErrorPopup.modal("show")},showRegisterVinIdSuccessPopup:function(response){ACC.suggestvinid.bindKeyPressEvent(this.registerVinIdCardSuccessPopup),$("#js-vinid-system-created").text(ACC.common.formatVinIdNumber(response.vinId)),this.registerVinIdCardSuccessPopup.modal("show")},showSuggestConnectSuccessPopup:function(){ACC.suggestvinid.bindKeyPressEvent(this.suggestConnectSuccessPopup),this.suggestConnectSuccessPopup.modal("show")},hideOptionConnectVinIdPopup:function(){this.optionConnectVinIdPopup.modal("hide")},hideVerifyVinIdOTPPopup:function(){this.verifyOTPConnectVinIdSystemPopup.modal("hide"),ACC.common.resetForm($("#sign-in__verify_opt_connect_vinid_system"))},hideRegisterVinIdPopup:function(){this.registerVinIdCardPopup.modal("hide"),ACC.common.resetForm($("#sign-in__register_vinid_card")),$(".js-gender-man").prop("checked",!0),$("#js-register-vinid-card-promotion").prop("checked",!0),$("#js-register-vinid-card-day option:first").prop("selected",!0),$("#js-register-vinid-card-month option:first").prop("selected",!0),$("#js-register-vinid-card-year option:first").prop("selected",!0)},hideVerifyADROTPPopup:function(){this.verifyOTPConnectVinIdPopup.modal("hide"),ACC.common.resetForm($("#sign-in__verify_opt_connect_vinid"))},hideVerifyADROTP2Popup:function(){this.verifyOTPConnectVinIdPopup2.modal("hide"),ACC.common.resetForm($("#sign-in__verify_opt_connect_vinid2"))},hideConnectOtherVinIdPopup:function(){ACC.common.resetForm($("#sign-in__connect_vinid")),this.connectVinIdPopup.modal("hide")},hideRegisterVinIdSuccessPopup:function(){this.registerVinIdCardSuccessPopup.modal("hide")},hideSuggestConnectSuccessPopup:function(){this.suggestConnectSuccessPopup.modal("hide")},sendADROTP:function(vinId,isResend){isResend&&$(".adr-otp-sent-notify").attr("style","display:none"),$("#sign-in__verify_opt_connect_vinid .modal-content").block();var data={vinId:vinId,type:ACC.config.otpRequestType.SIGNIN_MAPPING_VINID_TO_ADR};isResend&&(data.resend=!0),ACC.otp.sendADROTP(data,ACC.otp.func.signInUp).then(function(response){isResend&&$(".adr-otp-sent-notify").attr("style","display:block"),$("#sign-in__verify_opt_connect_vinid .modal-content").unblock()},function(error){error.responseJSON&&(ACC.suggestvinid.addErrorMessageToField($("#js-otp-input"),error.responseJSON.message),isResend&&$(".adr-otp-sent-notify").attr("style","display:none")),$("#sign-in__verify_opt_connect_vinid .modal-content").unblock()})},sendADROTP2:function(vinId,isResend){$("#sign-in__verify_opt_connect_vinid2 .modal-content").block(),isResend&&$(".adr-otp-sent-notify2").attr("style","display:none");var data={vinId:vinId,type:ACC.config.otpRequestType.SIGNIN_MAPPING_VINID_TO_ADR};isResend&&(data.resend=!0),ACC.otp.sendADROTP(data,ACC.otp.func.signInUp).then(function(response){isResend&&$(".adr-otp-sent-notify2").attr("style","display:block"),$("#sign-in__verify_opt_connect_vinid2 .modal-content").unblock()},function(error){error.responseJSON&&(ACC.suggestvinid.addErrorMessageToField($("#js-otp-input2"),error.responseJSON.message),isResend&&$(".adr-otp-sent-notify2").attr("style","display:none")),$("#sign-in__verify_opt_connect_vinid2 .modal-content").unblock()})},sendVinIdOTP:function(formDataVinId){$("#sign-in__verify_opt_connect_vinid_system .modal-content").block(),$.ajax({url:ACC.config.signUpVinIdUrl+"?otpfunc="+ACC.otp.func.signInUp,type:"post",data:JSON.stringify(formDataVinId),dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){$("#sign-in__verify_opt_connect_vinid_system .modal-content").unblock()},error:function(error,textStatus,errorThrown){
error.responseJSON&&ACC.suggestvinid.addErrorMessageToField($("#js-otp-input-vinid-system"),error.responseJSON.message),$("#sign-in__verify_opt_connect_vinid_system .modal-content").unblock()}})},reSendVinIdOTP:function(){$("#sign-in__verify_opt_connect_vinid_system .modal-content").block(),$(".vinid-system-otp-sent-notify").attr("style","display:none"),ACC.otp.resendVinIdOTP(ACC.suggestvinid.formDataVinId,ACC.otp.func.signInUp).then(function(response){$(".vinid-system-otp-sent-notify").attr("style","display:block"),$("#sign-in__verify_opt_connect_vinid_system .modal-content").unblock()},function(error){error.responseJSON&&(ACC.suggestvinid.addErrorMessageToField($("#js-otp-input-vinid-system"),error.responseJSON.message),$(".vinid-system-otp-sent-notify").attr("style","display:none")),$("#sign-in__verify_opt_connect_vinid_system .modal-content").unblock()})},initDataForPopup:function(){for(var daySelect=$("#js-register-vinid-card-day"),i=1;i<32;i++){var day=i;i<10&&(day="0"+i);var option=$('<option value="'+day+'">'+day+"</option>");daySelect.append(option)}for(var monthSelect=$("#js-register-vinid-card-month"),i=1;i<13;i++){var month=i;month<10&&(month="0"+month);var option=$('<option value="'+month+'">'+month+"</option>");monthSelect.append(option)}for(var yearSelect=$("#js-register-vinid-card-year"),currentYear=(new Date).getFullYear(),i=currentYear;i>=1918;i--){var option=$('<option value="'+i+'">'+i+"</option>");yearSelect.append(option)}},bindKeyPressEvent:function(popup){popup.keypress(function(event){"13"==(event.keyCode?event.keyCode:event.which)&&popup.find("button.btn-primary").trigger("click")})}},ACC.assistedservice={_autoload:["bindEvents"],bindEvents:function(){this.views.bindEvents(),this.model.initData()},model:{adjustOrderReq:{},orderNumber:"",initData:function(){this.initEmptyAdjustReq(),this.orderNumber=$("#currentOrderNumber").val()},initEmptyAdjustReq:function(){this.adjustOrderReq={reason:"",involvedDepartment:"",budget:"",adjustAmount:"",applyType:"",orderItems:[],notes:"",shippingFeeType:""}}},services:{showCreateRequestForm:function(){var _services=this;$.blockUI(),ACC.assistedservice.ajax(ACC.config.assistedService.createAdjustOrderFormUrl,"GET").then(function(res){$.unblockUI(),ACC.assistedservice.views.showAdjustOrderRequestForm(res),ACC.assistedservice.model.initEmptyAdjustReq(),_services.loadReasons(),_services.loadInvolvedDepartments(),_services.loadApplyTypes(),_services.loadAllBudgets()},function(jqXHR){$.unblockUI(),ACC.assistedservice.views.showError(jqXHR)})},loadReasons:function(){ACC.assistedservice.ajax(ACC.config.assistedService.adjustmentOrderReasonsUrl,"GET").then(function(res){ACC.assistedservice.views.buildReasons(res.reasons)},function(jqXHR){console.log(jqXHR)})},loadInvolvedDepartments:function(){ACC.assistedservice.ajax(ACC.config.assistedService.involvedDepartmentUrl,"GET").then(function(res){ACC.assistedservice.views.buildInvolvedDepartments(res.enums)},function(jqXHR){console.log(jqXHR)})},loadApplyTypes:function(){ACC.assistedservice.ajax(ACC.config.assistedService.applyTypeUrl,"GET").then(function(res){ACC.assistedservice.views.buildApplyOn(res.enums)},function(jqXHR){console.log(jqXHR)})},loadAllBudgets:function(){ACC.assistedservice.ajax(ACC.config.assistedService.budgetUrl,"GET").then(function(res){var budgets=res.budgets,options=[];$.each(budgets,function(index,budget){options.push({code:budget.code,description:"{name} - amount: {amount}".replace("{name}",budget.name).replace("{amount}",budget.amount)})}),ACC.assistedservice.views.buildBudgets(options)},function(jqXHR){console.log(jqXHR)})},postAdjustOrderRequest:function(){$.blockUI(),ACC.assistedservice.views.hideErrorMessage(),ACC.assistedservice.model.adjustOrderReq.orderNumber=ACC.assistedservice.model.orderNumber,ACC.assistedservice.ajax(ACC.config.assistedService.adjustRequestUrl,"POST",ACC.assistedservice.model.adjustOrderReq).then(function(res){$.unblockUI(),ACC.assistedservice.model.initEmptyAdjustReq(),ACC.assistedservice.views.showSuccess(),ACC.assistedservice.views.resetForm()},function(jqXHR){$.unblockUI();var message=jqXHR.responseJSON.message;ACC.assistedservice.views.showErrorMessage(message)})}},views:{selectors:{adjustOrderPopup:"#js-adjust-order-popup",adjustOrderBtn:".js-create-adjust-amount",selectApplyOn:"select.js-application-types",selectAdjustBudget:"select.js-adjust-budget",selectInvolvedDepartment:"select.js-involved-departments",selectAdjustOrderItems:"select.js-adjust-order-items",selectAdjustReason:"select.js-adjust-reasons",selectShippingFee:".js-adjust-shiping-fee",orderItemGroup:".js-adjust-order-group",shippingFeeGroup:".js-adjust-shipping-fee-group",adjustOrderForm:".js-adjust-order-form",submitRequestBtn:"button.js-submit-adjust-request",errorMessage:".js-error-message",successMessage:".js-success-message",warningFreeShipMessage:".js-adjust-shipping-fee-warning-message",closeSuccessMessage:".js-success-message .glyphicon-remove"},buildReasons:function(reasons){this.buildOptions($(this.selectors.selectAdjustReason),reasons)},buildInvolvedDepartments:function(departments){this.buildOptions($(this.selectors.selectInvolvedDepartment),departments)},buildApplyOn:function(types){this.buildOptions($(this.selectors.selectApplyOn),types)},buildBudgets:function(types){this.buildOptions($(this.selectors.selectAdjustBudget),types)},buildShippingFees:function(types){this.buildOptions($(this.selectors.selectShippingFee),types)},buildOptions:function(selectElm,values){selectElm.find("option").remove();var options=[{code:"",description:""}];$.each(values,function(index,value){options.push(value)}),$.each(options,function(index,option){selectElm.append(new Option(option.description,option.code))})},bindEvents:function(){$(document).on("click",this.selectors.adjustOrderBtn,function(e){ACC.assistedservice.services.showCreateRequestForm()}),$(document).on("change",this.selectors.selectApplyOn,function(e){var applyType=$(this).val();"ORDER_ITEMS"===applyType?(ACC.assistedservice.views.showWarningFreeShipOrder(!1),$(ACC.assistedservice.views.selectors.orderItemGroup).show(),$(ACC.assistedservice.views.selectors.shippingFeeGroup).hide(),ACC.assistedservice.views.clearSelectOrderItems(),ACC.assistedservice.views.initOrderItemsSelect()):"SHIPPING_FEE"===applyType&&($(ACC.assistedservice.views.selectors.orderItemGroup).hide(),ACC.assistedservice.views.initShippingFeeTypes())}),$(document).on("click",this.selectors.submitRequestBtn,function(e){e.preventDefault(),ACC.assistedservice.views.updateModel(),ACC.assistedservice.services.postAdjustOrderRequest()}),$(document).on("keyup","#_asmPersonifyForm input[name='cartId']",function(){formValidate(this,8,!0),isErrorDisplayed()&&($("input[name='cartId']").removeClass("ASM-input-error"),$(".ASM_alert")&&$(".ASM_alert").remove())}),$(document).on("keyup",".js-adjust-order-form input[name='adjustAmount']",function(){var viewVal=$(this).val(),realValue=viewVal.replace(/\./g,""),newVal=ACC.common.formatThousands(realValue),lengthDiff=newVal.length-viewVal.length;lengthDiff=-1==lengthDiff?0:lengthDiff;var start=this.selectionStart+lengthDiff,end=this.selectionEnd+lengthDiff;$(this).val(newVal),this.setSelectionRange(start,end)}),$(document).on("click",this.selectors.closeSuccessMessage,function(){$(ACC.assistedservice.views.selectors.successMessage).hide()})},initOrderItemsSelect:function(){var url=ACC.config.assistedService.orderEntriesUrl.replace("{orderCode}",ACC.assistedservice.model.orderNumber);ACC.assistedservice.ajax(url,"GET").then(function(res){var orderEntries=res.orderEntries,entries=[];orderEntries&&$.each(orderEntries,function(index,item){var orderEntry=item.orderEntry,entry={id:item.pk,text:function(){var product=orderEntry.product;return product.currentOffer.code+" - "+product.name+", quantity: "+item.quantity+", total price: "+item.totalPrice.formattedValue}()};entries.push(entry)}),ACC.assistedservice.selectizeItems=$(ACC.assistedservice.views.selectors.selectAdjustOrderItems).selectize({plugins:["remove_button"],maxItems:null,valueField:"id",labelField:"text",searchField:"text",options:entries})},function(jqXHR){console.error(jqXHR)})},clearSelectOrderItems:function(){void 0!==ACC.assistedservice.selectizeItems&&void 0!==ACC.assistedservice.selectizeItems[0]&&"undefined"!==ACC.assistedservice.selectizeItems[0].selectize&&ACC.assistedservice.selectizeItems[0].selectize.clear()},initShippingFeeTypes:function(){var url=ACC.config.assistedService.shippingFeeTypesUrl.replace("{orderCode}",ACC.assistedservice.model.orderNumber);$(ACC.assistedservice.views.selectors.warningFreeShipMessage).show(),ACC.assistedservice.ajax(url,"GET").then(function(res){var shippingFees=res.enums;shippingFees.length>0?($(ACC.assistedservice.views.selectors.shippingFeeGroup).show(),ACC.assistedservice.views.buildShippingFees(shippingFees)):ACC.assistedservice.views.showWarningFreeShipOrder(!0)},function(jqXHR){console.error(jqXHR)})},showWarningFreeShipOrder:function(isShow){if(isShow){var warningMessage=$("#js-free-shipping-warning-message").val();$(ACC.assistedservice.views.selectors.warningFreeShipMessage).is(":visible")&&$(ACC.assistedservice.views.selectors.warningFreeShipMessage).html(warningMessage)}else $(ACC.assistedservice.views.selectors.warningFreeShipMessage).html(""),$(ACC.assistedservice.views.selectors.warningFreeShipMessage).hide()},showAdjustOrderRequestForm:function(html){$(this.selectors.adjustOrderPopup).html(html),$(this.selectors.adjustOrderPopup).modal("show")},showError:function(jqXHR){if($.unblockUI(),"403"==jqXHR.status){$(this.selectors.adjustOrderPopup).html('<div class="modal-body"><div class="modal-dialog" role="document"><div class="modal-content"><button type="button" class="close" data-dismiss="modal" aria-hidden="true"><span aria-hidden="true" class="glyphicon glyphicon-remove"></span></button><div class="modal-header"></div><div class="modal-body"><p style="color: #f39000">Phiên đăng nhập của bạn đã kết thúc. Vui lòng đăng nhập lại.</p>'),$(this.selectors.adjustOrderPopup).modal("show")}},showErrorMessage:function(message){$(this.selectors.errorMessage).html(message),$(this.selectors.errorMessage).addClass("error"),$(this.selectors.errorMessage).show()},hideErrorMessage:function(){$(this.selectors.errorMessage).html(""),$(this.selectors.errorMessage).removeClass("error"),$(this.selectors.errorMessage).hide()},showSuccess:function(){$(ACC.assistedservice.views.selectors.successMessage).fadeIn(),setTimeout(function(){$(ACC.assistedservice.views.selectors.successMessage).fadeOut()},5e3)},resetForm:function(){$(this.selectors.adjustOrderForm).find("select[name='reason']").val(""),$(this.selectors.adjustOrderForm).find("select[name='involvedDepartment']").val(""),$(this.selectors.adjustOrderForm).find("select[name='budget']").val(""),$(this.selectors.adjustOrderForm).find("input[name='adjustAmount']").val(""),$(this.selectors.adjustOrderForm).find("select[name='applyType']").val("").change(),$(this.selectors.adjustOrderForm).find("input[name='notes']").val(""),$(this.selectors.selectShippingFee).val(""),$(this.selectors.shippingFeeGroup).hide(),ACC.assistedservice.views.clearSelectOrderItems(),$(this.selectors.selectAdjustOrderItems).val(""),$(this.selectors.orderItemGroup).hide()},updateModel:function(){var model=ACC.assistedservice.model.adjustOrderReq;model.reason=$(this.selectors.adjustOrderForm).find("select[name='reason']").val(),model.involvedDepartment=$(this.selectors.adjustOrderForm).find("select[name='involvedDepartment']").val(),model.budget=$(this.selectors.adjustOrderForm).find("select[name='budget']").val(),model.adjustAmount=$(this.selectors.adjustOrderForm).find("input[name='adjustAmount']").val().replace(/\./g,""),model.applyType=$(this.selectors.adjustOrderForm).find("select[name='applyType']").val(),model.note=$(this.selectors.adjustOrderForm).find("input[name='notes']").val(),"ORDER_ITEMS"==model.applyType&&(model.orderItems=$(this.selectors.selectAdjustOrderItems).val()),"SHIPPING_FEE"==model.applyType&&(model.shippingFeeType=$(this.selectors.selectShippingFee).val())}},ajax:function(url,method,data){var config={url:url,type:method,cache:!1,contentType:"application/json"};return"GET"!==method&&"get"!=method?(config.data=JSON.stringify(data),config.dataType="json"):config.data=data,$.ajax(config)}},ACC.customerProfile={_autoload:["init"],init:function(){this.initEventListener(),$(document).on("click","#acc_sendVerificationEmail",function(e){e.preventDefault();var dataString="verificationEmail="+$("#acc_pu_verficationEmail").text();$.ajax({url:ACC.config.encodedContextPath+"/my-account/verify-profile-email",type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:dataString,success:function(response){"success"==response&&($(this).attr("href","#modal-cpp-2"),$(this).click())}})}),$(document).on("click","#acc_sendOtpMessage",function(e){e.preventDefault();var phone=$("#acc_phone").html(),dataForSend={username:phone,type:ACC.config.otpRequestType.SIGNIN_VERIFY_PHONE};ACC.otp.sendADROTP(dataForSend,ACC.otp.func.signInUp).then(function(response){ACC.adrOtpPopup.showInSuccess({phone:phone,ignoreRightPanel:!0},ACC.customerProfile.handleConfirmOtp)},function(jqXHR){ACC.adrOtpPopup.showInError({phone:phone,ignoreRightPanel:!0},jqXHR.responseJSON.message,ACC.customerProfile.handleConfirmOtp)})}),$(document).on("focusout","#acc_profile_phone_update_text",function(e){e.preventDefault(),ACC.customerProfile.sendEmailPhoneValidation()}),$(document).on("focusout","#acc_profile_email_update_text",function(e){e.preventDefault(),ACC.customerProfile.sendEmailPhoneValidation()}),$(document).ready(function(e){$(".number-only").keypress(function(e){if(isNaN(this.value+""+String.fromCharCode(e.charCode)))return!1})})},sendEmailPhoneValidation:function(){var email=$("#acc_profile_email_update_text").val(),phone=$("#acc_profile_phone_update_text").val(),dataString={email:email,phone:phone};$.ajax({url:ACC.config.encodedContextPath+"/my-account/profile/validate",type:"POST",contentType:"application/json; charset=UTF-8",data:JSON.stringify(dataString),success:function(response){var error=jQuery.parseJSON(response);$("#phone\\.errors").length?($("#acc_phone_error").text(""),$("#phone\\.errors").text(void 0!=error.phone?error.phone:"")):$("#acc_phone_error").text(void 0!=error.phone?error.phone:""),$("#email\\.errors").length?($("#acc_email_error").text(""),$("#email\\.errors").text(void 0!=error.email?error.email:"")):$("#acc_email_error").text(void 0!=error.email?error.email:"")}})},handleConfirmOtp:function(phone,otpCode){var data=JSON.stringify({otpCode:otpCode,username:phone}),url=ACC.adrOtpPopup.attachCaptchaData(ACC.config.verifyLoginOTPUrl);$.postJSONCallback(url,data,function(result){ACC.adrOtpPopup.hide(),$("#acc_sendOtpMessage").hide()},function(jqXHR){ACC.adrOtpPopup.errorMsg.html(jqXHR.responseJSON.message),ACC.adrOtpPopup.successMsg.hide(),ACC.adrOtpPopup.resetCaptCha()})},initEventListener:function(){$(".js-toggle-profile-menu").on("click",function(event){event.stopPropagation(),$(".section__sidebar-profile").toggleClass("open")}),$(document).click(function(e){var container=$(".section__sidebar-profile");container.is(e.target)||0!==container.has(e.target).length||container.removeClass("open")})}},ACC.adrBrandMerchant={_autoload:[["initNav",$(".menu__section-brand-merchant").length>0],["initNavBrandHeader",$(".js-navbar-brand").length>0]],initNav:function(){var _this=this;$("body").width()>=parseInt(screenSm)?_this.calculateNav():$("#js-menu-brand-merchant").addClass("calculated"),0===$(".js-brand-nav .brand_nav-item").length?$(".menu__section-brand-merchant").addClass("hidden"):$(".menu__section-brand-merchant").removeClass("hidden"),ACC.adrBrandMerchant.calculateBranNavScreensize(),$(window).bind("resize",function(){$(".brand_nav-item").removeClass("hidden"),$(".js-brand-nav_more ul.dropdown-menu").contents().remove(),ACC.adrBrandMerchant.calculateBranNavScreensize()})},initNavBrandHeader:function(){var mediaQuery=_.template("screen and (max-width: <%= size %>)")({size:"1024px"}),$navBrand=$(".js-navbar-brand"),navBrandFunc={enter:function(){$navBrand.find("span").css({overflow:"visible",display:"block"}),$navBrand.addClass("is-active")},leave:function(){$navBrand.find("span").css({overflow:"hidden",display:"inline-block"}),$navBrand.removeClass("is-active")},interact:function(e){var $dom=$(e.target).closest(".js-navbar-brand");1!==$dom.length?navBrandFunc.leave():$dom.hasClass("is-active")?navBrandFunc.leave():navBrandFunc.enter()},forget:function(e){1!==$(e.target).closest(".js-navbar-brand").length&&navBrandFunc.leave()}};enquire.register(mediaQuery,{match:function(){$(document).bind("click touchstart",navBrandFunc.interact),$(document).bind("touchmove",navBrandFunc.forget)},unmatch:function(){$(document).unbind("click touchstart",navBrandFunc.interact),$(document).unbind("touchmove",navBrandFunc.forget)}})},calculateNav:function(){var $nav,$dropDown,navWidth,$parent=$("#js-menu-brand-merchant"),tmpWidth=0;$nav=$parent.find(".navbar-main"),$dropDown=$parent.find(".navbar-more li.dropdown .dropdown-menu"),$dropDown.find("> li").appendTo($nav),$navItems=$nav.find("> li"),navWidth=$nav.width(),$navItems.each(function(){var w,$item=$(this);w=$item.outerWidth(),(tmpWidth+=w)>=navWidth&&$item.prependTo($dropDown)}),$parent.addClass("calculated")},calculateBranNavScreensize:function(){var $brandNav;if($brandNav=$(".js-brand-nav"),$brandNav.height()>70){var $lastnav=$brandNav.find("li.brand_nav-item:visible:last");return $lastnav.clone().prependTo(".js-brand-nav_more ul.dropdown-menu"),$lastnav.addClass("hidden"),ACC.adrBrandMerchant.calculateBranNavScreensize()}$(".js-brand-nav_more ul.dropdown-menu li").length<1?$(".js-brand-nav_more").addClass("hidden"):$(".js-brand-nav_more").removeClass("hidden")}},ACC.vinidDetail={_autoload:["bindRegisterVinId","bindConnectVinId","submitConnectVinId","verifyADROTP","resendADROTP","autoFocusOnShow"],formData:{connectVinCardForm:"#js-profile-connect-vincard-form",connectVinCardBtn:".js-profile-connect-vincard-btn",registerVinCardBtn:".js-profile-register-vincard-btn",vinCardNumberInput:".js-profile-connect-vincard-number",vinCardNumberHidden:".js-profile-hidden-otp-vinid",connectVinCardPopup:".js-profile-connect-vincard-popup",errorMessage:"p.error-message",verifyVinOtpForm:"#js-profile-verify-otp-form",vinOtpInput:".js-profile-otp-input",profileUsername:".js-profile-username",resendVinOtp:".js-profile-otp-resend",verifyVinOtpPopup:".js-profile-otp-popup",phoneCryptLabel:".js-profile-phone-otp",sendOtpNotify:".js-profile-otp-notify",vinidCardErrorPopup:"#js-profile-vinid_card_error",orderCodeHidden:"#js-order-code-hidden",vinIdEncriptLabel:"#js-vinid-number-hidden",rewardPointLabel:"#js-reward-point-otp",blockHidden:"#js-reward-otp-hidden"},autoFocusOnShow:function(){$(ACC.vinidDetail.formData.connectVinCardPopup).on("shown.bs.modal",function(e){$(e.currentTarget).find("form").find(":text,:radio,:checkbox,select,textarea").each(function(){this.readOnly||this.disabled||this.focus()})})},bindRegisterVinId:function(){$(ACC.vinidDetail.formData.registerVinCardBtn).click(function(event){ACC.suggestvinid.showRegisterVinIdPopup()})},bindConnectVinId:function(){$(".js-profile-connect-vincard-btn").click(function(event){event.preventDefault(),ACC.vinidDetail.showPopupConnectVinId()})},submitConnectVinId:function(){$(ACC.vinidDetail.formData.connectVinCardForm).submit(function(event){event.preventDefault(),$.blockUI();var formData={vinId:$(ACC.vinidDetail.formData.vinCardNumberInput).val(),orderCode:$(ACC.vinidDetail.formData.orderCodeHidden).val()};$.ajax({url:ACC.config.connectVinIDWithoutCaptchaUrl,type:"post",data:JSON.stringify(formData),dataType:"json",contentType:"application/json; charset=utf-8",success:function(result){result.page&&"VIN_CARD_ERROR"===result.page?(ACC.vinidDetail.hideConnectVinIdPopup(),ACC.vinidDetail.showVinCardErrorPopup()):(ACC.vinidDetail.sendADROTP(result.vinId),ACC.vinidDetail.hideConnectVinIdPopup(),ACC.vinidDetail.showPopupVerifyADROTP(result),$(ACC.vinidDetail.formData.vinCardNumberHidden).val(result.vinId)),$.unblockUI()},error:function(error,textStatus,errorThrown){if($.unblockUI(),error.responseJSON){var errorMsg="";if(void 0!=error.responseJSON.errorMessage){errorMsg=JSON.parse(error.responseJSON.errorMessage).vinid}else errorMsg=error.responseJSON.message;$(ACC.vinidDetail.formData.connectVinCardPopup).find(ACC.vinidDetail.formData.errorMessage).text(errorMsg)}}})})},verifyADROTP:function(){$(ACC.vinidDetail.formData.verifyVinOtpForm).submit(function(event){event.preventDefault(),$.blockUI();var otpCode=$(ACC.vinidDetail.formData.vinOtpInput).val(),username=$(ACC.vinidDetail.formData.profileUsername).val(),vinId=$(ACC.vinidDetail.formData.vinCardNumberHidden).val(),formData={otpCode:otpCode,vinId:vinId,username:username},url=ACC.config.verifyOTPADRFromProfile+"?g-recaptcha-response="+ACC.captcha.getResponse("js-profile-vinid-otp-captcha");ACC.otp.verifyAndMapADROTPFromProfile(formData,url).then(function(response){ACC.vinidDetail.hideVerifyADROTPPopup(),$.unblockUI(),location.reload()},function(error){$.unblockUI(),error.responseJSON&&ACC.vinidDetail.addErrorMessageToField($(ACC.vinidDetail.formData.vinOtpInput),error.responseJSON.message),ACC.captcha.reset("js-profile-vinid-otp-captcha")})})},resendADROTP:function(){$(ACC.vinidDetail.formData.resendVinOtp).click(function(event){var vinId=$(ACC.vinidDetail.formData.vinCardNumberHidden).val();ACC.vinidDetail.resetForm($(ACC.vinidDetail.formData.verifyVinOtpForm)),ACC.vinidDetail.sendADROTP(vinId,!0)})},sendADROTP:function(vinId,isResend){$.blockUI(),$(ACC.vinidDetail.formData.sendOtpNotify).attr("style","display:none");var data={vinId:vinId,type:ACC.config.otpRequestType.SIGNIN_MAPPING_VINID_TO_ADR};isResend&&(data.resend=!0),ACC.otp.sendADROTP(data,ACC.otp.func.signInUp).then(function(response){$.unblockUI(),isResend&&$(ACC.vinidDetail.formData.sendOtpNotify).attr("style","display:block")},function(error){$.unblockUI(),error.responseJSON&&(ACC.suggestvinid.addErrorMessageToField($(ACC.vinidDetail.formData.vinOtpInput),error.responseJSON.message),$(ACC.vinidDetail.formData.sendOtpNotify).attr("style","display:none"))})},closeConnectVinPopUp:function(){event.preventDefault(),$(".js-profile-connect-vincard-popup .close").click(function(event){ACC.vinidDetail.hideConnectVinIdPopup()})},closeVerifyOTPPopUp:function(){event.preventDefault(),$(".js-profile-otp-popup .close").click(function(event){ACC.vinidDetail.hideVerifyADROTPPopup()})},showPopupConnectVinId:function(){this.resetForm($(ACC.vinidDetail.formData.connectVinCardForm)),$(ACC.vinidDetail.formData.connectVinCardPopup).modal("show")},showPopupVerifyADROTP:function(result){$(ACC.vinidDetail.formData.phoneCryptLabel).text(result.phoneEncrypt),$(ACC.vinidDetail.formData.vinIdEncriptLabel).text(result.vinIdEncrypt),result.rewardPoint?($(ACC.vinidDetail.formData.blockHidden).show(),$(ACC.vinidDetail.formData.rewardPointLabel).text(result.rewardPoint)):$(ACC.vinidDetail.formData.blockHidden).hide(),this.resetForm($(ACC.vinidDetail.formData.verifyVinOtpForm)),ACC.captcha.renderWidget("js-profile-vinid-otp-captcha"),$(ACC.vinidDetail.formData.verifyVinOtpPopup).modal("show")},showVinCardErrorPopup:function(){$(ACC.vinidDetail.formData.vinidCardErrorPopup).modal("show")},hideVerifyADROTPPopup:function(){$(ACC.vinidDetail.formData.verifyVinOtpPopup).modal("hide")},hideConnectVinIdPopup:function(){$(ACC.vinidDetail.formData.connectVinCardPopup).modal("hide")},addErrorMessageToField:function(fieldGroup,error){var parentElement=fieldGroup.parent(),errorContainer=parentElement.find(ACC.vinidDetail.formData.errorMessage);"OK"===error?errorContainer.text(""):errorContainer.text(error)},resetForm:function($form){$form.find(".error-message").html(""),$form.resetForm()}},ACC.adrExpandCollapse={_autoload:[["init",$(".js-height-toggle").length>0],["productDescriptionToggle",$(".js-height-toggle-description").length>0]],init:function(){$(".js-height-toggle").each(function(){var $content,$toggle,$expand,$collapse,maxHeight,itemHeight,total,item,$item=$(this);$content=$item.find('[data-role="content"]'),$toggle=$item.find('[data-role="toggle"]'),$expand=$item.find('[data-role="expand"]'),$collapse=$item.find('[data-role="collapse"]'),item=$content.attr("data-item"),total=parseFloat($content.attr("data-total"))||5,itemHeight=item?$(item).eq(0).height():parseFloat($content.attr("data-item-height"))||0,maxHeight=itemHeight*total,$content.height()>maxHeight&&($toggle.show(),$content.css({"max-height":maxHeight,overflow:"hidden"}),$item.css("max-height","none"),$collapse.hide()),$expand.on("click",function(event){event.preventDefault(),$content.css({"max-height":"none"}),$collapse.show(),$expand.hide()}),$collapse.on("click",function(event){event.preventDefault(),$content.css({"max-height":maxHeight,overflow:"hidden"}),$expand.show(),$collapse.hide()})})},productDescriptionToggle:function(){for(var index,$item=$(".js-height-toggle-description"),length=$item.find(".short-des__content ul li").length,counttmp=0,i=0;i<length;i++)if((counttmp+=$item.find(".short-des__content ul li").eq(i).height())>=120){index=i;break}for(var count=100,j=0;j<index;j++)count+=5;$item.find(".short-des__expand").on("click",function(){$item.find(".short-des__content").height("auto"),$item.find(".short-des__expand").hide(),$item.find(".short-des__collapse").show()}),$item.find(".short-des__collapse").on("click",function(){$item.find(".short-des__content").height(count),$item.find(".short-des__expand").show(),$item.find(".short-des__collapse").hide()});var initToggle=function(){$item.find(".short-des__content").height()>120?($item.find(".short-des__content").height(count),$item.find(".short-des__expand").show(),$item.find(".short-des__collapse").hide()):$item.find(".short-des__toggle").hide()};initToggle(),$("window").on("resize",function(){initToggle()})}},ACC.adrProductDetail={_autoload:["initGalleryDataByJson",["init",$(".product-detail__section").length>0],["initMenuDetail",$(".js-menu-detail_swiper").length>0],["initVoucher",$(".product-detail__section.product-detail__deal").length>0],["viewMoreReviewComment",$(".js-view-more-review").length>0],["initDatePicker",$(".datepicker").length>0],["bindDisplayWithNoPrice",$(".product-detail__section").length>0],["bindTimeCountDown",$(".properties-list-info-deal, .deal-expiration-date-text").length>0],["bindNicescrollManyCities",$(".js-properties-list__city").length>0],["unblockAddToCart",$("#addToCartButton").length>0],["bindCautionPopup",$(".pageType-CategoryPage, .page-search, .pageType-ProductPage").length>0]],init:function(){var _this=this;if(_this.DOM={$stickyHeader:$(".js-product-detail__sticky-header"),$message:$(".js-location-message"),$mapList:$(".js-map-address")},_this.initPopover(),_this.initSpecification(),_this.initIframeInDetail(),_this.initProductReference(),_this.DOM.$stickyHeader.length>0&&_this.initStickyHeader(),_this.bindFocusRatingComment(),_this.initMap(),$(".js-view-merchant").on("click",function(event){event.preventDefault();var target,offset,$this=$(this);target=$this.attr("data-target"),(offset=$(target).offset())&&$("html, body").animate({scrollTop:offset.top})}),$(".js-product-suggestion-btn").on("click",function(event){event.preventDefault(),$(".js-product-suggestion-container").addClass("show-all")}),$("#showAllMerchants").on("click",function(event){$(".adr-table-row.order-item.adr-order-hidden").toggleClass("hidden"),event.preventDefault(),event.stopPropagation();var showallMsg=$(this).data("showall-message"),collapseMsg=$(this).data("collapse-message"),curMsg=$(this).text(),nextMsg=curMsg===showallMsg?collapseMsg:showallMsg;$(this).text(nextMsg)}),$("#showAllMerchantsMiniBuyBox").on("click",function(event){$(".mini-buy-box-adr-order-hidden").toggleClass("hidden"),$(".mini-buy-box-adr-order-hidden").hasClass("hidden")?$(".btn-expand .caret").removeClass("expand"):$(".btn-expand .caret").addClass("expand"),event.preventDefault(),event.stopPropagation()}),$(".js-map-address li:nth-child(1)").addClass("active"),$(".js-map-address li a").click(function(){$(this).parent().addClass("active").siblings().removeClass("active")}),$(".product-detail__variants").length>0&&$(".product-detail__variants").eq(0).attr("id","productVariants"),$(".swiper-button-disabled").removeClass("swiper-button-disabled"),this.initMessage(),$('input[name="srcIframeMap"]').length>0){var params=$("#mapAddressSection").find('input[name="srcIframeMap"]:first').val(),latitude=$("#mapAddressSection").find('input[name="latitude"]:first').val(),longitude=$("#mapAddressSection").find('input[name="longitude"]:first').val();if(""!=latitude&&""!=longitude)_this.loadGoogleMapByCoordinates([$(".map-google-section-desktop"),$("#mapAddressSection").find(".map-google-section-mobile:first")],latitude,longitude);else{var ifrmElement=_this.createIframeGoogleMap(params);$(".map-google-section-desktop").append(ifrmElement),$("#mapAddressSection").find(".map-google-section-mobile:first").append(ifrmElement)}$("#mapAddressSection").getNiceScroll().resize(),$(document).on("click",".redemption-location-item",function(event){_this.toogleDisplayGoogleMap(this);var googleMap4Desktop=$(".map-google-section-desktop"),googleMap4Mobile=$(this).next();googleMap4Desktop.empty(),googleMap4Mobile.empty();var $parent=$(this).parent(),params=$parent.find('input[name="srcIframeMap"]:first').val(),latitude=$parent.find('input[name="latitude"]:first').val(),longitude=$parent.find('input[name="longitude"]:first').val();""!=latitude&&""!=longitude?_this.loadGoogleMapByCoordinates([googleMap4Desktop,googleMap4Mobile],latitude,longitude):(googleMap4Desktop.append(_this.createIframeGoogleMap(params)),googleMap4Mobile.append(_this.createIframeGoogleMap(params))),event.preventDefault(),event.stopPropagation()})}$("#product-detail__similar-product").length>0&&$(".status-no-stock").click(function(){$("html, body").animate({scrollTop:$("#product-detail__similar-product").offset().top-80},"slow")})},initVoucher:function(){var _this=this;$(document).on("change","#pdpStartReferredDate",function(){var value=$(this).val();$(this).parents(".addtocart-component").find("#addToCartForm").find(".js-startdate-referred-input").val(value)}),$(document).on("change","#pdpEndReferredDate",function(){var value=$(this).val();$(this).parents(".addtocart-component").find("#addToCartForm").find(".js-enddate-referred-input").val(value)}),_this.initAddToCartValidation()},initIframeInDetail:function(){$(".detail__info iframe").wrap('<div class="video-container"></div>')},initMessage:function(){var _this=this;_this.DOM.$message.length>0&&($(document).on("click",function(){_this.DOM.$message.fadeOut()}),$(window).on("load",function(){setTimeout(function(){_this.DOM.$message.fadeOut()},3e3)}))},initMap:function(){var niceScrollOpts,_this=this,$domMapAddress=$(".js-map-address");niceScrollOpts={cursorwidth:"6px",cursorborderradius:"0",cursorborder:"1px solid transparent",cursorcolor:"#666",autohidemode:!1,background:"#d8d8d8",horizrailenabled:!1,disablemutationobserver:!0,railpadding:{top:1,right:1,left:1,bottom:1}},$domMapAddress.length>0&&$domMapAddress.find("li").length>0&&$domMapAddress.niceScroll(niceScrollOpts),$("body").width()<parseInt(screenSm)&&enquire.register("(max-width: 768px)",{match:function(){$domMapAddress.getNiceScroll().resize(),$(".map-address__address-item, .redemption-location-item").addClass("is-xs")},unmatch:function(){$(".map-address__address-item, .redemption-location-item").removeClass("is-xs")},setup:function(){},deferSetup:!0}),_this.DOM.$mapList.length>0&&_this.DOM.$mapList.find("li").length>0&&$(document).on("click",".map-address__address-item",function(event){_this.toogleDisplayGoogleMap(this);var googleMap4Desktop=$(".map-google-popup-desktop"),googleMap4Mobile=$(this).next();googleMap4Desktop.empty(),googleMap4Mobile.empty()
;var $parent=$(this).parent(),params=$parent.find('input[name="srcIframeMap"]:first').val(),latitude=$parent.find('input[name="latitude"]:first').val(),longitude=$parent.find('input[name="longitude"]:first').val();""!=latitude&&""!=longitude?_this.loadGoogleMapByCoordinates([googleMap4Desktop,googleMap4Mobile],latitude,longitude):(googleMap4Desktop.append(_this.createIframeGoogleMap(params)),googleMap4Mobile.append(_this.createIframeGoogleMap(params))),event.preventDefault(),event.stopPropagation()}),$("#redemptionLocations").on("shown.bs.modal",function(){var latitude=$("#mapAddressPopup").find('input[name="latitude"]:first').val(),longitude=$("#mapAddressPopup").find('input[name="longitude"]:first').val();if(""!=latitude&&""!=longitude)_this.loadGoogleMapByCoordinates([$(".map-google-popup-desktop"),$("#mapAddressPopup").find(".map-google-popup-mobile:first")],latitude,longitude);else{var params=$("#mapAddressPopup").find('input[name="srcIframeMap"]:first').val(),ifrmElement=_this.createIframeGoogleMap(params);$(".map-google-popup-desktop").append(ifrmElement),$("#mapAddressPopup").find(".map-google-popup-mobile:first").append(ifrmElement)}$("#mapAddressPopup").getNiceScroll().resize()})},loadGoogleMapByCoordinates:function(elementArray,latitude,longitude){$.each(elementArray,function(index,mapItem){var uluru={lat:Number(latitude),lng:Number(longitude)},map=new google.maps.Map(mapItem.get(0),{zoom:15,center:uluru});new google.maps.Marker({position:uluru,map:map});mapItem.find("iframe").attr("src",""),mapItem.find("iframe").hide()})},createIframeGoogleMap:function(src){var iframe=document.createElement("iframe");return iframe.width="100%",iframe.height="370",iframe.frameborder="0",iframe.style="border: 0",iframe.allowfullscreen="true",iframe.src=src,iframe},toogleDisplayGoogleMap:function(element){if($(element).attr("class").indexOf("is-xs")>0){$(element).not($(element)).removeClass("is-map-show"),$(element).toggleClass("is-map-show"),$(".map-google").addClass("hidden"),$(element).hasClass("is-map-show")&&$(element).next(".map-google").removeClass("hidden"),$(".js-map-address").getNiceScroll().resize()}},initStickyHeader:function(){var _this=this;if($("body").width()<parseInt(screenSm))return!1;$(window).on("scroll",function(){var scrollTop=$(this).scrollTop();$("#place-show__sticky").offset().top-60<=scrollTop?_this.DOM.$stickyHeader.addClass("sticky slideInDown"):_this.DOM.$stickyHeader.removeClass("sticky slideInDown")}).trigger("scroll")},initTheatreImage:function(){$("#modal-theatre-image").on("shown.bs.modal",function(){var $swiper,$list,swiper,$this=$(this);$swiper=$this.find(".js-theatre-image__swiper"),$list=$this.find(".js-theatre-image__list");var listSwiperOpts,mediaQuery,handle;listSwiperOpts={direction:"vertical",slidesPerView:"auto",spaceBetween:8,autoHeight:!0,mousewheelControl:!0,mousewheelForceToAxis:!0,mousewheelReleaseOnEdges:!0,mousewheelInvert:!0,scrollbar:".swiper-scrollbar",scrollbarHide:!1,scrollbarDraggable:!0,scrollbarSnapOnRelease:!0},swiper=$swiper.swiper({}),$list.swiper(),mediaQuery={tablet:_.template("screen and (min-width: <%= size %>)")({size:screenSmMin}),mobile:_.template("screen and (max-width: <%= size %>)")({size:screenXsMax})},handle={tablet:function(){$swiper[0].swiper.destroy(!1,!0),swiper=$swiper.swiper({keyboardControl:!0}),$list[0].swiper.destroy(!1,!0),$list.swiper(listSwiperOpts)},mobile:function(){$swiper[0].swiper.destroy(!1,!0),swiper=$swiper.swiper(),$list[0].swiper.destroy(!1,!0),listSwiperOpts.direction="horizontal",$list.swiper(listSwiperOpts)}},enquire.register(mediaQuery.tablet,{match:function(){handle.tablet()},unmatch:function(){handle.mobile()}}),enquire.register(mediaQuery.mobile,{match:function(){handle.mobile()},unmatch:function(){handle.tablet()}}),swiper.on("slideChangeEnd",function(w){var swiperIndex,listIndex,$listEl;$list.find(".theatre-image__list-item").removeClass("active"),swiperIndex=$(w.slides[w.activeIndex]).find(".theatre-image__stage-item").attr("data-index"),$listEl=$list.find('.theatre-image__list-item[data-index="'+swiperIndex+'"]'),listIndex=$listEl.parent().index(),$listEl.addClass("active"),$list[0].swiper.slideTo(listIndex)}),$list.find(".theatre-image__list-item").removeClass("active"),$list.find('.theatre-image__list-item[data-type="image"]').first().addClass("active"),$list.find(".theatre-image__list-item").on("click",function(event){event.preventDefault();var listIndex,swiperIndex;listIndex=$(this).attr("data-index"),swiperIndex=$swiper.find('.theatre-image__stage-item[data-index="'+listIndex+'"]').parent().index(),swiper.slideTo(parseInt(swiperIndex))}),$swiper.find(".swiper-button-next").off("click").on("click",function(event){event.preventDefault(),swiper.slideNext()}),$swiper.find(".swiper-button-prev").off("click").on("click",function(event){event.preventDefault(),swiper.slidePrev()})})},initMenuDetail:function(){var menuDetail,menuDetailModal;menuDetailModal="#modal-cpp-menu-details-images-info",$(menuDetailModal).on("shown.bs.modal",function(){menuDetail=new Swiper(".js-menu-detail_swiper",{autoHeight:!0,slidesPerView:1,nextButton:"#modal-cpp-menu-details-images-info .swiper-button-next",prevButton:"#modal-cpp-menu-details-images-info .swiper-button-prev",spaceBetween:0})})},initAddToCartValidation:function(){$(document).on("click","#addToCartButton",function(e){e.preventDefault(),ACC.adrProductDetail.sendCartValidation($(this))})},initDatePicker:function(){var startDateDom,endDateDom;$(".input-range").length>0&&$(".input-range").each(function(){var drpDomData,drpFormat,drpStartDate,drpEndDate,dateRangePickerOptions;drpDomData={format:$(this).attr("data-datepicker-format"),currentDate:$(this).attr("data-datepicker-current-date"),startDate:$(this).attr("data-datepicker-start-date"),endDate:$(this).attr("data-datepicker-end-date")},drpFormat="dd/mm/yyyy",drpStartDate=drpDomData.currentDate,drpEndDate="",_.isEmpty(drpDomData.format)||(drpFormat=drpDomData.format),!_.isEmpty(drpDomData.startDate)&&$.datepicker.parseDate("dd/mm/yy",drpDomData.startDate)>$.datepicker.parseDate("dd/mm/yy",drpDomData.currentDate)&&(drpStartDate=drpDomData.startDate),_.isEmpty(drpDomData.endDate)||(drpEndDate=drpDomData.endDate),dateRangePickerOptions={format:drpFormat,language:"vi",inputs:$(".datepicker"),startDate:drpStartDate,templates:{leftArrow:"&#60;",rightArrow:"&#62;"}},_.isEmpty(drpEndDate)||(dateRangePickerOptions.endDate=drpEndDate),$(".input-range").datepicker(dateRangePickerOptions)}),$(".datepicker").each(function(){var dataPickerOptions,nowDate,currentDate,startDate,endDate;nowDate=new Date,new Date(nowDate.getFullYear(),nowDate.getMonth(),nowDate.getDate(),0,0,0,0),currentDate=$(this).attr("data-current-date"),startDate=$(this).attr("data-start-date"),endDate=$(this).attr("data-end-date"),void 0!==endDate&&""!==endDate&&$.datepicker.parseDate("dd/mm/yy",currentDate)>$.datepicker.parseDate("dd/mm/yy",endDate)&&$(this).closest(".product-detail__deal-col").remove(),dataPickerOptions={format:"dd/mm/yyyy",language:"vi",autoclose:!1,templates:{leftArrow:"&#60;",rightArrow:"&#62;"}},(void 0===startDate||$.datepicker.parseDate("dd/mm/yy",currentDate)>$.datepicker.parseDate("dd/mm/yy",startDate))&&(startDate=currentDate),dataPickerOptions.startDate=startDate,void 0!==endDate&&(dataPickerOptions.endDate=endDate),$(this).datepicker(dataPickerOptions)}),startDateDom=".datepicker.startdate",endDateDom=".datepicker.enddate ";var $addToCartComponent=$(startDateDom).parents(".addtocart-component"),$addToCartBtn=$addToCartComponent.find("#addToCartButton");$(startDateDom).datepicker().on("changeDate",function(e){if(null!==$(this).datepicker("getDate")){$(this).datepicker("hide"),$(endDateDom).datepicker("setStartDate",e.date);var startDateVal=$(startDateDom).datepicker("getDate"),endDateVal=$(endDateDom).datepicker("getDate");null===endDateVal&&($(endDateDom).datepicker("clearDates"),$(endDateDom).datepicker("update"),$(endDateDom).datepicker("show"),$addToCartBtn.addClass("disabled")),null!==startDateVal&&null!==endDateVal&&$addToCartBtn.removeClass("disabled")}}),$(startDateDom).datepicker().on("clearDate",function(e){var startDateVal=$(startDateDom).datepicker("getDate"),endDateVal=$(endDateDom).datepicker("getDate");$addToCartBtn.addClass("disabled"),$(startDateVal).datepicker("clearDates"),$(startDateVal).datepicker("show"),null===startDateVal&&null===endDateVal&&$addToCartBtn.removeClass("disabled")}),$(endDateDom).datepicker().on("changeDate",function(e){if(null!==$(this).datepicker("getDate")){$(endDateDom).datepicker("hide");var startDateVal=$(startDateDom).datepicker("getDate"),endDateVal=$(endDateDom).datepicker("getDate");null!==startDateVal&&null!==endDateVal&&$addToCartBtn.removeClass("disabled")}}),$(endDateDom).datepicker().on("clearDate",function(e){console.log(startDateVal,endDateVal);var startDateVal=$(startDateDom).datepicker("getDate"),endDateVal=$(endDateDom).datepicker("getDate");$addToCartBtn.addClass("disabled"),$(endDateVal).datepicker("clearDates"),$(endDateVal).datepicker("show"),null===startDateVal&&null===endDateVal&&$addToCartBtn.removeClass("disabled")})},sendCartValidation:function(self){if($("#startReferredDateStr").length>0){var code=$("input[name*='productCodePost']").val(),startDate=$("#startReferredDateStr").val(),endDate=$("#endReferredDateStr").val(),dataString={productCode:code,startReferredDateStr:startDate,endReferredDateStr:endDate};$.ajax({url:ACC.config.encodedContextPath+"/cart/validate",type:"POST",contentType:"application/json; charset=UTF-8",data:JSON.stringify(dataString),dataType:"json",success:function(response){if("OK"==response.status)$("#addtocartErrorMsg").text(""),$(".addtocartErrorMsg").addClass("hidden");else{var errors=response.fieldValidations;void 0!=errors&&($(".addtocartErrorMsg").removeClass("hidden"),$("#addtocartErrorMsg").text(errors.startReferredDate))}}})}},initProductReference:function(){0==$("#count-product-together").children().size()&&$("#product-detail__together-viewed").hide(),0==$("#count-product-together-mobile").children().size()&&$("#product-detail__together-viewed-mobile").hide()},initSpecification:function(){$("#allClassificationAtrrModal").on("shown.bs.modal",function(){if($("body").width()<parseInt(screenSm))return!1;var instance,$scroll=$(this).find("#js-product-detail__specs");instance=$scroll.getNiceScroll(),instance&&instance[0]?instance.resize():$scroll.niceScroll({cursorwidth:"5px",cursorborderradius:"0",cursorborder:"1px solid transparent",cursorcolor:"#cc2023",autohidemode:!1,background:"#d8d8d8",horizrailenabled:!1,disablemutationobserver:!0,railpadding:{top:1,right:1,left:1,bottom:1}})}),$("#allClassificationAtrrModal").blur(function(){$(this).modal()})},initPopover:function(){$('.product-detail__section [data-toggle="popover"]').popover({trigger:"manual",container:"body",animation:!0,viewport:{selector:".product-detail__section > .container",padding:20},html:!0,content:function(){var target,$this=$(this);return target=$this.attr("data-target"),target?$(target).html():$this.attr("data-content")}}).on("click",function(e){e.preventDefault()}).on("mouseenter",function(){var _this=this;$(this).popover("show"),$(".popover").on("mouseleave",function(){$(_this).popover("hide")})}).on("mouseleave",function(){var _this=this;setTimeout(function(){$(".popover:hover").length||$(_this).popover("hide")},100)})},initLocation:function(){$('.product-detail__sidebar__location-checker select[name="city"]').selectize({onChange:function(value){this.$dropdown_content.find(".current").removeClass("current"),this.$dropdown_content.find('[data-value="'+value+'"]').addClass("current")}}),$('.product-detail__sidebar__location-checker select[name="district_only"]').selectize({plugins:["restore_on_backspace"],onInitialize:function(){this.$dropdown.append('<div class="no-result"><a href="">Không có địa chỉ của bạn</a></div>')},onChange:function(value){this.$dropdown_content.find(".current").removeClass("current"),this.$dropdown_content.find('[data-value="'+value+'"]').addClass("current")}}),$('.product-detail__sidebar__location-checker select[name="district"]').selectize({plugins:["restore_on_backspace"],onInitialize:function(){this.$dropdown.append('<div class="no-result"><a href="">Không có địa chỉ của bạn</a></div>')},onChange:function(value){this.$dropdown_content.find(".current").removeClass("current"),this.$dropdown_content.find('[data-value="'+value+'"]').addClass("current")}}),$('.product-detail__sidebar__location-checker select[name="ward"]').selectize({plugins:["restore_on_backspace"],onInitialize:function(){this.$dropdown.append('<div class="no-result"><a href="">Không có địa chỉ của bạn</a></div>')}})},initGallery:function(){var $stage,zoom,$thumbs,$gallery=$(".js-product-detail__gallery"),width=$(".product-detail__info").width();if($stage=$gallery.find(".product-gallery__stage img.stage"),$thumbs=$gallery.find(".gallery-thumbnail__item"),$("body").width()<parseInt(screenMd))return $thumbs.on("click",function(){var img,$this=$(this);img=$this.attr("data-image"),$stage.attr({src:img,"data-image":img,"data-zoom-image":$this.attr("data-zoom-image")})}),!1;$stage.ezPlus({borderSize:1,borderColour:"#eee",zoomWindowPosition:1,zoomWindowOffsetx:16,easing:!1,zoomEnabled:!0,zoomWindowWidth:width,zoomWindowHeight:width}),zoom=$stage.data("ezPlus"),zoom.onImageSwap=function(){zoom.zoomEnabled=!1,$(".zoomContainer").hide()},zoom.onImageSwapComplete=zoom.onZoomedImageLoaded=function(){zoom.options.zoomEnabled=!0,$(".zoomContainer").show()},$thumbs.on("mouseenter",function(){var $thisItem=$(this);if(!$thisItem.hasClass("gallery-thumbnail__item-image"))return!1;switch($thisItem.addClass("active").siblings(".active").removeClass("active"),$thisItem.attr("data-type")){case"image":zoom.swaptheimage($thisItem.attr("data-image"),$thisItem.attr("data-zoom-image")),$stage.removeClass("hide")}})},viewMoreReviewComment:function(){var length,current,$reviewWrapper=$(".js-view-more-review"),next=15;$("body").on("click",".js-view-more-review .btn-view-more-review",function(){length=$reviewWrapper.find(".review-list").attr("data-totalReviews"),current=next,next=current+10,length<=next&&(next=length,$reviewWrapper.find(".btn-view-more-review").addClass("hidden"));for(var j=current;j<next;j++)$reviewWrapper.find(".product-comment__item").eq(j).removeClass("hidden");$(".js-ratingCalc").each(function(){var rating=$(this).data("rating");$(this).find(".js-greenStars").width($(this).width()*(parseFloat(rating.rating,10)/rating.total))})})},bindFocusRatingComment:function(){$(document).on("click","#js-focus-ratingbox",function(e){$("html, body").animate({scrollTop:$("#reviewComment").offset().top-190},500),$("#reviewComment").focus()})},initGalleryDataByJson:function(){if("undefined"!=typeof productJsonMedias&&productJsonMedias.length>0){var stageImageIndex;if(stageImageIndex=0,productJsonMedias.length>0){for(var i=0;i<productJsonMedias.length;i++)if("image"===productJsonMedias[i].type.toLowerCase()){stageImageIndex=i;break}$(".product-gallery__stage").append(ACC.adrProductDetail.markupGalleryItem.stage_image(productJsonMedias[stageImageIndex]))}for(var i=0;i<productJsonMedias.length;i++){var swiperStageHtml,swiperListHtml;if(swiperStageHtml="",swiperListHtml="",i<4){var thumbHtml;thumbHtml='<div class="col-xs-2-5"><div class="gallery-thumbnail__item-wrapper">',"image"===productJsonMedias[i].type.toLowerCase()&&(thumbHtml+=ACC.adrProductDetail.markupGalleryItem.thumb_image(productJsonMedias[i])),"video"===productJsonMedias[i].type.toLowerCase()&&(thumbHtml+=ACC.adrProductDetail.markupGalleryItem.thumb_video(productJsonMedias[i])),thumbHtml+="</div></div>",$(".product-gallery__thumbnail .row").append(thumbHtml)}"image"===productJsonMedias[i].type.toLowerCase()&&(swiperStageHtml+=ACC.adrProductDetail.markupGalleryItem.swiper_stage(productJsonMedias[i],i)),swiperListHtml+=ACC.adrProductDetail.markupGalleryItem.swiper_list(productJsonMedias[i],i),$(".js-theatre-image__swiper .swiper-wrapper").append(swiperStageHtml),$(".js-theatre-image__list .swiper-wrapper").append(swiperListHtml)}if(productJsonMedias.length>5)$(".product-gallery__thumbnail .row").append(ACC.adrProductDetail.markupGalleryItem.thumb_more(productJsonMedias[4])),$(".js-gallery-thumbnail__count").text("+"+(productJsonMedias.length-4));else if(void 0!==productJsonMedias[4]){var thumbHtml;thumbHtml='<div class="col-xs-2-5"><div class="gallery-thumbnail__item-wrapper">',"image"===productJsonMedias[4].type.toLowerCase()&&(thumbHtml+=ACC.adrProductDetail.markupGalleryItem.thumb_image(productJsonMedias[4])),"video"===productJsonMedias[4].type.toLowerCase()&&(thumbHtml+=ACC.adrProductDetail.markupGalleryItem.thumb_video(productJsonMedias[4])),thumbHtml+="</div></div>",$(".product-gallery__thumbnail .row").append(thumbHtml)}ACC.adrProductDetail.initGallery(),ACC.adrProductDetail.initTheatreImage(),ACC.adrProductDetail.initGalleryVideoItem()}},initGalleryVideoItem:function(){$("body").on("click",".gallery-thumbnail__item-video, .theatre-image__video-item",function(){var videoTitle,videoUrl,videoHtml;videoTitle=$(this).attr("data-title"),videoUrl=$(this).attr("data-url"),videoHtml="",videoHtml+=ACC.adrProductDetail.markupGalleryItem.popup_video(videoUrl),$("#modal-theatre-video .product-detail__theatre-title h1").html(videoTitle),$("#modal-theatre-video .product-detail__theatre-content").html(videoHtml),$("#modal-theatre-video").modal("show")}),$(".modal").on("hidden.bs.modal",function(){$("video").each(function(){$(this)[0].pause()})})},markupGalleryItem:{stage_image:function(data){var markup;return markup="",markup+='<img class="stage" src="'+data.zoomUrl+'" data-zoom-image="'+data.zoomUrl+'" data-image="'+data.zoomUrl+'">'},thumb_image:function(data){var markup;return markup="",markup+='<div class="gallery-thumbnail__item gallery-thumbnail__item-image" data-type="'+data.type.toLowerCase()+'" data-image="'+data.zoomUrl+'" data-zoom-image="'+data.zoomUrl+'"><img class="img-responsive" src="'+data.url+'" /></div>'},thumb_video:function(data){var markup;return markup="",markup+='<a class="gallery-thumbnail__item gallery-thumbnail__item-video" data-type="'+data.type.toLowerCase()+'" data-title="'+data.description+'" data-url="'+data.url+'"><div class="vertical-alignment-helper"><div class="vertical-align-center"><i class="adr-icon icon-play"></i></div></div></a>'},thumb_more:function(data){var markup;return markup="",markup+='<div class="col-xs-2-5 js-gallery-thumbnail__more"><div class="gallery-thumbnail__item-wrapper"><a class="gallery-thumbnail__item gallery-thumbnail__item-gallery" data-type="'+data.type.toLowerCase()+'"  data-title="'+data.description+'"  href="#modal-theatre-image" data-toggle="modal"> <img class="img-responsive" src="'+data.url+'"> <div class="gallery-thumbnail__mask"><div class="vertical-alignment-helper"><div class="vertical-align-center js-gallery-thumbnail__count"></div></div></div></a></div></div>'},swiper_stage:function(data,index){var markup,dataIndex;return markup="",dataIndex="","image"===data.type.toLowerCase()&&(dataIndex=' data-index="'+index+'"'),markup+='<div class="swiper-slide"><a class="theatre-image__stage-item" href="#" data-type="'+data.type.toLowerCase()+'" '+dataIndex+'><img class="img-responsive lazy" src="'+data.carouselUrl+'" alt=""></a></div>'},swiper_list:function(data,index){var markup,dataIndex;return markup="",dataIndex="","image"===data.type.toLowerCase()?(dataIndex=' data-index="'+index+'"',markup+='<div class="swiper-slide"><a class="theatre-image__list-item" data-type="'+data.type.toLowerCase()+'" href="#" '+dataIndex+'><img class="img-responsive lazy" width="92" src="'+data.carouselUrl+'" alt=""></a></div>'):markup+='<div class="swiper-slide"><a class="theatre-image__list-item theatre-image__video-item" data-type="'+data.type.toLowerCase()+'" data-title="'+data.description+'" data-url="'+data.url+'" href="#" '+dataIndex+'><i class="adr-icon icon-play"></i></a></div>',markup},popup_video:function(videoUrl){var markup;return markup="",void 0!==videoUrl&&videoUrl.length>0&&(markup+='<div class="embed-responsive embed-responsive-16by9"><video class="embed-responsive-item" controls width="640" height="360"><source src="'+videoUrl+'" type="video/mp4"/><p>Your browser does not support video tag</p></video></div>'),markup}},bindDisplayWithNoPrice:function(){var classNameList=".addtocart-component, .suggest__product,.variant-section, .product-detail__sidebar__merchant, .sticky-header__info-price";"true"===outofstockFlag?$(classNameList).addClass("hide"):$(classNameList).removeClass("hide")},bindTimeCountDown:function(){var exprDate=$("#expiryDate").val();$("#info-deal").countdown(exprDate,function(event){$(this).text(event.strftime("%D Ngày, %H:%M':%S''"))}),$(".deal-expiration-date-text").each(function(event){var $text=$(this),expirationDate=$text.prev("input:first").val();""!=expirationDate?$text.countdown(expirationDate,function(event){event.offset.totalDays>0?$(this).text(event.strftime("Còn %D ngày")):event.offset.hours>0||event.offset.minutes>0||event.offset.seconds>0?$(this).text(event.strftime("Còn %H:%M':%S''")):$(this).text("Còn 00 ngày")}):$(this).text("Còn 00 ngày")})},bindNicescrollManyCities:function(){var $listCities=$(".dropdown-menu .js-properties-list__city");$listCities.find("li").length>16&&$listCities.niceScroll({cursorwidth:"4px",cursorborder:"none",autohidemode:!1,cursorcolor:"#dddddd",disablemutationobserver:!0}),$(".dropdown-menu").mouseover(function(){$(this).show()})},unblockAddToCart:function(){$(window).load(function(){$("#addToCartButton").removeClass("disabled")})},checkCookiesModal:function(){var cookie_name=$(".modal-check").attr("id")+"_"+$(".modal-check").attr("name"),my_cookie=$.cookie(cookie_name);$("#popup-caution").length>0&&("true"===my_cookie||$("#popup-caution").modal({backdrop:"static",keyboard:!1})),$(".btn-caution-ok").on("click",function(e){return ACC.adrProductDetail.updateCookieValue(),!0}),$(".btn-caution-cancel").on("click",function(e){return!0})},updateCookieValue:function(){var $validCheck=$(".modal-check").prop("checked"),cookie_name=$(".modal-check").attr("id")+"_"+$(".modal-check").attr("name");$validCheck?$.cookie(cookie_name,!0,{path:"/",expires:1}):$.cookie(cookie_name,!1,{path:"/",expires:1})},bindCautionPopup:function(){ACC.adrProductDetail.checkCookiesModal()}},ACC.giftcoderedeem={isInitPopover:!1,_config:{element:{giftcodeValue:"#js-giftcode-input",giftcodeSuccessPopup:".js-giftcode-success",giftcodeErrorMessage:".js-giftcode-error",giftcodeErrorPopup:"#js-giftcode-error-detail",giftcodeShow:"#js-giftcode-response",giftcodeDiscount:"#js-giftcode-discount",giftcodeBlockPopup:"#js-giftcode-block",giftcodeRemove:"#js-giftcode-remove",giftcodeAllRemove:"#js-giftcode-redeem",cartDetail:".js-payment-method-cart-detail",paymentoptionFragment:".js-paymentoption-fragment-form",paymentoptions:"#vinPaymentDetailsForm",giftcodeDiv:"#js-giftcode-redemption"}},_autoload:["initElements","bindMoreGiftcodeBlockPopup","bindApplyGiftcode","bindRemoveGiftcode","bindRefreshCartDetail","bindGiftCodeBox","bindRemoveAllGiftcode"],initElements:function(){ACC.common.loadModuleElements(ACC.giftcoderedeem)},bindMoreGiftcodeBlockPopup:function(){$(ACC.giftcoderedeem._config.element.giftcodeBlockPopup).popover()},bindGiftCodeBox:function(){$(document).on("change",".js-giftcode-checkout-block input",function(event){var checked=$(this).is(":checked"),$block=$(this).closest(".checkout-block").find(".checkout-block__body");checked?(0==ACC.giftcoderedeem.isInitPopover&&(ACC.giftcoderedeem.isInitPopover=!0,ACC.checkout.initPopover()),$block.stop().slideDown()):$block.stop().slideUp()})},bindApplyGiftcode:function(){$(document).on("keydown",".js-giftcode-input, .js-giftcode-submit-form-btn",function(e){if(13==e.keyCode)return e.preventDefault(),$(".js-giftcode-submit-form-btn").click(),!1}),$(document).on("click",".js-giftcode-submit-form-btn",function(event){event.preventDefault();var giftcode=$(document).find(ACC.giftcoderedeem._config.element.giftcodeValue).val(),popup=$(document).find(ACC.giftcoderedeem._config.element.giftcodeSuccessPopup).last();$.ajax({url:ACC.config.applyGiftcodeUrl+"?giftcode="+giftcode,type:"post",data:{CSRFToken:ACC.config.CSRFToken},dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){$.blockUI()},complete:function(){$.unblockUI()},success:function(data){"timedout"==data.result&&location.reload(!0),ACC.giftcoderedeem.processResultData(data,popup),window.mediator.publish("refreshPaymentOptionsInPaymentMethod")}})})},bindRemoveGiftcode:function(){$(document).on("click",ACC.giftcoderedeem._config.element.giftcodeRemove,function(event){event.preventDefault(),$.blockUI();var popup=this.closest(ACC.giftcoderedeem._config.element.giftcodeSuccessPopup),giftcode=$(popup).find(ACC.giftcoderedeem._config.element.giftcodeShow).text();$.ajax({url:ACC.config.removeGiftcodeUrl+"?giftcode="+giftcode,type:"post",data:{CSRFToken:ACC.config.CSRFToken},contentType:"application/json; charset=utf-8",beforeSend:function(){$.blockUI()},complete:function(){$.unblockUI()},success:function(data){$.unblockUI(),$(popup).addClass("hide"),window.mediator.publish("refreshAppliedGiftcode"),window.mediator.publish("refreshCartInPaymentMethod"),window.mediator.publish("refreshPaymentOptionsInPaymentMethod")},error:function(data,textStatus,errorThrown){$.unblockUI()}})})},bindRemoveAllGiftcode:function(){$(document).on("change",ACC.giftcoderedeem._config.element.giftcodeAllRemove,function(event){$(this).is(":checked")||$.ajax({url:ACC.config.removeAllGiftcodeUrl,type:"post",data:{CSRFToken:ACC.config.CSRFToken},success:function(data,textStatus,xhr){200==xhr.status&&(window.mediator.publish("refreshCartInPaymentMethod"),window.mediator.publish("refreshPaymentOptionsInPaymentMethod"),ACC.giftcoderedeem.resetSuccess(),ACC.giftcoderedeem.resetError())}})})},processResultData:function(response,divSuccess){if("ACTIVE"==response.result){if(response.isRefeshAppliedCodes)window.mediator.publish("refreshAppliedGiftcode");else{ACC.giftcoderedeem.resetError();var newDivSuccess=$(divSuccess).clone(!0,!0);newDivSuccess.find(ACC.giftcoderedeem._config.element.giftcodeShow).html(response.giftCode),newDivSuccess.removeClass("hide"),newDivSuccess.find(ACC.giftcoderedeem._config.element.giftcodeDiscount).html(response.couponMessage),$(document).find(ACC.giftcoderedeem._config.element.giftcodeValue).val(""),$(newDivSuccess.get(0).outerHTML).insertAfter($(divSuccess))}response.isRefundAndReem?ACC.vinidredeem.refundAndRedeemVinID():window.mediator.publish("refreshCartInPaymentMethod")}else"INACTIVE"==response.result?(ACC.giftcoderedeem.resetError(),$(document).find(ACC.giftcoderedeem._config.element.giftcodeErrorPopup).html(response.couponDescription),$(document).find(ACC.giftcoderedeem._config.element.giftcodeErrorMessage).removeClass("hide"),$(document).find(ACC.giftcoderedeem._config.element.giftcodeErrorMessage).html(response.couponMessage),$(document).find(ACC.giftcoderedeem._config.element.giftcodeValue).val("")):"INVALID"==response.result&&(ACC.giftcoderedeem.resetError(),$(document).find(ACC.giftcoderedeem._config.element.giftcodeErrorMessage).removeClass("hide"),$(document).find(ACC.giftcoderedeem._config.element.giftcodeErrorMessage).html(response.couponMessage),$(document).find(ACC.giftcoderedeem._config.element.giftcodeValue).val(""))},resetError:function(){$(document).find(ACC.giftcoderedeem._config.element.giftcodeErrorMessage).addClass("hide"),$(document).find(ACC.giftcoderedeem._config.element.giftcodeErrorPopup).removeClass("in")},resetSuccess:function(){$(document).find(ACC.giftcoderedeem._config.element.giftcodeSuccessPopup).addClass("hide")},bindRefreshCartDetail:function(){window.mediator.subscribe("refreshCartInPaymentMethod",function(){var $showIconLoad=$(".js-payment-method-cart-detail .sidebar-product__order .iconLoad");$showIconLoad.show(),$.get(ACC.config.refreshCartUrl,function(result){$showIconLoad.hide(),result&&$(ACC.giftcoderedeem._config.element.cartDetail).html(result)})}),window.mediator.subscribe("refreshPaymentOptionsInPaymentMethod",function(){var paymentOptionUrl=ACC.config.refreshPaymentOptionsUrl;"undefined"!=typeof currentStepCheckout&&(paymentOptionUrl=paymentOptionUrl+"/?currentstep="+currentStepCheckout),$.get(paymentOptionUrl,function(result){if(result){var doc=$(result);if(void 0!==doc){var el=doc.find(".oneclickoptionhaserror");if(el&&el.length>0){var url=ACC.config.encodedContextPath+"/checkout/multi/payment-method/add";return void window.location.replace(url)}}var $form=$(ACC.giftcoderedeem._config.element.paymentoptions).find(".js-checkout-paymentoption-fragment"),$clone=$form.clone(!0),$formInDoc=doc.find(".js-checkout-paymentoption-fragment");$clone.html($formInDoc.html()),$form.replaceWith($clone);var $this=$(".js-payment-method .adr-radio-input");if($this.each(function(index){var $parent=$(this).parents(".checkout-payment-methods"),$detail=$(this).parents(".js-payment-method").siblings(".checkout-payment-method-detail");$(this).is(":checked")&&($detail.slideDown(),$parent.find(".checkout-payment-method-detail").not($detail).slideUp())}),void 0!==doc&&void 0!=doc[0])for(var scripts=doc[0].getElementsByTagName("script"),i=0;i<scripts.length;++i){var script=scripts[i];eval(script.innerHTML)}ACC.checkout.initInstallmentPeriod()}})}),window.mediator.subscribe("refreshAppliedGiftcode",function(){$.get(ACC.config.refreshAppliedGiftcode,function(result){result&&$(ACC.giftcoderedeem._config.element.giftcodeDiv).html(result)})})}},ACC.autocreateuser={_config:{element:{passwordSubmit:"#js-auto-create-password-form",passwordValue:".js-auto-create-user-password-input",passwordError:".js-auto-create-password-error",passwordDialog:"#js-auto-create-user-password",otpDialog:"#js-auto-create-user-otp",otpValue:".js-auto-create-user-otp-input",otpCancel:".js-auto-create-user-otp-cancel",otpSubmit:"#js-auto-create-user-otp-form",otpResend:".js-auto-create-user-otp-resend",otpResendMessage:".js-auto-create-user-otp-resend-message",otpError:".js-auto-create-user-otp-error",phone:".js-auto-create-user-phone"}},_autoload:["initElements","showSetPasswordDialog","bindPasswordSubmit","bindResendOtp","bindOtpSubmit"],initElements:function(){ACC.common.loadModuleElements(ACC.autocreateuser)},bindPasswordSubmit:function(){$(document).on("submit",ACC.autocreateuser._config.element.passwordSubmit,function(event){event.preventDefault(),$.blockUI(),$(ACC.autocreateuser._config.element.passwordError).text("");var passwordValue=$(ACC.autocreateuser._config.element.passwordValue).val(),data={password:passwordValue,CSRFToken:ACC.config.CSRFToken};$.ajax({url:ACC.config.setPasswordUrl,type:"post",data:JSON.stringify(data),dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){$.unblockUI(),$(ACC.autocreateuser._config.element.passwordDialog).modal("hide"),0!=$(ACC.autocreateuser._config.element.otpDialog).length?(ACC.autocreateuser.sendOtp(),ACC.captcha.renderWidgetForPopup("js-auto-create-user-otp-captcha"),$(ACC.autocreateuser._config.element.otpDialog).modal("show")):(ACC.login.updateUserInfo(!0),ACC.suggestvinid.processSuggestVinID($(ACC.autocreateuser._config.element.phone).text()))},error:function(data,textStatus,errorThrown){$.unblockUI(),$(ACC.autocreateuser._config.element.passwordError).text(data.responseJSON)}})})},sendOtp:function(){ACC.otp.sendADROTP({type:ACC.config.otpRequestType.AUTO_CREATE_VERIFY_PHONE,resend:!1,username:$(ACC.autocreateuser._config.element.phone).text(),CSRFToken:ACC.config.CSRFToken},ACC.otp.func.autoCreate)},bindResendOtp:function(){$(document).on("click",ACC.autocreateuser._config.element.otpResend,function(e){e.preventDefault(),$.blockUI(),ACC.autocreateuser.hideError();var phone=$(ACC.autocreateuser._config.element.phone).text();ACC.otp.sendADROTP({type:ACC.config.otpRequestType.AUTO_CREATE_VERIFY_PHONE,resend:!0,username:phone,CSRFToken:ACC.config.CSRFToken
},ACC.otp.func.autoCreate).then(function(response){$.unblockUI(),$(ACC.autocreateuser._config.element.otpResendMessage).removeClass("hide"),ACC.autocreateuser.hideError(),ACC.login.updateUserInfo(!0)},function(jqXHR){$.unblockUI(),$(ACC.autocreateuser._config.element.otpResendMessage).addClass("hide"),ACC.autocreateuser.showError(jqXHR.responseJSON.message)})})},bindOtpSubmit:function(){$(document).on("submit",ACC.autocreateuser._config.element.otpSubmit,function(event){event.preventDefault(),$.blockUI(),ACC.autocreateuser.hideError();var otpValue=$(ACC.autocreateuser._config.element.otpValue).val(),data=JSON.stringify({otpCode:otpValue,CSRFToken:ACC.config.CSRFToken}),url=ACC.config.autoCreateVerifyOtpUrl+"?g-recaptcha-response="+ACC.captcha.getResponse("js-auto-create-user-otp-captcha");$.postJSONCallback(url,data,function(result){$.unblockUI(),$(ACC.autocreateuser._config.element.otpDialog).modal("hide"),ACC.suggestvinid.processSuggestVinID($(ACC.autocreateuser._config.element.phone).text())},function(jqXHR){$.unblockUI(),ACC.autocreateuser.showError(jqXHR.responseJSON.message),ACC.captcha.reset("js-auto-create-user-otp-captcha")})})},showSetPasswordDialog:function(){var setPasswordDialog=$(ACC.autocreateuser._config.element.passwordDialog);0!=setPasswordDialog.length&&(setPasswordDialog.modal("show"),window.onbeforeunload=function(){$.postJSONCallback("/checkout/auto-create/sendPassword",function(){})})},showError:function(msg){$(ACC.autocreateuser._config.element.otpError).html(msg),$(ACC.autocreateuser._config.element.otpError).show()},hideError:function(){$(ACC.autocreateuser._config.element.otpError).hide()}},ACC.adrLandingPage={_autoload:[["initNav",$(".lp-section.lp-navigation").length>0],["initPopupYoutubeLandingPage",$(".popup__open-youtube-ldpage").length>0],["bindTabOnClick",$(".js-lb-tab-component").length>0],["handleHashPart",$(".pageType-LandingPage").length>0]],initNav:function(){var _this=this;$("body").width()>=parseInt(screenSm)?_this.calculateNav():$("#js-lp-navigation").addClass("calculated")},initTabGroup:function(){var activeTab=window.location.hash;if(""!=activeTab)$(".js-lb-tab-component .tab-pane").removeClass("active"),$(activeTab).addClass("active");else{var firstTab=$(".call-witch-tab").eq(0);activeTab=$(firstTab).attr("data-target"),$(firstTab).addClass("active"),$(activeTab).addClass("active");var $firstTabChild=$(".lp-product-header-tabs li");$firstTabChild.removeClass("active"),$firstTabChild.eq(0).addClass("active")}},bindTabOnClick:function(){$(".call-witch-tab").on("shown.bs.tab",function(e){var hash=$(e.target).attr("href");hash||(hash=$(this).data("target"));var tabid=hash.replace("#",""),curr_page=window.location.href.substr(0,window.location.href.indexOf("#")),reload_page="";reload_page=curr_page.indexOf("tabid")>-1?curr_page.replace(/(tabid=).*/,"$1"+tabid)+hash:curr_page.indexOf("?")>-1?curr_page+"&tabid="+tabid+hash:curr_page+"?tabid="+tabid+hash,window.location.href=reload_page})},initPopupYoutubeLandingPage:function(){$(".popup__open-youtube-ldpage").click(function(){$(".popup__open-youtube .modal").modal("show");var $this=$(this),$iframe=$("<iframe>").attr("src",$this.data("link")),$title=$("<h1>").text($this.data("title")).css("display","none");$("#video-view .modal-body").html($title).append($iframe),$iframe.wrap("<div class='class-video embed-responsive embed-responsive-16by9'>")})},calculateNav:function(){var $nav,$dropDown,navWidth,$parent=$("#js-lp-navigation"),tmpWidth=0;$nav=$parent.find(".navbar-main"),$dropDown=$parent.find(".navbar-more li.dropdown .dropdown-menu"),$dropDown.find("> li").appendTo($nav),$navItems=$nav.find("> li"),navWidth=$nav.width(),$navItems.each(function(){var w,$item=$(this);w=$item.outerWidth(),(tmpWidth+=w)>=navWidth&&($item.prependTo($dropDown),$dropDown.parents(".navbar-more").show())}),$parent.addClass("calculated")},handleHashPart:function(){var $hashPart=window.location.hash,$this=($hashPart.substring($hashPart.indexOf("#")+0),$(".call-witch-tab"));$this.each(function(){var $link=$(this).attr("data-target");return $link!=$hashPart||($(this).parent().addClass("active"),!1)})}},ACC.CSRF={_autoload:[],initPull:function(){this.updateCSRF()},updateCSRF:function(){return $.ajax({type:"GET",url:"/getCSRF",success:function(result){null!=result&&void 0!=result&&result!=ACC.config.CSRFToken&&(ACC.config.CSRFToken=result)}})}},ACC.mobileCharge={_autoload:[["init",$(".mobile-charge").length>0]],currentProvider:_.isEmpty(ACC.topup)||_.isEmpty(ACC.topup.currentProvider)?"VT":ACC.topup.currentProvider,currentProviderByPhone:_.isEmpty(ACC.topup)||_.isEmpty(ACC.topup.currentProvider)?"VT":ACC.topup.currentProvider,currentProviderPlanCode:_.isEmpty(ACC.topup)||_.isEmpty(ACC.topup.currentCardProductNumber)?"50":ACC.topup.currentCardProductNumber,topupTypes:{BUYCARD:"BUYCARD",TOPUP:"TOPUP"},errorCodes:{LESS_THAN_MIN_QTY:"VIN_CORE_099",LARGER_THAN_MAX_QTY:"VIN_CORE_100"},init:function(){ACC.mobileCharge.loadProviderOffers(ACC.mobileCharge.currentProvider,ACC.mobileCharge.currentProviderPlanCode).then(function(){$(".js-mobile-charge__providers .mobile-charge__provider-item").each(function(){var provider=$(this).attr("data-topup-service-provider");ACC.mobileCharge.checkProviderState(provider)})}),$(window).on("load",_.debounce(ACC.mobileCharge.calculateTotalPriceFromOffer,ACC.requests.timeout)),$(document).on("click",".js-mini-cart-close-button, .js-mini-cart-off",function(e){var $body=$("body");e.preventDefault(),ACC.colorbox.close(),$body.removeClass("modal-open")}),$(".list-number li").on("click",function(){var $getPhone=$(this).text();$("#number-phone").val($getPhone),$(".js-mobile-charge__phone-number").trigger("change")}),$(".js-mobile-charge__phone-number").on("input change",function(){var $this=$(this),text=$.trim($this.val()),listPrefix=_.flatten(_.toArray(ACC.topup.phonePrefixNumberConfig)),numberInPrefix=!1,providerByPhone=!1,validatePrefix=ACC.mobileCharge.matchStartNumber(text,listPrefix);0===text.length&&($("#js-card-submit").attr("disabled","true"),$this.siblings(".mobile-charge__input-error-2").hide().html(""),$this.siblings(".mobile-charge__input-error").show().html("Số điện thoại không được để trống.")),text.length>0&&0==validatePrefix?($this.siblings(".mobile-charge__input-error").hide().html(""),$this.siblings(".mobile-charge__input-error-2").show().html(ACC.message.topupProviderNotSupport),$("#js-card-submit").attr("disabled","true")):$this.siblings(".mobile-charge__input-error-2").hide().html(""),text&&!/^(84|0)((1(2([0-9])|6([2-9])|86|88|99))|(9([0-9]))|((86|88|89)))([0-9]{7})$/.test(text)?($this.siblings(".mobile-charge__input-error-2").hide().html(""),$this.siblings(".mobile-charge__input-error").show().html("Số điện thoại không đúng định dạng."),$("#js-card-submit").attr("disabled","true")):($this.siblings(".mobile-charge__input-error").hide().html(""),_.each(ACC.topup.phonePrefixNumberConfig,function(prefixes,key,list){_.each(prefixes,function(prefix){if(0===text.indexOf(prefix)){numberInPrefix=!0,providerByPhone=key,ACC.mobileCharge.currentProviderByPhone=providerByPhone,$("#js-card-submit").removeAttr("disabled");var providerTpl=_.template(".js-mobile-charge__providers a<%= providerAttr %>"),$selectedProvider=$(providerTpl({providerAttr:_.template('[data-topup-service-provider="<%= provider %>"]')({provider:providerByPhone})}));if(!$selectedProvider.hasClass("disabled")){$(providerTpl({providerAttr:""})).removeClass("active"),$selectedProvider.addClass("active");var planCode=$selectedProvider.attr("data-current-code");ACC.mobileCharge.loadProviderOffers(providerByPhone,planCode).then(function(){ACC.mobileCharge.renderQuantitySelectBox(),ACC.mobileCharge.calculateTotalPriceFromOffer()})}}})}))}),$(".js-mobile-charge__providers").each(function(){$(this).find(".mobile-charge__provider-item").on("click",function(event){event.preventDefault();var $this=$(this),provider=$this.attr("data-topup-service-provider"),currentCode=$(this).attr("data-current-code"),$numberPhone=($("#provide-phone").val(),$.trim($(".js-mobile-charge__phone-number").val()));ACC.mobileCharge.loadProviderOffers(provider,currentCode).then(function(){ACC.mobileCharge.renderQuantitySelectBox(),ACC.mobileCharge.calculateTotalPriceFromOffer(),$this.hasClass("disabled")||$this.addClass("active").parents(".mobile-charge__providers").find(".active").not($this).removeClass("active"),$numberPhone.length<1&&$(".js-mobile-charge__phone-number").siblings(".mobile-charge__input-error").show().html("Số điện thoại không được để trống.")})})}),$(document).on("click",".js-mobile-charge__price .mobile-charge__price-item",function(event){event.preventDefault();var $this=$(this),code=$this.attr("data-code"),currentQty=$this.attr("data-quantity"),quantityHtml=ACC.template.topup.offerQuantity({minOrderQty:$this.attr("data-min"),maxOrderQty:$this.attr("data-max"),availableToSell:$this.attr("data-available"),currentQuantity:currentQty});ACC.mobileCharge.currentProviderPlanCode=code,$(".mobile-charge__provider-item").attr("data-current-code",code),$(".js-qty-selector.js-product-order__quanity").replaceWith(quantityHtml),$this.addClass("active").parents(".js-mobile-charge__price").find(".active").not($this).removeClass("active"),ACC.mobileCharge.renderQuantitySelectBox(currentQty);var priceObj={type:$('input[name="charge-type"]:checked').val(),quantity:currentQty,price:$this.attr("data-price"),dom:"#js-card-total"};ACC.mobileCharge.calculateTotalPrice(priceObj)}),$(document).on("change",'#js-mobile-charge__type input[type="radio"]',function(){var dom,$this=$(this),type=$this.val();switch($("#js-mobile-charge__topup .js-mobile-charge__price .mobile-charge__price-item").trigger("change"),type){case ACC.mobileCharge.topupTypes.BUYCARD:dom="#js-mobile-charge__prepaid .js-mobile-charge__price .mobile-charge__price-item";break;case ACC.mobileCharge.topupTypes.TOPUP:dom="#js-mobile-charge__topup .js-mobile-charge__price .mobile-charge__price-item"}if($this.is(":checked")){var $topup=$("#js-mobile-charge__topup"),$prepaid=$("#js-mobile-charge__prepaid"),$message=$(".mobile-charge__input-hint");type===ACC.mobileCharge.topupTypes.BUYCARD?($prepaid.removeClass("hidden"),$topup.addClass("hidden"),$message.addClass("hidden"),$(".bye-cart").show(),$(".top-up").hide()):type===ACC.mobileCharge.topupTypes.TOPUP&&($message.removeClass("hidden"),$topup.removeClass("hidden"),$prepaid.addClass("hidden"),$(".top-up").show(),$(".bye-cart").hide()),ACC.mobileCharge.loadProviderOffers(ACC.mobileCharge.currentProviderByPhone,ACC.mobileCharge.currentProviderPlanCode).then(function(){ACC.mobileCharge.calculateTotalPriceFromOffer()})}$(dom).attr("data-type",type)}),$(document).on("change keyup","#pdpAddtoCartSelect,#pdpAddtoCartInput",function(){var val=$(this).val();isNaN(val)&&"pdpAddtoCartInput"===val&&(val=ACC.mobileCharge.getQuantity()),ACC.mobileCharge.updateQuantityDataOfAllPlan(val),ACC.mobileCharge.calculateTotalPriceFromOffer()}),$("#js-card-submit").on("click",function(e){e.preventDefault(),ACC.mobileCharge.addToInstantCart()})},getCurrentProviderElm:function(){return $(".js-mobile-charge__providers").find(".mobile-charge__provider-item.active")},updateQuantityDataOfAllPlan:function(val){$(".js-mobile-charge__price .mobile-charge__price-item").each(function(index,item){var availableToSell=$(item).attr("data-available"),minQty=$(item).attr("data-min"),maxQty=$(item).attr("data-max"),isOnsite=$(item).attr("data-onsite"),maxAvailableQty=availableToSell,availableQty=1;isOnsite&&(void 0!==maxQty&&""!=maxQty&&(maxAvailableQty=Math.min(availableToSell,maxQty)),void 0!==minQty&&""!=minQty?availableQty=Math.min(availableToSell,minQty):minQty=1,val>=parseInt(minQty)&&val<=parseInt(maxAvailableQty)?$(item).attr("data-quantity",val):val>parseInt(maxAvailableQty)?$(item).attr("data-quantity",maxAvailableQty):$(item).attr("data-quantity",availableQty))})},addToInstantCart:function(){$.blockUI();var topupPhone=ACC.mobileCharge.getTopupPhone(),quantity=ACC.mobileCharge.getQuantity(),offerCode=ACC.mobileCharge.getOfferCode();if(""===offerCode||void 0===offerCode)return $.unblockUI(),ACC.mobileCharge.showMessage(ACC.mobileCharge.getEmptyOfferCodeMessage()),!1;$.ajax({url:ACC.config.topup.addToCartUrl,method:"POST",data:{topupPhone:topupPhone,productCodePost:offerCode,qty:quantity}}).then(function(res){res.hasError?($.unblockUI(),ACC.mobileCharge.showMessage(res.addToCartLayer),res.errorCode!=ACC.mobileCharge.errorCodes.LESS_THAN_MIN_QTY&&res.errorCode!=ACC.mobileCharge.errorCodes.LARGER_THAN_MAX_QTY||ACC.mobileCharge.reloadQuantityAndSetDefaultBy(res.errorCode)):window.location.href=ACC.config.contextPath+"/checkout?adrIC="+res.cartAnalyticsData.cartCode},function(jqXHR){$.unblockUI(),"403"==jqXHR.status&&ACC.CSRF.updateCSRF().then(function(){ACC.mobileCharge.addToInstantCart()})})},loadProviderOffers:function(provider,currentCode,dom){if(!_.isUndefined(provider)){_.isUndefined(currentCode)&&(currentCode="");var offersObj={data:{type:$('input[name="charge-type"]:checked').val(),provider:provider,phone:$(".js-mobile-charge__phone-number").val()}};if(_.isUndefined(dom))switch(offersObj.data.type){case ACC.mobileCharge.topupTypes.BUYCARD:dom="#js-mobile-charge__prepaid .js-mobile-charge__price";break;case ACC.mobileCharge.topupTypes.TOPUP:dom="#js-mobile-charge__topup .js-mobile-charge__price";break;default:dom="#js-mobile-charge__prepaid .js-mobile-charge__price"}var offerReq=ACC.requests.topup.getOffers(offersObj);return offerReq.done(function(res){if(!_.isEmpty(res)){var offersHtml='<div class="row">';if(_.each(res.topupOffers,function(offer){var state=currentCode===offer.topupPlanCode?" active ":" ";state=offer.isOnsite?state:" disabled ";var quantity=offer.isOnsite?ACC.mobileCharge.getQuantity():0;quantity=isNaN(quantity)?1:quantity;var minAvailableQty=Math.min(offer.availableToSell,offer.minOrderQuantity),maxAvailableQty=Math.min(offer.availableToSell,offer.maxOrderQuantity);offer.isOnsite&&(quantity<minAvailableQty?quantity=minAvailableQty:quantity>maxAvailableQty&&(quantity=maxAvailableQty)),offersHtml+=ACC.template.topup.offer({type:offersObj.data.type,min:offer.minOrderQuantity,max:offer.maxOrderQuantity,available:offer.availableToSell,offer:offer.offerCode,code:offer.topupPlanCode,label:offer.topupPlanLabel,provider:res.currentProvider,price:offer.price,quantity:quantity,active:state,onsite:offer.isOnsite})}),offersHtml+="</div>",void 0!==res.topupOffers){_.every(res.topupOffers,function(offer){return!offer.isOnsite})&&"BUYCARD"===offersObj.data.type&&$('.mobile-charge__provider-item[data-topup-service-provider="'+provider+'"]').addClass("disabled").removeClass("active")}_.isElement($(dom)[0])&&$(dom).html(offersHtml)}}),offerReq}},checkProviderState:function(provider,currentCode){if(!_.isUndefined(provider)){_.isUndefined(currentCode)&&(currentCode="");var offersObj={data:{type:$('input[name="charge-type"]:checked').val(),provider:provider,phone:$(".js-mobile-charge__phone-number").val()}},offerReq=ACC.requests.topup.getOffers(offersObj);return offerReq.done(function(res){if(!_.isEmpty(res)){return _.every(res.topupOffers,function(offer){return!offer.isOnsite})?void $('.mobile-charge__provider-item[data-topup-service-provider="'+provider+'"]').addClass("disabled"):void 0}}),offerReq}},renderQuantitySelectBox:function(currentQty){var $currOffer=ACC.mobileCharge.getCurrentOfferDom(),currentQuantity=_.isUndefined(currentQty)?$currOffer.attr("data-quantity"):currentQty,quantityHtml=ACC.template.topup.offerQuantity({minOrderQty:$currOffer.attr("data-min"),maxOrderQty:$currOffer.attr("data-max"),availableToSell:$currOffer.attr("data-available"),currentQuantity:currentQuantity});$(".js-qty-selector.js-product-order__quanity").replaceWith(quantityHtml);var optionsOfSelectBox=$(".product-order__quanity-select option");if(void 0!==optionsOfSelectBox&&null!=optionsOfSelectBox&&optionsOfSelectBox.length>0){var length=optionsOfSelectBox.length;if("pdpAddtoCartInput"==optionsOfSelectBox[length-1].value&&length>2){var maximumSelectedOption=optionsOfSelectBox[length-2].value;!isNaN(maximumSelectedOption)&&currentQuantity>parseInt(maximumSelectedOption)&&($(".product-order__quanity-select").val("pdpAddtoCartInput").change(),$(".js-qty-selector-input").val(currentQuantity).change())}}},getEmptyOfferCodeMessage:function(){var html='<div id="addToCartLayer" class="add-to-cart cart">';return html+='<div class="cart_popup_error_msg">',html+='<p class="alert alert-warning ">',html+='<i class="adr-icon icon-warning" style="top:0;"></i>',html+=ACC.topup.emptyTopupOfferMessage,html+="</p>",html+="</div>",html+='<a href="javascript:void(0);" class="js-mini-cart-off"></a>',html+="</div>"},reloadQuantityAndSetDefaultBy:function(errorCode){var currentProviderElm=ACC.mobileCharge.getCurrentProviderElm();if(!_.isUndefined(currentProviderElm)){var currentPlanCode=$(currentProviderElm).attr("data-current-code"),currentProvider=$(currentProviderElm).attr("data-topup-service-provider");ACC.mobileCharge.loadProviderOffers(currentProvider,currentPlanCode).then(function(res){if(errorCode==ACC.mobileCharge.errorCodes.LARGER_THAN_MAX_QTY){var currentPlan=ACC.mobileCharge.getCurrentPlanCodeBy(res.topupOffers,currentPlanCode);ACC.mobileCharge.renderQuantitySelectBox(currentPlan.maxOrderQuantity)}else ACC.mobileCharge.renderQuantitySelectBox();ACC.mobileCharge.calculateTotalPriceFromOffer()})}},getCurrentPlanCodeBy:function(topupOffers,planCode){var currentOffer={};return $.each(topupOffers,function(index,offer){if(planCode==offer.topupPlanCode)return currentOffer=offer,!1}),currentOffer},showMessage:function(textHtml){$.colorbox({html:textHtml,maxWidth:"100%",width:"335px",initialWidth:"120px",className:"error-limit-quanity",closeButton:!1})},calculateTotalPrice:function(priceObj){_.defaults(priceObj,{type:ACC.mobileCharge.topupTypes.BUYCARD,quantity:1,price:0,dom:""});var totalFormat,total=0;switch((isNaN(priceObj.price)||_.isEmpty(priceObj.price))&&(priceObj.price=0),_.isEmpty(priceObj.quantity)&&(priceObj.quantity=1),priceObj.type){case ACC.mobileCharge.topupTypes.BUYCARD:total=priceObj.price*parseInt(priceObj.quantity);break;case ACC.mobileCharge.topupTypes.TOPUP:total=1*priceObj.price;break;default:total=priceObj.price}return totalFormat=ACC.mobileCharge.addCommas(total),_.isElement($(priceObj.dom)[0])&&$(priceObj.dom).html(totalFormat),totalFormat},calculateTotalPriceFromOffer:function(priceObj){var type=$('input[name="charge-type"]:checked').val(),currOffer=_.template(".js-mobile-charge__price .mobile-charge__price-item.active<%= typeAttr %>")({typeAttr:_.template('[data-type="<%= type %>"]')({type:type})}),$currOffer=$(currOffer),priceObj=priceObj||{};_.defaults(priceObj,{type:type,quantity:$currOffer.attr("data-quantity"),price:$currOffer.attr("data-price"),dom:"#js-card-total"}),ACC.mobileCharge.calculateTotalPrice(priceObj)},getQuantity:function(){if($('input[name="charge-type"]:checked').val()==ACC.mobileCharge.topupTypes.TOPUP)return 1;var qty=$("#pdpAddtoCartSelect").val();return"pdpAddtoCartInput"===qty&&(qty=$("#pdpAddtoCartInput").val()),qty=parseInt(qty)},getCurrentOfferDom:function(){var type=$('input[name="charge-type"]:checked').val(),currOffer=_.template(".js-mobile-charge__price .mobile-charge__price-item.active<%= typeAttr %>")({typeAttr:_.template('[data-type="<%= type %>"]')({type:type})});return $(currOffer)},getOfferCode:function(){return ACC.mobileCharge.getCurrentOfferDom().attr("data-offer")},getTopupPhone:function(){return $("#number-phone").val()},addCommas:function(nStr){nStr+="",x=nStr.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var rgx=/(\d+)(\d{3})/;rgx.test(x1);)x1=x1.replace(rgx,"$1.$2");return x1+x2},matchStartNumber:function(num,numbers){for(var ix in numbers)if(num.startsWith(""+numbers[ix]))return!0;return!1}},ACC.captcha={enable:!1,siteKey:null,isLoaded:!1,recaptchaRendered:{},loadScriptAndBindAll:function(){$.ajax({url:ACC.config.encodedContextPath+"/register/captcha/widget/recaptcha",type:"GET",async:!1,cache:!1,success:function(html){if(html&&""!=html.trim()){ACC.captcha.enable=!0;var widget=$(html);widget.appendTo(".js-recaptcha-Vinrocketcaptcha"),ACC.captcha.siteKey=widget.filter(".g-recaptcha_widget").data("sitekey"),$.getScript("https://www.google.com/recaptcha/api.js?hl="+document.documentElement.lang,function(){"false"==$(".recaptchaChallangeAnswered").val()&&$(".g-recaptcha_incorrect").show()})}}})},waitGreCaptcha:function(){ACC.captcha.loadScriptAndBindAll();var d=jQuery.Deferred(),doCheckGrecaptcha=function(){"undefined"==typeof grecaptcha?setTimeout(doCheckGrecaptcha,100):d.resolve()};return doCheckGrecaptcha(),d.promise()},renderWidget:function(widgetId){ACC.captcha.waitGreCaptcha().then(function(){if(ACC.captcha.enable&&grecaptcha&&void 0==ACC.captcha.recaptchaRendered[widgetId]){var captcha=grecaptcha.render(widgetId,{sitekey:ACC.captcha.siteKey});ACC.captcha.recaptchaRendered[widgetId]=captcha}})},renderWidgetForPopup:function(widgetId){ACC.captcha.waitGreCaptcha().then(function(){if(ACC.captcha.enable&&grecaptcha){var captcha=grecaptcha.render(widgetId,{sitekey:ACC.captcha.siteKey});ACC.captcha.recaptchaRendered[widgetId]=captcha}})},reset:function(widgetId){if(ACC.captcha.enable&&grecaptcha&&void 0!=ACC.captcha.recaptchaRendered[widgetId]){var weId="#"+widgetId+"-error";$(weId).html(""),$(weId).hide(),grecaptcha.reset(ACC.captcha.recaptchaRendered[widgetId])}},getResponse:function(widgetId){return ACC.captcha.enable&&grecaptcha?grecaptcha.getResponse(ACC.captcha.recaptchaRendered[widgetId]):""},showError:function(widgetId,msg){if(ACC.captcha.enable&&grecaptcha){var weId="#"+widgetId+"-error";$(weId).html(msg),$(weId).show()}}},$(function(){_autoload()});